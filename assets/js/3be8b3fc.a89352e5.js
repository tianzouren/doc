"use strict";(self.webpackChunkdoc=self.webpackChunkdoc||[]).push([[2263],{1542:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_32-d1956ea7e626cd3d58138968b39530aa.png"},2629:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756684381469-1a8ac8d65d549a14b8171a1fbc5df49a.png"},3581:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741208371-be532883482f42d03d1c25a24a447c41.png"},4795:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756682644061-aef8bb1d00be24b3f3e77c633a3bc420.png"},5613:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_22-b34b88f38285300421eb2b91ed692a55.png"},6492:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_38-9a73a0bfaeab8dedc0b52c3765b3fc5f.png"},6576:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741899345-e3d0d588e2909299176d5e0ac5c1f9ce.png"},8635:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741244328-3996092cf952e85fb852e8743269e527.png"},8751:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_2-1d77f617164524b75e7a34377fb54b82.png"},9571:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741810158-8ee51d7dadb205192088b4054bbdffb5.png"},10084:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741838018-062e6e3b7f6f6c01eaf243fa8e853145.png"},10412:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756682598255-c45bff9af0765e4735f807c32ff22356.png"},12064:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733087675-0807793dd16eebdb3e3524ffccd62180.png"},12697:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756684447804-a35a80fafe885e9c94ac2093e5633fbb.png"},12981:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733923796-f8eb9ea70ad5b435dd4e257a2d431811.png"},13128:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756683233212-eb08a0c805c946110f79a19eac88209a.png"},13193:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736994405-da1ff842971e0eecfd5e83ca665e873e.png"},13678:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756742328433-8554a5e374d5a09c39a74b2760405fec.png"},13734:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756735321906-6e69bf8decc279420c19117f5609b105.png"},14086:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756734563389-58524cd1c6c95054fccec62196019fdb.png"},14626:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_7-f5365c472a8ed5aad0029804e0725117.png"},14881:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732868180-b0ba2efea7578021e6d4fdacf0e28a4f.png"},14934:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_21-3ae9673ec5f3a7c9772dd95ab807e900.png"},15450:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756685011005-1bdb928205827ed687e43ffa9e99171f.png"},15458:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756735436275-553131a25644fc9fd7a4dae204f549f5.png"},15979:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_37-8be30df62b1b542841fa118e191e472f.png"},16234:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737539886-821d713ab4e9aed88965cbc9f43cec08.png"},16574:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736205571-5356edc58a293a1fd7865bbf7741af26.png"},16624:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736824682-6f34a840b4f4d4cf05edb265f4d77022.png"},16749:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741370982-d6edfd176c1fde9f0e650d8a0439eafd.png"},17206:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756684416650-5241252e302a2ae014570b76ea0d8e26.png"},17263:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732204911-d86a1c395b40bc83ec181aac50ce499e.png"},18677:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732172001-be7e31eff36ad3a51e2174a3099d11eb.png"},20897:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733143093-193d7c6e9a9f7f7631a17830cb807525.png"},21559:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736455102-94241128d39cd2a423b62da3ab273d16.png"},21878:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756734292238-2fe8e513ece8a42ad2d88bc3b96b5247.png"},22814:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737423334-7243b99a2b2bf79ca74ee056cd9b9b39.png"},23317:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737573634-9c0e52555e0525b77bb3cf54471596f4.png"},23475:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756684702329-a9a1d0a3baf8743347a15c799f87bda2.png"},23586:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756682689243-7f5d451d7da99035c7456dcc4114d233.png"},23654:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_3-1d3d6f1f5f0017a9b9b868c9a3120d35.png"},24050:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_25-c05a7e9242e0f3509d90750973560b83.png"},24977:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741863693-1d6adb0fc6203842b9c10f1a5b263c85.png"},25169:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736812545-6da8a6e681a3cc4bcf5bca40926bf5da.png"},25564:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732734101-02f7ad9e53a97a5a19f76b928eae3066.png"},26767:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756742532824-39aa87a179967c12da5179086dc15880.png"},26845:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756742267322-3b1808807a7c7b56ea7b32c9170f906a.png"},28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>a});var s=r(96540);const i={},d=s.createContext(i);function t(e){const n=s.useContext(d);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(d.Provider,{value:n},e.children)}},28633:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_4-98277c349e92bf40563d2367eee43f46.png"},28689:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756682656684-6a4791f68cf3beba63643399bd736064.png"},28925:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756685081098-8efce89ee39026fe0ab8958a47a8092d.png"},29430:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732617284-d4ed351c1b4d666517f6ce8055348ec5.png"},29520:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732196024-a9cad428d559bcfa1f358eae148c74aa.png"},29565:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741424469-703b88b417a4384d5c3324a2a6de90ef.png"},29789:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733457972-a36ea9bd4e81ea7ce01d4f6a26e34180.png"},30415:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756734010565-72b08f3974b4c12d5646f4079327bb24.png"},30419:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737243177-a6c53dc3c78c9856216ead7de105ae72.png"},30433:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_17-83b9b806bf23820a3082b3c53e2d63db.png"},31197:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_40-9d1d3c11b246a681228fedd2904b5a0f.png"},31708:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737267626-6569a94d05d4795a5a0fb88002d665b5.png"},32087:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732751217-89e77affadbd701ce04e08d839cd9bc6.png"},32104:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756742466906-81cb79f42727396c149d1b0e861ae69c.png"},32211:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_15-edb739338a60e1faaf19192639a003f3.png"},32985:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756734022557-fae5afba90af1ccd3da41865d0f0ca62.png"},33475:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756742625281-d73e4830bf9b6089c857146bf2313f4e.png"},33773:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732834750-e36fc5b42b726d7c33cd16b9097b7170.png"},34258:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756682807254-9b61478883df600be82897864b33db55.png"},34282:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736124117-71e5e4e92f316218992f0f488a153a61.png"},34368:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_27-23b00c888bbd3865249f5992b1e6e81c.png"},34467:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736949971-481dc06f1800f2e14e5adf1471cc4626.png"},35377:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737184298-9d90277481857320a30ba18aef363f82.png"},35536:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732723156-4bc0615dbd72070feac694dfdb850a44.png"},37172:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736097859-53ad50eef22f9a678df85027de2a2f3c.png"},37335:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_11-9f701eb0cb9af56575f9373844646f21.png"},37985:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736745896-42df1f5de21fc2fd1b0c9b37ea7bf562.png"},38001:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756734441158-2bbe596a51a513f5d56ff54be6df0410.png"},40559:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_33-45f79f037cc4e7f964644da555be148e.png"},41980:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733132513-96957625269a91868c22f4b9c6bec4f4.png"},42408:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732787402-3130e798d2cfa2a0c6e93c327b210b7c.png"},42555:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756742496498-d51ff7db116a48a564c93803b9fda9db.png"},42664:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736081892-a3a0a4473fdf612e64336dcad6fa4146.png"},43545:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756734685435-72963d4aaf70b96d164f9ff506898a4c.png"},44173:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733028439-e049da8cc24e0f2f559b5228cdc48282.png"},44183:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732629550-e335c04701f1b7227181df6d8bb993b4.png"},44332:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756735788471-063e09fa6698d111d0663f4a7c0ad379.png"},44623:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756742317904-51511c61d50dd8e910348e304fa2fcf7.png"},44688:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_34-7f45aa3a5cdccda94d9ab1c18276afab.png"},44971:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756742290634-7964d58408eb8a6506be7038ad773b42.png"},45213:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732983171-dcdf8c8d692244d454dc8957dcbe369a.png"},45637:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756734135741-862e53ab692ff684efbdee03d69548c1.png"},45818:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741793308-d93ef6c25106875796d064e498ee9eae.png"},45977:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756734327573-7df727cf270c01dafc98507887b6d80e.png"},45997:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732822490-1a5cbdb9beb731d420c7926ac085af96.png"},46331:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733712631-d9d83fc9acf763561bb0166cad66f056.png"},47088:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756742563119-39b9c80d10192f4e63c4ac4ddecf6b6d.png"},47268:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756684935119-c9bc1f19c8a0fddd5032003a7e26b15d.png"},48604:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_12-69727432f7f60ce364ada9a86eb424eb.png"},48750:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736388588-ef0a8ffce94572e58d525128f03ef7b0.png"},49506:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736515935-0b734c9c57624e23a8857a14a80e090b.png"},50636:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733033386-e049da8cc24e0f2f559b5228cdc48282.png"},50937:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_35-2bec154ed9292068da9f4d4ea558a217.png"},51736:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756742547294-b3c0365a2eec8b428535df0e8a668e5a.png"},51776:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732536934-9e7bad0a9ae77cc7c4e82c5e6caeaa03.png"},52012:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737205785-a68694c771c944db2c71a30933666e03.png"},52325:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736194629-c576aabb7d6fc0b0c3f0384ffef85df9.png"},52516:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732135823-1acf8d20fc844c38942880cbb6477d14.png"},52928:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756683157769-751daf8ef902a83f186cdf7909da1b3a.png"},53876:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756685033216-7d6a1b2332a54d4697c07abb454fa4e4.png"},55746:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756683248047-771462f4bb8c5431ae4601713b2539c1.png"},57720:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_16-0a182559da4b95383b46e09541593540.png"},59375:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_19-e2f741ef8d6ad8decaecdac12c564719.png"},60416:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741915311-be8185babc51bfb179671d49a7bb664a.png"},61042:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737494710-495c5662e3682334dd6a4d89d83282b3.png"},61639:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_28-e61778c20fe851b2aa9359d102768503.png"},61931:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_6-46b5517a70b5d73d9399df752a333a8d.png"},62141:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732973033-37a167ab68990abf87124aa04ce124d6.png"},62490:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756684999300-f37aa99899374b258038238d07068adf.png"},63361:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733376024-b76eb5cd347f1e9cccc947875a22dc39.png"},63658:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756682584609-c45bff9af0765e4735f807c32ff22356.png"},63694:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_10-8ff5a9c1a53b335db8a786f53c39db72.png"},64147:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741886579-865e89ef37489391abbc154ce228322f.png"},64999:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736787005-f7ed82c54be1e1cc418ca367c8ebaa6e.png"},65324:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737140624-0c7ee3b0494db3ec0035694cc9be1596.png"},65527:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741300958-68f7f3c660ced59922489297ca98a879.png"},66068:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_30-a2ff8c769a968685d77f2ae2edec9f66.png"},66117:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_13-be0eaacf1ac14fcc5ce54f6686f7368d.png"},66330:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737319518-12fb92e62d0733a26bd2440588187e98.png"},66650:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732709947-a36ea9bd4e81ea7ce01d4f6a26e34180.png"},67037:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737123972-1f756ec1961d3ac469b6165aca30aa98.png"},67643:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736599196-51a73be7944faec9a57d7c15d74f77f5.png"},68297:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737460637-b3f8e5881d9e9145300a4b0e15e9a76f.png"},68772:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741114121-53d72a35f96fc688228fe17c262483da.png"},69807:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736707834-a37b7bbf9fcb5d2de3e73eedf113704a.png"},72140:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756736185947-e2a572c7da573b4e7d34b0cfb7842b6b.png"},72164:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732947178-19c860ce4733dd56c3ab1b1daa84d03d.png"},72188:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>o,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"REDIS/REDIS_REVIEW","title":"REDIS_REVIEW","description":"REDIS_REVIEW","source":"@site/docs/REDIS/redis_review.md","sourceDirName":"REDIS","slug":"/intereview/redis","permalink":"/doc/docs/intereview/redis","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/REDIS/redis_review.md","tags":[{"inline":true,"label":"INTERVIEW","permalink":"/doc/docs/tags/interview"},{"inline":true,"label":"REDIS","permalink":"/doc/docs/tags/redis"}],"version":"current","frontMatter":{"id":"REDIS_REVIEW","title":"REDIS_REVIEW","description":"REDIS_REVIEW","slug":"/intereview/redis","tags":["INTERVIEW","REDIS"]},"sidebar":"tutorialSidebar","previous":{"title":"NGINX-REVIEW","permalink":"/doc/docs/INTERVIEW/NGINX/NGINX-REVIEW"},"next":{"title":"SPRING-REVIEW","permalink":"/doc/docs/INTERVIEW/SPRING/SPRING-REVIEW"}}');var i=r(74848),d=r(28453);const t={id:"REDIS_REVIEW",title:"REDIS_REVIEW",description:"REDIS_REVIEW",slug:"/intereview/redis",tags:["INTERVIEW","REDIS"]},a=void 0,l={},c=[{value:"\ud83c\udf1f\u8bf4\u8bf4\u4ec0\u4e48\u662f Redis?",id:"\u8bf4\u8bf4\u4ec0\u4e48\u662f-redis",level:3},{value:"Redis \u548c MySQL \u7684\u533a\u522b\uff1f",id:"redis-\u548c-mysql-\u7684\u533a\u522b",level:3},{value:"\u9879\u76ee\u91cc\u54ea\u91cc\u7528\u5230\u4e86 Redis\uff1f",id:"\u9879\u76ee\u91cc\u54ea\u91cc\u7528\u5230\u4e86-redis",level:3},{value:"\u90e8\u7f72\u8fc7 Redis \u5417\uff1f",id:"\u90e8\u7f72\u8fc7-redis-\u5417",level:3},{value:"Redis \u7684\u9ad8\u53ef\u7528\u65b9\u6848\u6709\u90e8\u7f72\u8fc7\u5417\uff1f",id:"redis-\u7684\u9ad8\u53ef\u7528\u65b9\u6848\u6709\u90e8\u7f72\u8fc7\u5417",level:3},{value:".Redis \u53ef\u4ee5\u7528\u6765\u5e72\u4ec0\u4e48\uff1f",id:"redis-\u53ef\u4ee5\u7528\u6765\u5e72\u4ec0\u4e48",level:3},{value:"Redis\u6709\u54ea\u4e9b\u6570\u636e\u7c7b\u578b\uff1f",id:"redis\u6709\u54ea\u4e9b\u6570\u636e\u7c7b\u578b",level:3},{value:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u54c8\u5e0c\uff1f",id:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u54c8\u5e0c",level:3},{value:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u96c6\u5408\uff1f",id:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u96c6\u5408",level:3},{value:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u6709\u5e8f\u96c6\u5408\uff1f",id:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u6709\u5e8f\u96c6\u5408",level:3},{value:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0bBitmap\uff1f",id:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0bbitmap",level:3},{value:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0bHyperLogLog\uff1f",id:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0bhyperloglog",level:3},{value:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0bGEO\uff1f",id:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0bgeo",level:3},{value:"\u4e3a\u4ec0\u4e48\u4f7f\u7528 hash \u7c7b\u578b\u800c\u4e0d\u4f7f\u7528 string \u7c7b\u578b\u5e8f\u5217\u5316\u5b58\u50a8\uff1f",id:"\u4e3a\u4ec0\u4e48\u4f7f\u7528-hash-\u7c7b\u578b\u800c\u4e0d\u4f7f\u7528-string-\u7c7b\u578b\u5e8f\u5217\u5316\u5b58\u50a8",level:3},{value:"\ud83c\udf1fRedis \u4e3a\u4ec0\u4e48\u5feb\u5462\uff1f",id:"redis-\u4e3a\u4ec0\u4e48\u5feb\u5462",level:3},{value:"\u80fd\u8be6\u7ec6\u8bf4\u4e00\u4e0bIO\u591a\u8def\u590d\u7528\u5417\uff1f",id:"\u80fd\u8be6\u7ec6\u8bf4\u4e00\u4e0bio\u591a\u8def\u590d\u7528\u5417",level:3},{value:"\u8bf7\u8bf4\u8bf4 select\u3001poll\u3001epoll\u3001kqueue \u548c IOCP \u7684\u533a\u522b\uff1f",id:"\u8bf7\u8bf4\u8bf4-selectpollepollkqueue-\u548c-iocp-\u7684\u533a\u522b",level:3},{value:"\u4e3e\u4e2a\u4f8b\u5b50\u8bf4\u4e00\u4e0b IO \u591a\u8def\u590d\u7528\uff1f",id:"\u4e3e\u4e2a\u4f8b\u5b50\u8bf4\u4e00\u4e0b-io-\u591a\u8def\u590d\u7528",level:3},{value:"\u4e3e\u4f8b\u5b50\u8bf4\u4e00\u4e0b\u963b\u585e IO\u548c IO \u591a\u8def\u590d\u7528\u7684\u5dee\u522b\uff1f",id:"\u4e3e\u4f8b\u5b50\u8bf4\u4e00\u4e0b\u963b\u585e-io\u548c-io-\u591a\u8def\u590d\u7528\u7684\u5dee\u522b",level:3},{value:"select\u3001poll \u548c epoll \u7684\u5b9e\u73b0\u539f\u7406\uff1f",id:"selectpoll-\u548c-epoll-\u7684\u5b9e\u73b0\u539f\u7406",level:3},{value:"Redis\u4e3a\u4ec0\u4e48\u65e9\u671f\u9009\u62e9\u5355\u7ebf\u7a0b\uff1f",id:"redis\u4e3a\u4ec0\u4e48\u65e9\u671f\u9009\u62e9\u5355\u7ebf\u7a0b",level:3},{value:"Redis 6.0 \u4f7f\u7528\u591a\u7ebf\u7a0b\u662f\u600e\u4e48\u56de\u4e8b?",id:"redis-60-\u4f7f\u7528\u591a\u7ebf\u7a0b\u662f\u600e\u4e48\u56de\u4e8b",level:3},{value:"\u8bf4\u8bf4 Redis \u7684\u5e38\u7528\u547d\u4ee4\uff08\u8865\u5145\uff09",id:"\u8bf4\u8bf4-redis-\u7684\u5e38\u7528\u547d\u4ee4\u8865\u5145",level:3},{value:"\u8be6\u7ec6\u8bf4\u8bf4 set \u547d\u4ee4\uff1f",id:"\u8be6\u7ec6\u8bf4\u8bf4-set-\u547d\u4ee4",level:3},{value:"sadd \u547d\u4ee4\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u591a\u5c11\uff1f",id:"sadd-\u547d\u4ee4\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u591a\u5c11",level:4},{value:"incr\u547d\u4ee4\u4e86\u89e3\u5417\uff1f",id:"incr\u547d\u4ee4\u4e86\u89e3\u5417",level:4},{value:"\u5355\u7ebf\u7a0b\u7684Redis QPS \u80fd\u5230\u591a\u5c11\uff1f(\u8865\u5145)",id:"\u5355\u7ebf\u7a0b\u7684redis-qps-\u80fd\u5230\u591a\u5c11\u8865\u5145",level:3},{value:"\u6301\u4e45\u5316",id:"\u6301\u4e45\u5316",level:2},{value:"\ud83c\udf1fRedis\u7684\u6301\u4e45\u5316\u65b9\u5f0f\u6709\u54ea\u4e9b\uff1f",id:"redis\u7684\u6301\u4e45\u5316\u65b9\u5f0f\u6709\u54ea\u4e9b",level:3},{value:"\u8be6\u7ec6\u8bf4\u4e00\u4e0b RDB\uff1f",id:"\u8be6\u7ec6\u8bf4\u4e00\u4e0b-rdb",level:3},{value:"\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u81ea\u52a8\u89e6\u53d1 RDB \u6301\u4e45\u5316\uff1f",id:"\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u81ea\u52a8\u89e6\u53d1-rdb-\u6301\u4e45\u5316",level:3},{value:"\u8be6\u7ec6\u8bf4\u4e00\u4e0b AOF\uff1f",id:"\u8be6\u7ec6\u8bf4\u4e00\u4e0b-aof",level:3},{value:"AOF \u7684\u5237\u76d8\u7b56\u7565\u4e86\u89e3\u5417\uff1f",id:"aof-\u7684\u5237\u76d8\u7b56\u7565\u4e86\u89e3\u5417",level:3},{value:"\u8bf4\u8bf4AOF\u7684\u91cd\u5199\u673a\u5236\uff1f",id:"\u8bf4\u8bf4aof\u7684\u91cd\u5199\u673a\u5236",level:3},{value:"AOF \u91cd\u5199\u7684\u5177\u4f53\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f",id:"aof-\u91cd\u5199\u7684\u5177\u4f53\u8fc7\u7a0b\u662f\u600e\u6837\u7684",level:3},{value:"AOF \u6587\u4ef6\u5b58\u50a8\u7684\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u6570\u636e\uff1f",id:"aof-\u6587\u4ef6\u5b58\u50a8\u7684\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u6570\u636e",level:3},{value:"AOF\u91cd\u5199\u671f\u95f4\u547d\u4ee4\u53ef\u80fd\u4f1a\u5199\u5165\u4e24\u6b21\uff0c\u4f1a\u9020\u6210\u4ec0\u4e48\u5f71\u54cd\uff1f",id:"aof\u91cd\u5199\u671f\u95f4\u547d\u4ee4\u53ef\u80fd\u4f1a\u5199\u5165\u4e24\u6b21\u4f1a\u9020\u6210\u4ec0\u4e48\u5f71\u54cd",level:3},{value:"RDB \u548c AOF \u5404\u81ea\u6709\u4ec0\u4e48\u4f18\u7f3a\u70b9\uff1f",id:"rdb-\u548c-aof-\u5404\u81ea\u6709\u4ec0\u4e48\u4f18\u7f3a\u70b9",level:3},{value:"RDB \u548c AOF \u5982\u4f55\u9009\u62e9\uff1f",id:"rdb-\u548c-aof-\u5982\u4f55\u9009\u62e9",level:3},{value:"Redis\u5982\u4f55\u6062\u590d\u6570\u636e\uff1f",id:"redis\u5982\u4f55\u6062\u590d\u6570\u636e",level:3},{value:"\ud83c\udf1fRedis 4.0 \u7684\u6df7\u5408\u6301\u4e45\u5316\u4e86\u89e3\u5417\uff1f",id:"redis-40-\u7684\u6df7\u5408\u6301\u4e45\u5316\u4e86\u89e3\u5417",level:3},{value:"\u4f60\u5728\u5f00\u53d1\u4e2d\u662f\u600e\u4e48\u914d\u7f6e RDB \u548c AOF \u7684\uff1f",id:"\u4f60\u5728\u5f00\u53d1\u4e2d\u662f\u600e\u4e48\u914d\u7f6e-rdb-\u548c-aof-\u7684",level:3},{value:"\u5bf9\u4e8e\u5355\u7eaf\u7684\u7f13\u5b58\u573a\u666f\uff0c\u6216\u8005\u672c\u5730\u5f00\u53d1\uff0c\u6211\u4f1a\u53ea\u542f\u7528 RDB\uff0c\u5173\u95ed AOF\uff1a",id:"\u5bf9\u4e8e\u5355\u7eaf\u7684\u7f13\u5b58\u573a\u666f\u6216\u8005\u672c\u5730\u5f00\u53d1\u6211\u4f1a\u53ea\u542f\u7528-rdb\u5173\u95ed-aof",level:3},{value:"\u800c\u5bf9\u4e8e\u91d1\u878d\u7c7b\u7b49\u9ad8\u4e00\u81f4\u6027\u7684\u7cfb\u7edf\uff0c\u6211\u901a\u5e38\u4f1a\u5728\u5173\u952e\u65f6\u95f4\u7a97\u53e3\u52a8\u6001\u5c06 appendfsync \u8bbe\u7f6e\u4e3a always\uff1a",id:"\u800c\u5bf9\u4e8e\u91d1\u878d\u7c7b\u7b49\u9ad8\u4e00\u81f4\u6027\u7684\u7cfb\u7edf\u6211\u901a\u5e38\u4f1a\u5728\u5173\u952e\u65f6\u95f4\u7a97\u53e3\u52a8\u6001\u5c06-appendfsync-\u8bbe\u7f6e\u4e3a-always",level:3},{value:"\u9ad8\u53ef\u7528",id:"\u9ad8\u53ef\u7528",level:2},{value:"\u4e3b\u4ece\u590d\u5236\u4e86\u89e3\u5417\uff1f",id:"\u4e3b\u4ece\u590d\u5236\u4e86\u89e3\u5417",level:3},{value:"\u4e3b\u4ece\u590d\u5236\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u4ec0\u4e48?",id:"\u4e3b\u4ece\u590d\u5236\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u4ec0\u4e48",level:3},{value:"\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u51fa\u73b0\u4e3b\u4ece\u590d\u5236\u6570\u636e\u4e0d\u4e00\u81f4\uff1f",id:"\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u51fa\u73b0\u4e3b\u4ece\u590d\u5236\u6570\u636e\u4e0d\u4e00\u81f4",level:3},{value:"Redis\u4e3b\u4ece\u6709\u51e0\u79cd\u5e38\u89c1\u7684\u62d3\u6251\u7ed3\u6784\uff1f",id:"redis\u4e3b\u4ece\u6709\u51e0\u79cd\u5e38\u89c1\u7684\u62d3\u6251\u7ed3\u6784",level:3},{value:"Redis\u7684\u4e3b\u4ece\u590d\u5236\u539f\u7406\u4e86\u89e3\u5417\uff1f",id:"redis\u7684\u4e3b\u4ece\u590d\u5236\u539f\u7406\u4e86\u89e3\u5417",level:3},{value:"\u8be6\u7ec6\u8bf4\u8bf4\u5168\u91cf\u540c\u6b65\u548c\u589e\u91cf\u540c\u6b65\uff1f",id:"\u8be6\u7ec6\u8bf4\u8bf4\u5168\u91cf\u540c\u6b65\u548c\u589e\u91cf\u540c\u6b65",level:3},{value:"\u4e3b\u4ece\u590d\u5236\u5b58\u5728\u54ea\u4e9b\u95ee\u9898\u5462\uff1f",id:"\u4e3b\u4ece\u590d\u5236\u5b58\u5728\u54ea\u4e9b\u95ee\u9898\u5462",level:3},{value:"Redis\u54e8\u5175\u673a\u5236\u4e86\u89e3\u5417\uff1f",id:"redis\u54e8\u5175\u673a\u5236\u4e86\u89e3\u5417",level:3},{value:"Redis\u54e8\u5175\u7684\u5de5\u4f5c\u539f\u7406\u77e5\u9053\u5417\uff1f",id:"redis\u54e8\u5175\u7684\u5de5\u4f5c\u539f\u7406\u77e5\u9053\u5417",level:3},{value:"Redis\u9886\u5bfc\u8005\u9009\u4e3e\u4e86\u89e3\u5417\uff1f",id:"redis\u9886\u5bfc\u8005\u9009\u4e3e\u4e86\u89e3\u5417",level:3},{value:"\u65b0\u7684\u4e3b\u8282\u70b9\u662f\u600e\u6837\u88ab\u6311\u9009\u51fa\u6765\u7684\uff1f",id:"\u65b0\u7684\u4e3b\u8282\u70b9\u662f\u600e\u6837\u88ab\u6311\u9009\u51fa\u6765\u7684",level:3},{value:"Redis\u96c6\u7fa4\u4e86\u89e3\u5417\uff1f",id:"redis\u96c6\u7fa4\u4e86\u89e3\u5417",level:3},{value:"\u8bf7\u8be6\u7ec6\u8bf4\u4e00\u8bf4Redis Cluster\uff1f\uff08\u8865\u5145\uff09",id:"\u8bf7\u8be6\u7ec6\u8bf4\u4e00\u8bf4redis-cluster\u8865\u5145",level:3},{value:"\u96c6\u7fa4\u4e2d\u6570\u636e\u5982\u4f55\u5206\u533a\uff1f",id:"\u96c6\u7fa4\u4e2d\u6570\u636e\u5982\u4f55\u5206\u533a",level:3},{value:"\u80fd\u8bf4\u8bf4 Redis \u96c6\u7fa4\u7684\u539f\u7406\u5417\uff1f",id:"\u80fd\u8bf4\u8bf4-redis-\u96c6\u7fa4\u7684\u539f\u7406\u5417",level:3},{value:"\u90e8\u7f72 Redis \u96c6\u7fa4\u81f3\u5c11\u9700\u8981\u51e0\u4e2a\u7269\u7406\u8282\u70b9\uff1f",id:"\u90e8\u7f72-redis-\u96c6\u7fa4\u81f3\u5c11\u9700\u8981\u51e0\u4e2a\u7269\u7406\u8282\u70b9",level:3},{value:"\u8bf4\u8bf4Redis\u96c6\u7fa4\u7684\u52a8\u6001\u4f38\u7f29\uff1f",id:"\u8bf4\u8bf4redis\u96c6\u7fa4\u7684\u52a8\u6001\u4f38\u7f29",level:3},{value:"MOVED \u548c ASK \u91cd\u5b9a\u5411\u7684\u533a\u522b\uff1f",id:"moved-\u548c-ask-\u91cd\u5b9a\u5411\u7684\u533a\u522b",level:3},{value:"\u7f13\u5b58\u8bbe\u8ba1",id:"\u7f13\u5b58\u8bbe\u8ba1",level:2},{value:"\ud83c\udf1f\u4ec0\u4e48\u662f\u7f13\u5b58\u51fb\u7a7f\uff1f",id:"\u4ec0\u4e48\u662f\u7f13\u5b58\u51fb\u7a7f",level:3},{value:"\u4ec0\u4e48\u662f\u7f13\u5b58\u7a7f\u900f\uff1f",id:"\u4ec0\u4e48\u662f\u7f13\u5b58\u7a7f\u900f",level:3},{value:"\u4ec0\u4e48\u662f\u7f13\u5b58\u96ea\u5d29\uff1f",id:"\u4ec0\u4e48\u662f\u7f13\u5b58\u96ea\u5d29",level:3},{value:"\ud83c\udf1f\u80fd\u8bf4\u8bf4\u5e03\u9686\u8fc7\u6ee4\u5668\u5417\uff1f",id:"\u80fd\u8bf4\u8bf4\u5e03\u9686\u8fc7\u6ee4\u5668\u5417",level:3},{value:"\u5e03\u9686\u8fc7\u6ee4\u5668\u5b58\u5728\u8bef\u5224\u5417\uff1f",id:"\u5e03\u9686\u8fc7\u6ee4\u5668\u5b58\u5728\u8bef\u5224\u5417",level:3},{value:"\u5e03\u9686\u8fc7\u6ee4\u5668\u652f\u6301\u5220\u9664\u5417\uff1f",id:"\u5e03\u9686\u8fc7\u6ee4\u5668\u652f\u6301\u5220\u9664\u5417",level:3},{value:"\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u7528\u54c8\u5e0c\u8868\u800c\u662f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\uff1f",id:"\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u7528\u54c8\u5e0c\u8868\u800c\u662f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668",level:3},{value:"\ud83c\udf1f\u5982\u4f55\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u2f00\u81f4\u6027\uff1f",id:"\u5982\u4f55\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u81f4\u6027",level:3},{value:"\u90a3\u518d\u6765\u8bf4\u8bf4\u4e3a\u4ec0\u4e48\u8981\u5220\u9664\u7f13\u5b58\u800c\u4e0d\u662f\u66f4\u65b0\u7f13\u5b58\uff1f",id:"\u90a3\u518d\u6765\u8bf4\u8bf4\u4e3a\u4ec0\u4e48\u8981\u5220\u9664\u7f13\u5b58\u800c\u4e0d\u662f\u66f4\u65b0\u7f13\u5b58",level:3},{value:"\u90a3\u518d\u8bf4\u8bf4\u4e3a\u4ec0\u4e48\u8981\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\uff1f",id:"\u90a3\u518d\u8bf4\u8bf4\u4e3a\u4ec0\u4e48\u8981\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58",level:3},{value:"\u90a3\u5047\u5982\u5bf9\u7f13\u5b58\u6570\u636e\u5e93\u4e00\u81f4\u6027\u8981\u6c42\u5f88\u9ad8\uff0c\u8be5\u600e\u4e48\u529e\u5462\uff1f",id:"\u90a3\u5047\u5982\u5bf9\u7f13\u5b58\u6570\u636e\u5e93\u4e00\u81f4\u6027\u8981\u6c42\u5f88\u9ad8\u8be5\u600e\u4e48\u529e\u5462",level:3},{value:"\u5982\u4f55\u4fdd\u8bc1\u672c\u5730\u7f13\u5b58\u548c\u5206\u5e03\u5f0f\u7f13\u5b58\u7684\u4e00\u81f4\uff1f",id:"\u5982\u4f55\u4fdd\u8bc1\u672c\u5730\u7f13\u5b58\u548c\u5206\u5e03\u5f0f\u7f13\u5b58\u7684\u4e00\u81f4",level:3},{value:"\u5982\u679c\u5728\u9879\u76ee\u4e2d\u591a\u4e2a\u5730\u65b9\u90fd\u8981\u4f7f\u7528\u5230\u4e8c\u7ea7\u7f13\u5b58\u7684\u903b\u8f91\uff0c\u5982\u4f55\u8bbe\u8ba1\u8fd9\u4e00\u5757\uff1f",id:"\u5982\u679c\u5728\u9879\u76ee\u4e2d\u591a\u4e2a\u5730\u65b9\u90fd\u8981\u4f7f\u7528\u5230\u4e8c\u7ea7\u7f13\u5b58\u7684\u903b\u8f91\u5982\u4f55\u8bbe\u8ba1\u8fd9\u4e00\u5757",level:3},{value:"\u672c\u5730\u7f13\u5b58\u548c Redis \u7684\u533a\u522b\u4e86\u89e3\u5417\uff1f",id:"\u672c\u5730\u7f13\u5b58\u548c-redis-\u7684\u533a\u522b\u4e86\u89e3\u5417",level:3},{value:"\u4ec0\u4e48\u662f\u70edKey\uff1f",id:"\u4ec0\u4e48\u662f\u70edkey",level:3},{value:"\u90a3\u600e\u4e48\u76d1\u63a7\u70edKey \u5462\uff1f",id:"\u90a3\u600e\u4e48\u76d1\u63a7\u70edkey-\u5462",level:3},{value:"\u90a3\u600e\u4e48\u5904\u7406\u70edKey \u5462\uff1f",id:"\u90a3\u600e\u4e48\u5904\u7406\u70edkey-\u5462",level:3},{value:"\u600e\u4e48\u5904\u7406\u5927 Key \u5462\uff1f",id:"\u600e\u4e48\u5904\u7406\u5927-key-\u5462",level:3},{value:"\u7f13\u5b58\u9884\u70ed\u600e\u4e48\u505a\u5462\uff1f",id:"\u7f13\u5b58\u9884\u70ed\u600e\u4e48\u505a\u5462",level:3},{value:"\u65e0\u5e95\u6d1e\u95ee\u9898\u542c\u8bf4\u8fc7\u5417\uff1f\u5982\u4f55\u89e3\u51b3\uff1f",id:"\u65e0\u5e95\u6d1e\u95ee\u9898\u542c\u8bf4\u8fc7\u5417\u5982\u4f55\u89e3\u51b3",level:3},{value:"Redis \u8fd0\u7ef4",id:"redis-\u8fd0\u7ef4",level:2},{value:"Redis \u62a5\u5185\u5b58\u4e0d\u8db3\u600e\u4e48\u5904\u7406\uff1f",id:"redis-\u62a5\u5185\u5b58\u4e0d\u8db3\u600e\u4e48\u5904\u7406",level:3},{value:"Redis key\u8fc7\u671f\u7b56\u7565\u6709\u54ea\u4e9b\uff1f",id:"redis-key\u8fc7\u671f\u7b56\u7565\u6709\u54ea\u4e9b",level:3},{value:"\ud83c\udf1fRedis\u6709\u54ea\u4e9b\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff1f",id:"redis\u6709\u54ea\u4e9b\u5185\u5b58\u6dd8\u6c70\u7b56\u7565",level:3},{value:"LRU \u548c LFU \u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f",id:"lru-\u548c-lfu-\u7684\u533a\u522b\u662f\u4ec0\u4e48",level:3},{value:"Redis\u53d1\u751f\u963b\u585e\u4e86\u600e\u4e48\u89e3\u51b3\uff1f",id:"redis\u53d1\u751f\u963b\u585e\u4e86\u600e\u4e48\u89e3\u51b3",level:3},{value:"Redis \u5e94\u7528",id:"redis-\u5e94\u7528",level:2},{value:"Redis\u5982\u4f55\u5b9e\u73b0\u5f02\u6b65\u6d88\u606f\u961f\u5217\uff1f",id:"redis\u5982\u4f55\u5b9e\u73b0\u5f02\u6b65\u6d88\u606f\u961f\u5217",level:3},{value:"Redis\u5982\u4f55\u5b9e\u73b0\u5ef6\u65f6\u6d88\u606f\u961f\u5217?",id:"redis\u5982\u4f55\u5b9e\u73b0\u5ef6\u65f6\u6d88\u606f\u961f\u5217",level:3},{value:"\ud83c\udf1fRedis\u652f\u6301\u4e8b\u52a1\u5417\uff1f",id:"redis\u652f\u6301\u4e8b\u52a1\u5417",level:3},{value:"\u8bf4\u4e00\u4e0b Redis \u4e8b\u52a1\u7684\u539f\u7406\uff1f",id:"\u8bf4\u4e00\u4e0b-redis-\u4e8b\u52a1\u7684\u539f\u7406",level:3},{value:"Redis \u4e8b\u52a1\u6709\u54ea\u4e9b\u6ce8\u610f\u70b9\uff1f",id:"redis-\u4e8b\u52a1\u6709\u54ea\u4e9b\u6ce8\u610f\u70b9",level:3},{value:"Redis\u4e8b\u52a1\u4e3a\u4ec0\u4e48\u4e0d\u652f\u6301\u56de\u6eda\uff1f",id:"redis\u4e8b\u52a1\u4e3a\u4ec0\u4e48\u4e0d\u652f\u6301\u56de\u6eda",level:3},{value:"Redis\u4e8b\u52a1\u6ee1\u8db3\u539f\u5b50\u6027\u5417\uff1f\u8981\u600e\u4e48\u6539\u8fdb\uff1f",id:"redis\u4e8b\u52a1\u6ee1\u8db3\u539f\u5b50\u6027\u5417\u8981\u600e\u4e48\u6539\u8fdb",level:3},{value:"Redis \u4e8b\u52a1\u7684 ACID \u7279\u6027\u5982\u4f55\u4f53\u73b0\uff1f",id:"redis-\u4e8b\u52a1\u7684-acid-\u7279\u6027\u5982\u4f55\u4f53\u73b0",level:3},{value:"\u6709Lua\u811a\u672c\u64cd\u4f5cRedis\u7684\u7ecf\u9a8c\u5417\uff1f",id:"\u6709lua\u811a\u672c\u64cd\u4f5credis\u7684\u7ecf\u9a8c\u5417",level:3},{value:"Redis\u7684\u7ba1\u9053Pipeline\u4e86\u89e3\u5417\uff1f",id:"redis\u7684\u7ba1\u9053pipeline\u4e86\u89e3\u5417",level:3},{value:"\u4ec0\u4e48\u573a\u666f\u4e0b\u9002\u5408\u4f7f\u7528 Pipeline\u5462\uff1f",id:"\u4ec0\u4e48\u573a\u666f\u4e0b\u9002\u5408\u4f7f\u7528-pipeline\u5462",level:3},{value:"\u6709\u4e86\u89e3\u8fc7 Pipeline \u7684\u5e95\u5c42\u539f\u7406\u5417\uff1f",id:"\u6709\u4e86\u89e3\u8fc7-pipeline-\u7684\u5e95\u5c42\u539f\u7406\u5417",level:3},{value:"\ud83c\udf1fRedis\u80fd\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u5417\uff1f",id:"redis\u80fd\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u5417",level:3},{value:"Redis\u5982\u4f55\u4fdd\u8bc1 SETNX \u4e0d\u4f1a\u53d1\u751f\u51b2\u7a81\uff1f",id:"redis\u5982\u4f55\u4fdd\u8bc1-setnx-\u4e0d\u4f1a\u53d1\u751f\u51b2\u7a81",level:3},{value:"SETNX\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u5982\u4f55\u89e3\u51b3\uff1f",id:"setnx\u6709\u4ec0\u4e48\u95ee\u9898\u5982\u4f55\u89e3\u51b3",level:3},{value:"Redisson\u4e86\u89e3\u591a\u5c11\uff1f",id:"redisson\u4e86\u89e3\u591a\u5c11",level:3},{value:"\u8be6\u7ec6\u8bf4\u8bf4Redisson\u7684\u770b\u95e8\u72d7\u673a\u5236\uff1f",id:"\u8be6\u7ec6\u8bf4\u8bf4redisson\u7684\u770b\u95e8\u72d7\u673a\u5236",level:3},{value:"\u770b\u95e8\u72d7\u673a\u5236\u4e2d\u7684\u68c0\u67e5\u9501\u8fc7\u7a0b\u662f\u539f\u5b50\u64cd\u4f5c\u5417\uff1f",id:"\u770b\u95e8\u72d7\u673a\u5236\u4e2d\u7684\u68c0\u67e5\u9501\u8fc7\u7a0b\u662f\u539f\u5b50\u64cd\u4f5c\u5417",level:3},{value:"Redlock\u4f60\u4e86\u89e3\u591a\u5c11\uff1f",id:"redlock\u4f60\u4e86\u89e3\u591a\u5c11",level:3},{value:"\u7ea2\u9501\u80fd\u4e0d\u80fd\u4fdd\u8bc1\u767e\u5206\u767e\u4e0a\u9501\uff1f",id:"\u7ea2\u9501\u80fd\u4e0d\u80fd\u4fdd\u8bc1\u767e\u5206\u767e\u4e0a\u9501",level:3},{value:"\u9879\u76ee\u4e2d\u6709\u7528\u5230\u5206\u5e03\u5f0f\u9501\u5417\uff1f",id:"\u9879\u76ee\u4e2d\u6709\u7528\u5230\u5206\u5e03\u5f0f\u9501\u5417",level:3},{value:"\u5e95\u5c42\u7ed3\u6784",id:"\u5e95\u5c42\u7ed3\u6784",level:2},{value:"\ud83c\udf1fRedis\u90fd\u6709\u54ea\u4e9b\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1f",id:"redis\u90fd\u6709\u54ea\u4e9b\u5e95\u5c42\u6570\u636e\u7ed3\u6784",level:3},{value:"\u7b80\u5355\u4ecb\u7ecd\u4e0b\u94fe\u8868\uff1f",id:"\u7b80\u5355\u4ecb\u7ecd\u4e0b\u94fe\u8868",level:3},{value:"\u5173\u4e8e\u6574\u6570\u96c6\u5408\uff0c\u80fd\u518d\u8be6\u7ec6\u8bf4\u8bf4\u5417\uff1f",id:"\u5173\u4e8e\u6574\u6570\u96c6\u5408\u80fd\u518d\u8be6\u7ec6\u8bf4\u8bf4\u5417",level:3},{value:"\u8bf4\u4e00\u4e0bzset \u7684\u5e95\u5c42\u539f\u7406\uff1f",id:"\u8bf4\u4e00\u4e0bzset-\u7684\u5e95\u5c42\u539f\u7406",level:3},{value:"\u4f60\u77e5\u9053\u4e3a\u4ec0\u4e48Redis 7.0\u8981\u7528listpack\u6765\u66ff\u4ee3ziplist\u5417\uff1f",id:"\u4f60\u77e5\u9053\u4e3a\u4ec0\u4e48redis-70\u8981\u7528listpack\u6765\u66ff\u4ee3ziplist\u5417",level:3},{value:"\u8fde\u9501\u66f4\u65b0\u662f\u600e\u4e48\u53d1\u751f\u7684\uff1f",id:"\u8fde\u9501\u66f4\u65b0\u662f\u600e\u4e48\u53d1\u751f\u7684",level:3},{value:"Redis \u4e3a\u4ec0\u4e48\u4e0d\u7528 C \u8bed\u8a00\u7684\u539f\u751f\u5b57\u7b26\u4e32\uff1f",id:"redis-\u4e3a\u4ec0\u4e48\u4e0d\u7528-c-\u8bed\u8a00\u7684\u539f\u751f\u5b57\u7b26\u4e32",level:3},{value:"\u4f60\u7814\u7a76\u8fc7 Redis \u7684\u5b57\u5178\u6e90\u7801\u5417\uff1f",id:"\u4f60\u7814\u7a76\u8fc7-redis-\u7684\u5b57\u5178\u6e90\u7801\u5417",level:3},{value:"\u9047\u5230\u54c8\u5e0c\u51b2\u7a81\u600e\u4e48\u529e\uff1f",id:"\u9047\u5230\u54c8\u5e0c\u51b2\u7a81\u600e\u4e48\u529e",level:3},{value:"\ud83c\udf1f\u4f60\u4e86\u89e3\u8df3\u8868\u5417\uff1f",id:"\u4f60\u4e86\u89e3\u8df3\u8868\u5417",level:3},{value:"\u600e\u4e48\u5f80\u8df3\u8868\u63d2\u5165\u8282\u70b9\u5462\uff1f",id:"\u600e\u4e48\u5f80\u8df3\u8868\u63d2\u5165\u8282\u70b9\u5462",level:3},{value:"zset\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u8df3\u8868\u5462\uff1f",id:"zset\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u8df3\u8868\u5462",level:3},{value:"\u8df3\u8868\u662f\u5982\u4f55\u5b9a\u4e49\u7684\u5462\uff1f",id:"\u8df3\u8868\u662f\u5982\u4f55\u5b9a\u4e49\u7684\u5462",level:3},{value:"span \u8de8\u5ea6\u6709\u4ec0\u4e48\u7528\uff1f",id:"span-\u8de8\u5ea6\u6709\u4ec0\u4e48\u7528",level:3},{value:"\u4e3a\u4ec0\u4e48\u8df3\u8868\u7684\u8303\u56f4\u67e5\u8be2\u6548\u7387\u6bd4\u5b57\u5178\u9ad8\uff1f",id:"\u4e3a\u4ec0\u4e48\u8df3\u8868\u7684\u8303\u56f4\u67e5\u8be2\u6548\u7387\u6bd4\u5b57\u5178\u9ad8",level:3},{value:"\u538b\u7f29\u5217\u8868\u4e86\u89e3\u5417\uff1f",id:"\u538b\u7f29\u5217\u8868\u4e86\u89e3\u5417",level:3},{value:"ziplist \u7684\u8282\u70b9\u6570\u91cf\u4f1a\u8d85\u8fc7 65535 \u5417\uff1f",id:"ziplist-\u7684\u8282\u70b9\u6570\u91cf\u4f1a\u8d85\u8fc7-65535-\u5417",level:3},{value:"ziplist \u7684\u7f16\u7801\u7c7b\u578b\u4e86\u89e3\u591a\u5c11\uff1f",id:"ziplist-\u7684\u7f16\u7801\u7c7b\u578b\u4e86\u89e3\u591a\u5c11",level:3},{value:"quicklist \u4e86\u89e3\u5417\uff1f",id:"quicklist-\u4e86\u89e3\u5417",level:3},{value:"LZF \u538b\u7f29\u7b97\u6cd5\u4e86\u89e3\u5417\uff1f",id:"lzf-\u538b\u7f29\u7b97\u6cd5\u4e86\u89e3\u5417",level:3},{value:"\u8865\u5145",id:"\u8865\u5145",level:2},{value:"\u5047\u5982 Redis \u91cc\u9762\u6709 1 \u4ebf\u4e2a key\uff0c\u5176\u4e2d\u6709 10w \u4e2a key \u662f\u4ee5\u67d0\u4e2a\u56fa\u5b9a\u7684\u5df2\u77e5\u7684\u524d\u7f00\u5f00\u5934\u7684\uff0c\u5982\u4f55\u5c06\u5b83\u4eec\u5168\u90e8\u627e\u51fa\u6765\uff1f",id:"\u5047\u5982-redis-\u91cc\u9762\u6709-1-\u4ebf\u4e2a-key\u5176\u4e2d\u6709-10w-\u4e2a-key-\u662f\u4ee5\u67d0\u4e2a\u56fa\u5b9a\u7684\u5df2\u77e5\u7684\u524d\u7f00\u5f00\u5934\u7684\u5982\u4f55\u5c06\u5b83\u4eec\u5168\u90e8\u627e\u51fa\u6765",level:3},{value:"Redis\u5728\u79d2\u6740\u573a\u666f\u4e0b\u53ef\u4ee5\u626e\u6f14\u4ec0\u4e48\u89d2\u8272\uff1f",id:"redis\u5728\u79d2\u6740\u573a\u666f\u4e0b\u53ef\u4ee5\u626e\u6f14\u4ec0\u4e48\u89d2\u8272",level:3},{value:"Redis\u5177\u4f53\u5982\u4f55\u5b9e\u73b0\u524a\u5cf0\u5462\uff1f",id:"redis\u5177\u4f53\u5982\u4f55\u5b9e\u73b0\u524a\u5cf0\u5462",level:3},{value:"Redis\u5982\u4f55\u505a\u9650\u6d41\u5462\uff1f",id:"redis\u5982\u4f55\u505a\u9650\u6d41\u5462",level:3},{value:"\u5ba2\u6237\u7aef\u5b95\u673a\u540e Redis \u670d\u52a1\u7aef\u5982\u4f55\u611f\u77e5\u5230\uff1f",id:"\u5ba2\u6237\u7aef\u5b95\u673a\u540e-redis-\u670d\u52a1\u7aef\u5982\u4f55\u611f\u77e5\u5230",level:3}];function h(e){const n={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",p:"p",pre:"pre",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h3,{id:"\u8bf4\u8bf4\u4ec0\u4e48\u662f-redis",children:"\ud83c\udf1f\u8bf4\u8bf4\u4ec0\u4e48\u662f Redis?"}),"\n",(0,i.jsx)(n.p,{children:"\u5b83\u4e3b\u8981\u7684\u7279\u70b9\u662f\u628a\u6570\u636e\u653e\u5728\u5185\u5b58\u5f53\u4e2d\uff0c\u76f8\u6bd4\u76f4\u63a5\u8bbf\u95ee\u78c1\u76d8\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u8bfb\u5199\u901f\u5ea6\u4f1a\u5feb\u5f88\u591a\uff0c\u57fa\u672c\u4e0a\u80fd\u8fbe\u5230\u5fae\u79d2\u7ea7\u7684\u54cd\u5e94\u3002\r\n\u6240\u4ee5\u5728\u4e00\u4e9b\u5bf9\u6027\u80fd\u8981\u6c42\u5f88\u9ad8\u7684\u573a\u666f\uff0c\u6bd4\u5982\u7f13\u5b58\u70ed\u70b9\u6570\u636e\u3001\u9632\u6b62\u63a5\u53e3\u7206\u5237\uff0c\u90fd\u4f1a\u7528\u5230 Redis\u3002\r\n\u4e0d\u4ec5\u5982\u6b64\uff0cRedis \u8fd8\u652f\u6301\u6301\u4e45\u5316\uff0c\u53ef\u4ee5\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5f02\u6b65\u843d\u76d8\uff0c\u4ee5\u4fbf\u670d\u52a1\u5b95\u673a\u91cd\u542f\u540e\u80fd\u6062\u590d\u6570\u636e"}),"\n",(0,i.jsx)(n.h3,{id:"redis-\u548c-mysql-\u7684\u533a\u522b",children:"Redis \u548c MySQL \u7684\u533a\u522b\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["Redis \u5c5e\u4e8e\u975e\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u6570\u636e\u662f\u901a\u8fc7\u952e\u503c\u5bf9\u7684\u5f62\u5f0f\u653e\u5728\u5185\u5b58\u5f53\u4e2d\u7684\uff1bMySQL \u5c5e\u4e8e\u5173\u7cfb\u578b\u6570\u636e\u5e93\uff0c\u6570\u636e\u4ee5\u884c\u548c\u5217\u7684\u5f62\u5f0f\u5b58\u50a8\u5728\u78c1\u76d8\u5f53\u4e2d\u3002\r\n",(0,i.jsx)(n.img,{alt:"img.png",src:r(87156).A+"",width:"1178",height:"786"}),"\r\n\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u4f1a\u5c06 MySQL \u4f5c\u4e3a\u4e3b\u5b58\u50a8\uff0cRedis \u4f5c\u4e3a\u7f13\u5b58\uff0c\u901a\u8fc7\u5148\u67e5 Redis\uff0c\u672a\u547d\u4e2d\u518d\u67e5 MySQL \u5e76\u5199\u56deRedis \u7684\u65b9\u5f0f\u6765\u63d0\u9ad8\u7cfb\u7edf\u7684\u6574\u4f53\u6027\u80fd"]}),"\n",(0,i.jsx)(n.h3,{id:"\u9879\u76ee\u91cc\u54ea\u91cc\u7528\u5230\u4e86-redis",children:"\u9879\u76ee\u91cc\u54ea\u91cc\u7528\u5230\u4e86 Redis\uff1f"}),"\n",(0,i.jsx)(n.h3,{id:"\u90e8\u7f72\u8fc7-redis-\u5417",children:"\u90e8\u7f72\u8fc7 Redis \u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u6211\u6709\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u90e8\u7f72\u5355\u673a\u7248 Redis\uff0c\u4ece\u5b98\u7f51\u4e0b\u8f7d\u6e90\u7801\u5305\u89e3\u538b\u540e\u6267\u884c make && make install \u7f16\u8bd1\u5b89\u88c5\u3002\u7136\u540e\u7f16\u8f91 redis.conf \u6587\u4ef6\uff0c\u5f00\u542f\u8fdc\u7a0b\u8bbf\u95ee\u3001\u8bbe\u7f6e\u5bc6\u7801\u3001\u9650\u5236\u5185\u5b58\u3001\u8bbe\u7f6e\u5185\u5b58\u8fc7\u671f\u6dd8\u6c70\u7b56\u7565\u3001\u5f00\u542f AOF \u6301\u4e45\u5316\u7b49\uff1a"}),"\n",(0,i.jsx)(n.h3,{id:"redis-\u7684\u9ad8\u53ef\u7528\u65b9\u6848\u6709\u90e8\u7f72\u8fc7\u5417",children:"Redis \u7684\u9ad8\u53ef\u7528\u65b9\u6848\u6709\u90e8\u7f72\u8fc7\u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u6709\u90e8\u7f72\u8fc7\u54e8\u5175\u673a\u5236\uff0c\u8fd9\u662f\u4e00\u4e2a\u76f8\u5bf9\u6210\u719f\u7684\u9ad8\u53ef\u7528\u89e3\u51b3\u65b9\u6848\uff0c\u6211\u4eec\u751f\u4ea7\u73af\u5883\u90e8\u7f72\u7684\u662f\u4e00\u4e3b\u4e24\u4ece\u7684 Redis \u5b9e\u4f8b\uff0c\u518d\u52a0\u4e0a\u4e09\u4e2a Sentinel \u8282\u70b9\u76d1\u63a7\u5b83\u4eec\u3002Sentinel \u7684\u914d\u7f6e\u76f8\u5bf9\u7b80\u5355\uff0c\u4e3b\u8981\u8bbe\u7f6e\u4e86\u6545\u969c\u8f6c\u79fb\u7684\u5224\u5b9a\u6761\u4ef6\u548c\u8d85\u65f6\u9608\u503c\u3002\r\n\u4e3b\u8282\u70b9\u914d\u7f6e:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"port 6379\r\nappendonly yes\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u4ece\u8282\u70b9\u914d\u7f6e\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"replicaof 192.168.1.10 6379\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u54e8\u5175\u8282\u70b9\u914d\u7f6e\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"sentinel monitor mymaster 192.168.1.10 6379 2\r\nsentinel down-after-milliseconds mymaster 5000\r\nsentinel failover-timeout mymaster 60000\r\nsentinel parallel-syncs mymaster 1\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u4e3b\u8282\u70b9\u53d1\u751f\u6545\u969c\u65f6\uff0cSentinel \u80fd\u591f\u81ea\u52a8\u68c0\u6d4b\u5e76\u534f\u5546\u9009\u51fa\u65b0\u7684\u4e3b\u8282\u70b9\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5927\u6982\u9700\u8981 10-15 \u79d2\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u53e6\u4e00\u4e2a\u5927\u578b\u9879\u76ee\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86 Redis Cluster \u96c6\u7fa4\u65b9\u6848\u3002\u8be5\u9879\u76ee\u6570\u636e\u91cf\u5927\u4e14\u589e\u957f\u5feb\uff0c\u9700\u8981\u6c34\u5e73\u6269\u5c55\u80fd\u529b\u3002\u6211\u4eec\u90e8\u7f72\u4e86 6 \u4e2a\u4e3b\u8282\u70b9\uff0c\u6bcf\u4e2a\u4e3b\u8282\u70b9\u914d\u5907\u4e00\u4e2a\u4ece\u8282\u70b9\uff0c\u5f62\u6210\u4e86\u4e00\u4e2a 3\u4e3b3\u4ece \u7684\u521d\u59cb\u96c6\u7fa4\u3002Redis Cluster \u7684\u8bbe\u7f6e\u6bd4 Sentinel \u590d\u6742\u4e00\u4e9b\uff0c\u9700\u8981\u6b63\u786e\u914d\u7f6e\u96c6\u7fa4\u8282\u70b9\u95f4\u901a\u4fe1\u3001\u5206\u7247\u6620\u5c04\u7b49\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-redis",children:"redis-server redis-7000.conf\r\nredis-server redis-7001.conf\r\n...\r\n\r\n# \u4f7f\u7528 redis-cli \u521b\u5efa\u96c6\u7fa4\r\n# Redis \u4f1a\u81ea\u52a8\u5c06 key \u54c8\u5e0c\u5230 16384 \u4e2a\u69fd\u4f4d\r\n# \u4e3b\u8282\u70b9\u5747\u5206\u69fd\u4f4d\uff0c\u4ece\u8282\u70b9\u81ea\u52a8\u8ddf\u968f\r\nredis-cli --cluster create \\\r\n  127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 \\\r\n  127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 \\\r\n  --cluster-replicas 1\n"})}),"\n",(0,i.jsx)(n.p,{children:"Redis Cluster \u6700\u5927\u7684\u4f18\u52bf\u662f\u6570\u636e\u81ea\u52a8\u5206\u7247\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u7b80\u5355\u5730\u589e\u52a0\u8282\u70b9\u6765\u6269\u5c55\u96c6\u7fa4\u5bb9\u91cf\u3002\u6b64\u5916\uff0c\u5b83\u7684\u6545\u969c\u8f6c\u79fb\u4e5f\u5f88\u5feb\uff0c\u901a\u5e38\u5728\u51e0\u79d2\u5185\u5c31\u80fd\u5b8c\u6210\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u4e8e\u4e00\u4e9b\u8f7b\u91cf\u7ea7\u5e94\u7528\uff0c\u6211\u4e5f\u4f7f\u7528\u8fc7\u4e3b\u4ece\u590d\u5236\u52a0\u624b\u52a8\u6545\u969c\u8f6c\u79fb\u7684\u65b9\u6848\u3002\u4e3b\u8282\u70b9\u8d1f\u8d23\u8bfb\u5199\u64cd\u4f5c\uff0c\u4ece\u8282\u70b9\u8d1f\u8d23\u8bfb\u64cd\u4f5c\u3002\u624b\u52a8\u6545\u969c\u8f6c\u79fb\u65f6\uff0c\u6211\u4eec\u4f1a\u5148\u5c06\u4ece\u8282\u70b9\u63d0\u5347\u4e3a\u4e3b\u8282\u70b9\uff0c\u7136\u540e\u91cd\u65b0\u914d\u7f6e\u5176\u4ed6\u4ece\u8282\u70b9\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-redis",children:"# 1. \u53d6\u6d88\u4ece\u8282\u70b9\u8eab\u4efd\r\nredis-cli -h <slave-ip> slaveof no one\r\n\r\n# 2. \u5c06\u5176\u4ed6\u4ece\u8282\u70b9\u6307\u5411\u65b0\u7684\u4e3b\u8282\u70b9\r\nredis-cli -h <other-slave-ip> slaveof <new-master-ip> <port>```\n"})}),"\n",(0,i.jsx)(n.h3,{id:"redis-\u53ef\u4ee5\u7528\u6765\u5e72\u4ec0\u4e48",children:".Redis \u53ef\u4ee5\u7528\u6765\u5e72\u4ec0\u4e48\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u53ef\u4ee5\u7528\u6765\u505a\u7f13\u5b58\uff0c\u6bd4\u5982\u8bf4\u628a\u9ad8\u9891\u8bbf\u95ee\u7684\u6587\u7ae0\u8be6\u60c5\u3001\u5546\u54c1\u4fe1\u606f\u3001\u7528\u6237\u4fe1\u606f\u653e\u5165 Redis \u5f53\u4e2d\uff0c\u5e76\u901a\u8fc7\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u6765\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u51cf\u8f7b\u6570\u636e\u5e93\u7684\u8bbf\u95ee\u538b\u529b\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"redis\u6709\u54ea\u4e9b\u6570\u636e\u7c7b\u578b",children:"Redis\u6709\u54ea\u4e9b\u6570\u636e\u7c7b\u578b\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["Redis \u652f\u6301\u4e94\u79cd\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff0c\u5206\u522b\u662f\u5b57\u7b26\u4e32\u3001\u5217\u8868\u3001\u54c8\u5e0c\u3001\u96c6\u5408\u548c\u6709\u5e8f\u96c6\u5408\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_1.png",src:r(86292).A+"",width:"818",height:"746"}),"\r\n\u8fd8\u6709\u4e09\u79cd\u6269\u5c55\u6570\u636e\u7c7b\u578b\uff0c\u5206\u522b\u662f\u7528\u4e8e\u4f4d\u7ea7\u64cd\u4f5c\u7684 Bitmap\u3001\u7528\u4e8e\u57fa\u6570\u4f30\u7b97\u7684 HyperLogLog\u3001\u652f\u6301\u5b58\u50a8\u548c\u67e5\u8be2\u5730\u7406\u5750\u6807\u7684 GEO\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u5b57\u7b26\u4e32\uff1f\r\n\u5b57\u7b26\u4e32\u662f\u6700\u57fa\u672c\u7684\u6570\u636e\u7c7b\u578b\uff0c\u53ef\u4ee5\u5b58\u50a8\u6587\u672c\u3001\u6570\u5b57\u6216\u8005\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u6700\u5927\u5bb9\u91cf\u662f 512 MB\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_2.png",src:r(8751).A+"",width:"1636",height:"620"}),"\r\n\u9002\u5408\u7f13\u5b58\u5355\u4e2a\u5bf9\u8c61\uff0c\u6bd4\u5982\u9a8c\u8bc1\u7801\u3001token\u3001\u8ba1\u6570\u5668\u7b49\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u5217\u8868\uff1f\r\n\u5217\u8868\u662f\u4e00\u4e2a\u6709\u5e8f\u7684\u5143\u7d20\u96c6\u5408\uff0c\u652f\u6301\u4ece\u5934\u90e8\u6216\u5c3e\u90e8\u63d2\u5165/\u5220\u9664\u5143\u7d20\uff0c\u5e38\u7528\u4e8e\u6d88\u606f\u961f\u5217\u6216\u4efb\u52a1\u5217\u8868\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_3.png",src:r(23654).A+"",width:"1710",height:"718"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u54c8\u5e0c",children:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u54c8\u5e0c\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u54c8\u5e0c\u662f\u4e00\u4e2a\u952e\u503c\u5bf9\u96c6\u5408\uff0c\u9002\u5408\u5b58\u50a8\u5bf9\u8c61\uff0c\u5982\u5546\u54c1\u4fe1\u606f\u3001\u7528\u6237\u4fe1\u606f\u7b49\u3002\u6bd4\u5982\u8bf4 ",(0,i.jsx)(n.code,{children:"value = {name: '\u6c89\u9ed8\u738b\u4e8c', age: 18}"}),"\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_4.png",src:r(28633).A+"",width:"1160",height:"908"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u96c6\u5408",children:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u96c6\u5408\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u96c6\u5408\u662f\u65e0\u5e8f\u4e14\u4e0d\u91cd\u590d\u7684\uff0c\u652f\u6301\u4ea4\u96c6\u3001\u5e76\u96c6\u64cd\u4f5c\uff0c\u67e5\u8be2\u6548\u7387\u80fd\u8fbe\u5230 O(1) \u7ea7\u522b\uff0c\u4e3b\u8981\u7528\u4e8e\u53bb\u91cd\u3001\u6807\u7b7e\u3001\u5171\u540c\u597d\u53cb\u7b49\u573a\u666f\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_5.png",src:r(96528).A+"",width:"1254",height:"686"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u6709\u5e8f\u96c6\u5408",children:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u6709\u5e8f\u96c6\u5408\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u6709\u5e8f\u96c6\u5408\u7684\u5143\u7d20\u6309\u5206\u6570\u8fdb\u884c\u6392\u5e8f\uff0c\u652f\u6301\u8303\u56f4\u67e5\u8be2\uff0c\u9002\u7528\u4e8e\u6392\u884c\u699c\u6216\u4f18\u5148\u7ea7\u961f\u5217\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_6.png",src:r(61931).A+"",width:"822",height:"392"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0bbitmap",children:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0bBitmap\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["Bitmap \u53ef\u4ee5\u628a\u4e00\u7ec4\u4e8c\u8fdb\u5236\u4f4d\u7d27\u51d1\u5730\u5b58\u50a8\u5728\u4e00\u5757\u8fde\u7eed\u5185\u5b58\u4e2d\uff0c\u6bcf\u4e00\u4f4d\u4ee3\u8868\u4e00\u4e2a\u5bf9\u8c61\u7684\u72b6\u6001\uff0c\u6bd4\u5982\u662f\u5426\u7b7e\u5230\u3001\u662f\u5426\u6d3b\u8dc3\u7b49\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_7.png",src:r(14626).A+"",width:"1098",height:"503"}),"\r\n\u6bd4\u5982\u7528\u6237 0 \u7684\u5df2\u7b7e\u5230 1\u3001\u7528\u6237 1 \u672a\u7b7e\u5230 0\u3001\u7528\u6237 2 \u5df2\u7b7e\u5230\uff0cRedis \u5c31\u4f1a\u628a\u8fd9\u4e9b\u72b6\u6001\u653e\u8fdb\u4e00\u4e2a\u8fde\u7eed\u7684\u4e8c\u8fdb\u5236\u4e32 101\uff0c1 \u4ebf\u7528\u6237\u7b7e\u5230\u4ec5\u9700 100,000,000 / 8 / 1024 \u2248 12MB \u7684\u7a7a\u95f4\uff0c\u771f\u7684\u7701\u5230\u79bb\u8c31\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0bhyperloglog",children:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0bHyperLogLog\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["HyperLogLog \u662f\u4e00\u79cd\u7528\u4e8e\u57fa\u6570\u7edf\u8ba1\u7684\u6982\u7387\u6027\u6570\u636e\u7ed3\u6784\uff0c\u53ef\u4ee5\u5728\u4ec5\u6709 12KB \u7684\u5185\u5b58\u7a7a\u95f4\u4e0b\uff0c\u7edf\u8ba1\u6d77\u91cf\u6570\u636e\u96c6\u4e2d\u4e0d\u91cd\u590d\u5143\u7d20\u7684\u4e2a\u6570\uff0c\u8bef\u5dee\u7387\u4ec5 0.81%\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_8.png",src:r(99141).A+"",width:"571",height:"225"}),"\r\n\u5e95\u5c42\u57fa\u4e8e LogLog \u7b97\u6cd5\u6539\u8fdb\uff0c\u5148\u628a\u6bcf\u4e2a\u5143\u7d20\u54c8\u5e0c\u6210\u4e00\u4e2a\u4e8c\u8fdb\u5236\u4e32\uff0c\u7136\u540e\u53d6\u524d 14 \u4f4d\u8fdb\u884c\u5206\u7ec4\uff0c\u653e\u5230 16384 \u4e2a\u6876\u4e2d\uff0c\u8bb0\u5f55\u6bcf\u7ec4\u6700\u5927\u7684\u524d\u5bfc\u96f6\u6570\u91cf\uff0c\u6700\u540e\u7528\u4e00\u4e2a\u8fd1\u4f3c\u516c\u5f0f\u63a8\u7b97\u51fa\u603b\u4f53\u7684\u57fa\u6570\u3002\r\n\uff1f\uff1f\uff1f"]}),"\n",(0,i.jsx)(n.h3,{id:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0bgeo",children:"\u8be6\u7ec6\u4ecb\u7ecd\u4e0bGEO\uff1f"}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3a\u4ec0\u4e48\u4f7f\u7528-hash-\u7c7b\u578b\u800c\u4e0d\u4f7f\u7528-string-\u7c7b\u578b\u5e8f\u5217\u5316\u5b58\u50a8",children:"\u4e3a\u4ec0\u4e48\u4f7f\u7528 hash \u7c7b\u578b\u800c\u4e0d\u4f7f\u7528 string \u7c7b\u578b\u5e8f\u5217\u5316\u5b58\u50a8\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"Hash \u53ef\u4ee5\u53ea\u8bfb\u53d6\u6216\u8005\u4fee\u6539\u67d0\u4e00\u4e2a\u5b57\u6bb5\uff0c\u800c String \u9700\u8981\u4e00\u6b21\u6027\u628a\u6574\u4e2a\u5bf9\u8c61\u53d6\u51fa\u6765\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"redis-\u4e3a\u4ec0\u4e48\u5feb\u5462",children:"\ud83c\udf1fRedis \u4e3a\u4ec0\u4e48\u5feb\u5462\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c\u4e00\uff0cRedis \u7684\u6240\u6709\u6570\u636e\u90fd\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u800c\u5185\u5b58\u7684\u8bfb\u5199\u901f\u5ea6\u672c\u8eab\u5c31\u6bd4\u78c1\u76d8\u5feb\u51e0\u4e2a\u6570\u91cf\u7ea7\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_9.png",src:r(81628).A+"",width:"1456",height:"682"}),"\r\n\u7b2c\u4e8c\uff0cRedis \u91c7\u7528\u4e86\u57fa\u4e8e IO \u591a\u8def\u590d\u7528\u6280\u672f\u7684\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\u6765\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\u548c\u6267\u884c Redis \u547d\u4ee4\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_10.png",src:r(63694).A+"",width:"2136",height:"674"}),"\r\n\u5176\u4e2d\u7684 IO \u591a\u8def\u590d\u7528\u6280\u672f\u53ef\u4ee5\u5728\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\uff0c\u540c\u65f6\u76d1\u542c\u6210\u5343\u4e0a\u4e07\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\uff0c\u89e3\u51b3\u4f20\u7edf IO \u6a21\u578b\u4e2d\u6bcf\u4e2a\u8fde\u63a5\u90fd\u9700\u8981\u4e00\u4e2a\u72ec\u7acb\u7ebf\u7a0b\u5e26\u6765\u7684\u6027\u80fd\u5f00\u9500\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_11.png",src:r(37335).A+"",width:"2417",height:"985"}),"\r\nIO \u591a\u8def\u590d\u7528\u4f1a\u6301\u7eed\u76d1\u542c\u8bf7\u6c42\uff0c\u7136\u540e\u628a\u51c6\u5907\u597d\u7684\u8bf7\u6c42\u538b\u5165\u5230\u4e00\u4e2a\u961f\u5217\u5f53\u4e2d\uff0c\u5e76\u5c06\u5176\u6709\u5e8f\u5730\u4f20\u9012\u7ed9\u6587\u4ef6\u4e8b\u4ef6\u5206\u6d3e\u5668\uff0c\u6700\u540e\u7531\u4e8b\u4ef6\u5904\u7406\u5668\u6765\u6267\u884c\u5bf9\u5e94\u7684 accept\u3001read \u548c write \u8bf7\u6c42\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_12.png",src:r(48604).A+"",width:"1272",height:"1150"}),"\r\nRedis \u4f1a\u6839\u636e\u64cd\u4f5c\u7cfb\u7edf\u9009\u62e9\u6700\u4f18\u7684 IO \u591a\u8def\u590d\u7528\u6280\u672f\uff0c\u6bd4\u5982 Linux \u4e0b\u4f7f\u7528 epoll\uff0cmacOS \u4e0b\u4f7f\u7528 kqueue \u7b49\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5728 Redis 6.0 \u4e4b\u524d\uff0c\u5305\u62ec\u8fde\u63a5\u5efa\u7acb\u3001\u8bf7\u6c42\u8bfb\u53d6\u3001\u54cd\u5e94\u53d1\u9001\uff0c\u4ee5\u53ca\u547d\u4ee4\u6267\u884c\u90fd\u662f\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u987a\u5e8f\u6267\u884c\u7684\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u7684\u9501\u7ade\u4e89\u548c\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u56e0\u4e3a Redis \u7684\u7edd\u5927\u90e8\u5206\u64cd\u4f5c\u90fd\u662f\u5728\u5185\u5b58\u4e2d\u8fdb\u884c\u7684\uff0c\u6027\u80fd\u74f6\u9888\u4e3b\u8981\u662f\u5185\u5b58\u64cd\u4f5c\u548c\u7f51\u7edc\u901a\u4fe1\uff0c\u800c\u4e0d\u662f CPU\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_13.png",src:r(66117).A+"",width:"1644",height:"656"}),"\r\n\u4e3a\u4e86\u8fdb\u4e00\u6b65\u89e3\u51b3\u7f51\u7edc IO \u7684\u6027\u80fd\u74f6\u9888\uff0cRedis 6.0 \u5f15\u5165\u4e86\u591a\u7ebf\u7a0b\u673a\u5236\uff0c\u628a\u7f51\u7edc IO \u548c\u547d\u4ee4\u6267\u884c\u5206\u5f00\uff0c\u7f51\u7edc IO \u4ea4\u7ed9\u7ebf\u7a0b\u6c60\u6765\u5904\u7406\uff0c\u800c\u547d\u4ee4\u6267\u884c\u4ecd\u7136\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u8fdb\u884c\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5145\u5206\u5229\u7528\u591a\u6838 CPU \u7684\u6027\u80fd\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_14.png",src:r(81450).A+"",width:"1638",height:"858"}),"\r\n\u4e3b\u7ebf\u7a0b\u4e13\u6ce8\u4e8e\u547d\u4ee4\u6267\u884c\uff0c\u7f51\u7edcIO \u7531\u5176\u4ed6\u7ebf\u7a0b\u5206\u62c5\uff0c\u5728\u591a\u6838 CPU \u73af\u5883\u4e0b\uff0cRedis \u7684\u6027\u80fd\u53ef\u4ee5\u5f97\u5230\u663e\u8457\u63d0\u5347\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_15.png",src:r(32211).A+"",width:"740",height:"1115"}),"\r\n\u603b\u7ed3\uff1a\r\n",(0,i.jsx)(n.img,{alt:"img_16.png",src:r(57720).A+"",width:"1400",height:"1036"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u80fd\u8be6\u7ec6\u8bf4\u4e00\u4e0bio\u591a\u8def\u590d\u7528\u5417",children:"\u80fd\u8be6\u7ec6\u8bf4\u4e00\u4e0bIO\u591a\u8def\u590d\u7528\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["IO \u591a\u8def\u590d\u7528\u662f\u4e00\u79cd\u5141\u8bb8\u5355\u4e2a\u8fdb\u7a0b\u540c\u65f6\u76d1\u89c6\u591a\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u6280\u672f\uff0c\u4f7f\u5f97\u7a0b\u5e8f\u80fd\u591f\u9ad8\u6548\u5904\u7406\u591a\u4e2a\u5e76\u53d1\u8fde\u63a5\u800c\u65e0\u9700\u521b\u5efa\u5927\u91cf\u7ebf\u7a0b\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_17.png",src:r(30433).A+"",width:"948",height:"618"}),"\r\nIO \u591a\u8def\u590d\u7528\u7684\u6838\u5fc3\u601d\u60f3\u662f\uff1a\u8ba9\u5355\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u7b49\u5f85\u591a\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u5c31\u7eea\uff0c\u7136\u540e\u5bf9\u5c31\u7eea\u7684\u63cf\u8ff0\u7b26\u8fdb\u884c\u64cd\u4f5c\u3002\u8fd9\u6837\u53ef\u4ee5\u5728\u4e0d\u4f7f\u7528\u591a\u7ebf\u7a0b\u6216\u591a\u8fdb\u7a0b\u7684\u60c5\u51b5\u4e0b\u5904\u7406\u5e76\u53d1\u8fde\u63a5\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_18.png",src:r(90630).A+"",width:"637",height:"772"})]}),"\n",(0,i.jsx)(n.p,{children:"\u4e3b\u8981\u7684\u5b9e\u73b0\u673a\u5236\u5305\u62ec select\u3001poll\u3001epoll\u3001kqueue \u548c IOCP \u7b49\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u8bf7\u8bf4\u8bf4-selectpollepollkqueue-\u548c-iocp-\u7684\u533a\u522b",children:(0,i.jsx)(n.a,{href:"https://javabetter.cn/sidebar/sanfene/redis.html#%E8%AF%B7%E8%AF%B4%E8%AF%B4-select%E3%80%81poll%E3%80%81epoll%E3%80%81kqueue-%E5%92%8C-iocp-%E7%9A%84%E5%8C%BA%E5%88%AB",children:"\u8bf7\u8bf4\u8bf4 select\u3001poll\u3001epoll\u3001kqueue \u548c IOCP \u7684\u533a\u522b\uff1f"})}),"\n",(0,i.jsx)(n.p,{children:"select \u7684\u7f3a\u70b9\u662f\u5355\u4e2a\u8fdb\u7a0b\u80fd\u76d1\u89c6\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u91cf\u6709\u9650\uff0c\u4e00\u822c\u4e3a 1024 \u4e2a\uff0c\u4e14\u6bcf\u6b21\u8c03\u7528\u90fd\u9700\u8981\u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\u4ece\u7528\u6237\u6001\u590d\u5236\u5230\u5185\u6838\u6001\uff0c\u7136\u540e\u904d\u5386\u627e\u51fa\u5c31\u7eea\u7684\u63cf\u8ff0\u7b26\uff0c\u6027\u80fd\u8f83\u5dee\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"// select \u7684\u57fa\u672c\u4f7f\u7528\r\nint select(int nfds, fd_set *readfds, fd_set *writefds, \r\n           fd_set *exceptfds, struct timeval *timeout);\r\n\r\n// \u793a\u4f8b\u4ee3\u7801\r\nfd_set readfds;\r\nFD_ZERO(&readfds);                // \u6e05\u7a7a\u96c6\u5408\r\nFD_SET(sockfd, &readfds);         // \u6dfb\u52a0\u76d1\u542c\u5957\u63a5\u5b57\r\nselect(sockfd + 1, &readfds, NULL, NULL, NULL);\r\nif (FD_ISSET(sockfd, &readfds)) { // \u68c0\u67e5\u662f\u5426\u5c31\u7eea\r\n    // \u5904\u7406\u8bfb\u4e8b\u4ef6\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"poll \u7684\u4f18\u70b9\u662f\u6ca1\u6709\u6700\u5927\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u91cf\u7684\u9650\u5236\uff0c\u4f46\u662f\u6bcf\u6b21\u8c03\u7528\u4ecd\u7136\u9700\u8981\u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\u4ece\u7528\u6237\u6001\u590d\u5236\u5230\u5185\u6838\u6001\uff0c\u4f9d\u7136\u9700\u8981\u904d\u5386\uff0c\u6027\u80fd\u4ecd\u7136\u8f83\u5dee\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"// poll \u7684\u57fa\u672c\u4f7f\u7528\r\nint poll(struct pollfd *fds, nfds_t nfds, int timeout);\r\n\r\n// \u793a\u4f8b\u4ee3\u7801\r\nstruct pollfd fds[MAX_EVENTS];\r\nfds[0].fd = sockfd;\r\nfds[0].events = POLLIN;    // \u76d1\u542c\u8bfb\u4e8b\u4ef6\r\npoll(fds, 1, -1);\r\nif (fds[0].revents & POLLIN) {\r\n    // \u5904\u7406\u8bfb\u4e8b\u4ef6\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"epoll \u662f Linux \u7279\u6709\u7684 IO \u591a\u8def\u590d\u7528\u673a\u5236\uff0c\u652f\u6301\u5927\u89c4\u6a21\u5e76\u53d1\u8fde\u63a5\uff0c\u4f7f\u7528\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\uff0c\u6027\u80fd\u66f4\u9ad8\u3002\u5176\u5de5\u4f5c\u539f\u7406\u662f\u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26\u6ce8\u518c\u5230\u5185\u6838\u4e2d\uff0c\u7136\u540e\u901a\u8fc7\u4e8b\u4ef6\u901a\u77e5\u673a\u5236\u6765\u5904\u7406\u5c31\u7eea\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u4e0d\u9700\u8981\u8f6e\u8be2\uff0c\u4e5f\u4e0d\u9700\u8981\u6570\u636e\u62f7\u8d1d\uff0c\u66f4\u6ca1\u6709\u6570\u91cf\u9650\u5236\uff0c\u6240\u4ee5\u6027\u80fd\u975e\u5e38\u9ad8\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"// epoll \u7684\u57fa\u672c\u4f7f\u7528\r\nint epoll_create(int size);\r\nint epoll_ctl(int epfd, int op, int fd, struct epoll_event *event);\r\nint epoll_wait(int epfd, struct epoll_event *events, int maxevents, int timeout);\r\n\r\n// \u793a\u4f8b\u4ee3\u7801\r\nint epfd = epoll_create(1);\r\nstruct epoll_event ev, events[MAX_EVENTS];\r\nev.events = EPOLLIN;\r\nev.data.fd = sockfd;\r\nepoll_ctl(epfd, EPOLL_CTL_ADD, sockfd, &ev);\r\n\r\nwhile (1) {\r\n    int nfds = epoll_wait(epfd, events, MAX_EVENTS, -1);\r\n    for (int i = 0; i < nfds; i++) {\r\n        if (events[i].data.fd == sockfd) {\r\n            // \u5904\u7406\u8bfb\u4e8b\u4ef6\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"kqueue \u662f BSD/macOS \u7cfb\u7edf\u4e0b\u7684 IO \u591a\u8def\u590d\u7528\u673a\u5236\uff0c\u7c7b\u4f3c\u4e8e epoll\uff0c\u652f\u6301\u5927\u89c4\u6a21\u5e76\u53d1\u8fde\u63a5\uff0c\u4f7f\u7528\u4e8b\u4ef6\u9a71\u52a8\u6a21\u578b\u3002\r\nIOCP \u662f Windows \u7cfb\u7edf\u4e0b\u7684 IO \u591a\u8def\u590d\u7528\u673a\u5236\uff0c\u4f7f\u7528\u4f7f\u7528\u5b8c\u6210\u7aef\u53e3\u6a21\u578b\u800c\u975e\u4e8b\u4ef6\u901a\u77e5\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3e\u4e2a\u4f8b\u5b50\u8bf4\u4e00\u4e0b-io-\u591a\u8def\u590d\u7528",children:"\u4e3e\u4e2a\u4f8b\u5b50\u8bf4\u4e00\u4e0b IO \u591a\u8def\u590d\u7528\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u6bd4\u5982\u8bf4\u6211\u662f\u4e00\u540d\u6570\u5b66\u8001\u5e08\uff0c\u4e0a\u8bfe\u65f6\u63d0\u51fa\u4e86\u4e00\u4e2a\u95ee\u9898\uff1a\u201c\u4eca\u5929\u8c01\u6765\u8bc1\u660e\u4e00\u4e0b\u52fe\u80a1\u5b9a\u5f8b\uff1f\u201d"}),"\n",(0,i.jsx)(n.p,{children:"\u540c\u5b66\u5c0f\u738b\u4e3e\u624b\uff0c\u6211\u5c31\u8ba9\u5c0f\u738b\u56de\u7b54\uff1b\u5c0f\u674e\u4e3e\u624b\uff0c\u6211\u5c31\u8ba9\u5c0f\u674e\u56de\u7b54\uff1b\u5c0f\u5f20\u4e3e\u624b\uff0c\u6211\u5c31\u8ba9\u5c0f\u5f20\u56de\u7b54\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd9\u79cd\u6a21\u5f0f\u5c31\u662f IO \u591a\u8def\u590d\u7528\uff0c\u6211\u53ea\u9700\u8981\u5728\u8bb2\u53f0\u4e0a\u7b49\uff0c\u8c01\u4e3e\u624b\u8c01\u56de\u7b54\uff0c\u4e0d\u9700\u8981\u4e00\u4e2a\u4e00\u4e2a\u53bb\u95ee\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756682551610",src:r(99262).A+"",width:"1127",height:"616"}),"\r\nRedis \u5c31\u662f\u4f7f\u7528 epoll \u8fd9\u6837\u7684 IO \u591a\u8def\u590d\u7528\u673a\u5236\uff0c\u5728\u5355\u7ebf\u7a0b\u6a21\u578b\u4e0b\u5b9e\u73b0\u9ad8\u6548\u7684\u7f51\u7edc IO\uff0c\u4ece\u800c\u652f\u6301\u9ad8\u5e76\u53d1\u7684\u8bf7\u6c42\u5904\u7406\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3e\u4f8b\u5b50\u8bf4\u4e00\u4e0b\u963b\u585e-io\u548c-io-\u591a\u8def\u590d\u7528\u7684\u5dee\u522b",children:"\u4e3e\u4f8b\u5b50\u8bf4\u4e00\u4e0b\u963b\u585e IO\u548c IO \u591a\u8def\u590d\u7528\u7684\u5dee\u522b\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u5047\u8bbe\u6211\u662f\u4e00\u540d\u8001\u5e08\uff0c\u8ba9\u5b66\u751f\u89e3\u7b54\u4e00\u9053\u9898\u76ee\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u6211\u7684\u7b2c\u4e00\u79cd\u9009\u62e9\uff1a\u6309\u987a\u5e8f\u9010\u4e2a\u68c0\u67e5\uff0c\u5148\u68c0\u67e5 A\u540c\u5b66\uff0c\u7136\u540e\u662f B\uff0c\u4e4b\u540e\u662f C\u3001D\u3002\u3002\u3002\u8fd9\u4e2d\u95f4\u5982\u679c\u6709\u4e00\u4e2a\u5b66\u751f\u5361\u4f4f\uff0c\u5168\u73ed\u90fd\u4f1a\u88ab\u803d\u8bef\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd9\u79cd\u5c31\u662f\u963b\u585e IO\uff0c\u4e0d\u5177\u6709\u5e76\u53d1\u80fd\u529b\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756682584609",src:r(63658).A+"",width:"760",height:"1095"}),"\r\n",(0,i.jsx)(n.img,{alt:"1756682598255",src:r(10412).A+"",width:"760",height:"1095"}),"\r\n\u6211\u7684\u7b2c\u4e8c\u79cd\u9009\u62e9\uff0c\u6211\u7ad9\u5728\u8bb2\u53f0\u4e0a\u7b49\uff0c\u8c01\u4e3e\u624b\u6211\u53bb\u68c0\u67e5\u8c01\u3002C\u3001D \u4e3e\u624b\uff0c\u6211\u53bb\u68c0\u67e5 C\u3001D \u7684\u7b54\u6848\uff0c\u7136\u540e\u7ee7\u7eed\u56de\u5230\u8bb2\u53f0\u4e0a\u7b49\u3002\u6b64\u65f6 E\u3001A \u53c8\u4e3e\u624b\uff0c\u7136\u540e\u53bb\u5904\u7406 E \u548c A\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"selectpoll-\u548c-epoll-\u7684\u5b9e\u73b0\u539f\u7406",children:"select\u3001poll \u548c epoll \u7684\u5b9e\u73b0\u539f\u7406\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"select \u548c poll \u90fd\u662f\u901a\u8fc7\u628a\u6240\u6709\u6587\u4ef6\u63cf\u8ff0\u7b26\u4f20\u9012\u7ed9\u5185\u6838\uff0c\u7531\u5185\u6838\u904d\u5386\u5224\u65ad\u54ea\u4e9b\u5c31\u7eea\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["select \u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26 FD \u901a\u8fc7 BitsMap \u4f20\u5165\u5185\u6838\uff0c\u8f6e\u8be2\u6240\u6709\u7684 FD\uff0c\u901a\u8fc7\u8c03\u7528 file->poll \u51fd\u6570\u67e5\u8be2\u662f\u5426\u6709\u5bf9\u5e94\u4e8b\u4ef6\uff0c\u6ca1\u6709\u5c31\u5c06 task \u52a0\u5165 FD \u5bf9\u5e94 file \u7684\u5f85\u5524\u9192\u961f\u5217\uff0c\u7b49\u5f85\u4e8b\u4ef6\u6765\u4e34\u88ab\u5524\u9192\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756682635040",src:r(88948).A+"",width:"2157",height:"1243"}),"\r\npoll \u6539\u8fdb\u4e86\u8fde\u63a5\u6570\u4e0a\u9650\u95ee\u9898\uff0c\u4e0d\u518d\u7528 BitsMap \u6765\u4f20\u5165 FD\uff0c\u53d6\u800c\u4ee3\u4e4b\u7684\u662f\u52a8\u6001\u6570\u7ec4 pollfd\uff0c\u4f46\u672c\u8d28\u4e0a\u4ecd\u662f\u7ebf\u6027\u904d\u5386\uff0c\u6027\u80fd\u6ca1\u6709\u63d0\u5347\u592a\u591a\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756682644061",src:r(4795).A+"",width:"1503",height:"780"}),"\r\nselect\u548cpoll\u7684\u6a21\u5f0f\u90fd\u662f\uff0c\u4e00\u6b21\u5c06\u53c2\u6570\u62f7\u8d1d\u5230\u5185\u6838\u7a7a\u95f4\uff0c\u7b49\u6709\u7ed3\u679c\u4e86\u518d\u4e00\u6b21\u62f7\u8d1d\u51fa\u53bb\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["epoll \u5c06\u76d1\u542c\u7684 FD \u6ce8\u518c\u8fdb\u5185\u6838\u7684\u7ea2\u9ed1\u6811\uff0c\u7531\u5185\u6838\u5728\u4e8b\u4ef6\u89e6\u53d1\u65f6\u5c06\u5c31\u7eea\u7684 FD \u653e\u5165 ready list\u3002\u5e94\u7528\u7a0b\u5e8f\u901a\u8fc7 epoll_wait \u83b7\u53d6\u5c31\u7eea\u7684 FD\uff0c\u4ece\u800c\u907f\u514d\u904d\u5386\u6240\u6709\u8fde\u63a5\u7684\u5f00\u9500\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756682656684",src:r(28689).A+"",width:"2125",height:"1217"}),"\r\nepoll \u6700\u5927\u7684\u4f18\u70b9\u662f\uff1a\u652f\u6301\u4e8b\u4ef6\u9a71\u52a8 + \u8fb9\u7f18\u89e6\u53d1\uff0cADD \u65f6\u62f7\u8d1d\u4e00\u6b21\uff0cepoll_wait \u65f6\u5229\u7528 MMAP \u548c\u7528\u6237\u5171\u4eab\u7a7a\u95f4\uff0c\u76f4\u63a5\u62f7\u8d1d\u6570\u636e\u5230\u7528\u6237\u7a7a\u95f4\uff0c\u56e0\u6b64\u5728\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\u6027\u80fd\u8fdc\u9ad8\u4e8e select \u548c poll\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"redis\u4e3a\u4ec0\u4e48\u65e9\u671f\u9009\u62e9\u5355\u7ebf\u7a0b",children:"Redis\u4e3a\u4ec0\u4e48\u65e9\u671f\u9009\u62e9\u5355\u7ebf\u7a0b\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c\u4e00\uff0c\u5355\u7ebf\u7a0b\u6a21\u578b\u4e0d\u9700\u8981\u8003\u8651\u590d\u6742\u7684\u9501\u673a\u5236\uff0c\u4e0d\u5b58\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u7684\u6b7b\u9501\u3001\u7ade\u6001\u6761\u4ef6\u7b49\u95ee\u9898\uff0c\u5f00\u53d1\u8d77\u6765\u66f4\u5feb\uff0c\u4e5f\u66f4\u5bb9\u6613\u7ef4\u62a4\r\n",(0,i.jsx)(n.img,{alt:"1756682689243",src:r(23586).A+"",width:"2978",height:"1228"})]}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e8c\uff0cRedis \u662fIO \u5bc6\u96c6\u578b\u800c\u975e CPU \u5bc6\u96c6\u578b\uff0c\u4e3b\u8981\u53d7\u5185\u5b58\u548c\u7f51\u7edc IO \u9650\u5236\uff0c\u800c\u975e CPU \u7684\u8ba1\u7b97\u80fd\u529b\uff0c\u5355\u7ebf\u7a0b\u53ef\u4ee5\u907f\u514d\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u5f00\u9500\u3002\r\n\u54ea\u6015\u6211\u4eec\u5728\u4e00\u4e2a\u666e\u901a\u7684 Linux \u670d\u52a1\u5668\u4e0a\u542f\u52a8 Redis \u670d\u52a1\uff0c\u5b83\u4e5f\u80fd\u5728 1s \u5185\u5904\u7406 1000000 \u4e2a\u7528\u6237\u8bf7\u6c42\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e09\uff0c\u5355\u7ebf\u7a0b\u53ef\u4ee5\u4fdd\u8bc1\u547d\u4ee4\u6267\u884c\u7684\u539f\u5b50\u6027\uff0c\u65e0\u9700\u989d\u5916\u7684\u540c\u6b65\u673a\u5236\u3002"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u867d\u7136\u6700\u521d\u91c7\u7528\u4e86\u5355\u7ebf\u7a0b\u8bbe\u8ba1\uff0c\u4f46\u540e\u7eed\u7684\u7248\u672c\u4e2d\u4e5f\u5728\u7279\u5b9a\u65b9\u9762\u5f15\u5165\u4e86\u591a\u7ebf\u7a0b\uff0c\u6bd4\u5982\u8bf4 Redis 4.0 \u5c31\u5f15\u5f02\u6b65\u591a\u7ebf\u7a0b\uff0c\u7528\u4e8e\u6e05\u7406\u810f\u6570\u636e\u3001\u91ca\u653e\u65e0\u7528\u8fde\u63a5\u3001\u5220\u9664\u5927 Key \u7b49\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"redis-60-\u4f7f\u7528\u591a\u7ebf\u7a0b\u662f\u600e\u4e48\u56de\u4e8b",children:"Redis 6.0 \u4f7f\u7528\u591a\u7ebf\u7a0b\u662f\u600e\u4e48\u56de\u4e8b?"}),"\n",(0,i.jsx)(n.p,{children:"Redis 6.0 \u7684\u591a\u7ebf\u7a0b\u4ec5\u7528\u4e8e\u5904\u7406\u7f51\u7edc IO\uff0c\u5305\u62ec\u7f51\u7edc\u6570\u636e\u7684\u8bfb\u53d6\u3001\u5199\u5165\uff0c\u4ee5\u53ca\u8bf7\u6c42\u89e3\u6790\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u800c\u547d\u4ee4\u7684\u6267\u884c\u4f9d\u7136\u662f\u5355\u7ebf\u7a0b\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u88ab\u79f0\u4e3a\u201cIO \u7ebf\u7a0b\u5316\u201d\uff0c\u80fd\u591f\u5728\u9ad8\u8d1f\u8f7d\u7684\u60c5\u51b5\u4e0b\uff0c\u6700\u5927\u9650\u5ea6\u5730\u63d0\u5347 Redis \u7684\u54cd\u5e94\u901f\u5ea6\u3002"}),"\n",(0,i.jsx)(n.p,{children:"---- \u8fd9\u90e8\u5206\u9762\u8bd5\u4e2d\u53ef\u4ee5\u4e0d\u80cc\uff0c\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3 start ----"}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u4e00\u53d8\u5316\u4e3b\u8981\u662f\u56e0\u4e3a\u968f\u7740\u7f51\u7edc\u5e26\u5bbd\u548c\u670d\u52a1\u5668\u6027\u80fd\u7684\u63d0\u5347\uff0cRedis \u7684\u74f6\u9888\u4ece CPU \u9010\u6e10\u8f6c\u79fb\u5230\u4e86\u7f51\u7edc IO\uff1a"}),"\n",(0,i.jsxs)(n.p,{children:["\u5e26\u5bbd\u4ece 10Gbps \u63d0\u5347\u5230 100Gbps\uff0c\u751a\u81f3\u66f4\u9ad8\u3002\r\n\u8bf7\u6c42\u7684\u5e76\u53d1\u6570\u4ece\u51e0\u5343\u5230\u51e0\u4e07\uff0c\u751a\u81f3\u51e0\u5341\u4e07\u3002\r\n\u5355\u7ebf\u7a0b\u5728\u9ad8\u8d1f\u8f7d\u573a\u666f\u4e0b\u5904\u7406\u7f51\u7edc IO \u51fa\u73b0\u4e86\u660e\u663e\u7684\u6027\u80fd\u74f6\u9888\uff0cRedis \u7684\u5f00\u53d1\u56e2\u961f\u901a\u8fc7\u7814\u7a76\u53d1\u73b0\uff0c\u5728\u5904\u7406\u5927\u6570\u636e\u5305\u65f6\uff0c\u5355\u7ebf\u7a0b Redis \u6709\u8d85\u8fc7 80% \u7684 CPU \u65f6\u95f4\u82b1\u5728\u7f51\u7edc IO \u4e0a\uff0c\u800c\u5b9e\u9645\u547d\u4ee4\u6267\u884c\u4ec5\u5360 20% \u5de6\u53f3\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756682807254",src:r(34258).A+"",width:"1162",height:"888"})]}),"\n",(0,i.jsx)(n.p,{children:"Redis 6.0 \u7684\u591a\u7ebf\u7a0b IO \u6a21\u578b\u4e3b\u8981\u5305\u542b\u4e09\u4e2a\u6838\u5fc3\u6b65\u9aa4\uff1a\r\n\u4ecd\u7136\u7531\u4e3b\u7ebf\u7a0b\u8d1f\u8d23\u63a5\u6536\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\u3002\r\n\u4e3b\u7ebf\u7a0b\u5c06\u8fde\u63a5\u8bf7\u6c42\u5206\u53d1\u7ed9\u591a\u4e2a IO \u7ebf\u7a0b\u8fdb\u884c\u5904\u7406\uff0c\u4e3b\u7ebf\u7a0b\u8d1f\u8d23\u89e3\u6790\u548c\u6267\u884c\u547d\u4ee4\u3002\r\n\u547d\u4ee4\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u7531\u591a\u4e2a IO \u7ebf\u7a0b\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002"}),"\n",(0,i.jsx)(n.p,{children:"Redis 6.0 \u9ed8\u8ba4\u4ecd\u7136\u4f7f\u7528\u5355\u7ebf\u7a0b\u6a21\u5f0f\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u6216\u547d\u4ee4\u884c\u53c2\u6570\u542f\u7528\u591a\u7ebf\u7a0b\u6a21\u5f0f\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5efa\u8bae\u5c06 IO \u7ebf\u7a0b\u6570\u8bbe\u7f6e\u4e3a CPU \u6838\u5fc3\u6570\u7684\u4e00\u534a\uff0c\u4e00\u822c\u4e0d\u5efa\u8bae\u8d85\u8fc7 8 \u4e2a\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7ecf\u8fc7\u591a\u6b21\u6d4b\u8bd5\uff0cRedis 6.0 \u5728\u5904\u7406 1-200 \u5b57\u8282\u7684\u5c0f\u6570\u636e\u5305\u65f6\uff0c\u6027\u80fd\u63d0\u5347 1.5-2 \u500d\uff1b\u5728\u5904\u7406 1KB \u4ee5\u4e0a\u7684\u5927\u6570\u636e\u5305\u65f6\u63d0\u5347\u7ea6 3-5 \u500d\u3002"}),"\n",(0,i.jsx)(n.p,{children:"----\u8fd9\u90e8\u5206\u9762\u8bd5\u4e2d\u53ef\u4ee5\u4e0d\u80cc\uff0c\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3 end ----"}),"\n",(0,i.jsx)(n.h3,{id:"\u8bf4\u8bf4-redis-\u7684\u5e38\u7528\u547d\u4ee4\u8865\u5145",children:"\u8bf4\u8bf4 Redis \u7684\u5e38\u7528\u547d\u4ee4\uff08\u8865\u5145\uff09"}),"\n",(0,i.jsx)(n.p,{children:"\u4e00\u53e5\u8bdd\u56de\u7b54\uff08\u4e5f\u4e0d\u7528\u5168\u90e8\u90fd\u80cc\uff0c\u6311\u4e09\u4e2a\u5c31\u884c\uff09\uff1a\r\nRedis \u652f\u6301\u591a\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u5e38\u7528\u7684\u547d\u4ee4\u4e5f\u6bd4\u8f83\u591a\uff0c\u6bd4\u5982\u8bf4\u64cd\u4f5c\u5b57\u7b26\u4e32\u53ef\u4ee5\u7528 SET/GET/INCR\uff0c\u64cd\u4f5c\u54c8\u5e0c\u53ef\u4ee5\u7528 HSET/HGET/HGETALL\uff0c\u64cd\u4f5c\u5217\u8868\u53ef\u4ee5\u7528 LPUSH/LPOP/LRANGE\uff0c\u64cd\u4f5c\u96c6\u5408\u53ef\u4ee5\u7528 SADD/SISMEMBER\uff0c\u64cd\u4f5c\u6709\u5e8f\u96c6\u5408\u53ef\u4ee5\u7528 ZADD/ZRANGE/ZINCRBY\u7b49\uff0c\u901a\u7528\u547d\u4ee4\u6709 EXPIRE/DEL/KEYS \u7b49\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u8be6\u7ec6\u8bf4\u8bf4-set-\u547d\u4ee4",children:"\u8be6\u7ec6\u8bf4\u8bf4 set \u547d\u4ee4\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"SET \u547d\u4ee4\u7528\u4e8e\u8bbe\u7f6e\u5b57\u7b26\u4e32\u7684 key\uff0c\u652f\u6301\u8fc7\u671f\u65f6\u95f4\u548c\u6761\u4ef6\u5199\u5165\uff0c\u5e38\u7528\u4e8e\u8bbe\u7f6e\u7f13\u5b58\u3001\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u3001\u5ef6\u957f Session \u7b49\u573a\u666f\u3002\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cSET \u4f1a\u8986\u76d6\u952e\u5df2\u6709\u7684\u503c\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u652f\u6301\u591a\u79cd\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u65b9\u5f0f\uff0c\u6bd4\u5982\u8bf4 EX \u8bbe\u7f6e\u79d2\u7ea7\u8fc7\u671f\u65f6\u95f4\uff0cPX \u8bbe\u7f6e\u6beb\u79d2\u8fc7\u671f\u65f6\u95f4\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u652f\u6301\u6761\u4ef6\u5199\u5165\uff0c\u4f7f\u5176\u53ef\u4ee5\u5b9e\u73b0\u539f\u5b50\u6027\u64cd\u4f5c\uff0c\u6bd4\u5982\u8bf4 NX \u4ec5\u5728\u952e\u4e0d\u5b58\u5728\u65f6\u8bbe\u7f6e\u503c\uff0cXX \u4ec5\u5728\u952e\u5b58\u5728\u65f6\u8bbe\u7f6e\u503c\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7f13\u5b58\u5b9e\u73b0\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-reids",children:"SET user:profile:{userid} {JSON\u6570\u636e} EX 3600  # \u5b58\u50a8\u7528\u6237\u8d44\u6599\uff0c\u5e76\u8bbe\u7f6e1\u5c0f\u65f6\u8fc7\u671f\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-reids",children:"SET lock:resource_name {random_value} EX 10 NX  # \u83b7\u53d6\u9501\uff0c10\u79d2\u540e\u81ea\u52a8\u91ca\u653e\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5b58\u50a8 Session\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-reids",children:"SET session:{sessionid} {session_data} EX 1800  # \u5b58\u50a8\u7528\u6237\u4f1a\u8bdd\uff0c30\u5206\u949f\u8fc7\u671f\n"})}),"\n",(0,i.jsx)(n.h4,{id:"sadd-\u547d\u4ee4\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u591a\u5c11",children:"sadd \u547d\u4ee4\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f\u591a\u5c11\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"SADD \u652f\u6301\u4e00\u6b21\u6dfb\u52a0\u591a\u4e2a\u5143\u7d20\uff0c\u8fd4\u56de\u503c\u4e3a\u5b9e\u9645\u6dfb\u52a0\u6210\u529f\u7684\u5143\u7d20\u6570\u91cf\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(N)\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-reids",children:'redis-cli SADD myset "apple" "banana" "orange"\n'})}),"\n",(0,i.jsx)(n.h4,{id:"incr\u547d\u4ee4\u4e86\u89e3\u5417",children:"incr\u547d\u4ee4\u4e86\u89e3\u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"INCR \u662f\u4e00\u4e2a\u539f\u5b50\u547d\u4ee4\uff0c\u53ef\u4ee5\u5c06\u6307\u5b9a\u952e\u7684\u503c\u52a0 1\uff0c\u5982\u679c key \u4e0d\u5b58\u5728\uff0c\u4f1a\u5148\u5c06\u5176\u8bbe\u7f6e\u4e3a 0\uff0c\u518d\u6267\u884c\u52a0 1 \u64cd\u4f5c\u3002\r\n\u5e38\u7528\u4e8e\u7f51\u7ad9\u8bbf\u95ee\u91cf\u3001\u6587\u7ae0\u70b9\u8d5e\u6570\u7b49\u8ba1\u6570\u5668\u7684\u5b9e\u73b0\uff1b\u7ed3\u5408\u8fc7\u671f\u65f6\u95f4\u5b9e\u73b0\u9650\u6d41\u5668\uff1b\u751f\u6210\u5206\u5e03\u5f0f\u552f\u4e00 ID\uff1b\u5e93\u5b58\u6263\u51cf\u7b49\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'# \u9650\u5236\u7528\u6237\u6bcf\u5206\u949f\u6700\u591a\u8bbf\u95ee10\u6b21\r\nFUNCTION limit_api_call(user_id)\r\n    current = INCR("rate:"+user_id)\r\n    IF current == 1 THEN\r\n        EXPIRE("rate:"+user_id, 60)\r\n    END\r\n    IF current > 10 THEN\r\n        RETURN false  # \u8d85\u51fa\u9650\u5236\r\n    ELSE\r\n        RETURN true   # \u5141\u8bb8\u8bbf\u95ee\r\n    END\r\nEND\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u5355\u7ebf\u7a0b\u7684redis-qps-\u80fd\u5230\u591a\u5c11\u8865\u5145",children:"\u5355\u7ebf\u7a0b\u7684Redis QPS \u80fd\u5230\u591a\u5c11\uff1f(\u8865\u5145)"}),"\n",(0,i.jsx)(n.p,{children:"\u4e00\u4e2a\u666e\u901a\u670d\u52a1\u5668\u7684 Redis \u5b9e\u4f8b\u901a\u5e38\u53ef\u4ee5\u8fbe\u5230\u6bcf\u79d2\u5341\u4e07\u5de6\u53f3\u7684 QPS\u3002\r\n----\u8fd9\u90e8\u5206\u9762\u8bd5\u4e2d\u53ef\u4ee5\u4e0d\u80cc\uff0c\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3 start ----"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u7684 QPS\uff08\u6bcf\u79d2\u8bf7\u6c42\u6570\uff09\u6027\u80fd\u53d6\u51b3\u4e8e\u591a\u79cd\u56e0\u7d20\uff0c\u5305\u62ec\u786c\u4ef6\u914d\u7f6e\u3001\u7f51\u7edc\u5ef6\u8fdf\u3001\u6570\u636e\u7ed3\u6784\u3001\u547d\u4ee4\u7c7b\u578b\u7b49\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u53ef\u4ee5\u901a\u8fc7 redis-benchmark \u547d\u4ee4\u8fdb\u884c\u57fa\u51c6\u6d4b\u8bd5\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"redis-benchmark -h 127.0.0.1 -p 6379 -c 50 -n 10000"}),"\n",(0,i.jsx)(n.p,{children:"2023 \u5e74\u524d\uff0c\u6211\u7528\u7684\u662f\u4e00\u53f0 macOS\uff0c4 GHz \u56db\u6838 Intel Core i7\uff0c32 GB 1867 MHz DDR3\uff0c\u6d4b\u8bd5\u7ed3\u679c\u5982\u4e0b\uff1a\r\n\u53ef\u4ee5\u770b\u5f97\u51fa\uff0c\u6bcf\u79d2\u80fd\u5904\u7406\u8d85\u8fc7 10 \u4e07\u6b21\u8bf7\u6c42\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u6301\u4e45\u5316",children:"\u6301\u4e45\u5316"}),"\n",(0,i.jsx)(n.h3,{id:"redis\u7684\u6301\u4e45\u5316\u65b9\u5f0f\u6709\u54ea\u4e9b",children:"\ud83c\udf1fRedis\u7684\u6301\u4e45\u5316\u65b9\u5f0f\u6709\u54ea\u4e9b\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e3b\u8981\u6709\u4e24\u79cd\uff0cRDB \u548c AOF\u3002RDB \u901a\u8fc7\u521b\u5efa\u65f6\u95f4\u70b9\u5feb\u7167\u6765\u5b9e\u73b0\u6301\u4e45\u5316\uff0cAOF \u901a\u8fc7\u8bb0\u5f55\u6bcf\u4e2a\u5199\u64cd\u4f5c\u547d\u4ee4\u6765\u5b9e\u73b0\u6301\u4e45\u5316\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756683157769",src:r(52928).A+"",width:"609",height:"400"}),"\r\n\u8fd9\u4e24\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1 Redis \u670d\u52a1\u5668\u5728\u91cd\u542f\u540e\u4e0d\u4e22\u5931\u6570\u636e\uff0c\u901a\u8fc7 RDB \u548c AOF \u6587\u4ef6\u6765\u6062\u590d\u5185\u5b58\u4e2d\u539f\u6709\u7684\u6570\u636e\u3002"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"1756683178222",src:r(92233).A+"",width:"923",height:"1200"})}),"\n",(0,i.jsx)(n.h3,{id:"\u8be6\u7ec6\u8bf4\u4e00\u4e0b-rdb",children:"\u8be6\u7ec6\u8bf4\u4e00\u4e0b RDB\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["RDB \u6301\u4e45\u5316\u673a\u5236\u53ef\u4ee5\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u5185\u5c06 Redis \u67d0\u4e00\u65f6\u523b\u7684\u6570\u636e\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684 RDB \u6587\u4ef6\u4e2d\uff0c\u5f53 Redis \u91cd\u542f\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u52a0\u8f7d\u8fd9\u4e2a RDB \u6587\u4ef6\u6765\u6062\u590d\u6570\u636e\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756683200167",src:r(89085).A+"",width:"1456",height:"1299"})]}),"\n",(0,i.jsxs)(n.p,{children:["RDB \u6301\u4e45\u5316\u53ef\u4ee5\u901a\u8fc7 save \u548c bgsave \u547d\u4ee4\u624b\u52a8\u89e6\u53d1\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 save \u6307\u4ee4\u81ea\u52a8\u89e6\u53d1\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756683233212",src:r(13128).A+"",width:"517",height:"362"}),"\r\nsave \u547d\u4ee4\u4f1a\u963b\u585e Redis \u8fdb\u7a0b\uff0c\u76f4\u5230 RDB \u6587\u4ef6\u521b\u5efa\u5b8c\u6210\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["bgsave \u547d\u4ee4\u4f1a\u5728\u540e\u53f0 fork \u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u6267\u884c RDB \u6301\u4e45\u5316\u64cd\u4f5c\uff0c\u4e3b\u8fdb\u7a0b\u4e0d\u4f1a\u88ab\u963b\u585e\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756683248047",src:r(55746).A+"",width:"687",height:"455"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u81ea\u52a8\u89e6\u53d1-rdb-\u6301\u4e45\u5316",children:"\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u81ea\u52a8\u89e6\u53d1 RDB \u6301\u4e45\u5316\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c\u4e00\u79cd\uff0c\u5728 Redis \u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e RDB \u6301\u4e45\u5316\u53c2\u6570 ",(0,i.jsx)(n.code,{children:"save <seconds> <changes>"}),"\uff0c\u8868\u793a\u5728\u6307\u5b9a\u65f6\u95f4\u95f4\u9694\u5185\uff0c\u5982\u679c\u6709\u6307\u5b9a\u6570\u91cf\u7684\u952e\u53d1\u751f\u53d8\u5316\uff0c\u5c31\u4f1a\u81ea\u52a8\u89e6\u53d1 RDB \u6301\u4e45\u5316\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c\u4e8c\u79cd\uff0c\u4e3b\u4ece\u590d\u5236\u65f6\uff0c\u5f53\u4ece\u8282\u70b9\u7b2c\u4e00\u6b21\u8fde\u63a5\u5230\u4e3b\u8282\u70b9\u65f6\uff0c\u4e3b\u8282\u70b9\u4f1a\u81ea\u52a8\u6267\u884c bgsave \u751f\u6210 RDB \u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u53d1\u9001\u7ed9\u4ece\u8282\u70b9\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756684381469",src:r(2629).A+"",width:"828",height:"842"}),"\r\n\u7b2c\u4e09\u79cd\uff0c\u5982\u679c\u6ca1\u6709\u5f00\u542f AOF\uff0c\u6267\u884c shutdown \u547d\u4ee4\u65f6\uff0cRedis \u4f1a\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21 RDB \u6587\u4ef6\uff0c\u4ee5\u786e\u4fdd\u6570\u636e\u4e0d\u4f1a\u4e22\u5931"]}),"\n",(0,i.jsx)(n.h3,{id:"\u8be6\u7ec6\u8bf4\u4e00\u4e0b-aof",children:"\u8be6\u7ec6\u8bf4\u4e00\u4e0b AOF\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["AOF \u901a\u8fc7\u8bb0\u5f55\u6bcf\u4e2a\u5199\u64cd\u4f5c\u547d\u4ee4\uff0c\u5e76\u5c06\u5176\u8ffd\u52a0\u5230 AOF \u6587\u4ef6\u6765\u5b9e\u73b0\u6301\u4e45\u5316\uff0cRedis \u670d\u52a1\u5668\u5b95\u673a\u540e\u53ef\u4ee5\u901a\u8fc7\u91cd\u65b0\u6267\u884c\u8fd9\u4e9b\u547d\u4ee4\u6765\u6062\u590d\u6570\u636e\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756684416650",src:r(17206).A+"",width:"1456",height:"662"}),"\r\n\u5f53 Redis \u6267\u884c\u5199\u64cd\u4f5c\u65f6\uff0c\u4f1a\u5c06\u5199\u547d\u4ee4\u8ffd\u52a0\u5230 AOF \u7f13\u51b2\u533a\uff1bRedis \u4f1a\u6839\u636e\u540c\u6b65\u7b56\u7565\u5c06\u7f13\u51b2\u533a\u7684\u6570\u636e\u5199\u5165\u5230 AOF \u6587\u4ef6\u3002\r\n\u5f53 AOF \u6587\u4ef6\u8fc7\u5927\u65f6\uff0cRedis \u4f1a\u81ea\u52a8\u8fdb\u884c AOF \u91cd\u5199\uff0c\u5254\u9664\u591a\u4f59\u7684\u547d\u4ee4\uff0c\u6bd4\u5982\u8bf4\u591a\u6b21\u5bf9\u540c\u4e00\u4e2a key \u7684 set \u548c del\uff0c\u751f\u6210\u4e00\u4e2a\u65b0\u7684 AOF \u6587\u4ef6\uff1b\u5f53 Redis \u91cd\u542f\u65f6\uff0c\u8bfb\u53d6 AOF \u6587\u4ef6\u4e2d\u7684\u547d\u4ee4\u5e76\u91cd\u65b0\u6267\u884c\uff0c\u4ee5\u6062\u590d\u6570\u636e\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"aof-\u7684\u5237\u76d8\u7b56\u7565\u4e86\u89e3\u5417",children:"AOF \u7684\u5237\u76d8\u7b56\u7565\u4e86\u89e3\u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u5c06 AOF \u7f13\u51b2\u533a\u7684\u6570\u636e\u5199\u5165\u5230 AOF \u6587\u4ef6\u65f6\uff0c\u6d89\u53ca\u4e24\u4e2a\u7cfb\u7edf\u8c03\u7528\uff1awrite \u5c06\u6570\u636e\u5199\u5165\u5230\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f13\u51b2\u533a\uff0cfsync \u5c06 OS \u7f13\u51b2\u533a\u7684\u6570\u636e\u5237\u65b0\u5230\u78c1\u76d8\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u91cc\u7684\u5237\u76d8\u6d89\u53ca\u5230\u4e09\u79cd\u7b56\u7565\uff1aalways\u3001everysec \u548c no\u3002"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"1756684447804",src:r(12697).A+"",width:"1200",height:"1095"})}),"\n",(0,i.jsx)(n.p,{children:"always\uff1a\u6bcf\u6b21\u5199\u547d\u4ee4\u6267\u884c\u5b8c\uff0c\u7acb\u5373\u8c03\u7528 fsync \u540c\u6b65\u5230\u78c1\u76d8\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u4e0d\u4e22\u5931\uff0c\u4f46\u6027\u80fd\u8f83\u5dee\u3002\r\neverysec\uff1a\u6bcf\u79d2\u8c03\u7528\u4e00\u6b21 fsync\uff0c\u5c06\u591a\u6761\u547d\u4ee4\u4e00\u6b21\u6027\u540c\u6b65\u5230\u78c1\u76d8\uff0c\u6027\u80fd\u8f83\u597d\uff0c\u6570\u636e\u4e22\u5931\u7684\u65f6\u95f4\u7a97\u53e3\u4e3a 1 \u79d2\u3002\r\nno\uff1a\u4e0d\u4e3b\u52a8\u8c03\u7528 fsync\uff0c\u7531\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\uff0c\u6027\u80fd\u6700\u597d\uff0c\u4f46\u6570\u636e\u4e22\u5931\u7684\u65f6\u95f4\u7a97\u53e3\u4e0d\u786e\u5b9a\uff0c\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f13\u5b58\u7b56\u7565\uff0c\u53ef\u80fd\u4f1a\u4e22\u5931\u5927\u91cf\u6570\u636e\u3002\r\n\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 appendfsync \u53c2\u6570\u8fdb\u884c\u8bbe\u7f6e\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u8bf4\u8bf4aof\u7684\u91cd\u5199\u673a\u5236",children:"\u8bf4\u8bf4AOF\u7684\u91cd\u5199\u673a\u5236\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u7531\u4e8e AOF \u6587\u4ef6\u4f1a\u968f\u7740\u5199\u64cd\u4f5c\u7684\u589e\u52a0\u800c\u4e0d\u65ad\u589e\u957f\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c Redis \u63d0\u4f9b\u4e86\u91cd\u5199\u673a\u5236\u6765\u5bf9 AOF \u6587\u4ef6\u8fdb\u884c\u538b\u7f29\u548c\u4f18\u5316\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756684639798",src:r(90470).A+"",width:"3970",height:"1080"})]}),"\n",(0,i.jsx)(n.p,{children:"AOF \u91cd\u5199\u53ef\u4ee5\u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u89e6\u53d1\uff0c\u7b2c\u4e00\u79cd\u662f\u624b\u52a8\u6267\u884c BGREWRITEAOF \u547d\u4ee4\uff0c\u9002\u7528\u4e8e\u9700\u8981\u7acb\u5373\u51cf\u5c0fAOF\u6587\u4ef6\u5927\u5c0f\u7684\u573a\u666f\u3002\r\n\u7b2c\u4e8c\u79cd\u662f\u5728 Redis \u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u81ea\u52a8\u91cd\u5199\u53c2\u6570\uff0c\u6bd4\u5982\u8bf4 auto-aof-rewrite-percentage \u548c auto-aof-rewrite-min-size\uff0c\u8868\u793a\u5f53 AOF \u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7\u6307\u5b9a\u503c\u65f6\uff0c\u81ea\u52a8\u89e6\u53d1\u91cd\u5199\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"auto-aof-rewrite-percentage 100  # \u9ed8\u8ba4\u503c100\uff0c\u8868\u793a\u5f53\u524dAOF\u6587\u4ef6\u5927\u5c0f\u76f8\u6bd4\u4e0a\u6b21\u91cd\u5199\u540e\u5927\u5c0f\u589e\u957f\u4e86\u591a\u5c11\u767e\u5206\u6bd4\u65f6\u89e6\u53d1\u91cd\u5199\r\nauto-aof-rewrite-min-size 64mb  # \u9ed8\u8ba4\u503c64MB\uff0c\u8868\u793aAOF\u6587\u4ef6\u81f3\u5c11\u8981\u8fbe\u5230\u8fd9\u4e2a\u5927\u5c0f\u624d\u4f1a\u8003\u8651\u91cd\u5199\n"})}),"\n",(0,i.jsx)(n.h3,{id:"aof-\u91cd\u5199\u7684\u5177\u4f53\u8fc7\u7a0b\u662f\u600e\u6837\u7684",children:"AOF \u91cd\u5199\u7684\u5177\u4f53\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["Redis \u5728\u6536\u5230\u91cd\u5199\u6307\u4ee4\u540e\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u5e76 fork \u4e00\u4efd\u4e0e\u7236\u8fdb\u7a0b\u5b8c\u5168\u76f8\u540c\u7684\u6570\u636e\u526f\u672c\uff0c\u7136\u540e\u904d\u5386\u5185\u5b58\u4e2d\u7684\u6240\u6709\u952e\u503c\u5bf9\uff0c\u751f\u6210\u91cd\u5efa\u5b83\u4eec\u6240\u9700\u7684\u6700\u5c11\u547d\u4ee4\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756684702329",src:r(23475).A+"",width:"1158",height:"642"}),"\r\n\u6bd4\u5982\u8bf4\u591a\u4e2a RPUSH \u547d\u4ee4\u53ef\u4ee5\u5408\u5e76\u4e3a\u4e00\u4e2a\u5e26\u6709\u591a\u4e2a\u53c2\u6570\u7684 RPUSH\uff1b"]}),"\n",(0,i.jsx)(n.p,{children:"\u6bd4\u5982\u8bf4\u4e00\u4e2a\u952e\u88ab\u8bbe\u7f6e\u540e\u53c8\u88ab\u5220\u9664\uff0c\u8fd9\u4e2a\u952e\u7684\u6240\u6709\u64cd\u4f5c\u90fd\u4e0d\u4f1a\u88ab\u5199\u5165\u65b0 AOF\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u6bd4\u5982\u8bf4\u4f7f\u7528 SADD key member1 member2 member3 \u4ee3\u66ff\u591a\u4e2a\u5355\u72ec\u7684 SADD key memberX\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5b50\u8fdb\u7a0b\u5728\u6267\u884c AOF \u91cd\u5199\u7684\u540c\u65f6\uff0c\u4e3b\u8fdb\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u5904\u7406\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u547d\u4ee4\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\uff0cRedis \u4f7f\u7528\u4e86 AOF \u91cd\u5199\u7f13\u51b2\u533a\u673a\u5236\uff0c\u4e3b\u8fdb\u7a0b\u5728\u6267\u884c\u5199\u64cd\u4f5c\u65f6\uff0c\u4f1a\u5c06\u547d\u4ee4\u540c\u65f6\u5199\u5165\u65e7\u7684 AOF \u6587\u4ef6\u548c\u91cd\u5199\u7f13\u51b2\u533a\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b49\u5b50\u8fdb\u7a0b\u5b8c\u6210\u91cd\u5199\u540e\uff0c\u4f1a\u5411\u4e3b\u8fdb\u7a0b\u53d1\u9001\u4e00\u4e2a\u4fe1\u53f7\uff0c\u4e3b\u8fdb\u7a0b\u6536\u5230\u540e\u5c06\u91cd\u5199\u7f13\u51b2\u533a\u4e2d\u7684\u547d\u4ee4\u8ffd\u52a0\u5230\u65b0\u7684 AOF \u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u8c03\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684 rename\uff0c\u5c06\u65e7\u7684 AOF \u6587\u4ef6\u66ff\u6362\u4e3a\u65b0\u7684 AOF \u6587\u4ef6\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\u4e3b\u8fdb\u7a0b\uff08fork\uff09  \r\n   \u2502  \r\n   \u251c\u2500\u2192 \u5b50\u8fdb\u7a0b\uff08\u751f\u6210\u65b0\u7684 AOF \u6587\u4ef6\uff09  \r\n   \u2502       \u2502  \r\n   \u2502       \u251c\u2500\u2192 \u5185\u5b58\u5feb\u7167  \r\n   \u2502       \u251c\u2500\u2192 \u5199\u5165\u4e34\u65f6 AOF \u6587\u4ef6  \r\n   \u2502       \u251c\u2500\u2192 \u901a\u77e5\u4e3b\u8fdb\u7a0b\u5b8c\u6210  \r\n   \u2502  \r\n   \u251c\u2500\u2192 \u4e3b\u8fdb\u7a0b\uff08\u8ffd\u52a0\u7f13\u51b2\u533a\u5230\u65b0 AOF \u6587\u4ef6\uff09  \r\n   \u251c\u2500\u2192 \u66ff\u6362\u65e7 AOF \u6587\u4ef6  \r\n   \u251c\u2500\u2192 \u91cd\u5199\u5b8c\u6210\n"})}),"\n",(0,i.jsx)(n.p,{children:"AOF \u91cd\u5199\u671f\u95f4\uff0cRedis \u670d\u52a1\u5668\u4f1a\u5904\u4e8e\u7279\u6b8a\u72b6\u6001\uff1a\r\naof_child_pid \u4e0d\u4e3a 0\uff0c\u8868\u793a\u6709\u5b50\u8fdb\u7a0b\u5728\u6267\u884c AOF \u91cd\u5199\r\naof_rewrite_buf_blocks \u94fe\u8868\u4e0d\u4e3a\u7a7a\uff0c\u5b58\u50a8 AOF \u91cd\u5199\u7f13\u51b2\u533a\u5185\u5bb9\r\n\u5982\u679c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e no-appendfsync-on-rewrite \u4e3a yes\uff0c\u90a3\u4e48\u91cd\u5199\u671f\u95f4\u53ef\u80fd\u4f1a\u6682\u505c AOF \u6587\u4ef6\u7684 fsync \u64cd\u4f5c\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"aof-\u6587\u4ef6\u5b58\u50a8\u7684\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u6570\u636e",children:"AOF \u6587\u4ef6\u5b58\u50a8\u7684\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u6570\u636e\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"AOF \u6587\u4ef6\u5b58\u50a8\u7684\u662f Redis \u670d\u52a1\u5668\u63a5\u6536\u5230\u7684\u5199\u547d\u4ee4\u6570\u636e\uff0c\u4ee5 Redis \u534f\u8bae\u683c\u5f0f\u4fdd\u5b58\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u79cd\u683c\u5f0f\u7684\u7279\u70b9\u662f\uff0c\u6bcf\u4e2a\u547d\u4ee4\u4ee5*\u5f00\u5934\uff0c\u540e\u8ddf\u53c2\u6570\u7684\u6570\u91cf\uff0c\u6bcf\u4e2a\u53c2\u6570\u524d\u7528$\u7b26\u53f7\uff0c\u540e\u8ddf\u53c2\u6570\u5b57\u8282\u957f\u5ea6\uff0c\u7136\u540e\u662f\u53c2\u6570\u7684\u5b9e\u9645\u5185\u5bb9\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"aof\u91cd\u5199\u671f\u95f4\u547d\u4ee4\u53ef\u80fd\u4f1a\u5199\u5165\u4e24\u6b21\u4f1a\u9020\u6210\u4ec0\u4e48\u5f71\u54cd",children:"AOF\u91cd\u5199\u671f\u95f4\u547d\u4ee4\u53ef\u80fd\u4f1a\u5199\u5165\u4e24\u6b21\uff0c\u4f1a\u9020\u6210\u4ec0\u4e48\u5f71\u54cd\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["AOF \u91cd\u5199\u671f\u95f4\u547d\u4ee4\u4f1a\u540c\u65f6\u5199\u5165\u73b0\u6709AOF\u6587\u4ef6\u548c\u91cd\u5199\u7f13\u51b2\u533a\uff0c\u8fd9\u79cd\u673a\u5236\u662f\u6709\u610f\u8bbe\u8ba1\u7684\uff0c\u5e76\u4e0d\u4f1a\u5bfc\u81f4\u6570\u636e\u91cd\u590d\u6216\u4e0d\u4e00\u81f4\u95ee\u9898\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756684860111",src:r(91153).A+"",width:"900",height:"466"}),"\r\n\u56e0\u4e3a\u65b0\u65e7\u6587\u4ef6\u662f\u5206\u79bb\u7684\uff0c\u73b0\u6709\u547d\u4ee4\u5199\u5165\u5f53\u524d AOF \u6587\u4ef6\uff0c\u91cd\u5199\u7f13\u51b2\u533a\u7684\u547d\u4ee4\u6700\u7ec8\u5199\u5165\u65b0\u7684 AOF \u6587\u4ef6\uff0c\u5b8c\u6210\u540e\uff0c\u65b0\u6587\u4ef6\u901a\u8fc7\u539f\u5b50\u6027\u7684 rename \u64cd\u4f5c\u66ff\u6362\u65e7\u6587\u4ef6\u3002\u4e24\u4e2a\u6587\u4ef6\u662f\u5b8c\u5168\u5206\u79bb\u7684\uff0c\u4e0d\u4f1a\u5bfc\u81f4\u540c\u4e00\u4e2a AOF \u6587\u4ef6\u4e2d\u51fa\u73b0\u91cd\u590d\u547d\u4ee4\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"rdb-\u548c-aof-\u5404\u81ea\u6709\u4ec0\u4e48\u4f18\u7f3a\u70b9",children:"RDB \u548c AOF \u5404\u81ea\u6709\u4ec0\u4e48\u4f18\u7f3a\u70b9\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"RDB \u901a\u8fc7 fork \u5b50\u8fdb\u7a0b\u5728\u7279\u5b9a\u65f6\u95f4\u70b9\u5bf9\u5185\u5b58\u6570\u636e\u8fdb\u884c\u5168\u91cf\u5907\u4efd\uff0c\u751f\u6210\u4e8c\u8fdb\u5236\u683c\u5f0f\u7684\u5feb\u7167\u6587\u4ef6\u3002\u5176\u6700\u5927\u4f18\u52bf\u5728\u4e8e\u5907\u4efd\u6062\u590d\u6548\u7387\u9ad8\uff0c\u6587\u4ef6\u7d27\u51d1\uff0c\u6062\u590d\u901f\u5ea6\u5feb\uff0c\u9002\u5408\u5927\u89c4\u6a21\u6570\u636e\u7684\u5907\u4efd\u548c\u8fc1\u79fb\u573a\u666f\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u7f3a\u70b9\u662f\u53ef\u80fd\u4e22\u5931\u4e24\u6b21\u5feb\u7167\u671f\u95f4\u7684\u6240\u6709\u6570\u636e\u53d8\u66f4\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756684935119",src:r(47268).A+"",width:"1600",height:"332"})]}),"\n",(0,i.jsx)(n.p,{children:"AOF \u4f1a\u8bb0\u5f55\u6bcf\u4e00\u6761\u4fee\u6539\u6570\u636e\u7684\u5199\u547d\u4ee4\u3002\u8fd9\u79cd\u65e5\u5fd7\u8ffd\u52a0\u7684\u65b9\u5f0f\u8ba9 AOF \u80fd\u591f\u63d0\u4f9b\u63a5\u8fd1\u5b9e\u65f6\u7684\u6570\u636e\u5907\u4efd\uff0c\u6570\u636e\u4e22\u5931\u98ce\u9669\u53ef\u4ee5\u63a7\u5236\u5728 1 \u79d2\u5185\u751a\u81f3\u5b8c\u5168\u907f\u514d\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7f3a\u70b9\u662f\u6587\u4ef6\u4f53\u79ef\u8f83\u5927\uff0c\u6062\u590d\u901f\u5ea6\u6162\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u6765\u4e2a\u8868\u683c\u5bf9\u6bd4\u4e00\u4e0b\uff1a\r\nwaitx"}),"\n",(0,i.jsx)(n.h3,{id:"rdb-\u548c-aof-\u5982\u4f55\u9009\u62e9",children:"RDB \u548c AOF \u5982\u4f55\u9009\u62e9\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u9009\u62e9 Redis \u6301\u4e45\u5316\u65b9\u6848\u65f6\uff0c\u6211\u4f1a\u4ece\u4e1a\u52a1\u9700\u6c42\u548c\u6280\u672f\u7279\u6027\u4e24\u4e2a\u7ef4\u5ea6\u6765\u8003\u8651\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u5982\u679c\u662f\u7f13\u5b58\u573a\u666f\uff0c\u53ef\u4ee5\u63a5\u53d7\u4e00\u5b9a\u7a0b\u5ea6\u7684\u6570\u636e\u4e22\u5931\uff0c\u6211\u4f1a\u503e\u5411\u4e8e\u9009\u62e9 RDB \u6216\u8005\u5b8c\u5168\u4e0d\u4f7f\u7528\u6301\u4e45\u5316\u3002RDB \u7684\u5feb\u7167\u65b9\u5f0f\u5bf9\u6027\u80fd\u5f71\u54cd\u5c0f\uff0c\u800c\u4e14\u6062\u590d\u901f\u5ea6\u5feb\uff0c\u975e\u5e38\u9002\u5408\u8fd9\u7c7b\u573a\u666f\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756684999300",src:r(62490).A+"",width:"2750",height:"1631"})]}),"\n",(0,i.jsxs)(n.p,{children:["\u4f46\u5982\u679c\u662f\u5904\u7406\u8ba2\u5355\u6216\u8005\u652f\u4ed8\u8fd9\u6837\u7684\u6838\u5fc3\u4e1a\u52a1\uff0c\u6570\u636e\u4e22\u5931\u5c06\u9020\u6210\u4e25\u91cd\u540e\u679c\uff0c\u90a3\u4e48 AOF \u5c31\u6210\u4e3a\u5fc5\u7136\u9009\u62e9\u3002\u901a\u8fc7\u914d\u7f6e\u6bcf\u79d2\u540c\u6b65\u4e00\u6b21\uff0c\u53ef\u4ee5\u5c06\u6f5c\u5728\u7684\u6570\u636e\u4e22\u5931\u98ce\u9669\u9650\u5236\u5728\u53ef\u63a5\u53d7\u8303\u56f4\u5185\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756685011005",src:r(15450).A+"",width:"2176",height:"1582"})]}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u5b9e\u9645\u7684\u9879\u76ee\u5f53\u4e2d\uff0c\u6211\u66f4\u504f\u5411\u4e8e\u4f7f\u7528 RDB + AOF \u7684\u6df7\u5408\u6a21\u5f0f\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"redis\u5982\u4f55\u6062\u590d\u6570\u636e",children:"Redis\u5982\u4f55\u6062\u590d\u6570\u636e\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u5f53 Redis \u670d\u52a1\u91cd\u542f\u65f6\uff0c\u5b83\u4f1a\u4f18\u5148\u67e5\u627e AOF \u6587\u4ef6\uff0c\u5982\u679c\u5b58\u5728\u5c31\u901a\u8fc7\u91cd\u653e\u5176\u4e2d\u7684\u547d\u4ee4\u6765\u6062\u590d\u6570\u636e\uff1b\u5982\u679c\u4e0d\u5b58\u5728\u6216\u672a\u542f\u7528 AOF\uff0c\u5219\u4f1a\u5c1d\u8bd5\u52a0\u8f7d RDB \u6587\u4ef6\uff0c\u76f4\u63a5\u5c06\u4e8c\u8fdb\u5236\u6570\u636e\u8f7d\u5165\u5185\u5b58\u6765\u6062\u590d\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756685033216",src:r(53876).A+"",width:"772",height:"512"}),"\r\n\u5982\u679c AOF \u6587\u4ef6\u635f\u574f\u7684\u8bdd\uff0cRedis \u4f1a\u5c1d\u8bd5\u901a\u8fc7 redis-check-aof \u5de5\u5177\u6765\u4fee\u590d AOF \u6587\u4ef6\uff0c\u6216\u8005\u76f4\u63a5\u4f7f\u7528 --repair \u53c2\u6570\u6765\u4fee\u590d\u3002\r\n\u867d\u7136 Redis \u8fd8\u63d0\u4f9b\u4e86 redis-check-rdb \u5de5\u5177\u6765\u68c0\u67e5 RDB \u6587\u4ef6\u7684\u5b8c\u6574\u6027\uff0c\u4f46\u5b83\u5e76\u4e0d\u652f\u6301\u4fee\u590d RDB \u6587\u4ef6\uff0c\u53ea\u80fd\u7528\u6765\u9a8c\u8bc1\u6587\u4ef6\u7684\u5b8c\u6574\u6027\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"redis-40-\u7684\u6df7\u5408\u6301\u4e45\u5316\u4e86\u89e3\u5417",children:"\ud83c\udf1fRedis 4.0 \u7684\u6df7\u5408\u6301\u4e45\u5316\u4e86\u89e3\u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u6df7\u5408\u6301\u4e45\u5316\u7ed3\u5408\u4e86 RDB \u548c AOF \u4e24\u79cd\u65b9\u5f0f\u7684\u4f18\u70b9\uff0c\u89e3\u51b3\u4e86\u5b83\u4eec\u5404\u81ea\u7684\u4e0d\u8db3\u3002\u5728 Redis 4.0 \u4e4b\u524d\uff0c\u6211\u4eec\u8981\u4e48\u9762\u4e34 RDB \u53ef\u80fd\u4e22\u5931\u6570\u636e\u7684\u98ce\u9669\uff0c\u8981\u4e48\u627f\u53d7 AOF \u6062\u590d\u6162\u7684\u95ee\u9898\uff0c\u5f88\u96be\u4e24\u5168\u5176\u7f8e\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u6df7\u5408\u6301\u4e45\u5316\u7684\u5de5\u4f5c\u539f\u7406\u975e\u5e38\u5de7\u5999\uff1a\u5728 AOF \u91cd\u5199\u671f\u95f4\uff0c\u5148\u4ee5 RDB \u683c\u5f0f\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5feb\u7167\u4fdd\u5b58\u5230 AOF \u6587\u4ef6\u7684\u5f00\u5934\uff0c\u518d\u5c06\u91cd\u5199\u671f\u95f4\u7684\u547d\u4ee4\u4ee5 AOF \u683c\u5f0f\u8ffd\u52a0\u5230\u6587\u4ef6\u672b\u5c3e\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756685081098",src:r(28925).A+"",width:"664",height:"327"}),"\r\n\u8fd9\u6837\uff0c\u5f53\u9700\u8981\u6062\u590d\u6570\u636e\u65f6\uff0cRedis \u5148\u52a0\u8f7d RDB \u683c\u5f0f\u7684\u6570\u636e\u6765\u5feb\u901f\u6062\u590d\u5927\u90e8\u5206\u7684\u6570\u636e\uff0c\u7136\u540e\u901a\u8fc7\u91cd\u653e\u547d\u4ee4\u6062\u590d\u6700\u8fd1\u7684\u6570\u636e\uff0c\u8fd9\u6837\u5c31\u80fd\u5728\u4fdd\u8bc1\u6570\u636e\u5b8c\u6574\u6027\u7684\u540c\u65f6\uff0c\u63d0\u5347\u6062\u590d\u901f\u5ea6\u3002\r\n\u5982\u4f55\u8bbe\u7f6e\u6301\u4e45\u5316\u6a21\u5f0f\uff1f\r\n\u542f\u7528\u6df7\u5408\u6301\u4e45\u5316\u7684\u65b9\u5f0f\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e aof-use-rdb-preamble yes \u5c31\u53ef\u4ee5\u4e86\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u4f60\u5728\u5f00\u53d1\u4e2d\u662f\u600e\u4e48\u914d\u7f6e-rdb-\u548c-aof-\u7684",children:"\u4f60\u5728\u5f00\u53d1\u4e2d\u662f\u600e\u4e48\u914d\u7f6e RDB \u548c AOF \u7684\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u4e8e\u5927\u591a\u6570\u751f\u4ea7\u73af\u5883\uff0c\u6211\u503e\u5411\u4e8e\u4f7f\u7528\u6df7\u5408\u6301\u4e45\u5316\u65b9\u5f0f\uff0c\u7ed3\u5408 RDB \u548c AOF \u7684\u4f18\u70b9\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# \u542f\u7528AOF\r\nappendonly yes\r\n\r\n# \u4f7f\u7528\u6df7\u5408\u6301\u4e45\u5316\r\naof-use-rdb-preamble yes\r\n\r\n# \u6bcf\u79d2\u540c\u6b65\u4e00\u6b21AOF\uff0c\u5e73\u8861\u6027\u80fd\u548c\u5b89\u5168\u6027\r\nappendfsync everysec\r\n\r\n# AOF\u91cd\u5199\u89e6\u53d1\u6761\u4ef6\uff1a\u6587\u4ef6\u589e\u957f100%\u4e14\u81f3\u5c11\u8fbe\u523064MB\r\nauto-aof-rewrite-percentage 100\r\nauto-aof-rewrite-min-size 64mb\r\n\r\n# RDB\u5907\u4efd\u7b56\u7565\r\nsave 900 1    # 15\u5206\u949f\u5185\u67091\u4e2a\u4fee\u6539\r\nsave 300 10   # 5\u5206\u949f\u5185\u670910\u4e2a\u4fee\u6539\r\nsave 60 10000 # 1\u5206\u949f\u5185\u670910000\u4e2a\u4fee\u6539\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5bf9\u4e8e\u5355\u7eaf\u7684\u7f13\u5b58\u573a\u666f\u6216\u8005\u672c\u5730\u5f00\u53d1\u6211\u4f1a\u53ea\u542f\u7528-rdb\u5173\u95ed-aof",children:"\u5bf9\u4e8e\u5355\u7eaf\u7684\u7f13\u5b58\u573a\u666f\uff0c\u6216\u8005\u672c\u5730\u5f00\u53d1\uff0c\u6211\u4f1a\u53ea\u542f\u7528 RDB\uff0c\u5173\u95ed AOF\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# \u7981\u7528AOF\r\nappendonly no\r\n\r\n# \u8f83\u5bbd\u677e\u7684RDB\u7b56\u7565\r\nsave 3600 1    # 1\u5c0f\u65f6\u5185\u67091\u4e2a\u4fee\u6539\r\nsave 300 100   # 5\u5206\u949f\u5185\u6709100\u4e2a\u4fee\u6539\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u800c\u5bf9\u4e8e\u91d1\u878d\u7c7b\u7b49\u9ad8\u4e00\u81f4\u6027\u7684\u7cfb\u7edf\u6211\u901a\u5e38\u4f1a\u5728\u5173\u952e\u65f6\u95f4\u7a97\u53e3\u52a8\u6001\u5c06-appendfsync-\u8bbe\u7f6e\u4e3a-always",children:"\u800c\u5bf9\u4e8e\u91d1\u878d\u7c7b\u7b49\u9ad8\u4e00\u81f4\u6027\u7684\u7cfb\u7edf\uff0c\u6211\u901a\u5e38\u4f1a\u5728\u5173\u952e\u65f6\u95f4\u7a97\u53e3\u52a8\u6001\u5c06 appendfsync \u8bbe\u7f6e\u4e3a always\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# \u542f\u7528AOF\r\nappendonly yes\r\n\r\n# \u4f7f\u7528\u6df7\u5408\u6301\u4e45\u5316\r\naof-use-rdb-preamble yes\r\n\r\n# \u6bcf\u4e2a\u547d\u4ee4\u90fd\u540c\u6b65\uff08\u8c28\u614e\u4f7f\u7528\uff0c\u6027\u80fd\u5f71\u54cd\u5927\uff09\r\n# \u901a\u5e38\u6211\u4f1a\u5728\u5173\u952e\u65f6\u95f4\u7a97\u53e3\u52a8\u6001\u4fee\u6539\u4e3aalways\r\nappendfsync always\r\n\r\n# \u66f4\u9891\u7e41\u7684RDB\u5feb\u7167\r\nsave 300 1     # 5\u5206\u949f\u5185\u67091\u4e2a\u4fee\u6539\r\nsave 60 100    # 1\u5206\u949f\u5185\u6709100\u4e2a\u4fee\u6539\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u53e6\u5916\uff0c\u5bf9\u4e8e\u9ad8\u5e76\u53d1\u573a\u666f\uff0c\u5e94\u8be5\u8bbe\u7f6eno-appendfsync-on-rewrite yes\uff0c\u907f\u514d AOF \u91cd\u5199\u5f71\u54cd\u4e3b\u8fdb\u7a0b\u6027\u80fd\uff1b\u5bf9\u4e8e\u5927\u578b\u5b9e\u4f8b\uff0c\u4e5f\u5e94\u8be5\u8bbe\u7f6e rdb-save-incremental-fsync yes \u6765\u51cf\u5c11\u5927\u578b RDB \u4fdd\u5b58\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# AOF\u91cd\u5199\u671f\u95f4\u4e0dfsync\uff0cAOF \u91cd\u5199\u671f\u95f4\uff0c\u4e3b\u8fdb\u7a0b\u4e0d\u4f1a\u5bf9\u65b0\u5199\u5165\u7684 AOF \u7f13\u51b2\u533a\u6267\u884c fsync \u64cd\u4f5c\uff08\u5373\u4e0d\u5f3a\u5236\u5237\u76d8\uff09\uff0c\u800c\u662f\u7b49\u91cd\u5199\u7ed3\u675f\u540e\u518d\u7edf\u4e00\u5237\u76d8\u3002\r\nno-appendfsync-on-rewrite yes\r\n# RDB \u5feb\u7167\u4fdd\u5b58\u65f6\u91c7\u7528\u589e\u91cf fsync\uff0c\u5373\u6bcf\u5199\u5165\u4e00\u5b9a\u91cf\u7684\u6570\u636e\u5c31\u6267\u884c\u4e00\u6b21 fsync\uff0c\u5c06\u6570\u636e\u5206\u6279\u540c\u6b65\u5230\u78c1\u76d8\u3002\r\nrdb-save-incremental-fsync yes\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u9ad8\u53ef\u7528",children:"\u9ad8\u53ef\u7528"}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3b\u4ece\u590d\u5236\u4e86\u89e3\u5417",children:"\u4e3b\u4ece\u590d\u5236\u4e86\u89e3\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e3b\u4ece\u590d\u5236\u5141\u8bb8\u4ece\u8282\u70b9\u7ef4\u62a4\u4e3b\u8282\u70b9\u7684\u6570\u636e\u526f\u672c\u3002\u5728\u8fd9\u79cd\u67b6\u6784\u4e2d\uff0c\u4e00\u4e2a\u4e3b\u8282\u70b9\u53ef\u4ee5\u8fde\u63a5\u591a\u4e2a\u4ece\u8282\u70b9\uff0c\u4ece\u800c\u5f62\u6210\u4e00\u4e3b\u591a\u4ece\u7684\u7ed3\u6784\u3002\u4e3b\u8282\u70b9\u8d1f\u8d23\u5904\u7406\u5199\u64cd\u4f5c\uff0c\u4ece\u8282\u70b9\u81ea\u52a8\u540c\u6b65\u4e3b\u8282\u70b9\u7684\u6570\u636e\u53d8\u66f4\uff0c\u5e76\u5904\u7406\u8bfb\u8bf7\u6c42\uff0c\u4ece\u800c\u5b9e\u73b0\u8bfb\u5199\u5206\u79bb\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_19.png",src:r(59375).A+"",width:"839",height:"385"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3b\u4ece\u590d\u5236\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u4ec0\u4e48",children:"\u4e3b\u4ece\u590d\u5236\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u4ec0\u4e48?"}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c\u4e00\uff0c\u4e3b\u8282\u70b9\u8d1f\u8d23\u5904\u7406\u5199\u8bf7\u6c42\uff0c\u4ece\u8282\u70b9\u8d1f\u8d23\u5904\u7406\u8bfb\u8bf7\u6c42\uff0c\u4ece\u800c\u5b9e\u73b0\u8bfb\u5199\u5206\u79bb\uff0c\u51cf\u8f7b\u4e3b\u8282\u70b9\u538b\u529b\u7684\u540c\u65f6\u63d0\u5347\u7cfb\u7edf\u7684\u5e76\u53d1\u80fd\u529b\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_20.png",src:r(93023).A+"",width:"3543",height:"1791"}),"\r\n\u7b2c\u4e8c\uff0c\u4ece\u8282\u70b9\u53ef\u4ee5\u4f5c\u4e3a\u4e3b\u8282\u70b9\u7684\u6570\u636e\u5907\u4efd\uff0c\u5f53\u4e3b\u8282\u70b9\u53d1\u751f\u6545\u969c\u65f6\uff0c\u53ef\u4ee5\u5feb\u901f\u5c06\u4ece\u8282\u70b9\u63d0\u5347\u4e3a\u65b0\u7684\u4e3b\u8282\u70b9\uff0c\u4ece\u800c\u4fdd\u8bc1\u7cfb\u7edf\u7684\u9ad8\u53ef\u7528\u6027\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_21.png",src:r(14934).A+"",width:"1041",height:"922"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u51fa\u73b0\u4e3b\u4ece\u590d\u5236\u6570\u636e\u4e0d\u4e00\u81f4",children:"\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u51fa\u73b0\u4e3b\u4ece\u590d\u5236\u6570\u636e\u4e0d\u4e00\u81f4\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["Redis \u7684\u4e3b\u4ece\u590d\u5236\u662f\u5f02\u6b65\u8fdb\u884c\u7684\uff0c\u56e0\u6b64\u5728\u4e3b\u8282\u70b9\u5b95\u673a\u3001\u7f51\u7edc\u6ce2\u52a8\u6216\u590d\u5236\u5ef6\u8fdf\u8f83\u9ad8\u65f6\u4f1a\u51fa\u73b0\u4ece\u8282\u70b9\u6570\u636e\u4e0d\u540c\u6b65\u7684\u60c5\u51b5\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_22.png",src:r(5613).A+"",width:"1580",height:"1512"}),"\r\n\u6bd4\u5982\u4e3b\u8282\u70b9\u5199\u5165\u6570\u636e\u540e\u5b95\u673a\uff0c\u4f46\u4ece\u8282\u70b9\u8fd8\u672a\u6765\u5f97\u53ca\u590d\u5236\uff0c\u5c31\u4f1a\u51fa\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"\u65f6\u95f4\u7ebf\uff1a\u2192\r\n\r\n\u5ba2\u6237\u7aef  \u2192  \u5411\u4e3b\u8282\u70b9 SET user:1 \u4e8c\u54e5     \u2192  \u4e3b\u8282\u70b9\u5904\u7406\u6210\u529f \u2705\r\n                            \u2193\r\n                          \u6b63\u51c6\u5907\u63a8\u9001\u7ed9\u4ece\u8282\u70b9\uff08\u5f02\u6b65\u590d\u5236\uff09... \u4f46\u8fd8\u6ca1\u63a8\u9001\u5b8c \u274c\r\n                            \u2193\r\n                  \u2014\u2014 \u7a81\u7136\u4e3b\u8282\u70b9\u5b95\u673a\uff08\u673a\u5668\u6b7b\u673a\u3001\u65ad\u7f51\uff09 \ud83d\udca5 \u2014\u2014\r\n                            \u2193\r\n          Sentinel \u76d1\u6d4b\u5230\u6545\u969c\uff0cfailover\uff1a\u5c06\u4ece\u8282\u70b9\u63d0\u5347\u4e3a\u65b0\u4e3b\u8282\u70b9 \ud83e\udde0\r\n                            \u2193\r\n\u5ba2\u6237\u7aef\u7ee7\u7eed\u8bf7\u6c42\uff1aGET user:1 \u2753\u2192 \u4ece\u8282\u70b9\u8fd4\u56de\uff1a\u7a7a \u274c\uff08\u6570\u636e\u6ca1\u540c\u6b65\u8fc7\u6765\uff09\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u53e6\u4e00\u4e2a\u5bb9\u6613\u88ab\u5ffd\u89c6\u7684\u56e0\u7d20\u662f\u4e3b\u8282\u70b9\u5185\u5b58\u538b\u529b\u3002\u5f53\u4e3b\u8282\u70b9\u5185\u5b58\u63a5\u8fd1\u4e0a\u9650\u5e76\u542f\u7528\u4e86\u6dd8\u6c70\u7b56\u7565\u65f6\uff0c\u67d0\u4e9b\u952e\u53ef\u80fd\u88ab\u81ea\u52a8\u5220\u9664\uff0c\u800c\u8fd9\u4e9b\u5220\u9664\u64cd\u4f5c\u5982\u679c\u672a\u80fd\u53ca\u65f6\u540c\u6b65\uff0c\u5c31\u4f1a\u9020\u6210\u4ece\u8282\u70b9\u4fdd\u7559\u4e86\u4e3b\u8282\u70b9\u5df2\u7ecf\u4e0d\u5b58\u5728\u7684\u6570\u636e\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_23.png",src:r(79460).A+"",width:"1958",height:"832"}),"\r\n\u4e3b\u4ece\u590d\u5236\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u89e3\u51b3\u65b9\u6848\u6709\u54ea\u4e9b\uff1f\r\n\u9996\u5148\u662f\u7f51\u7edc\u5c42\u9762\u7684\u4f18\u5316\uff0c\u7406\u60f3\u60c5\u51b5\u4e0b\uff0c\u4e3b\u4ece\u8282\u70b9\u5e94\u8be5\u90e8\u7f72\u5728\u540c\u4e00\u4e2a\u7f51\u7edc\u533a\u57df\u5185\uff0c\u907f\u514d\u8de8\u533a\u57df\u7684\u7f51\u7edc\u5ef6\u8fdf\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u5176\u6b21\u662f\u914d\u7f6e\u5c42\u9762\u7684\u8c03\u6574\uff0c\u6bd4\u5982\u8bf4\u9002\u5f53\u589e\u5927\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u548c\u5b58\u6d3b\u65f6\u95f4\uff0c\u4ee5\u4fbf\u4ece\u8282\u70b9\u91cd\u8fde\u540e\u8fdb\u884c\u589e\u91cf\u540c\u6b65\u800c\u4e0d\u662f\u5168\u91cf\u540c\u6b65\uff0c\u4ee5\u6700\u5927\u7a0b\u5ea6\u51cf\u5c11\u4e3b\u4ece\u540c\u6b65\u7684\u5ef6\u8fdf\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e09\u662f\u5f15\u5165\u76d1\u63a7\u548c\u81ea\u52a8\u4fee\u590d\u673a\u5236\uff0c\u5b9a\u671f\u68c0\u67e5\u4e3b\u4ece\u8282\u70b9\u7684\u6570\u636e\u4e00\u81f4\u6027\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u6bd4\u5982\u8bf4\u901a\u8fc7\u6bd4\u8f83\u4e3b\u4ece\u7684 offset \u5dee\u503c\u5224\u65ad\u4ece\u5e93\u662f\u5426\u843d\u540e\u3002\u4e00\u65e6\u8d85\u8fc7\u8bbe\u5b9a\u9608\u503c\uff0c\u5c31\u5c06\u4ece\u8282\u70b9\u5254\u9664\uff0c\u5e76\u91cd\u65b0\u8fdb\u884c\u5168\u91cf\u540c\u6b65\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_24.png",src:r(89403).A+"",width:"3000",height:"2048"})]}),"\n",(0,i.jsx)(n.h3,{id:"redis\u4e3b\u4ece\u6709\u51e0\u79cd\u5e38\u89c1\u7684\u62d3\u6251\u7ed3\u6784",children:"Redis\u4e3b\u4ece\u6709\u51e0\u79cd\u5e38\u89c1\u7684\u62d3\u6251\u7ed3\u6784\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u4e3b\u8981\u6709\u4e09\u79cd\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u6700\u57fa\u7840\u7684\u662f\u4e00\u4e3b\u4e00\u4ece\uff0c\u8fd9\u79cd\u6a21\u5f0f\u9002\u5408\u5c0f\u578b\u9879\u76ee\u3002\u4e00\u4e2a\u4e3b\u8282\u70b9\u8d1f\u8d23\u5199\u5165\uff0c\u4e00\u4e2a\u4ece\u8282\u70b9\u8d1f\u8d23\u8bfb\u548c\u6570\u636e\u5907\u4efd\u3002\u8fd9\u79cd\u7ed3\u6784\u867d\u7136\u7b80\u5355\uff0c\u4f46\u7ef4\u62a4\u6210\u672c\u4f4e\u3002\r\n\u968f\u7740\u4e1a\u52a1\u589e\u957f\uff0c\u8bfb\u8bf7\u6c42\u589e\u591a\uff0c\u53ef\u4ee5\u8003\u8651\u6269\u5c55\u4e3a\u4e00\u4e3b\u591a\u4ece\u7ed3\u6784\u3002\u4e3b\u8282\u70b9\u8d1f\u8d23\u5199\u5165\uff0c\u591a\u4e2a\u4ece\u8282\u70b9\u8fd8\u53ef\u4ee5\u5206\u644a\u538b\u529b\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_25.png",src:r(24050).A+"",width:"619",height:"322"}),"\r\n\u5728\u8de8\u5730\u57df\u90e8\u7f72\u573a\u666f\u4e2d\uff0c\u6811\u72b6\u4e3b\u4ece\u7ed3\u6784\u53ef\u4ee5\u6709\u6548\u964d\u4f4e\u4e3b\u8282\u70b9\u8d1f\u8f7d\u548c\u9700\u8981\u4f20\u9001\u7ed9\u4ece\u8282\u70b9\u7684\u6570\u636e\u91cf\u3002\u901a\u8fc7\u5f15\u5165\u590d\u5236\u4e2d\u95f4\u5c42\uff0c\u4ece\u8282\u70b9\u4e0d\u4ec5\u53ef\u4ee5\u590d\u5236\u4e3b\u8282\u70b9\u6570\u636e\uff0c\u540c\u65f6\u53ef\u4ee5\u4f5c\u4e3a\u5176\u4ed6\u4ece\u8282\u70b9\u7684\u4e3b\u8282\u70b9\u7ee7\u7eed\u5411\u4e0b\u5c42\u590d\u5236\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_26.png",src:r(89193).A+"",width:"549",height:"446"})]}),"\n",(0,i.jsx)(n.h3,{id:"redis\u7684\u4e3b\u4ece\u590d\u5236\u539f\u7406\u4e86\u89e3\u5417",children:"Redis\u7684\u4e3b\u4ece\u590d\u5236\u539f\u7406\u4e86\u89e3\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["Redis \u7684\u4e3b\u4ece\u590d\u5236\u662f\u6307\u901a\u8fc7\u5f02\u6b65\u590d\u5236\u5c06\u4e3b\u8282\u70b9\u7684\u6570\u636e\u53d8\u66f4\u540c\u6b65\u5230\u4ece\u8282\u70b9\uff0c\u4ece\u800c\u5b9e\u73b0\u6570\u636e\u5907\u4efd\u548c\u8bfb\u5199\u5206\u79bb\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5927\u81f4\u53ef\u4ee5\u5206\u4e3a\u4e09\u4e2a\u9636\u6bb5\uff1a\u5efa\u7acb\u8fde\u63a5\u3001\u540c\u6b65\u6570\u636e\u548c\u4f20\u64ad\u547d\u4ee4\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_27.png",src:r(34368).A+"",width:"3765",height:"1676"}),"\r\n\\\u5728\u5efa\u7acb\u8fde\u63a5\u9636\u6bb5\uff0c\u4ece\u8282\u70b9\u901a\u8fc7\u6267\u884c replicaof \u547d\u4ee4\u8fde\u63a5\u5230\u4e3b\u8282\u70b9\u3002\u8fde\u63a5\u5efa\u7acb\u540e\uff0c\u4ece\u8282\u70b9\u5411\u4e3b\u8282\u70b9\u53d1\u9001 psync \u547d\u4ee4\uff0c\u8bf7\u6c42\u6570\u636e\u540c\u6b65\u3002\u8fd9\u65f6\u4e3b\u8282\u70b9\u4f1a\u4e3a\u8be5\u4ece\u8282\u70b9\u521b\u5efa\u4e00\u4e2a\u8fde\u63a5\u548c\u590d\u5236\u7f13\u51b2\u533a\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_28.png",src:r(61639).A+"",width:"1242",height:"894"}),"\r\n\u540c\u6b65\u6570\u636e\u9636\u6bb5\u5206\u4e3a\u5168\u91cf\u540c\u6b65\u548c\u589e\u91cf\u540c\u6b65\u3002\u5f53\u4ece\u8282\u70b9\u9996\u6b21\u8fde\u63a5\u4e3b\u8282\u70b9\u65f6\uff0c\u4f1a\u89e6\u53d1\u5168\u91cf\u540c\u6b65\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_29.png",src:r(90302).A+"",width:"1484",height:"1538"}),"\r\n\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u8282\u70b9\u4f1a fork \u4e00\u4e2a\u5b50\u8fdb\u7a0b\u751f\u6210 RDB \u6587\u4ef6\uff0c\u540c\u65f6\u5c06\u6587\u4ef6\u751f\u6210\u671f\u95f4\u6536\u5230\u7684\u5199\u547d\u4ee4\u7f13\u5b58\u5230\u590d\u5236\u7f13\u51b2\u533a\u3002\u7136\u540e\u5c06 RDB \u6587\u4ef6\u53d1\u9001\u7ed9\u4ece\u8282\u70b9\uff0c\u4ece\u8282\u70b9\u6e05\u7a7a\u81ea\u5df1\u7684\u6570\u636e\u5e76\u52a0\u8f7d\u8fd9\u4e2a RDB \u6587\u4ef6\u3002\u7b49 RDB \u4f20\u8f93\u5b8c\u6210\u540e\uff0c\u4e3b\u8282\u70b9\u518d\u5c06\u7f13\u5b58\u7684\u5199\u547d\u4ee4\u53d1\u9001\u7ed9\u4ece\u8282\u70b9\u6267\u884c\uff0c\u786e\u4fdd\u6570\u636e\u5b8c\u5168\u4e00\u81f4\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_30.png",src:r(66068).A+"",width:"1156",height:"589"}),"\r\n\u4e3b\u4ece\u5b8c\u6210\u5168\u91cf\u540c\u6b65\u540e\uff0c\u4e3b\u8981\u4f9d\u9760\u4f20\u64ad\u547d\u4ee4\u9636\u6bb5\u6765\u4fdd\u6301\u6570\u636e\u7684\u589e\u91cf\u540c\u6b65\u3002\u4e3b\u8282\u70b9\u4f1a\u5c06\u6bcf\u6b21\u6267\u884c\u7684\u5199\u547d\u4ee4\u5b9e\u65f6\u53d1\u9001\u7ed9\u6240\u6709\u4ece\u8282\u70b9\r\n",(0,i.jsx)(n.img,{alt:"img_31.png",src:r(99101).A+"",width:"2462",height:"1438"}),"\r\nRedis 2.8 \u7248\u672c\u540e\uff0c\u4e3b\u8282\u70b9\u4f1a\u4e3a\u6bcf\u4e2a\u4ece\u8282\u70b9\u7ef4\u62a4\u4e00\u4e2a\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\uff0c\u7528\u4e8e\u5b58\u50a8\u6700\u8fd1\u7684\u5199\u547d\u4ee4\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_32.png",src:r(1542).A+"",width:"628",height:"479"})]}),"\n",(0,i.jsxs)(n.p,{children:["\u589e\u91cf\u590d\u5236\u65f6\uff0c\u4e3b\u8282\u70b9\u4f1a\u628a\u8981\u540c\u6b65\u7684\u5199\u547d\u4ee4\u6682\u5b58\u4e00\u4efd\u5230\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u3002\u8fd9\u6837\u5f53\u4ece\u8282\u70b9\u548c\u4e3b\u8282\u70b9\u53d1\u751f\u7f51\u7edc\u65ad\u8fde\uff0c\u4ece\u8282\u70b9\u91cd\u65b0\u8fde\u63a5\u540e\uff0c\u53ef\u4ee5\u4ece\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u4e2d\u590d\u5236\u5c1a\u672a\u540c\u6b65\u7684\u5199\u547d\u4ee4\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_33.png",src:r(40559).A+"",width:"1016",height:"810"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u8be6\u7ec6\u8bf4\u8bf4\u5168\u91cf\u540c\u6b65\u548c\u589e\u91cf\u540c\u6b65",children:"\u8be6\u7ec6\u8bf4\u8bf4\u5168\u91cf\u540c\u6b65\u548c\u589e\u91cf\u540c\u6b65\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u5168\u91cf\u540c\u6b65\u4f1a\u5c06\u4e3b\u8282\u70b9\u7684\u5b8c\u6574\u6570\u636e\u96c6\u4f20\u8f93\u7ed9\u4ece\u8282\u70b9\uff0c\u901a\u5e38\u53d1\u751f\u5728\u4ece\u8282\u70b9\u9996\u6b21\u8fde\u63a5\u4e3b\u8282\u70b9\u65f6\u3002"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"img_34.png",src:r(44688).A+"",width:"769",height:"787"}),"\r\n\u6b64\u65f6\uff0c\u4ece\u8282\u70b9\u53d1\u9001 psync ? -1 \u547d\u4ee4\u8bf7\u6c42\u540c\u6b65\u3002? \u8868\u793a\u4ece\u8282\u70b9\u6ca1\u6709\u4e3b\u8282\u70b9 ID\uff0c-1 \u8868\u793a\u6ca1\u6709\u504f\u79fb\u91cf\u3002\u4e3b\u8282\u70b9\u6536\u5230\u540e\u4f1a\u56de\u590d FULLRESYNC\u54cd\u5e94\u4ece\u8282\u70b9\u3002\u540c\u65f6\u4e5f\u4f1a\u5305\u542b\u4e3b\u5e93 runid \u548c\u590d\u5236\u504f\u79fb\u91cf offset \u4e24\u4e2a\u53c2\u6570\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u7136\u540e fork \u4e00\u4e2a\u5b50\u8fdb\u7a0b\u751f\u6210 RDB \u6587\u4ef6\uff0c\u5e76\u5c06\u65b0\u7684\u5199\u547d\u4ee4\u5b58\u5165\u590d\u5236\u7f13\u51b2\u533a\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u4ece\u5e93\u6536\u5230 RDB \u6587\u4ef6\u540e\uff0c\u6e05\u7a7a\u65e7\u6570\u636e\u5e76\u52a0\u8f7d\u65b0\u7684 RDB \u6587\u4ef6\u3002\u52a0\u8f7d\u5b8c\u6210\u540e\uff0c\u4ece\u8282\u70b9\u4f1a\u5411\u4e3b\u8282\u70b9\u56de\u590d\u786e\u8ba4\u6d88\u606f\uff0c\u4e3b\u8282\u70b9\u518d\u5c06\u590d\u5236\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u53d1\u9001\u7ed9\u4ece\u8282\u70b9\uff0c\u786e\u4fdd\u4ece\u8282\u70b9\u7684\u6570\u636e\u4e0e\u4e3b\u8282\u70b9\u4e00\u81f4\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5168\u91cf\u540c\u6b65\u7684\u4ee3\u4ef7\u5f88\u9ad8\uff0c\u56e0\u4e3a\u5b8c\u6574\u7684 RDB \u6587\u4ef6\u5728\u751f\u6210\u65f6\u4f1a\u5360\u7528\u5927\u91cf\u7684 CPU \u548c\u78c1\u76d8 IO\uff1b\u5728\u7f51\u7edc\u4f20\u8f93\u65f6\u8fd8\u4f1a\u6d88\u8017\u6389\u4e0d\u5c11\u5e26\u5bbd\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u4e8e\u662f Redis \u5728 2.8 \u7248\u672c\u540e\u5f15\u5165\u4e86\u589e\u91cf\u540c\u6b65\u7684\u6982\u5ff5\uff0c\u76ee\u7684\u662f\u5728\u65ad\u7ebf\u91cd\u8fde\u540e\u907f\u514d\u5168\u91cf\u540c\u6b65\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u589e\u91cf\u4f9d\u8d56\u4e09\u4e2a\u5173\u952e\u8981\u7d20\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"\u2460\u3001\u590d\u5236\u504f\u79fb\u91cf\uff1a\u4e3b\u4ece\u8282\u70b9\u5206\u522b\u7ef4\u62a4\u4e00\u4e2a\u590d\u5236\u504f\u79fb\u91cf\uff0c\u8bb0\u5f55\u4f20\u8f93\u7684\u5b57\u8282\u6570\u3002\u4e3b\u8282\u70b9\u6bcf\u4f20\u8f93 N \u4e2a\u5b57\u8282\u6570\u636e\uff0c\u81ea\u8eab\u7684\u590d\u5236\u504f\u79fb\u91cf\u5c31\u4f1a\u589e\u52a0 N\uff1b\u4ece\u8282\u70b9\u6bcf\u6536\u5230 N \u4e2a\u5b57\u8282\u6570\u636e\uff0c\u4e5f\u4f1a\u76f8\u5e94\u589e\u52a0\u81ea\u5df1\u7684\u504f\u79fb\u91cf\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u2461\u3001\u4e3b\u8282\u70b9 ID\uff1a\u6bcf\u4e2a\u4e3b\u8282\u70b9\u90fd\u6709\u4e00\u4e2a\u552f\u4e00 ID\uff0c\u5373\u590d\u5236 ID\uff0c\u7528\u4e8e\u6807\u8bc6\u4e3b\u8282\u70b9\u7684\u6570\u636e\u7248\u672c\u3002\u5f53\u4e3b\u8282\u70b9\u53d1\u751f\u91cd\u542f\u6216\u8005\u89d2\u8272\u53d8\u5316\u65f6\uff0cID \u4f1a\u6539\u53d8\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u2462\u3001\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\uff1a\u4e3b\u8282\u70b9\u7ef4\u62a4\u7684\u4e00\u4e2a\u56fa\u5b9a\u957f\u5ea6\u7684\u5148\u8fdb\u5148\u51fa\u961f\u5217\uff0c\u9ed8\u8ba4\u5927\u5c0f\u4e3a 1M\u3002\u4e3b\u8282\u70b9\u5728\u5411\u4ece\u8282\u70b9\u53d1\u9001\u547d\u4ee4\u7684\u540c\u65f6\uff0c\u4e5f\u4f1a\u5c06\u547d\u4ee4\u5199\u5165\u8fd9\u4e2a\u7f13\u51b2\u533a\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u5f53\u4ece\u8282\u70b9\u4e0e\u4e3b\u8282\u70b9\u65ad\u5f00\u91cd\u8fde\u540e\uff0c\u4f1a\u53d1\u9001 psync runId offset \u547d\u4ee4\uff0c\u5e26\u4e0a\u4e4b\u524d\u8bb0\u5f55\u7684\u4e3b\u8282\u70b9 ID \u548c\u590d\u5236\u504f\u79fb\u91cf\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_35.png",src:r(50937).A+"",width:"850",height:"445"}),"\r\n\u4e3b\u8282\u70b9\u6536\u5230\u8fd9\u4e2a\u547d\u4ee4\u540e\uff0c\u4f1a\u68c0\u67e5 runId \u548c offset\uff1a"]}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u4e3b\u8282\u70b9 ID \u4e0e\u4ece\u8282\u70b9\u63d0\u4f9b\u7684 runId \u4e0d\u5339\u914d\uff0c\u8bf4\u660e\u4e3b\u8282\u70b9\u5df2\u7ecf\u53d8\u5316\uff0c\u5fc5\u987b\u8fdb\u884c\u5168\u91cf\u540c\u6b65\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c ID \u5339\u914d\uff0c\u4e3b\u8282\u70b9\u4f1a\u67e5\u627e\u4ece\u8282\u70b9\u8bf7\u6c42\u7684\u504f\u79fb\u91cf\u4e4b\u540e\u7684\u6570\u636e\u662f\u5426\u8fd8\u5728\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u5982\u679c\u5728\uff0c\u53ea\u53d1\u9001\u4ece\u8be5\u504f\u79fb\u91cf\u5f00\u59cb\u7684\u589e\u91cf\u6570\u636e\uff0c\u8fd9\u5c31\u662f\u589e\u91cf\u540c\u6b65\uff1b\u5426\u5219\u8bf4\u660e\u65ad\u7ebf\u65f6\u95f4\u592a\u957f\uff0c\u79ef\u538b\u7f13\u51b2\u533a\u5df2\u7ecf\u8986\u76d6\u4e86\u8fd9\u90e8\u5206\u6570\u636e\uff0c\u9700\u8981\u5168\u91cf\u540c\u6b65\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_36.png",src:r(94850).A+"",width:"1080",height:"624"}),"\r\n\u589e\u91cf\u540c\u6b65\u7684\u4f18\u52bf\u663e\u800c\u6613\u89c1\uff1a\u53ea\u4f20\u8f93\u65ad\u7ebf\u671f\u95f4\u7684\u547d\u4ee4\u6570\u636e\uff0c\u5927\u5927\u51cf\u5c11\u4e86\u7f51\u7edc\u4f20\u8f93\u91cf\u548c\u4e3b\u4ece\u8282\u70b9\u7684\u8d1f\u8f7d\uff0c\u4ece\u8282\u70b9\u4e5f\u4e0d\u9700\u8981\u6e05\u7a7a\u91cd\u8f7d\u6570\u636e\uff0c\u80fd\u66f4\u5feb\u5730\u8ddf\u4e0a\u4e3b\u8282\u70b9\u72b6\u6001\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u4e8e\u5199\u5165\u9891\u7e41\u6216\u7f51\u7edc\u4e0d\u7a33\u5b9a\u7684\u73af\u5883\uff0c\u5e94\u8be5\u589e\u5927\u590d\u5236\u79ef\u538b\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0c\u786e\u4fdd\u77ed\u65f6\u95f4\u65ad\u7ebf\u540e\u80fd\u8fdb\u884c\u589e\u91cf\u540c\u6b65\u800c\u4e0d\u662f\u5168\u91cf\u540c\u6b65\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"repl-backlog-size 1mb  # \u9ed8\u8ba4\u503c 1MB\uff0c\u8868\u793a\u4e3b\u8282\u70b9\u7684\u590d\u5236\u7f13\u51b2\u533a\u5927\u5c0f\r\nrepl-backlog-ttl 3600  # \u9ed8\u8ba4\u503c 3600 \u79d2\uff0c\u8868\u793a\u4e3b\u8282\u70b9\u7684\u590d\u5236\u7f13\u51b2\u533a\u5b58\u6d3b\u65f6\u95f4\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3b\u4ece\u590d\u5236\u5b58\u5728\u54ea\u4e9b\u95ee\u9898\u5462",children:"\u4e3b\u4ece\u590d\u5236\u5b58\u5728\u54ea\u4e9b\u95ee\u9898\u5462\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u4e3b\u4ece\u590d\u5236\u7684\u6700\u5927\u6311\u6218\u6765\u81ea\u4e8e\u5b83\u7684\u5f02\u6b65\u7279\u6027\uff0c\u4e3b\u8282\u70b9\u5904\u7406\u5b8c\u5199\u547d\u4ee4\u540e\u4f1a\u7acb\u5373\u54cd\u5e94\u5ba2\u6237\u7aef\uff0c\u800c\u4e0d\u4f1a\u7b49\u5f85\u4ece\u8282\u70b9\u786e\u8ba4\uff0c\u8fd9\u5c31\u5bfc\u81f4\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u53ef\u80fd\u51fa\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\u3002"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"img_37.png",src:r(15979).A+"",width:"1344",height:"512"}),"\r\n\u53e6\u4e00\u4e2a\u5e38\u89c1\u95ee\u9898\u662f\u5168\u91cf\u540c\u6b65\u5bf9\u7cfb\u7edf\u7684\u51b2\u51fb\u3002\u5168\u91cf\u540c\u6b65\u4f1a\u5360\u7528\u5927\u91cf\u7684 CPU \u548c IO \u8d44\u6e90\uff0c\u5c24\u5176\u662f\u5728\u5927\u6570\u636e\u91cf\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u5bfc\u81f4\u4e3b\u8282\u70b9\u7684\u6027\u80fd\u4e0b\u964d\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u8111\u88c2\u95ee\u9898\u4e86\u89e3\u5417\uff1f\r\n\u5728 Redis \u7684\u54e8\u5175\u67b6\u6784\u4e2d\uff0c\u8111\u88c2\u7684\u5178\u578b\u8868\u73b0\u4e3a\uff1a\u4e3b\u8282\u70b9\u4e0e\u54e8\u5175\u3001\u4ece\u8282\u70b9\u4e4b\u95f4\u7684\u7f51\u7edc\u53d1\u751f\u6545\u969c\u4e86\uff0c\u4f46\u4e0e\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u662f\u6b63\u5e38\u7684\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e24\u4e2a\u201c\u4e3b\u8282\u70b9\u201d\u540c\u65f6\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u54e8\u5175\u8ba4\u4e3a\u4e3b\u8282\u70b9\u5df2\u7ecf\u4e0b\u7ebf\u4e86\uff0c\u4e8e\u662f\u4f1a\u5c06\u4e00\u4e2a\u4ece\u8282\u70b9\u9009\u4e3e\u4e3a\u65b0\u7684\u4e3b\u8282\u70b9\u3002\u4f46\u539f\u4e3b\u8282\u70b9\u5e76\u4e0d\u77e5\u60c5\uff0c\u4ecd\u7136\u5728\u7ee7\u7eed\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u3002\r\n",(0,i.jsx)(n.img,{alt:"img_38.png",src:r(6492).A+"",width:"1913",height:"1197"}),"\r\n\u7b49\u4e3b\u8282\u70b9\u7f51\u7edc\u6062\u590d\u6b63\u5e38\u4e86\uff0c\u53d1\u73b0\u5df2\u7ecf\u6709\u65b0\u7684\u4e3b\u8282\u70b9\u4e86\uff0c\u4e8e\u662f\u539f\u4e3b\u8282\u70b9\u4f1a\u81ea\u52a8\u964d\u7ea7\u4e3a\u4ece\u8282\u70b9\u3002\u5728\u964d\u7ea7\u8fc7\u7a0b\u4e2d\uff0c\u5b83\u9700\u8981\u4e0e\u65b0\u4e3b\u8282\u70b9\u8fdb\u884c\u5168\u91cf\u540c\u6b65\uff0c\u6b64\u65f6\u539f\u4e3b\u8282\u70b9\u7684\u6570\u636e\u4f1a\u88ab\u6e05\u7a7a\u3002\u5bfc\u81f4\u5ba2\u6237\u7aef\u5728\u539f\u4e3b\u8282\u70b9\u6545\u969c\u671f\u95f4\u5199\u5165\u7684\u6570\u636e\u5168\u90e8\u4e22\u5931\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"img_39.png",src:r(89381).A+"",width:"2671",height:"1872"}),"\r\n",(0,i.jsx)(n.img,{alt:"img_40.png",src:r(31197).A+"",width:"2671",height:"1872"}),"\r\n\u4e3a\u4e86\u9632\u6b62\u8fd9\u79cd\u6570\u636e\u4e22\u5931\uff0cRedis \u63d0\u4f9b\u4e86 min-slaves-to-write \u548c min-slaves-max-lag \u53c2\u6570\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u4e24\u4e2a\u53c2\u6570\u53ef\u4ee5\u8bbe\u7f6e\u6700\u5c11\u9700\u8981\u591a\u5c11\u4e2a\u4ece\u8282\u70b9\u5728\u7ebf\uff0c\u4ee5\u53ca\u4ece\u8282\u70b9\u7684\u6700\u5927\u5ef6\u8fdf\u65f6\u95f4\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# \u8bbe\u7f6e\u4e3b\u8282\u70b9\u80fd\u8fdb\u884c\u6570\u636e\u540c\u6b65\u7684\u6700\u5c11\u4ece\u8282\u70b9\u6570\u91cf\r\nmin-slaves-to-write 1\r\n# \u8bbe\u7f6e\u4e3b\u4ece\u8282\u70b9\u95f4\u8fdb\u884c\u6570\u636e\u540c\u6b65\u65f6\uff0c\u4ece\u8282\u70b9\u7ed9\u4e3b\u8282\u70b9\u53d1\u9001 ACK \u6d88\u606f\u7684\u6700\u5927\u5ef6\u8fdf\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\r\nmin-slaves-max-lag 10\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8bbe\u7f6e\u8fd9\u4e24\u4e2a\u53c2\u6570\u540e\uff0c\u5982\u679c\u4e3b\u8282\u70b9\u8fde\u63a5\u4e0d\u5230\u6307\u5b9a\u6570\u91cf\u7684\u4ece\u8282\u70b9\uff0c\u6216\u8005\u4ece\u8282\u70b9\u54cd\u5e94\u8d85\u65f6\uff0c\u4e3b\u8282\u70b9\u4f1a\u62d2\u7edd\u5199\u5165\u8bf7\u6c42\uff0c\u4ece\u800c\u907f\u514d\u8111\u88c2\u671f\u95f4\u7684\u6570\u636e\u51b2\u7a81\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5177\u4f53\u6765\u8bf4\uff0c\u5f53\u7f51\u7edc\u5206\u533a\u53d1\u751f\uff0c\u4e3b\u8282\u70b9\u4e0e\u4ece\u8282\u70b9\u3001\u54e8\u5175\u4e4b\u95f4\u7684\u8fde\u63a5\u65ad\u5f00\uff0c\u4f46\u4e3b\u8282\u70b9\u4e0e\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u6b63\u5e38\u65f6\uff0c\u7531\u4e8e\u4e3b\u8282\u70b9\u65e0\u6cd5\u518d\u8fde\u63a5\u5230\u4efb\u4f55\u4ece\u8282\u70b9\uff0c\u6216\u8005\u5ef6\u8fdf\u8d85\u8fc7\u4e86\u8bbe\u5b9a\u503c\uff0c\u6bd4\u5982\u8bf4\u914d\u7f6e\u4e86min-slaves-to-write 1\uff0c\u4e3b\u8282\u70b9\u5c31\u4f1a\u81ea\u52a8\u62d2\u7edd\u6240\u6709\u5199\u8bf7\u6c42\u3002"}),"\n",(0,i.jsx)(n.p,{children:'\u540c\u65f6\u5728\u7f51\u7edc\u7684\u53e6\u4e00\u4fa7\uff0c\u54e8\u5175\u4f1a\u68c0\u6d4b\u5230\u4e3b\u8282\u70b9"\u4e0b\u7ebf"\uff0c\u9009\u4e3e\u4e00\u4e2a\u4ece\u8282\u70b9\u6210\u4e3a\u65b0\u7684\u4e3b\u8282\u70b9\u3002\u7531\u4e8e\u539f\u4e3b\u8282\u70b9\u5df2\u7ecf\u505c\u6b62\u63a5\u53d7\u5199\u5165\uff0c\u6240\u4ee5\u4e0d\u4f1a\u4ea7\u751f\u65b0\u7684\u6570\u636e\u53d8\u66f4\uff0c\u7b49\u7f51\u7edc\u6062\u590d\u540e\uff0c\u5373\u4f7f\u539f\u4e3b\u8282\u70b9\u964d\u7ea7\u4e3a\u4ece\u8282\u70b9\u5e76\u8fdb\u884c\u5168\u91cf\u540c\u6b65\uff0c\u4e5f\u4e0d\u4f1a\u4e22\u5931\u7f51\u7edc\u5206\u533a\u671f\u95f4\u7684\u5199\u5165\u6570\u636e\uff0c\u56e0\u4e3a\u6839\u672c\u5c31\u6ca1\u6709\u65b0\u7684\u5199\u5165\u53d1\u751f\u3002'}),"\n",(0,i.jsx)(n.h3,{id:"redis\u54e8\u5175\u673a\u5236\u4e86\u89e3\u5417",children:"Redis\u54e8\u5175\u673a\u5236\u4e86\u89e3\u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u4e2d\u7684\u54e8\u5175\u7528\u4e8e\u76d1\u63a7\u4e3b\u4ece\u96c6\u7fa4\u7684\u8fd0\u884c\u72b6\u6001\uff0c\u5e76\u5728\u4e3b\u8282\u70b9\u6545\u969c\u65f6\u81ea\u52a8\u8fdb\u884c\u6545\u969c\u8f6c\u79fb\u3002"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"1756732135823",src:r(52516).A+"",width:"740",height:"381"}),"\r\n\u6838\u5fc3\u529f\u80fd\u5305\u62ec\u76d1\u63a7\u3001\u901a\u77e5\u548c\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\u3002\u54e8\u5175\u4f1a\u5b9a\u671f\u68c0\u67e5\u4e3b\u4ece\u8282\u70b9\u662f\u5426\u6309\u9884\u671f\u5de5\u4f5c\uff0c\u5f53\u68c0\u6d4b\u5230\u4e3b\u8282\u70b9\u6545\u969c\u65f6\uff0c\u5c31\u5728\u4ece\u8282\u70b9\u4e2d\u9009\u4e3e\u51fa\u4e00\u4e2a\u65b0\u7684\u4e3b\u8282\u70b9\uff0c\u5e76\u901a\u77e5\u5ba2\u6237\u7aef\u8fde\u63a5\u5230\u65b0\u7684\u4e3b\u8282\u70b9\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# \u76d1\u63a7\u7684\u4e3b\u8282\u70b9\u4fe1\u606f + \u591a\u5c11\u4e2a\u54e8\u5175\u540c\u610f\u624d\u7b97\u5b95\u673a\r\nsentinel monitor mymaster 127.0.0.1 6379 2\r\n# \u591a\u4e45\u4e0d\u54cd\u5e94\u5c31\u6807\u8bb0\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\r\nsentinel down-after-milliseconds mymaster 5000\r\n# \u6545\u969c\u8f6c\u79fb\u8d85\u65f6\u65f6\u95f4\r\nsentinel failover-timeout mymaster 60000\r\n# \u540c\u65f6\u5141\u8bb8\u591a\u5c11\u4e2a\u4ece\u8282\u70b9\u540c\u6b65\u65b0\u4e3b\u8282\u70b9\u6570\u636e\r\nsentinel parallel-syncs mymaster 1\n"})}),"\n",(0,i.jsx)(n.h3,{id:"redis\u54e8\u5175\u7684\u5de5\u4f5c\u539f\u7406\u77e5\u9053\u5417",children:"Redis\u54e8\u5175\u7684\u5de5\u4f5c\u539f\u7406\u77e5\u9053\u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u54e8\u5175\u7684\u5de5\u4f5c\u539f\u7406\u53ef\u4ee5\u6982\u62ec\u4e3a 4 \u4e2a\u5173\u952e\u6b65\u9aa4\uff1a\u5b9a\u65f6\u76d1\u63a7\u3001\u4e3b\u89c2\u4e0b\u7ebf\u3001\u9886\u5bfc\u8005\u9009\u4e3e\u548c\u6545\u969c\u8f6c\u79fb\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u9996\u5148\uff0c\u54e8\u5175\u4f1a\u5b9a\u671f\u5411\u6240\u6709 Redis \u8282\u70b9\u53d1\u9001 PING \u547d\u4ee4\u6765\u68c0\u6d4b\u5b83\u4eec\u662f\u5426\u53ef\u8fbe\u3002\u5982\u679c\u5728\u6307\u5b9a\u65f6\u95f4\u5185\u6ca1\u6709\u6536\u5230\u56de\u590d\uff0c\u54e8\u5175\u4f1a\u5c06\u8be5\u8282\u70b9\u6807\u8bb0\u4e3a\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732172001",src:r(18677).A+"",width:"1088",height:"736"}),"\r\n\u5f53\u4e00\u4e2a\u54e8\u5175\u5224\u65ad\u4e3b\u8282\u70b9\u4e3b\u89c2\u4e0b\u7ebf\u540e\uff0c\u4f1a\u8be2\u95ee\u5176\u4ed6\u54e8\u5175\u7684\u610f\u89c1\uff0c\u5982\u679c\u8fbe\u5230\u914d\u7f6e\u7684\u6cd5\u5b9a\u4eba\u6570\uff0c\u4e3b\u8282\u70b9\u4f1a\u88ab\u6807\u8bb0\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732184761",src:r(73757).A+"",width:"565",height:"511"}),"\r\n\u7136\u540e\u5f00\u59cb\u6545\u969c\u8f6c\u79fb\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u54e8\u5175\u4f1a\u5148\u9009\u4e3e\u51fa\u4e00\u4e2a\u9886\u5bfc\u8005\uff0c\u9886\u5bfc\u8005\u518d\u4ece\u4ece\u8282\u70b9\u4e2d\u9009\u62e9\u4e00\u4e2a\u6700\u9002\u5408\u7684\u8282\u70b9\u4f5c\u4e3a\u65b0\u7684\u4e3b\u8282\u70b9\uff0c\u9009\u62e9\u6807\u51c6\u5305\u62ec\u590d\u5236\u504f\u79fb\u91cf\u3001\u4f18\u5148\u7ea7\u7b49\u56e0\u7d20\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732196024",src:r(29520).A+"",width:"1220",height:"388"}),"\r\n\u786e\u5b9a\u65b0\u4e3b\u8282\u70b9\u540e\uff0c\u54e8\u5175\u4f1a\u5411\u5176\u53d1\u9001 SLAVEOF NO ONE \u547d\u4ee4\u4f7f\u5176\u5347\u7ea7\u4e3a\u4e3b\u8282\u70b9\uff0c\u7136\u540e\u5411\u5176\u4ed6\u4ece\u8282\u70b9\u53d1\u9001 SLAVEOF \u547d\u4ee4\u6307\u5411\u65b0\u4e3b\u8282\u70b9\uff0c\u6700\u540e\u901a\u8fc7\u53d1\u5e03/\u8ba2\u9605\u673a\u5236\u901a\u77e5\u5ba2\u6237\u7aef\u4e3b\u8282\u70b9\u5df2\u7ecf\u53d1\u751f\u53d8\u5316\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732204911",src:r(17263).A+"",width:"1035",height:"1555"})]}),"\n",(0,i.jsxs)(n.p,{children:["\u5728\u5b9e\u9645\u90e8\u7f72\u4e2d\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u54e8\u5175\u673a\u5236\u7684\u53ef\u9760\u6027\uff0c\u901a\u5e38\u5efa\u8bae\u81f3\u5c11\u90e8\u7f72\u4e09\u4e2a\u54e8\u5175\u8282\u70b9\uff0c\u5e76\u4e14\u8fd9\u4e9b\u8282\u70b9\u5e94\u5206\u5e03\u5728\u4e0d\u540c\u7684\u7269\u7406\u673a\u5668\u4e0a\uff0c\u964d\u4f4e\u5355\u70b9\u6545\u969c\u98ce\u9669\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732229854",src:r(88230).A+"",width:"2799",height:"1727"}),"\r\n\u540c\u65f6\uff0c\u6cd5\u5b9a\u4eba\u6570\u7684\u8bbe\u7f6e\u4e5f\u975e\u5e38\u5173\u952e\uff0c\u4e00\u822c\u5efa\u8bae\u8bbe\u7f6e\u4e3a\u54e8\u5175\u6570\u91cf\u7684\u4e00\u534a\u52a0\u4e00\uff0c\u65e2\u80fd\u786e\u4fdd\u5728\u5c11\u6570\u54e8\u5175\u6545\u969c\u65f6\u7cfb\u7edf\u4ecd\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u53c8\u80fd\u907f\u514d\u7f51\u7edc\u5206\u533a\u5bfc\u81f4\u7684\u8111\u88c2\u95ee\u9898\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"redis\u9886\u5bfc\u8005\u9009\u4e3e\u4e86\u89e3\u5417",children:"Redis\u9886\u5bfc\u8005\u9009\u4e3e\u4e86\u89e3\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["Redis \u4f7f\u7528 Raft \u7b97\u6cd5\u5b9e\u73b0\u9886\u5bfc\u8005\u9009\u4e3e\uff0c\u76ee\u7684\u662f\u5728\u4e3b\u8282\u70b9\u6545\u969c\u65f6\uff0c\u9009\u51fa\u4e00\u4e2a\u54e8\u5175\u6765\u8d1f\u8d23\u6267\u884c\u6545\u969c\u8f6c\u79fb\u64cd\u4f5c\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732303608",src:r(79752).A+"",width:"1490",height:"640"}),"\r\n\u9009\u4e3e\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff1a"]}),"\n",(0,i.jsx)(n.p,{children:"\u2460\u3001\u5f53\u4e00\u4e2a\u54e8\u5175\u786e\u8ba4\u4e3b\u8282\u70b9\u5ba2\u89c2\u4e0b\u7ebf\u540e\uff0c\u4f1a\u5411\u5176\u4ed6\u54e8\u5175\u8282\u70b9\u53d1\u9001\u8bf7\u6c42\uff0c\u8868\u660e\u5e0c\u671b\u7531\u81ea\u5df1\u6765\u6267\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u5e76\u8ba9\u6240\u6709\u5176\u4ed6\u54e8\u5175\u8fdb\u884c\u6295\u7968\u3002\u5019\u9009\u8005\u4f1a\u5148\u7ed9\u81ea\u5df1\u5148\u6295 1 \u7968\uff0c\u7136\u540e\u7b49\u5f85\u5176\u4ed6\u54e8\u5175\u8282\u70b9\u7684\u6295\u7968\u7ed3\u679c\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:'// sentinel.c\u4e2d\u7684sentinelAskMasterStateToOtherSentinels\u51fd\u6570\r\nvoid sentinelAskMasterStateToOtherSentinels(sentinelRedisInstance *master) {\r\n    dictIterator *di;\r\n    dictEntry *de;\r\n\r\n    di = dictGetIterator(master->sentinels);\r\n    while((de = dictNext(di)) != NULL) {\r\n        sentinelRedisInstance *sentinel = dictGetVal(de);\r\n        int retval;\r\n        \r\n        // \u53ea\u6709\u5728\u8fdb\u5165\u9886\u5bfc\u8005\u9009\u4e3e\u9636\u6bb5\u624d\u53d1\u9001\u6295\u7968\u8bf7\u6c42\r\n        if (master->failover_state == SENTINEL_FAILOVER_STATE_SELECT_LEADER) {\r\n            // \u53d1\u9001\u7279\u6b8a\u7684is-master-down-by-addr\u547d\u4ee4\u8bf7\u6c42\u6295\u7968\r\n            retval = redisAsyncCommand(sentinel->cc,\r\n                sentinelReceiveVoteFromSentinel, sentinel,\r\n                "SENTINEL is-master-down-by-addr %s %d %llu %s",\r\n                master->addr->ip, master->addr->port,\r\n                (unsigned long long)master->failover_epoch,\r\n                // \u8fd9\u91cc\u53d1\u9001\u81ea\u5df1\u7684runid\u8bf7\u6c42\u6295\u7968\r\n                sentinelGetMyRunID());\r\n        } else {\r\n            // \u5426\u5219\u53ea\u8be2\u95ee\u4e3b\u8282\u70b9\u72b6\u6001\uff0c\u4e0d\u8bf7\u6c42\u6295\u7968\r\n            retval = redisAsyncCommand(sentinel->cc,\r\n                sentinelReceiveIsMasterDownReply, sentinel,\r\n                "SENTINEL is-master-down-by-addr %s %d %llu *",\r\n                master->addr->ip, master->addr->port,\r\n                (unsigned long long)0);\r\n        }\r\n    }\r\n    dictReleaseIterator(di);\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u2461\u3001\u6536\u5230\u8bf7\u6c42\u7684\u54e8\u5175\u8282\u70b9\u8fdb\u884c\u5224\u65ad\uff0c\u5982\u679c\u5019\u9009\u8005\u7684\u65e5\u5fd7\u548c\u81ea\u5df1\u7684\u4e00\u6837\u65b0\uff0c\u4efb\u671f\u53f7\u4e5f\u5c0f\u4e8e\u81ea\u5df1\uff0c\u4e14\u4e4b\u524d\u6ca1\u6709\u6295\u7968\u8fc7\uff0c\u5c31\u4f1a\u6295\u540c\u610f\u7968 Y\u3002\u5426\u5219\u56de\u590d N\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'// sentinel.c\u4e2d\u7684sentinelCommand\u51fd\u6570\u90e8\u5206(\u5904\u7406SENTINEL\u547d\u4ee4)\r\n// \u5904\u7406is-master-down-by-addr\u547d\u4ee4\r\nelse if (!strcasecmp(c->argv[1]->ptr,"is-master-down-by-addr")) {\r\n    /* SENTINEL IS-MASTER-DOWN-BY-ADDR <ip> <port> <current-epoch> <runid> */\r\n    sentinelRedisInstance *ri;\r\n    char *master_ip = c->argv[2]->ptr;\r\n    int master_port = atoi(c->argv[3]->ptr);\r\n    long long req_epoch = strtoull(c->argv[4]->ptr,NULL,10);\r\n    char *req_runid = c->argv[5]->ptr;\r\n    int isdown = 0;\r\n    char *leader = "*";\r\n    long long leader_epoch = -1;\r\n    \r\n    ri = sentinelGetMasterByAddress(master_ip, master_port);\r\n    if (ri) {\r\n        isdown = ri->flags & SRI_S_DOWN;\r\n        \r\n        // \u5224\u65ad\u662f\u5426\u662f\u6295\u7968\u8bf7\u6c42\r\n        if (req_runid[0] != \'*\') {\r\n            // \u68c0\u67e5\u662f\u5426\u5df2\u7ecf\u5728\u5f53\u524d\u914d\u7f6e\u7eaa\u5143\u4e2d\u6295\u8fc7\u7968\r\n            if (req_epoch > sentinel.current_epoch) {\r\n                // \u66f4\u65b0\u81ea\u5df1\u7684\u914d\u7f6e\u7eaa\u5143\r\n                sentinel.current_epoch = req_epoch;\r\n            }\r\n            \r\n            // \u5982\u679c\u6211\u4eec\u89c9\u5f97\u4e3b\u8282\u70b9\u4e0b\u7ebf\u4e86\uff0c\u4e14\u5728\u8fd9\u4e2aepoch\u8fd8\u6ca1\u6295\u8fc7\u7968\uff0c\u5219\u6295\u7968\r\n            if (isdown && sentinel.current_epoch == req_epoch &&\r\n                sentinel.leader_epoch < req_epoch)\r\n            {\r\n                // \u8bb0\u5f55\u6295\u7968\u4fe1\u606f\r\n                sentinel.leader_epoch = req_epoch;\r\n                sentinel.leader = sdsnew(req_runid);\r\n                leader = req_runid;\r\n                leader_epoch = req_epoch;\r\n            }\r\n        }\r\n    }\r\n    \r\n    // \u8fd4\u56de\u6295\u7968\u7ed3\u679c\r\n    addReplyMultiBulkLen(c,3);\r\n    addReplyLongLong(c, isdown);\r\n    addReplyBulkCString(c, leader);\r\n    addReplyLongLong(c, leader_epoch);\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u2462\u3001\u5019\u9009\u8005\u6536\u5230\u6295\u7968\u540e\u4f1a\u7edf\u8ba1\u81ea\u5df1\u7684\u5f97\u7968\u6570\uff0c\u5982\u679c\u83b7\u5f97\u4e86\u96c6\u7fa4\u4e2d\u8d85\u8fc7\u534a\u6570\u8282\u70b9\u7684\u6295\u7968\uff0c\u5b83\u5c31\u4f1a\u5f53\u9009\u4e3a\u9886\u5bfc\u8005\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'// sentinel.c\u4e2d\u7684sentinelReceiveVoteFromSentinel\u51fd\u6570\r\nvoid sentinelReceiveVoteFromSentinel(redisAsyncContext *c, void *reply, void *privdata) {\r\n    sentinelRedisInstance *sentinel = privdata;\r\n    sentinelRedisInstance *master = sentinel->master;\r\n    redisReply *r = reply;\r\n    char *leader = NULL;\r\n    \r\n    // \u5904\u7406\u56de\u590d\r\n    if (r->type == REDIS_REPLY_ARRAY && r->elements == 3) {\r\n        // \u89e3\u6790\u56de\u590d\u4e2d\u7684leader\u4fe1\u606f\r\n        if (r->element[1]->type == REDIS_REPLY_STRING)\r\n            leader = r->element[1]->str;\r\n        \r\n        // \u68c0\u67e5\u662f\u5426\u6295\u7ed9\u4e86\u6211\u4eec\r\n        if (leader && strcmp(leader, sentinelGetMyRunID()) == 0) {\r\n            // \u8bb0\u5f55\u83b7\u5f97\u4e00\u7968\r\n            dictAdd(master->sentinels_voted, sdsnew(sentinel->runid), sentinel);\r\n        }\r\n    }\r\n    \r\n    // \u68c0\u67e5\u662f\u5426\u83b7\u5f97\u591a\u6570\u7968\r\n    if (master->failover_state == SENTINEL_FAILOVER_STATE_SELECT_LEADER) {\r\n        int voters = dictSize(master->sentinels) + 1; // +1\u662f\u56e0\u4e3a\u5305\u62ec\u81ea\u5df1\r\n        int votes = dictSize(master->sentinels_voted) + 1; // \u81ea\u5df1\u4e5f\u7b97\u4e00\u7968\r\n        \r\n        // \u5982\u679c\u83b7\u5f97\u591a\u6570\u7968(\u5927\u4e8e\u4e00\u534a)\r\n        if (votes >= voters/2+1) {\r\n            // \u6210\u4e3a\u9886\u5bfc\u8005\uff0c\u5f00\u59cb\u6267\u884c\u6545\u969c\u8f6c\u79fb\r\n            sentinelEvent(LL_WARNING, "+elected-leader", master, "%@");\r\n            master->failover_state = SENTINEL_FAILOVER_STATE_FAILOVER_IN_PROGRESS;\r\n            sentinelFailoverSelectSlave(master);\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u2463\u3001\u5982\u679c\u6ca1\u6709\u54e8\u5175\u5728\u8fd9\u4e00\u8f6e\u6295\u7968\u4e2d\u83b7\u5f97\u8d85\u8fc7\u534a\u6570\u7684\u9009\u7968\uff0c\u8fd9\u6b21\u9009\u4e3e\u5c31\u4f1a\u5931\u8d25\uff0c\u7136\u540e\u8fdb\u884c\u4e0b\u4e00\u8f6e\u7684\u9009\u4e3e\u3002\u4e3a\u4e86\u9632\u6b62\u65e0\u9650\u5236\u7684\u9009\u4e3e\u5931\u8d25\uff0c\u6bcf\u4e2a\u54e8\u5175\u90fd\u4f1a\u6709\u4e00\u4e2a\u9009\u4e3e\u8d85\u65f6\u65f6\u95f4\uff0c\u4e14\u662f\u968f\u673a\u7684\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:'// sentinel.c\u4e2d\u7684sentinelFailoverSelectLeader\u51fd\u6570\r\nvoid sentinelFailoverSelectLeader(sentinelRedisInstance *master) {\r\n    // \u68c0\u67e5\u9009\u4e3e\u662f\u5426\u8d85\u65f6\r\n    mstime_t election_timeout = SENTINEL_ELECTION_TIMEOUT * 2;\r\n    if (mstime() - master->failover_start_time > election_timeout) {\r\n        // \u9009\u4e3e\u8d85\u65f6\uff0c\u91cd\u7f6e\u72b6\u6001\r\n        sentinelEvent(LL_WARNING, "-failover-abort-timeout", master, "%@");\r\n        sentinelAbortFailover(master);\r\n        return;\r\n    }\r\n    \r\n    // ... \u5176\u4ed6\u9009\u4e3e\u903b\u8f91 ...\r\n    \r\n    // \u5982\u679c\u6ca1\u6709\u8db3\u591f\u7968\u6570\u4e14\u672a\u8d85\u65f6\uff0c\u5219\u7ee7\u7eed\u7b49\u5f85\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd9\u91cc SENTINEL_ELECTION_TIMEOUT_MIN \u901a\u5e38\u4e3a 0\uff0cSENTINEL_ELECTION_TIMEOUT_MAX \u901a\u5e38\u4e3a 2000 \u6beb\u79d2\u3002\u8fd9\u6837\u6bcf\u4e2a\u54e8\u5175\u4f1a\u5728 0-2 \u79d2\u7684\u968f\u673a\u65f6\u95f4\u540e\u5f00\u59cb\u9009\u4e3e\uff0c\u51cf\u5c11\u9009\u4e3e\u51b2\u7a81\u3002\r\n[Raft\u7b97\u6cd5\u8be6\u89e3](",(0,i.jsx)(n.a,{href:"https://hoverzheng.github.io/post/technology-blog/blockchain/",children:"https://hoverzheng.github.io/post/technology-blog/blockchain/"}),"\r\nraft%E7%AE%97%E6%B3%95%E8%AF%A6%E8%A7%A33--%E9%80%89%E4%B8%BB/)"]}),"\n",(0,i.jsx)(n.h3,{id:"\u65b0\u7684\u4e3b\u8282\u70b9\u662f\u600e\u6837\u88ab\u6311\u9009\u51fa\u6765\u7684",children:"\u65b0\u7684\u4e3b\u8282\u70b9\u662f\u600e\u6837\u88ab\u6311\u9009\u51fa\u6765\u7684\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u54e8\u5175\u5728\u6311\u9009\u65b0\u7684\u4e3b\u8282\u70b9\u65f6\uff0c\u975e\u5e38\u7cbe\u7ec6\u5316\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732536934",src:r(51776).A+"",width:"496",height:"546"}),"\r\n\u9996\u5148\uff0c\u54e8\u5175\u4f1a\u5bf9\u6240\u6709\u4ece\u8282\u70b9\u8fdb\u884c\u4e00\u8f6e\u57fa\u7840\u7b5b\u9009\uff0c\u6392\u9664\u90a3\u4e9b\u4e0d\u6ee1\u8db3\u57fa\u672c\u6761\u4ef6\u7684\u8282\u70b9\u3002\u6bd4\u5982\u8bf4\u5df2\u4e0b\u7ebf\u7684\u8282\u70b9\u3001\u7f51\u7edc\u8fde\u63a5\u4e0d\u7a33\u5b9a\u7684\u8282\u70b9\uff0c\u4ee5\u53ca\u4f18\u5148\u7ea7\u8bbe\u4e3a 0 \u660e\u786e\u4e0d\u53c2\u4e0e\u6311\u9009\u7684\u8282\u70b9\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"// \u7b2c\u4e00\u8f6e\u7b5b\u9009\uff1a\u6392\u9664\u4e0d\u6ee1\u8db3\u57fa\u672c\u6761\u4ef6\u7684\u4ece\u8282\u70b9\r\nfor (int i = 0; i < numslaves; i++) {\r\n    sentinelRedisInstance *slave = slaves[i];\r\n    \r\n    // \u6392\u9664\u5df2\u4e0b\u7ebf\u7684\u4ece\u8282\u70b9\r\n    if (slave->flags & (SRI_S_DOWN|SRI_O_DOWN)) continue;\r\n    // \u6392\u9664\u65ad\u5f00\u8fde\u63a5\u7684\u4ece\u8282\u70b9\r\n    if (slave->link->disconnected) continue;\r\n    // \u6392\u9664\u8fd1\u671f\uff085\u79d2\u5185\uff09\u65ad\u8fc7\u8fde\u7684\u4ece\u8282\u70b9\r\n    if (mstime() - slave->link->last_avail_time > 5000) continue;\r\n    // \u6392\u9664\u672a\u5efa\u7acb\u4e3b\u4ece\u590d\u5236\u7684\u8282\u70b9\r\n    if (slave->slave_priority == 0) continue;\r\n    \r\n    // \u627e\u5230\u7b2c\u4e00\u4e2a\u6ee1\u8db3\u6761\u4ef6\u7684\u4ece\u8282\u70b9\r\n    selected = i;\r\n    break;\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7136\u540e\uff0c\u54e8\u5175\u4f1a\u5bf9\u5269\u4e0b\u7684\u4ece\u8282\u70b9\u8fdb\u884c\u6392\u5e8f\uff0c\u9009\u51fa\u6700\u5408\u9002\u7684\u4e3b\u8282\u70b9\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"// sentinel.c\u4e2d\u7684compareSlaves\u51fd\u6570\r\nint compareSlaves(sentinelRedisInstance *a, sentinelRedisInstance *b) {\r\n    // 1. \u9996\u5148\u6bd4\u8f83\u7528\u6237\u8bbe\u7f6e\u7684\u4f18\u5148\u7ea7\uff0c\u503c\u8d8a\u5c0f\u4f18\u5148\u7ea7\u8d8a\u9ad8\r\n    if (a->slave_priority != b->slave_priority)\r\n        return (a->slave_priority < b->slave_priority) ? 1 : 2;\r\n        \r\n    // 2. \u5982\u679c\u4f18\u5148\u7ea7\u76f8\u540c\uff0c\u6bd4\u8f83\u590d\u5236\u504f\u79fb\u91cf\uff0c\u504f\u79fb\u91cf\u8d8a\u5927\u6570\u636e\u8d8a\u65b0\r\n    if (a->slave_repl_offset > b->slave_repl_offset) return 1;\r\n    else if (a->slave_repl_offset < b->slave_repl_offset) return 2;\r\n    \r\n    // 3. \u5982\u679c\u590d\u5236\u504f\u79fb\u91cf\u4e5f\u76f8\u540c\uff0c\u6bd4\u8f83\u8fd0\u884cID\u7684\u5b57\u5178\u5e8f\r\n    return (strcmp(a->runid, b->runid) < 0) ? 1 : 2;\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6392\u5e8f\u7684\u6807\u51c6\u6709\u4e09\u4e2a\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"\u2460\u3001\u4ece\u8282\u70b9\u4f18\u5148\u7ea7\uff1a slave-priority \u7684\u503c\u8d8a\u5c0f\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff0c\u4f18\u5148\u7ea7\u4e3a 0 \u7684\u4ece\u8282\u70b9\u4e0d\u4f1a\u88ab\u9009\u4e2d\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u2461\u3001\u590d\u5236\u504f\u79fb\u91cf\uff1a \u504f\u79fb\u91cf\u8d8a\u5927\u610f\u5473\u7740\u4ece\u8282\u70b9\u7684\u6570\u636e\u8d8a\u65b0\uff0c\u590d\u5236\u7684\u8d8a\u5b8c\u6574\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u2462\u3001\u8fd0\u884c ID\uff1a \u5982\u679c\u4f18\u5148\u7ea7\u548c\u504f\u79fb\u91cf\u90fd\u76f8\u540c\uff0c\u5c31\u6bd4\u8f83\u8fd0\u884c ID \u7684\u5b57\u5178\u5e8f\uff0c\u5b57\u5178\u5e8f\u5c0f\u7684\u4f18\u5148\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u9009\u51fa\u65b0\u4e3b\u8282\u70b9\u540e\uff0c\u54e8\u5175\u4f1a\u5411\u5176\u53d1\u9001 SLAVEOF NO ONE \u547d\u4ee4\u5c06\u5176\u63d0\u5347\u4e3a\u4e3b\u8282\u70b9\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:'// sentinel.c\u4e2d\u7684sentinelFailoverPromoteSlave\u51fd\u6570\r\nvoid sentinelFailoverPromoteSlave(sentinelRedisInstance *master) {\r\n    // ... \u9009\u62e9\u6700\u4f73\u4ece\u8282\u70b9\u7684\u903b\u8f91 ...\r\n    \r\n    // \u5411\u9009\u4e2d\u7684\u4ece\u8282\u70b9\u53d1\u9001SLAVEOF NO ONE\u547d\u4ee4\uff0c\u4f7f\u5176\u6210\u4e3a\u4e3b\u8282\u70b9\r\n    retval = redisAsyncCommand(slave->link->cc,\r\n        sentinelReceivePromotionResponseFromSlave, master,\r\n        "SLAVEOF NO ONE");\r\n        \r\n    // \u66f4\u65b0\u72b6\u6001\r\n    master->promoted_slave = slave;\r\n    slave->flags |= SRI_PROMOTED;\r\n    \r\n    // \u8bb0\u5f55\u65e5\u5fd7\r\n    sentinelEvent(LL_WARNING, "+promoted-slave", slave, "%@");\r\n    sentinelEvent(LL_WARNING, "+failover-state-wait-promotion", master, "%@");\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u4e4b\u540e\uff0c\u54e8\u5175\u4f1a\u7b49\u5f85\u65b0\u4e3b\u8282\u70b9\u7684\u89d2\u8272\u8f6c\u6362\u5b8c\u6210\uff0c\u901a\u8fc7\u53d1\u9001 INFO \u547d\u4ee4\u68c0\u67e5\u5176\u89d2\u8272\u662f\u5426\u5df2\u53d8\u4e3a master \u6765\u786e\u8ba4\u3002\u786e\u8ba4\u6210\u529f\u540e\uff0c\u4f1a\u66f4\u65b0\u6240\u6709\u4ece\u8282\u70b9\u7684\u590d\u5236\u76ee\u6807\uff0c\u6307\u5411\u65b0\u7684\u4e3b\u8282\u70b9\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"SLAVEOF new-master-ip new-master-port\n"})}),"\n",(0,i.jsx)(n.h3,{id:"redis\u96c6\u7fa4\u4e86\u89e3\u5417",children:"Redis\u96c6\u7fa4\u4e86\u89e3\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e3b\u4ece\u590d\u5236\u5b9e\u73b0\u4e86\u8bfb\u5199\u5206\u79bb\u548c\u6570\u636e\u5907\u4efd\uff0c\u54e8\u5175\u673a\u5236\u5b9e\u73b0\u4e86\u4e3b\u8282\u70b9\u6545\u969c\u65f6\u81ea\u52a8\u8fdb\u884c\u6545\u969c\u8f6c\u79fb\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732617284",src:r(29430).A+"",width:"591",height:"352"}),"\r\n\u96c6\u7fa4\u67b6\u6784\u662f\u5bf9\u524d\u4e24\u79cd\u65b9\u6848\u7684\u8fdb\u4e00\u6b65\u6269\u5c55\u548c\u5b8c\u5584\uff0c\u901a\u8fc7\u6570\u636e\u5206\u7247\u89e3\u51b3 Redis \u5355\u673a\u5185\u5b58\u5927\u5c0f\u7684\u9650\u5236\uff0c\u5f53\u7528\u6237\u57fa\u6570\u4ece\u767e\u4e07\u589e\u957f\u5230\u5343\u4e07\u7ea7\u522b\u65f6\uff0c\u6211\u4eec\u53ea\u9700\u7b80\u5355\u5730\u5411\u96c6\u7fa4\u4e2d\u6dfb\u52a0\u8282\u70b9\uff0c\u5c31\u80fd\u8f7b\u677e\u5e94\u5bf9\u4e0d\u65ad\u589e\u957f\u7684\u6570\u636e\u91cf\u548c\u8bbf\u95ee\u538b\u529b\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u6bd4\u5982\u8bf4\u6211\u4eec\u53ef\u4ee5\u5c06\u5355\u5b9e\u4f8b\u6a21\u5f0f\u4e0b\u7684\u6570\u636e\u5e73\u5747\u5206\u4e3a 5 \u4efd\uff0c\u7136\u540e\u542f\u52a8 5 \u4e2a Redis \u5b9e\u4f8b\uff0c\u6bcf\u4e2a\u5b9e\u4f8b\u4fdd\u5b58 5G \u7684\u6570\u636e\uff0c\u4ece\u800c\u5b9e\u73b0\u96c6\u7fa4\u5316\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732629550",src:r(44183).A+"",width:"1105",height:"590"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u8bf7\u8be6\u7ec6\u8bf4\u4e00\u8bf4redis-cluster\u8865\u5145",children:"\u8bf7\u8be6\u7ec6\u8bf4\u4e00\u8bf4Redis Cluster\uff1f\uff08\u8865\u5145\uff09"}),"\n",(0,i.jsxs)(n.p,{children:["Redis Cluster \u662f Redis \u5b98\u65b9\u63d0\u4f9b\u7684\u4e00\u79cd\u5206\u5e03\u5f0f\u96c6\u7fa4\u89e3\u51b3\u65b9\u6848\u3002\u5176\u6838\u5fc3\u7406\u5ff5\u662f\u53bb\u4e2d\u5fc3\u5316\uff0c\u91c7\u7528 P2P \u6a21\u5f0f\uff0c\u6ca1\u6709\u4e2d\u5fc3\u8282\u70b9\u7684\u6982\u5ff5\u3002\u6bcf\u4e2a\u8282\u70b9\u90fd\u4fdd\u5b58\u7740\u6570\u636e\u548c\u6574\u4e2a\u96c6\u7fa4\u7684\u72b6\u6001\uff0c\u8282\u70b9\u4e4b\u95f4\u901a\u8fc7 gossip \u534f\u8bae\u4ea4\u6362\u4fe1\u606f\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732709947",src:r(66650).A+"",width:"1400",height:"850"}),"\r\n\u5728\u6570\u636e\u5206\u7247\u65b9\u9762\uff0cRedis Cluster \u4f7f\u7528\u54c8\u5e0c\u69fd\u673a\u5236\u5c06\u6574\u4e2a\u96c6\u7fa4\u5212\u5206\u4e3a 16384 \u4e2a\u5355\u5143\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732723156",src:r(35536).A+"",width:"1400",height:"880"}),"\r\n\u4f8b\u5982\uff0c\u5982\u679c\u6211\u4eec\u6709 4 \u4e2a Redis \u5b9e\u4f8b\uff0c\u90a3\u4e48\u6bcf\u4e2a\u5b9e\u4f8b\u4f1a\u8d1f\u8d23 4000 \u591a\u4e2a\u54c8\u5e0c\u69fd\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732734101",src:r(25564).A+"",width:"1400",height:"407"}),"\r\n\u5728\u8ba1\u7b97\u54c8\u5e0c\u69fd\u7f16\u53f7\u65f6\uff0cRedis Cluster \u4f1a\u901a\u8fc7 CRC16 \u7b97\u6cd5\u5148\u8ba1\u7b97\u51fa\u952e\u7684\u54c8\u5e0c\u503c\uff0c\u518d\u5bf9\u8fd9\u4e2a\u54c8\u5e0c\u503c\u8fdb\u884c\u53d6\u6a21\u8fd0\u7b97\uff0c\u5f97\u5230\u4e00\u4e2a 0 \u5230 16383 \u4e4b\u95f4\u7684\u6574\u6570\u3002\r\nslot = CRC16(key) mod 16384\r\n\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5c06\u6570\u636e\u5747\u5300\u5730\u5206\u5e03\u5230\u5404\u4e2a\u8282\u70b9\u4e0a\uff0c\u907f\u514d\u6570\u636e\u503e\u659c\u7684\u95ee\u9898\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732751217",src:r(32087).A+"",width:"985",height:"477"}),"\r\n\u5f53\u9700\u8981\u5b58\u50a8\u6216\u67e5\u8be2\u4e00\u4e2a\u952e\u503c\u5bf9\u65f6\uff0cRedis Cluster \u4f1a\u5148\u8ba1\u7b97\u8fd9\u4e2a\u952e\u7684\u54c8\u5e0c\u69fd\u7f16\u53f7\uff0c\u7136\u540e\u6839\u636e\u54c8\u5e0c\u69fd\u7f16\u53f7\u627e\u5230\u5bf9\u5e94\u7684\u8282\u70b9\u8fdb\u884c\u64cd\u4f5c\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u96c6\u7fa4\u4e2d\u6570\u636e\u5982\u4f55\u5206\u533a",children:"\u96c6\u7fa4\u4e2d\u6570\u636e\u5982\u4f55\u5206\u533a\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u5e38\u89c1\u7684\u6570\u636e\u5206\u533a\u6709\u4e09\u79cd\uff1a\u8282\u70b9\u53d6\u4f59\u3001\u4e00\u81f4\u6027\u54c8\u5e0c\u548c\u54c8\u5e0c\u69fd\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u8282\u70b9\u53d6\u4f59\u5206\u533a\u7b80\u5355\u660e\u4e86\uff0c\u901a\u8fc7\u8ba1\u7b97\u952e\u7684\u54c8\u5e0c\u503c\uff0c\u7136\u540e\u5bf9\u8282\u70b9\u6570\u91cf\u53d6\u4f59\uff0c\u7ed3\u679c\u5c31\u662f\u76ee\u6807\u8282\u70b9\u7684\u7d22\u5f15\u3002\r\ntarget_node = hash(key) % N  // N\u4e3a\u8282\u70b9\u6570\u91cf\r\n",(0,i.jsx)(n.img,{alt:"1756732778273",src:r(92864).A+"",width:"695",height:"261"}),"\r\n\u7f3a\u70b9\u662f\u589e\u52a0\u4e00\u4e2a\u65b0\u8282\u70b9\u540e\uff0c\u8282\u70b9\u6570\u91cf\u4ece N \u53d8\u4e3a N+1\uff0c\u51e0\u4e4e\u6240\u6709\u7684\u53d6\u4f59\u7ed3\u679c\u90fd\u4f1a\u6539\u53d8\uff0c\u5bfc\u81f4\u5927\u90e8\u5206\u7f13\u5b58\u5931\u6548\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u4e3a\u4e86\u89e3\u51b3\u8282\u70b9\u53d8\u5316\u5bfc\u81f4\u7684\u5927\u89c4\u6a21\u6570\u636e\u8fc1\u79fb\u95ee\u9898\uff0c\u4e00\u81f4\u6027\u54c8\u5e0c\u5206\u533a\u51fa\u73b0\u4e86\uff1a\u5b83\u5c06\u6574\u4e2a\u54c8\u5e0c\u503c\u7a7a\u95f4\u60f3\u8c61\u6210\u4e00\u4e2a\u73af\uff0c\u8282\u70b9\u548c\u6570\u636e\u90fd\u6620\u5c04\u5230\u8fd9\u4e2a\u73af\u4e0a\u3002\u6570\u636e\u88ab\u5206\u914d\u5230\u987a\u65f6\u9488\u65b9\u5411\u4e0a\u9047\u5230\u7684\u7b2c\u4e00\u4e2a\u8282\u70b9\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732787402",src:r(42408).A+"",width:"586",height:"556"}),"\r\n\u8fd9\u79cd\u8bbe\u8ba1\u7684\u5de7\u5999\u4e4b\u5904\u5728\u4e8e\uff0c\u5f53\u8282\u70b9\u6570\u91cf\u53d8\u5316\u65f6\uff0c\u53ea\u6709\u90e8\u5206\u6570\u636e\u9700\u8981\u91cd\u65b0\u5206\u914d\u3002\u6bd4\u5982\u8bf4\u6211\u4eec\u4ece 5 \u4e2a\u8282\u70b9\u6269\u5bb9\u5230 8 \u4e2a\u8282\u70b9\uff0c\u7406\u8bba\u4e0a\u53ea\u6709\u7ea6 3/8 \u7684\u6570\u636e\u9700\u8981\u8fc1\u79fb\uff0c\u5927\u5927\u51cf\u8f7b\u4e86\u6269\u5bb9\u65f6\u7684\u7cfb\u7edf\u538b\u529b\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u4f46\u4e00\u81f4\u6027\u54c8\u5e0c\u4ecd\u7136\u6709\u4e00\u4e2a\u95ee\u9898\uff1a\u6570\u636e\u5206\u5e03\u4e0d\u5747\u5300\u3002\u6bd4\u5982\u8bf4\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u8282\u70b9 1 \u548c\u8282\u70b9 2 \u7684\u6570\u636e\u91cf\u5dee\u4e0d\u591a\uff0c\u4f46\u8282\u70b9 3 \u7684\u6570\u636e\u91cf\u5374\u8fdc\u8fdc\u5c0f\u4e8e\u5b83\u4eec\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["Redis Cluster \u7684\u54c8\u5e0c\u69fd\u5206\u533a\u5728\u4e00\u81f4\u6027\u54c8\u5e0c\u548c\u8282\u70b9\u53d6\u4f59\u7684\u57fa\u7840\u4e0a\uff0c\u505a\u4e86\u4e00\u4e9b\u6539\u8fdb\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732822490",src:r(45997).A+"",width:"1400",height:"1128"}),"\r\n\u5b83\u5c06\u6574\u4e2a\u54c8\u5e0c\u503c\u7a7a\u95f4\u5212\u5206\u4e3a 16384 \u4e2a\u69fd\u4f4d\uff0c\u6bcf\u4e2a\u8282\u70b9\u8d1f\u8d23\u4e00\u90e8\u5206\u69fd\uff0c\u6570\u636e\u901a\u8fc7 CRC16 \u7b97\u6cd5\u8ba1\u7b97\u540e\u5bf9 16384 \u53d6\u6a21\uff0c\u786e\u5b9a\u5b83\u5c5e\u4e8e\u54ea\u4e2a\u69fd\u3002\r\nslot = CRC16(key) % 16384\r\n",(0,i.jsx)(n.img,{alt:"1756732834750",src:r(33773).A+"",width:"1400",height:"921"}),"\r\n\u5047\u8bbe\u7cfb\u7edf\u4e2d\u6709 4 \u4e2a\u8282\u70b9\uff0c\u4e3a\u5176\u5206\u914d\u4e86 16 \u4e2a\u69fd(0-15)\uff1b"]}),"\n",(0,i.jsx)(n.p,{children:"\u69fd 0-3 \u4f4d\u4e8e\u8282\u70b9 node1\uff1b\r\n\u69fd 4-7 \u4f4d\u4e8e\u8282\u70b9 node2\uff1b\r\n\u69fd 8-11 \u4f4d\u4e8e\u8282\u70b9 node3\uff1b\r\n\u69fd 12-15 \u4f4d\u4e8e\u8282\u70b9 node4\u3002\r\n\u5982\u679c\u6b64\u65f6\u5220\u9664 node2\uff0c\u53ea\u9700\u8981\u5c06\u69fd 4-7 \u91cd\u65b0\u5206\u914d\u5373\u53ef\uff0c\u4f8b\u5982\u5c06\u69fd 4-5 \u5206\u914d\u7ed9 node1\uff0c\u69fd 6 \u5206\u914d\u7ed9 node3\uff0c\u69fd 7 \u5206\u914d\u7ed9 node4\uff0c\u6570\u636e\u5728\u8282\u70b9\u4e0a\u7684\u5206\u5e03\u4ecd\u7136\u8f83\u4e3a\u5747\u8861\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u6b64\u65f6\u589e\u52a0 node5\uff0c\u4e5f\u53ea\u9700\u8981\u5c06\u4e00\u90e8\u5206\u69fd\u5206\u914d\u7ed9 node5 \u5373\u53ef\uff0c\u6bd4\u5982\u8bf4\u5c06\u69fd 3\u3001\u69fd 7\u3001\u69fd 11\u3001\u69fd 15 \u8fc1\u79fb\u7ed9 node5\uff0c\u8282\u70b9\u4e0a\u7684\u5176\u4ed6\u69fd\u4f4d\u4fdd\u7559\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u56e0\u4e3a\u69fd\u7684\u4e2a\u6570\u521a\u597d\u662f 2 \u7684 14 \u6b21\u65b9\uff0c\u548c HashMap \u4e2d\u6570\u7ec4\u7684\u957f\u5ea6\u5fc5\u987b\u662f 2 \u7684\u5e42\u6b21\u65b9\u6709\u7740\u5f02\u66f2\u540c\u5de5\u4e4b\u5999\u3002\u5b83\u80fd\u4fdd\u8bc1\u6269\u5bb9\u540e\uff0c\u5927\u90e8\u5206\u6570\u636e\u505c\u7559\u5728\u6269\u5bb9\u524d\u7684\u4f4d\u7f6e\uff0c\u53ea\u6709\u5c11\u90e8\u5206\u6570\u636e\u9700\u8981\u8fc1\u79fb\u5230\u65b0\u7684\u69fd\u4e0a\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u80fd\u8bf4\u8bf4-redis-\u96c6\u7fa4\u7684\u539f\u7406\u5417",children:"\u80fd\u8bf4\u8bf4 Redis \u96c6\u7fa4\u7684\u539f\u7406\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["Redis \u96c6\u7fa4\u7684\u642d\u5efa\u59cb\u4e8e\u8282\u70b9\u7684\u6dfb\u52a0\u548c\u63e1\u624b\u3002\u6bcf\u4e2a\u8282\u70b9\u901a\u8fc7\u8bbe\u7f6e cluster-enabled yes \u6765\u5f00\u542f\u96c6\u7fa4\u6a21\u5f0f\u3002\u7136\u540e\u901a\u8fc7 CLUSTER MEET \u8fdb\u884c\u63e1\u624b\uff0c\u5c06\u5bf9\u65b9\u6dfb\u52a0\u5230\u5404\u81ea\u7684\u8282\u70b9\u5217\u8868\u4e2d\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732868180",src:r(14881).A+"",width:"813",height:"327"}),"\r\n\u8fd9\u4e2a\u8fc7\u7a0b\u8bbe\u8ba1\u7684\u975e\u5e38\u7cbe\u5de7\uff1a\u8282\u70b9 A \u53d1\u9001 MEET \u6d88\u606f\uff0c\u8282\u70b9 B \u56de\u590d PONG \u5e76\u53d1\u9001 PING\uff0c\u8282\u70b9 A \u56de\u590d PONG\uff0c\u4e8e\u662f\u53cc\u5411\u7684\u901a\u4fe1\u94fe\u8def\u5c31\u5efa\u7acb\u5b8c\u6210\u4e86\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732873364",src:r(83929).A+"",width:"1096",height:"1285"}),"\r\n\u6709\u8da3\u7684\u662f\uff0c\u7531\u4e8e\u91c7\u7528\u4e86 Gossip \u534f\u8bae\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u8ba9\u6bcf\u5bf9\u8282\u70b9\u90fd\u6267\u884c\u63e1\u624b\u3002\u5728\u4e00\u4e2a\u591a\u8282\u70b9\u96c6\u7fa4\u7684\u90e8\u7f72\u4e2d\uff0c\u4ec5\u9700\u8981\u8ba9\u7b2c\u4e00\u4e2a\u8282\u70b9\u4e0e\u5176\u4ed6\u8282\u70b9\u63e1\u624b\uff0c\u5176\u4f59\u8282\u70b9\u5c31\u80fd\u901a\u8fc7\u4fe1\u606f\u4f20\u64ad\u81ea\u52a8\u53d1\u73b0\u5e76\u8fde\u63a5\u5f7c\u6b64\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732898204",src:r(99913).A+"",width:"2732",height:"1960"}),"\r\n\u63e1\u624b\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7 CLUSTER ADDSLOTS \u547d\u4ee4\u4e3a\u4e3b\u8282\u70b9\u5206\u914d\u54c8\u5e0c\u69fd\u3002\u5f53 16384 \u4e2a\u69fd\u5168\u90e8\u5206\u914d\u5b8c\u6bd5\uff0c\u96c6\u7fa4\u6b63\u5f0f\u8fdb\u5165\u5c31\u7eea\u72b6\u6001\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732947178",src:r(72164).A+"",width:"756",height:"504"}),"\r\n\u6545\u969c\u68c0\u6d4b\u548c\u6062\u590d\u662f\u4fdd\u969c Redis \u96c6\u7fa4\u9ad8\u53ef\u7528\u7684\u5173\u952e\u3002\u6bcf\u79d2\u949f\uff0c\u8282\u70b9\u4f1a\u5411\u4e00\u5b9a\u6570\u91cf\u7684\u968f\u673a\u8282\u70b9\u53d1\u9001 PING \u6d88\u606f\uff0c\u5f53\u53d1\u73b0\u67d0\u4e2a\u8282\u70b9\u957f\u65f6\u95f4\u672a\u54cd\u5e94 PING \u6d88\u606f\uff0c\u5c31\u4f1a\u5c06\u5176\u6807\u8bb0\u4e3a\u4e3b\u89c2\u4e0b\u7ebf\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732973033",src:r(62141).A+"",width:"491",height:"225"}),"\r\n\u5f53\u534a\u6570\u4ee5\u4e0a\u7684\u4e3b\u8282\u70b9\u90fd\u8ba4\u4e3a\u67d0\u8282\u70b9\u4e3b\u89c2\u4e0b\u7ebf\u65f6\uff0c\u8fd9\u4e2a\u8282\u70b9\u5c31\u4f1a\u88ab\u6807\u8bb0\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732983171",src:r(45213).A+"",width:"793",height:"512"}),"\r\n\u5982\u679c\u4e0b\u7ebf\u7684\u662f\u4e3b\u8282\u70b9\uff0c\u5b83\u7684\u4ece\u8282\u70b9\u4e4b\u4e00\u5c06\u88ab\u9009\u4e3e\u4e3a\u65b0\u7684\u4e3b\u8282\u70b9\uff0c\u63a5\u7ba1\u539f\u4e3b\u8282\u70b9\u8d1f\u8d23\u7684\u54c8\u5e0c\u69fd\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756732994762",src:r(74723).A+"",width:"779",height:"400"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u90e8\u7f72-redis-\u96c6\u7fa4\u81f3\u5c11\u9700\u8981\u51e0\u4e2a\u7269\u7406\u8282\u70b9",children:"\u90e8\u7f72 Redis \u96c6\u7fa4\u81f3\u5c11\u9700\u8981\u51e0\u4e2a\u7269\u7406\u8282\u70b9\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u90e8\u7f72\u4e00\u4e2a\u751f\u4ea7\u73af\u5883\u53ef\u7528\u7684 Redis \u96c6\u7fa4\uff0c\u4ece\u6280\u672f\u89d2\u5ea6\u6765\u8bf4\uff0c\u81f3\u5c11\u9700\u8981 3 \u4e2a\u7269\u7406\u8282\u70b9\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u4e2a\u6700\u5c0f\u8282\u70b9\u6570\u7684\u8bbe\u5b9a\u5e76\u975e Redis \u6280\u672f\u4e0a\u7684\u786c\u6027\u8981\u6c42\uff0c\u800c\u662f\u57fa\u4e8e\u9ad8\u53ef\u7528\u539f\u5219\u7684\u5b9e\u8df5\u8003\u91cf\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u4ece\u5b9e\u8df5\u89d2\u5ea6\u770b\uff0c\u6700\u7ecf\u5178\u7684 Redis \u96c6\u7fa4\u914d\u7f6e\u662f 3 \u4e3b 3 \u4ece\uff0c\u5171 6 \u4e2a Redis \u5b9e\u4f8b\u3002\u8003\u8651\u5230\u9700\u8981 3 \u4e2a\u4e3b\u8282\u70b9\u548c 3 \u4e2a\u4ece\u8282\u70b9\uff0c\u5e76\u4e14\u6bcf\u5bf9\u4e3b\u4ece\u4e0d\u80fd\u5728\u540c\u4e00\u7269\u7406\u673a\u4e0a\uff0c\u90a3\u4e48\u81f3\u5c11\u9700\u8981 3 \u4e2a\u7269\u7406\u8282\u70b9\uff0c\u6bcf\u4e2a\u7269\u7406\u8282\u70b9\u4e0a\u8fd0\u884c 1 \u4e2a\u4e3b\u8282\u70b9\u548c\u53e6\u4e00\u4e2a\u4e3b\u8282\u70b9\u7684\u4ece\u8282\u70b9\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7269\u7406\u8282\u70b91\uff1a\u4e3b\u8282\u70b9A + \u4ece\u8282\u70b9B'\r\n\u7269\u7406\u8282\u70b92\uff1a\u4e3b\u8282\u70b9B + \u4ece\u8282\u70b9C'\r\n\u7269\u7406\u8282\u70b93\uff1a\u4e3b\u8282\u70b9C + \u4ece\u8282\u70b9A'\r\n\u8fd9\u79cd\u4ea4\u9519\u90e8\u7f72\u65b9\u5f0f\u53ef\u4ee5\u786e\u4fdd\u4efb\u4f55\u4e00\u4e2a\u7269\u7406\u8282\u70b9\u6545\u969c\u65f6\uff0c\u6700\u591a\u53ea\u5f71\u54cd\u4e00\u4e2a\u4e3b\u8282\u70b9\u548c\u4e00\u4e2a\u4e0d\u540c\u4e3b\u8282\u70b9\u7684\u4ece\u8282\u70b9\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u8bf4\u8bf4redis\u96c6\u7fa4\u7684\u52a8\u6001\u4f38\u7f29",children:"\u8bf4\u8bf4Redis\u96c6\u7fa4\u7684\u52a8\u6001\u4f38\u7f29\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["Redis \u96c6\u7fa4\u52a8\u6001\u4f38\u7f29\u7684\u6838\u5fc3\u673a\u5236\u662f\u901a\u8fc7\u91cd\u65b0\u5206\u914d\u54c8\u5e0c\u69fd\u5b9e\u73b0\u7684\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733028439",src:r(44173).A+"",width:"794",height:"479"}),"\r\n\u5f53\u9700\u8981\u6269\u5bb9\u65f6\uff0c\u9996\u5148\u901a\u8fc7 CLUSTER MEET \u547d\u4ee4\u5c06\u65b0\u8282\u70b9\u52a0\u5165\u96c6\u7fa4\uff1b\u7136\u540e\u4f7f\u7528 reshard \u547d\u4ee4\u5c06\u90e8\u5206\u54c8\u5e0c\u69fd\u91cd\u65b0\u5206\u914d\u7ed9\u65b0\u8282\u70b9\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733033386",src:r(50636).A+"",width:"794",height:"479"}),"\r\n\u7f29\u5bb9\u5219\u662f\u53cd\u5411\u64cd\u4f5c\uff1a\u5148\u5c06\u8981\u4e0b\u7ebf\u8282\u70b9\u8d1f\u8d23\u7684\u6240\u6709\u69fd\u8fc1\u79fb\u5230\u5176\u4ed6\u8282\u70b9\uff0c\u518d\u901a\u8fc7 CLUSTER FORGET \u547d\u4ee4\u5c06\u8282\u70b9\u4ece\u96c6\u7fa4\u4e2d\u79fb\u9664\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u6574\u4e2a\u4f38\u7f29\u8fc7\u7a0b\u652f\u6301\u5728\u7ebf\u64cd\u4f5c\uff0c\u65e0\u9700\u505c\u673a\uff0c\u5f97\u76ca\u4e8e Redis \u96c6\u7fa4\u7684 MOVED \u548c ASK \u91cd\u5b9a\u5411\u673a\u5236\u3002\u5f53\u5ba2\u6237\u7aef\u8bbf\u95ee\u7684\u952e\u4e0d\u5728\u5f53\u524d\u8282\u70b9\u65f6\uff0c\u4f1a\u6536\u5230\u91cd\u5b9a\u5411\u54cd\u5e94\uff0c\u6307\u5f15\u5b83\u8fde\u63a5\u5230\u6b63\u786e\u7684\u8282\u70b9"}),"\n",(0,i.jsx)(n.h3,{id:"moved-\u548c-ask-\u91cd\u5b9a\u5411\u7684\u533a\u522b",children:"MOVED \u548c ASK \u91cd\u5b9a\u5411\u7684\u533a\u522b\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["MOVED \u91cd\u5b9a\u5411\u53cd\u6620\u7684\u662f\u54c8\u5e0c\u69fd\u7684\u6c38\u4e45\u6027\u53d8\u66f4\u3002\u5f53\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e00\u4e2a\u952e\uff0c\u4f46\u952e\u6240\u5728\u7684\u69fd\u4e0d\u5728\u5f53\u524d\u8282\u70b9\u65f6\uff0c\u8282\u70b9\u4f1a\u8fd4\u56de MOVED \u54cd\u5e94\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u8fd9\u4e2a\u69fd\u73b0\u5728\u5f52\u5c5e\u4e8e\u54ea\u4e2a\u8282\u70b9\u3002\u901a\u5e38\u53d1\u751f\u5728\u96c6\u7fa4\u5b8c\u6210\u91cd\u65b0\u5206\u7247\u540e\uff0c\u69fd\u7684\u5206\u914d\u5173\u7cfb\u5df2\u7ecf\u7a33\u5b9a\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733078424",src:r(72994).A+"",width:"849",height:"689"}),"\r\n\u6bd4\u5982\u8bf4\u67d0\u4e2a\u69fd\u4ece\u8282\u70b9 A \u79fb\u52a8\u5230\u8282\u70b9 B \u540e\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u4ecd\u5411\u8282\u70b9 A \u8bf7\u6c42\u8be5\u69fd\u4e2d\u7684\u952e\uff0c\u4f1a\u6536\u5230 MOVED \u54cd\u5e94\uff0c\u63d0\u793a\u5e94\u8be5\u8fde\u63a5\u8282\u70b9 B\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["ASK \u91cd\u5b9a\u5411\u51fa\u73b0\u5728\u69fd\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\uff0c\u8868\u793a\u8bf7\u6c42\u7684\u952e\u53ef\u80fd\u5df2\u7ecf\u4ece\u6e90\u8282\u70b9\u8fc1\u79fb\u5230\u4e86\u76ee\u6807\u8282\u70b9\uff0c\u4f46\u8fc1\u79fb\u5c1a\u672a\u5b8c\u6210\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733087675",src:r(12064).A+"",width:"1250",height:"716"})]}),"\n",(0,i.jsx)(n.h2,{id:"\u7f13\u5b58\u8bbe\u8ba1",children:"\u7f13\u5b58\u8bbe\u8ba1"}),"\n",(0,i.jsx)(n.h3,{id:"\u4ec0\u4e48\u662f\u7f13\u5b58\u51fb\u7a7f",children:"\ud83c\udf1f\u4ec0\u4e48\u662f\u7f13\u5b58\u51fb\u7a7f\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u7f13\u5b58\u51fb\u7a7f\u662f\u6307\u67d0\u4e2a\u70ed\u70b9\u6570\u636e\u7f13\u5b58\u8fc7\u671f\u65f6\uff0c\u5927\u91cf\u8bf7\u6c42\u5c31\u4f1a\u7a7f\u900f\u7f13\u5b58\u76f4\u63a5\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u77ac\u95f4\u627f\u53d7\u7684\u538b\u529b\u5de8\u5927\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733132513",src:r(41980).A+"",width:"1890",height:"1498"}),"\r\n\u89e3\u51b3\u7f13\u5b58\u51fb\u7a7f\u6709\u4e24\u79cd\u5e38\u7528\u7684\u7b56\u7565\uff1a"]}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c\u4e00\u79cd\u662f\u52a0\u4e92\u65a5\u9501\u3002\u5f53\u7f13\u5b58\u5931\u6548\u65f6\uff0c\u7b2c\u4e00\u4e2a\u8bbf\u95ee\u7684\u7ebf\u7a0b\u5148\u83b7\u53d6\u9501\u5e76\u8d1f\u8d23\u91cd\u5efa\u7f13\u5b58\uff0c\u5176\u4ed6\u7ebf\u7a0b\u7b49\u5f85\u6216\u91cd\u8bd5\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733143093",src:r(20897).A+"",width:"395",height:"514"}),"\r\n\u8fd9\u79cd\u7b56\u7565\u867d\u7136\u4f1a\u5bfc\u81f4\u90e8\u5206\u8bf7\u6c42\u5ef6\u8fdf\uff0c\u4f46\u5b9e\u73b0\u8d77\u6765\u76f8\u5bf9\u7b80\u5355\u3002\u5728\u6280\u672f\u6d3e\u5b9e\u6218\u9879\u76ee\u4e2d\uff0c\u6211\u4eec\u5c31\u4f7f\u7528\u4e86 Redisson \u7684\u5206\u5e03\u5f0f\u9501\u6765\u786e\u4fdd\u53ea\u6709\u4e00\u4e2a\u670d\u52a1\u5b9e\u4f8b\u80fd\u66f4\u65b0\u7f13\u5b58\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'String cacheKey = "product::" + productId;\r\nRLock lock = redissonClient.getLock("lock::" + productId);\r\nif (lock.tryLock(10, TimeUnit.SECONDS)) {\r\n    try {\r\n        String result = cache.get(cacheKey);\r\n        if (result == null) {\r\n            result = database.queryProductById(productId);\r\n            cache.set(cacheKey, result, 60 * 1000); // \u8bbe\u7f6e\u7f13\u5b58\r\n        }\r\n    } finally {\r\n        lock.unlock();\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e8c\u79cd\u662f\u6c38\u4e0d\u8fc7\u671f\u7b56\u7565\u3002\u7f13\u5b58\u9879\u672c\u8eab\u4e0d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4e5f\u5c31\u662f\u6c38\u4e0d\u8fc7\u671f\uff0c\u4f46\u5728\u7f13\u5b58\u503c\u4e2d\u7ef4\u62a4\u4e00\u4e2a\u903b\u8f91\u8fc7\u671f\u65f6\u95f4\u3002\u5f53\u7f13\u5b58\u903b\u8f91\u4e0a\u8fc7\u671f\u65f6\uff0c\u8fd4\u56de\u65e7\u503c\u7684\u540c\u65f6\uff0c\u5f02\u6b65\u542f\u52a8\u4e00\u4e2a\u7ebf\u7a0b\u53bb\u66f4\u65b0\u7f13\u5b58\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public String getData(String key) {\r\n    CacheItem item = cache.get(key);\r\n    \r\n    if (item == null) {\r\n        // \u7f13\u5b58\u4e0d\u5b58\u5728\uff0c\u540c\u6b65\u52a0\u8f7d\r\n        String data = db.query(key);\r\n        cache.set(key, new CacheItem(data, System.currentTimeMillis() + expireTime));\r\n        return data;\r\n    } else if (item.isLogicalExpired()) {\r\n        // \u903b\u8f91\u8fc7\u671f\uff0c\u5f02\u6b65\u5237\u65b0\r\n        asyncRefresh(key);\r\n        // \u8fd4\u56de\u65e7\u6570\u636e\r\n        return item.getData();\r\n    }\r\n    \r\n    return item.getData();\r\n}\r\n\r\n// \u5f02\u6b65\u5237\u65b0\u7f13\u5b58\r\nprivate void asyncRefresh(final String key) {\r\n    threadPool.execute(() -> {\r\n        // \u91cd\u65b0\u67e5\u8be2\u6570\u636e\u5e93\r\n        String newData = db.query(key);\r\n        // \u66f4\u65b0\u7f13\u5b58\r\n        cache.set(key, new CacheItem(newData, System.currentTimeMillis() + expireTime));\r\n    });\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u4ec0\u4e48\u662f\u7f13\u5b58\u7a7f\u900f",children:"\u4ec0\u4e48\u662f\u7f13\u5b58\u7a7f\u900f\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u7f13\u5b58\u7a7f\u900f\u662f\u6307\u67e5\u8be2\u7684\u6570\u636e\u5728\u7f13\u5b58\u4e2d\u6ca1\u6709\u547d\u4e2d\uff0c\u56e0\u4e3a\u6570\u636e\u538b\u6839\u4e0d\u5b58\u5728\uff0c\u6240\u4ee5\u8bf7\u6c42\u4f1a\u76f4\u63a5\u843d\u5230\u6570\u636e\u5e93\u4e0a\u3002\u5982\u679c\u8fd9\u79cd\u67e5\u8be2\u975e\u5e38\u9891\u7e41\uff0c\u5c31\u4f1a\u7ed9\u6570\u636e\u5e93\u9020\u6210\u5f88\u5927\u7684\u538b\u529b\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733231061",src:r(94414).A+"",width:"1882",height:"1390"}),"\r\n\u7f13\u5b58\u51fb\u7a7f\u662f\u56e0\u4e3a\u5355\u4e2a\u70ed\u70b9\u6570\u636e\u7f13\u5b58\u5931\u6548\u5bfc\u81f4\u7684\uff0c\u800c\u7f13\u5b58\u7a7f\u900f\u662f\u56e0\u4e3a\u67e5\u8be2\u7684\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u539f\u56e0\u53ef\u80fd\u662f\u81ea\u8eab\u7684\u4e1a\u52a1\u4ee3\u7801\u6709\u95ee\u9898\uff0c\u6216\u8005\u662f\u6076\u610f\u653b\u51fb\u9020\u6210\u7684\uff0c\u6bd4\u5982\u722c\u866b\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u5e38\u7528\u7684\u89e3\u51b3\u65b9\u6848\u6709\u4e24\u79cd\uff1a\u7b2c\u4e00\u79cd\u662f\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u5b83\u662f\u4e00\u79cd\u7a7a\u95f4\u6548\u7387\u5f88\u9ad8\u7684\u6570\u636e\u7ed3\u6784\uff0c\u53ef\u4ee5\u7528\u6765\u5224\u65ad\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u5728\u96c6\u5408\u4e2d\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u6211\u4eec\u53ef\u4ee5\u5c06\u6240\u6709\u53ef\u80fd\u5b58\u5728\u7684\u6570\u636e\u54c8\u5e0c\u5230\u5e03\u9686\u8fc7\u6ee4\u5668\u4e2d\uff0c\u67e5\u8be2\u65f6\u5148\u68c0\u67e5\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u5982\u679c\u5e03\u9686\u8fc7\u6ee4\u5668\u8ba4\u4e3a\u8be5\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\u7a7a\uff1b\u5426\u5219\u518d\u53bb\u67e5\u8be2\u7f13\u5b58\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u907f\u514d\u65e0\u6548\u7684\u7f13\u5b58\u67e5\u8be2\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733241315",src:r(86083).A+"",width:"439",height:"574"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public String getData(String key) {\r\n    // \u7f13\u5b58\u4e2d\u4e0d\u5b58\u5728\u8be5key\r\n    String cacheResult = cache.get(key);\r\n    if (cacheResult != null) {\r\n        return cacheResult;\r\n    }\r\n    \r\n    // \u5e03\u9686\u8fc7\u6ee4\u5668\u5224\u65adkey\u662f\u5426\u53ef\u80fd\u5b58\u5728\r\n    if (!bloomFilter.mightContain(key)) {\r\n        return null; // \u4e00\u5b9a\u4e0d\u5b58\u5728\uff0c\u76f4\u63a5\u8fd4\u56de\r\n    }\r\n    \r\n    // \u53ef\u80fd\u5b58\u5728\uff0c\u67e5\u8be2\u6570\u636e\u5e93\r\n    String dbResult = db.query(key);\r\n    \r\n    // \u5c06\u7ed3\u679c\u653e\u5165\u7f13\u5b58\uff0c\u5305\u62ec\u7a7a\u503c\r\n    cache.set(key, dbResult != null ? dbResult : "", expireTime);\r\n    \r\n    return dbResult;\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5e03\u9686\u8fc7\u6ee4\u5668\u5b58\u5728\u8bef\u5224\uff0c\u5373\u53ef\u80fd\u4f1a\u8ba4\u4e3a\u67d0\u4e2a\u6570\u636e\u5b58\u5728\uff0c\u4f46\u5b9e\u9645\u4e0a\u5e76\u4e0d\u5b58\u5728\u3002\u4f46\u7edd\u4e0d\u4f1a\u6f0f\u5224\uff0c\u5373\u5982\u679c\u5e03\u9686\u8fc7\u6ee4\u5668\u8ba4\u4e3a\u67d0\u4e2a\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u90a3\u5b83\u4e00\u5b9a\u4e0d\u5b58\u5728\u3002\u56e0\u6b64\u5b83\u53ef\u4ee5\u6709\u6548\u62e6\u622a\u4e0d\u5b58\u5728\u7684\u6570\u636e\u67e5\u8be2\uff0c\u51cf\u8f7b\u6570\u636e\u5e93\u538b\u529b\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c\u4e8c\u79cd\u662f\u7f13\u5b58\u7a7a\u503c\u3002\u5bf9\u4e8e\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u6211\u4eec\u5c06\u7a7a\u503c\u5199\u5165\u7f13\u5b58\uff0c\u5e76\u8bbe\u7f6e\u4e00\u4e2a\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4\u3002\u8fd9\u6837\u4e0b\u6b21\u76f8\u540c\u7684\u67e5\u8be2\u5c31\u80fd\u76f4\u63a5\u4ece\u7f13\u5b58\u8fd4\u56de\uff0c\u800c\u4e0d\u518d\u8bbf\u95ee\u6570\u636e\u5e93\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733314451",src:r(79393).A+"",width:"369",height:"503"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public String getData(String key) {\r\n    String cacheResult = cache.get(key);\r\n    \r\n    // \u7f13\u5b58\u547d\u4e2d\uff0c\u5305\u62ec\u7a7a\u503c\r\n    if (cacheResult != null) {\r\n        // \u7279\u6b8a\u503c\u8868\u793a\u7a7a\u7ed3\u679c\r\n        if (cacheResult.equals("")) {\r\n            return null;\r\n        }\r\n        return cacheResult;\r\n    }\r\n    \r\n    // \u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u67e5\u8be2\u6570\u636e\u5e93\r\n    String dbResult = db.query(key);\r\n    \r\n    // \u5199\u5165\u7f13\u5b58\uff0c\u7a7a\u503c\u4e5f\u7f13\u5b58\uff0c\u4f46\u8bbe\u7f6e\u8f83\u77ed\u7684\u8fc7\u671f\u65f6\u95f4\r\n    int expireTime = dbResult == null ? EMPTY_EXPIRE_TIME : NORMAL_EXPIRE_TIME;\r\n    cache.set(key, dbResult != null ? dbResult : "", expireTime);\r\n    \r\n    return dbResult;\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u7f13\u5b58\u7a7a\u503c\u7684\u65b9\u6cd5\u5b9e\u73b0\u8d77\u6765\u6bd4\u8f83\u7b80\u5355\uff0c\u4f46\u9700\u8981\u7ed9\u7a7a\u503c\u8bbe\u7f6e\u4e00\u4e2a\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u514d\u6570\u636e\u5e93\u4e2d\u65b0\u589e\u4e86\u8fd9\u4e9b\u6570\u636e\u540e\uff0c\u7f13\u5b58\u4ecd\u7136\u8fd4\u56de\u7a7a\u503c\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u5b9e\u9645\u7684\u9879\u76ee\u5f53\u4e2d\uff0c\u8fd8\u9700\u8981\u5728\u63a5\u53e3\u5c42\u9762\u505a\u4e00\u4e9b\u5904\u7406\uff0c\u6bd4\u5982\u8bf4\u5bf9\u53c2\u6570\u8fdb\u884c\u6821\u9a8c\uff0c\u62e6\u622a\u660e\u663e\u4e0d\u5408\u7406\u7684\u8bf7\u6c42\uff1b\u6216\u8005\u5bf9\u7591\u4f3c\u653b\u51fb\u7684 IP \u8fdb\u884c\u9650\u6d41\u548c\u5c01\u7981\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u4ec0\u4e48\u662f\u7f13\u5b58\u96ea\u5d29",children:"\u4ec0\u4e48\u662f\u7f13\u5b58\u96ea\u5d29\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u7f13\u5b58\u96ea\u5d29\u662f\u6307\u5728\u67d0\u4e00\u65f6\u95f4\u6bb5\uff0c\u5927\u91cf\u7f13\u5b58\u540c\u65f6\u5931\u6548\u6216\u8005\u7f13\u5b58\u670d\u52a1\u7a81\u7136\u5b95\u673a\u4e86\uff0c\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u76f4\u63a5\u6d8c\u5411\u6570\u636e\u5e93\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u538b\u529b\u5267\u589e\uff0c\u751a\u81f3\u5f15\u53d1\u7cfb\u7edf\u5d29\u6e83\u7684\u73b0\u8c61\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733376024",src:r(63361).A+"",width:"827",height:"498"}),"\r\n\u7f13\u5b58\u51fb\u7a7f\u662f\u5355\u4e2a\u70ed\u70b9\u6570\u636e\u5931\u6548\u5bfc\u81f4\u7684\uff0c\u7f13\u5b58\u7a7f\u900f\u662f\u56e0\u4e3a\u8bf7\u6c42\u4e0d\u5b58\u5728\u7684\u6570\u636e\uff0c\u800c\u7f13\u5b58\u96ea\u5d29\u662f\u56e0\u4e3a\u5927\u8303\u56f4\u7684\u7f13\u5b58\u5931\u6548\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u7f13\u5b58\u96ea\u5d29\u4e3b\u8981\u6709\u4e09\u79cd\u6210\u56e0\u548c\u5e94\u5bf9\u7b56\u7565\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e00\u79cd\uff0c\u5927\u91cf\u7f13\u5b58\u540c\u65f6\u8fc7\u671f\uff0c\u89e3\u51b3\u65b9\u6cd5\u662f\u6dfb\u52a0\u968f\u673a\u8fc7\u671f\u65f6\u95f4\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public void setCache(String key, String value) {\r\n    // \u57fa\u7840\u8fc7\u671f\u65f6\u95f4\uff0c\u4f8b\u598230\u5206\u949f\r\n    int baseExpireSeconds = 1800;\r\n    // \u589e\u52a0\u968f\u673a\u8fc7\u671f\u65f6\u95f4\uff0c\u8303\u56f40-300\u79d2\r\n    int randomSeconds = new Random().nextInt(300);\r\n    // \u6700\u7ec8\u8fc7\u671f\u65f6\u95f4\u4e3a\u57fa\u7840\u65f6\u95f4\u52a0\u968f\u673a\u65f6\u95f4\r\n    cache.set(key, value, baseExpireSeconds + randomSeconds);\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e8c\u79cd\uff0c\u7f13\u5b58\u670d\u52a1\u5d29\u6e83\uff0c\u89e3\u51b3\u65b9\u6cd5\u662f\u4f7f\u7528\u9ad8\u53ef\u7528\u7684\u7f13\u5b58\u96c6\u7fa4\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u6bd4\u5982\u8bf4\u4f7f\u7528 Redis Cluster \u6784\u5efa\u591a\u8282\u70b9\u96c6\u7fa4\uff0c\u786e\u4fdd\u6570\u636e\u5728\u591a\u4e2a\u8282\u70b9\u4e0a\u6709\u5907\u4efd\uff0c\u5e76\u4e14\u652f\u6301\u81ea\u52a8\u6545\u969c\u8f6c\u79fb\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733457972",src:r(29789).A+"",width:"1400",height:"850"}),"\r\n\u5bf9\u4e8e\u4e00\u4e9b\u9ad8\u9891\u5173\u952e\u6570\u636e\uff0c\u53ef\u4ee5\u914d\u7f6e\u672c\u5730\u7f13\u5b58\u4f5c\u4e3a\u4e8c\u7ea7\u7f13\u5b58\uff0c\u7f13\u89e3 Redis \u7684\u538b\u529b\u3002\u5728\u6280\u672f\u6d3e\u5b9e\u6218\u9879\u76ee\u4e2d\uff0c\u6211\u4eec\u5c31\u91c7\u7528\u4e86\u591a\u7ea7\u7f13\u5b58\u7684\u7b56\u7565\uff0c\u5176\u4e2d\u5c31\u5305\u62ec\u4f7f\u7528\u672c\u5730\u7f13\u5b58 Caffeine \u6765\u4f5c\u4e3a\u4e8c\u7ea7\u7f13\u5b58\uff0c\u5f53 Redis \u51fa\u73b0\u95ee\u9898\u65f6\u81ea\u52a8\u5207\u6362\u5230\u672c\u5730\u7f13\u5b58\u3002\r\n\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a\u201c\u7f13\u5b58\u964d\u7ea7\u201d\uff0c\u4fdd\u8bc1 Redis \u53d1\u751f\u6545\u969c\u65f6\uff0c\u7cfb\u7edf\u80fd\u591f\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"LoadingCache<String, UserPermissions> permissionsCache = Caffeine.newBuilder()\r\n    .maximumSize(1000)\r\n    .expireAfterWrite(10, TimeUnit.MINUTES)\r\n    .build(this::loadPermissionsFromRedis);\r\n\r\npublic UserPermissions loadPermissionsFromRedis(String userId) {\r\n    try {\r\n        return redisClient.getPermissions(userId);\r\n    } catch (Exception ex) {\r\n        // Redis \u5f02\u5e38\u5904\u7406\uff0c\u5c1d\u8bd5\u4ece\u672c\u5730\u7f13\u5b58\u83b7\u53d6\r\n        return permissionsCache.getIfPresent(userId);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e09\u79cd\uff0c\u7f13\u5b58\u670d\u52a1\u6b63\u5e38\u4f46\u5e76\u53d1\u8bf7\u6c42\u91cf\u8d85\u8fc7\u4e86\u7f13\u5b58\u670d\u52a1\u7684\u627f\u8f7d\u80fd\u529b\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u53ef\u4ee5\u91c7\u7528\u9650\u6d41\u548c\u964d\u7ea7\u63aa\u65bd\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public String getData(String key) {\r\n    try {\r\n        // \u5c1d\u8bd5\u4ece\u7f13\u5b58\u83b7\u53d6\u6570\u636e\r\n        return cache.get(key);\r\n    } catch (Exception e) {\r\n        // \u7f13\u5b58\u670d\u52a1\u5f02\u5e38\uff0c\u89e6\u53d1\u7194\u65ad\r\n        if (circuitBreaker.shouldTrip()) {\r\n            // \u76f4\u63a5\u4ece\u6570\u636e\u5e93\u83b7\u53d6\uff0c\u5e76\u8fdb\u5165\u964d\u7ea7\u6a21\u5f0f\r\n            circuitBreaker.trip();\r\n            return getFromDbDirectly(key);\r\n        }\r\n        throw e;\r\n    }\r\n}\r\n\r\nprivate String getFromDbDirectly(String key) {\r\n    // \u5b9e\u65bd\u9650\u6d41\u4fdd\u62a4\r\n    if (!rateLimit.tryAcquire()) {\r\n        // \u8d85\u8fc7\u9650\u6d41\u9608\u503c\uff0c\u8fd4\u56de\u515c\u5e95\u6570\u636e\u6216\u9ed8\u8ba4\u503c\r\n        return getDefaultValue(key);\r\n    }\r\n    \r\n    // \u9650\u6d41\u901a\u8fc7\uff0c\u4ece\u6570\u636e\u5e93\u67e5\u8be2\r\n    return db.query(key);\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u80fd\u8bf4\u8bf4\u5e03\u9686\u8fc7\u6ee4\u5668\u5417",children:"\ud83c\udf1f\u80fd\u8bf4\u8bf4\u5e03\u9686\u8fc7\u6ee4\u5668\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u5e03\u9686\u8fc7\u6ee4\u5668\u662f\u4e00\u79cd\u7a7a\u95f4\u6548\u7387\u6781\u9ad8\u7684\u6982\u7387\u6027\u6570\u636e\u7ed3\u6784\uff0c\u7528\u4e8e\u5feb\u901f\u5224\u65ad\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u5728\u4e00\u4e2a\u96c6\u5408\u4e2d\u3002\u5b83\u7684\u7279\u70b9\u662f\u80fd\u591f\u4ee5\u6781\u5c0f\u7684\u5185\u5b58\u6d88\u8017\uff0c\u5224\u65ad\u4e00\u4e2a\u5143\u7d20\u201c\u4e00\u5b9a\u4e0d\u5728\u96c6\u5408\u4e2d\u201d\u6216\u201c\u53ef\u80fd\u5728\u96c6\u5408\u4e2d\u201d\uff0c\u5e38\u7528\u6765\u89e3\u51b3 Redis \u7f13\u5b58\u7a7f\u900f\u7684\u95ee\u9898\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733661312",src:r(96802).A+"",width:"1126",height:"284"}),"\r\n----\u8fd9\u90e8\u5206\u9762\u8bd5\u4e2d\u53ef\u4ee5\u4e0d\u80ccstart----"]}),"\n",(0,i.jsx)(n.p,{children:"\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u6838\u5fc3\u7531\u4e00\u4e2a\u5f88\u957f\u7684\u4e8c\u8fdb\u5236\u5411\u91cf\u548c\u4e00\u7cfb\u5217\u54c8\u5e0c\u51fd\u6570\u7ec4\u6210\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u521b\u5efa\u4e00\u4e2a\u957f\u5ea6\u4e3a m \u7684\u4f4d\u6570\u7ec4\uff0c\u521d\u59cb\u503c\u5168\u4e3a 0\uff0c\u540c\u65f6\u9009\u62e9 k \u4e2a\u4e0d\u540c\u7684\u54c8\u5e0c\u51fd\u6570\r\n\u5f53\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20\u65f6\uff0c\u7528 k \u4e2a\u54c8\u5e0c\u51fd\u6570\u8ba1\u7b97\u51fa k \u4e2a\u54c8\u5e0c\u503c\uff0c\u7136\u540e\u5bf9 m \u53d6\u6a21\uff0c\u5f97\u5230 k \u4e2a\u4f4d\u7f6e\uff0c\u5c06\u8fd9\u4e9b\u4f4d\u7f6e\u7684\u4e8c\u8fdb\u5236\u4f4d\u90fd\u8bbe\u4e3a 1\r\n\u5f53\u9700\u8981\u5224\u65ad\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u5728\u96c6\u5408\u4e2d\u65f6\uff0c\u540c\u6837\u7528 k \u4e2a\u54c8\u5e0c\u51fd\u6570\u8ba1\u7b97\u51fa k \u4e2a\u4f4d\u7f6e\uff0c\u5982\u679c\u8fd9\u4e9b\u4f4d\u7f6e\u7684\u4e8c\u8fdb\u5236\u4f4d\u6709\u4efb\u4f55\u4e00\u4e2a\u4e3a 0\uff0c\u8be5\u5143\u7d20\u4e00\u5b9a\u4e0d\u5728\u96c6\u5408\u4e2d\uff1b\u5982\u679c\u5168\u90e8\u4e3a 1\uff0c\u5219\u8be5\u5143\u7d20\u53ef\u80fd\u5728\u96c6\u5408\u4e2d"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public class BloomFilter<T> {\r\n    private BitSet bitSet;\r\n    private int bitSetSize;\r\n    private int numberOfHashFunctions;\r\n    \r\n    public BloomFilter(double falsePositiveProbability, int expectedNumberOfElements) {\r\n        // \u6839\u636e\u9884\u671f\u5143\u7d20\u6570\u91cf\u548c\u671f\u671b\u7684\u8bef\u5224\u7387\uff0c\u8ba1\u7b97\u6700\u4f18\u7684\u4f4d\u6570\u7ec4\u5927\u5c0f\u548c\u54c8\u5e0c\u51fd\u6570\u4e2a\u6570\r\n        this.bitSetSize = calculateOptimalBitSetSize(expectedNumberOfElements, falsePositiveProbability);\r\n        this.numberOfHashFunctions = calculateOptimalNumberOfHashFunctions(expectedNumberOfElements, bitSetSize);\r\n        this.bitSet = new BitSet(bitSetSize);\r\n    }\r\n    \r\n    public void add(T element) {\r\n        int[] hashes = createHashes(element);\r\n        for (int hash : hashes) {\r\n            bitSet.set(Math.abs(hash % bitSetSize), true);\r\n        }\r\n    }\r\n    \r\n    public boolean mightContain(T element) {\r\n        int[] hashes = createHashes(element);\r\n        for (int hash : hashes) {\r\n            if (!bitSet.get(Math.abs(hash % bitSetSize))) {\r\n                return false; // \u5982\u679c\u4efb\u4f55\u4e00\u4f4d\u4e3a0\uff0c\u5143\u7d20\u4e00\u5b9a\u4e0d\u5b58\u5728\r\n            }\r\n        }\r\n        return true; // \u6240\u6709\u4f4d\u90fd\u4e3a1\uff0c\u5143\u7d20\u53ef\u80fd\u5b58\u5728\r\n    }\r\n    \r\n    // \u5176\u4ed6\u8f85\u52a9\u65b9\u6cd5\uff0c\u5982\u8ba1\u7b97\u54c8\u5e0c\u503c\uff0c\u8ba1\u7b97\u6700\u4f18\u53c2\u6570\u7b49\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"----\u8fd9\u90e8\u5206\u9762\u8bd5\u4e2d\u53ef\u4ee5\u4e0d\u80ccend----"}),"\n",(0,i.jsx)(n.h3,{id:"\u5e03\u9686\u8fc7\u6ee4\u5668\u5b58\u5728\u8bef\u5224\u5417",children:"\u5e03\u9686\u8fc7\u6ee4\u5668\u5b58\u5728\u8bef\u5224\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u662f\u7684\uff0c\u5e03\u9686\u8fc7\u6ee4\u5668\u5b58\u5728\u8bef\u5224\u3002\u5b83\u53ef\u80fd\u4f1a\u9519\u8bef\u5730\u8ba4\u4e3a\u67d0\u4e2a\u5143\u7d20\u5728\u96c6\u5408\u4e2d\uff0c\u800c\u5143\u7d20\u5b9e\u9645\u4e0a\u5e76\u4e0d\u5728\u96c6\u5408\u4e2d\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733698709",src:r(86578).A+"",width:"1582",height:"860"}),"\r\n\u4f46\u5982\u679c\u5e03\u9686\u8fc7\u6ee4\u5668\u8ba4\u4e3a\u67d0\u4e2a\u5143\u7d20\u4e0d\u5b58\u5728\u4e8e\u96c6\u5408\u4e2d\uff0c\u90a3\u4e48\u5b83\u4e00\u5b9a\u4e0d\u5b58\u5728\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8bef\u5224\u4ea7\u751f\u7684\u539f\u56e0\u662f\u56e0\u4e3a\u54c8\u5e0c\u51b2\u7a81\u3002\u5728\u5e03\u9686\u8fc7\u6ee4\u5668\u4e2d\uff0c\u591a\u4e2a\u4e0d\u540c\u7684\u5143\u7d20\u53ef\u80fd\u6620\u5c04\u5230\u76f8\u540c\u7684\u4f4d\u7f6e\u3002\u968f\u7740\u5411\u5e03\u9686\u8fc7\u6ee4\u5668\u4e2d\u6dfb\u52a0\u7684\u5143\u7d20\u8d8a\u6765\u8d8a\u591a\uff0c\u4f4d\u6570\u7ec4\u4e2d\u7684 1 \u4e5f\u8d8a\u6765\u8d8a\u591a\uff0c\u53d1\u751f\u54c8\u5e0c\u51b2\u7a81\u7684\u6982\u7387\u968f\u4e4b\u589e\u52a0\uff0c\u8bef\u5224\u7387\u4e5f\u5c31\u968f\u4e4b\u4e0a\u5347\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733712631",src:r(46331).A+"",width:"800",height:"456"}),"\r\n\u8bef\u5224\u7387\u53d6\u51b3\u4e8e\u4ee5\u4e0b 3 \u4e2a\u56e0\u7d20\uff1a"]}),"\n",(0,i.jsx)(n.p,{children:"\u4f4d\u6570\u7ec4\u7684\u5927\u5c0f\uff08m\uff09\uff1am \u51b3\u5b9a\u4e86\u53ef\u4ee5\u5b58\u50a8\u7684\u6807\u5fd7\u4f4d\u6570\u91cf\u3002\u5982\u679c\u4f4d\u6570\u7ec4\u8fc7\u5c0f\uff0c\u90a3\u4e48\u54c8\u5e0c\u78b0\u649e\u7684\u51e0\u7387\u5c31\u4f1a\u589e\u52a0\uff0c\u4ece\u800c\u5bfc\u81f4\u66f4\u9ad8\u7684\u8bef\u5224\u7387\u3002\r\n\u54c8\u5e0c\u51fd\u6570\u7684\u6570\u91cf\uff08k\uff09\uff1ak \u51b3\u5b9a\u4e86\u6bcf\u4e2a\u5143\u7d20\u5728\u4f4d\u6570\u7ec4\u4e2d\u6807\u8bb0\u7684\u4f4d\u6570\u3002\u54c8\u5e0c\u51fd\u6570\u8d8a\u591a\uff0c\u78b0\u649e\u7684\u6982\u7387\u4e5f\u4f1a\u76f8\u5e94\u53d8\u5316\u3002\u5982\u679c\u54c8\u5e0c\u51fd\u6570\u592a\u5c11\uff0c\u8fc7\u6ee4\u5668\u5f88\u5feb\u4f1a\u53d8\u5f97\u4e0d\u7cbe\u786e\uff1b\u5982\u679c\u592a\u591a\uff0c\u8bef\u5224\u7387\u4e5f\u4f1a\u5347\u9ad8\uff0c\u6548\u7387\u4e0b\u964d\u3002\r\n\u5b58\u5165\u7684\u5143\u7d20\u6570\u91cf\uff08n\uff09\uff1an \u8d8a\u591a\uff0c\u54c8\u5e0c\u78b0\u649e\u7684\u51e0\u7387\u8d8a\u5927\uff0c\u4ece\u800c\u5bfc\u81f4\u66f4\u9ad8\u7684\u8bef\u5224\u7387\u3002\r\n\u8981\u964d\u4f4e\u8bef\u5224\u7387\uff0c\u53ef\u4ee5\u589e\u52a0\u4f4d\u6570\u7ec4\u7684\u5927\u5c0f\u6216\u8005\u51cf\u5c11\u63d2\u5165\u7684\u5143\u7d20\u6570\u91cf\u3002"}),"\n",(0,i.jsx)(n.p,{children:'\u8981\u5f7b\u5e95\u89e3\u51b3\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u8bef\u5224\u95ee\u9898\uff0c\u53ef\u4ee5\u5728\u5e03\u9686\u8fc7\u6ee4\u5668\u8fd4\u56de"\u53ef\u80fd\u5b58\u5728"\u65f6\uff0c\u518d\u901a\u8fc7\u6570\u636e\u5e93\u8fdb\u884c\u4e8c\u6b21\u786e\u8ba4\u3002'}),"\n",(0,i.jsx)(n.h3,{id:"\u5e03\u9686\u8fc7\u6ee4\u5668\u652f\u6301\u5220\u9664\u5417",children:"\u5e03\u9686\u8fc7\u6ee4\u5668\u652f\u6301\u5220\u9664\u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u5e03\u9686\u8fc7\u6ee4\u5668\u5e76\u4e0d\u652f\u6301\u5220\u9664\u64cd\u4f5c\uff0c\u8fd9\u662f\u5b83\u7684\u4e00\u4e2a\u91cd\u8981\u9650\u5236\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u6211\u4eec\u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20\u65f6\uff0c\u4f1a\u5c06\u4f4d\u6570\u7ec4\u4e2d\u7684 k \u4e2a\u4f4d\u7f6e\u8bbe\u7f6e\u4e3a 1\u3002\u7531\u4e8e\u591a\u4e2a\u4e0d\u540c\u5143\u7d20\u53ef\u80fd\u5171\u4eab\u76f8\u540c\u7684\u4f4d\uff0c\u5982\u679c\u6211\u4eec\u5c1d\u8bd5\u5220\u9664\u4e00\u4e2a\u5143\u7d20\uff0c\u5c06\u5176\u5bf9\u5e94\u7684 k \u4e2a\u4f4d\u91cd\u7f6e\u4e3a 0\uff0c\u53ef\u80fd\u4f1a\u9519\u8bef\u5730\u5f71\u54cd\u5230\u5176\u4ed6\u5143\u7d20\u7684\u5224\u65ad\u7ed3\u679c\u3002"}),"\n",(0,i.jsx)(n.p,{children:'\u4f8b\u5982\uff0c\u5143\u7d20 A \u548c\u5143\u7d20 B \u90fd\u5c06\u4f4d\u7f6e 5 \u8bbe\u4e3a 1\uff0c\u5982\u679c\u5220\u9664\u5143\u7d20 A \u65f6\u5c06\u4f4d\u7f6e 5 \u91cd\u7f6e\u4e3a 0\uff0c\u90a3\u4e48\u5bf9\u5143\u7d20 B \u7684\u67e5\u8be2\u5c31\u4f1a\u4ea7\u751f\u9519\u8bef\u7684"\u4e0d\u5b58\u5728"\u7ed3\u679c\uff0c\u8fd9\u8fdd\u80cc\u4e86\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u57fa\u672c\u7279\u6027\u3002'}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u60f3\u8981\u5b9e\u73b0\u5220\u9664\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528\u8ba1\u6570\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u5b83\u5728\u6bcf\u4e2a\u4f4d\u7f6e\u4e0a\u5b58\u50a8\u4e00\u4e2a\u8ba1\u6570\u5668\u800c\u4e0d\u662f\u5355\u4e00\u7684\u4f4d\u3002\u8fd9\u6837\u53ef\u4ee5\u901a\u8fc7\u51cf\u5c11\u8ba1\u6570\u5668\u7684\u503c\u6765\u5b9e\u73b0\u5220\u9664\u64cd\u4f5c\uff0c\u4f46\u4f1a\u589e\u52a0\u5185\u5b58\u5f00\u9500\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public class CountingBloomFilter<T> {\r\n    private int[] counters;\r\n    private int size;\r\n    private int hashFunctions;\r\n    \r\n    public CountingBloomFilter(int size, int hashFunctions) {\r\n        this.size = size;\r\n        this.hashFunctions = hashFunctions;\r\n        this.counters = new int[size];\r\n    }\r\n    \r\n    public void add(T element) {\r\n        int[] positions = getHashPositions(element);\r\n        for (int position : positions) {\r\n            counters[position]++;\r\n        }\r\n    }\r\n    \r\n    public void remove(T element) {\r\n        int[] positions = getHashPositions(element);\r\n        for (int position : positions) {\r\n            if (counters[position] > 0) {\r\n                counters[position]--;\r\n            }\r\n        }\r\n    }\r\n    \r\n    public boolean mightContain(T element) {\r\n        int[] positions = getHashPositions(element);\r\n        for (int position : positions) {\r\n            if (counters[position] == 0) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n    \r\n    private int[] getHashPositions(T element) {\r\n        // \u8ba1\u7b97\u54c8\u5e0c\u4f4d\u7f6e\u7684\u4ee3\u7801\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u7528\u54c8\u5e0c\u8868\u800c\u662f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668",children:"\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u7528\u54c8\u5e0c\u8868\u800c\u662f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u5e03\u9686\u8fc7\u6ee4\u5668\u6700\u7a81\u51fa\u7684\u4f18\u52bf\u662f\u5185\u5b58\u6548\u7387\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5047\u5982\u6211\u4eec\u8981\u5224\u65ad 10 \u4ebf\u4e2a\u7528\u6237 ID \u662f\u5426\u66fe\u7ecf\u8bbf\u95ee\u8fc7\u7279\u5b9a\u9875\u9762\uff0c\u4f7f\u7528\u54c8\u5e0c\u8868\u81f3\u5c11\u9700\u8981 10G \u5185\u5b58\uff08\u6bcf\u4e2a ID \u81f3\u5c11\u9700\u89818\u5b57\u8282\uff09\uff0c\u800c\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u53ea\u9700\u8981 1.2G \u5185\u5b58\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u5982\u4f55\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u81f4\u6027",children:"\ud83c\udf1f\u5982\u4f55\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u2f00\u81f4\u6027\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728\u6280\u672f\u6d3e\u5b9e\u6218\u9879\u76ee\u4e2d\uff0c\u5bf9\u4e8e\u6587\u7ae0\u6807\u7b7e\u8fd9\u79cd\u5141\u8bb8\u77ed\u6682\u4e0d\u4e00\u81f4\u7684\u6570\u636e\uff0c\u6211\u4f1a\u91c7\u7528 Cache Aside + TTL \u8fc7\u671f\u673a\u5236\u6765\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u4e00\u81f4\u6027\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756733923796",src:r(12981).A+"",width:"2350",height:"1602"})]}),"\n",(0,i.jsx)(n.p,{children:"\u5177\u4f53\u505a\u6cd5\u662f\u8bfb\u53d6\u65f6\u5148\u67e5 Redis\uff0c\u672a\u547d\u4e2d\u518d\u67e5 MySQL\uff0c\u540c\u65f6\u4e3a\u7f13\u5b58\u8bbe\u7f6e\u4e00\u4e2a\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4\uff1b\u66f4\u65b0\u65f6\u5148\u66f4\u65b0 MySQL\uff0c\u518d\u5220\u9664 Redis\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u8bfb\u53d6\u903b\u8f91\r\npublic UserInfo getUser(String userId) {\r\n    // \u5148\u67e5\u7f13\u5b58\r\n    UserInfo user = cache.get("user:" + userId);\r\n    if (user != null) {\r\n        return user;\r\n    }\r\n    \r\n    // \u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u67e5\u6570\u636e\u5e93\r\n    user = database.selectUser(userId);\r\n    if (user != null) {\r\n        // \u653e\u5165\u7f13\u5b58\uff0c\u8bbe\u7f6e\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4\r\n        cache.set("user:" + userId, user, 3600);\r\n    }\r\n    \r\n    return user;\r\n}\r\n\r\n// \u66f4\u65b0\u903b\u8f91\r\npublic void updateUser(UserInfo user) {\r\n    // \u5148\u66f4\u65b0\u6570\u636e\u5e93\r\n    database.updateUser(user);\r\n    \r\n    // \u5220\u9664\u7f13\u5b58\r\n    cache.delete("user:" + user.getId());\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u79cd\u65b9\u5f0f\u7b80\u5355\u6709\u6548\uff0c\u9002\u7528\u4e8e\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\u3002TTL \u8fc7\u671f\u65f6\u95f4\u4e5f\u80fd\u591f\u4fdd\u8bc1\u5373\u4f7f\u66f4\u65b0\u64cd\u4f5c\u5931\u8d25\uff0c\u672a\u80fd\u53ca\u65f6\u5220\u9664\u7f13\u5b58\uff0c\u8fc7\u671f\u65f6\u95f4\u4e5f\u80fd\u786e\u4fdd\u6570\u636e\u6700\u7ec8\u4e00\u81f4\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u90a3\u518d\u6765\u8bf4\u8bf4\u4e3a\u4ec0\u4e48\u8981\u5220\u9664\u7f13\u5b58\u800c\u4e0d\u662f\u66f4\u65b0\u7f13\u5b58",children:"\u90a3\u518d\u6765\u8bf4\u8bf4\u4e3a\u4ec0\u4e48\u8981\u5220\u9664\u7f13\u5b58\u800c\u4e0d\u662f\u66f4\u65b0\u7f13\u5b58\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u6700\u521d\u8bbe\u8ba1\u7f13\u5b58\u7b56\u7565\u65f6\uff0c\u6211\u4e5f\u8003\u8651\u8fc7\u76f4\u63a5\u66f4\u65b0\u7f13\u5b58\uff0c\u4f46\u901a\u8fc7\u5b9e\u8df5\u53d1\u73b0\uff0c\u5220\u9664\u7f13\u5b58\u662f\u66f4\u4f18\u7684\u9009\u62e9\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756734010565",src:r(30415).A+"",width:"997",height:"417"}),"\r\n\u6700\u4e3b\u8981\u7684\u539f\u56e0\u662f\u5728\u5e76\u53d1\u73af\u5883\u4e0b\uff0c\u5047\u8bbe\u6211\u4eec\u6709\u4e24\u4e2a\u5e76\u53d1\u7684\u66f4\u65b0\u64cd\u4f5c\uff0c\u5982\u679c\u91c7\u7528\u66f4\u65b0\u7f13\u5b58\u7684\u7b56\u7565\uff0c\u5c31\u53ef\u80fd\u51fa\u73b0\u8fd9\u6837\u7684\u65f6\u5e8f\u95ee\u9898\uff1a"]}),"\n",(0,i.jsx)(n.p,{children:"\u64cd\u4f5c A \u548c\u64cd\u4f5c B \u540c\u65f6\u53d1\u751f\uff0cA \u5148\u66f4\u65b0 MySQL \u5c06\u503c\u6539\u4e3a 10\uff0cB \u540e\u66f4\u65b0 MySQL \u5c06\u503c\u6539\u4e3a 11\u3002\u4f46\u5728\u7f13\u5b58\u66f4\u65b0\u65f6\uff0c\u53ef\u80fd B \u5148\u6267\u884c\u5c06\u7f13\u5b58\u8bbe\u4e3a 11\uff0c\u7136\u540e A \u624d\u6267\u884c\u5c06\u7f13\u5b58\u8bbe\u4e3a10\u3002\u8fd9\u6837\u5c31\u4f1a\u9020\u6210 MySQL \u662f 11 \u4f46 Redis \u662f 10 \u7684\u4e0d\u4e00\u81f4\u72b6\u6001\u3002\r\n\u800c\u91c7\u7528\u5220\u9664\u7b56\u7565\uff0c\u65e0\u8bba A \u548c B \u8c01\u5148\u5220\u9664\u7f13\u5b58\uff0c\u540e\u7eed\u7684\u8bfb\u53d6\u64cd\u4f5c\u90fd\u4f1a\u4ece MySQL \u83b7\u53d6\u6700\u65b0\u503c\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u53e6\u5916\uff0c\u76f8\u5bf9\u800c\u8a00\uff0c\u5220\u9664\u7f13\u5b58\u7684\u901f\u5ea6\u6bd4\u66f4\u65b0\u7f13\u5b58\u7684\u901f\u5ea6\u5feb\u5f97\u591a\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756734022557",src:r(32985).A+"",width:"645",height:"319"}),"\r\n\u56e0\u4e3a\u5220\u9664\u64cd\u4f5c\u53ea\u662f\u7b80\u5355\u7684 DEL \u547d\u4ee4\uff0c\u800c\u66f4\u65b0\u53ef\u80fd\u9700\u8981\u91cd\u65b0\u5e8f\u5217\u5316\u6574\u4e2a\u5bf9\u8c61\u518d\u5199\u5165\u7f13\u5b58\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u90a3\u518d\u8bf4\u8bf4\u4e3a\u4ec0\u4e48\u8981\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58",children:"\u90a3\u518d\u8bf4\u8bf4\u4e3a\u4ec0\u4e48\u8981\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u4e2a\u64cd\u4f5c\u987a\u5e8f\u7684\u9009\u62e9\u4e5f\u662f\u6211\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u8e29\u8fc7\u5751\u624d\u6df1\u523b\u7406\u89e3\u7684\u3002\u5047\u8bbe\u6211\u4eec\u91c7\u7528\u5148\u5220\u7f13\u5b58\u518d\u66f4\u65b0\u6570\u636e\u5e93\u7684\u7b56\u7565\uff0c\u5728\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\u5c31\u53ef\u80fd\u51fa\u73b0\u8fd9\u6837\u7684\u95ee\u9898\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"\u7ebf\u7a0b A \u8981\u66f4\u65b0\u7528\u6237\u4fe1\u606f\uff0c\u5148\u5220\u9664\u4e86\u7f13\u5b58\r\n\u7ebf\u7a0b B \u6070\u597d\u6b64\u65f6\u8981\u8bfb\u53d6\u8be5\u7528\u6237\u4fe1\u606f\uff0c\u53d1\u73b0\u7f13\u5b58\u4e3a\u7a7a\uff0c\u4e8e\u662f\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u6b64\u65f6\u8fd8\u662f\u65e7\u503c\r\n\u7ebf\u7a0b B \u5c06\u67e5\u5230\u7684\u65e7\u503c\u91cd\u65b0\u653e\u5165\u7f13\u5b58\r\n\u7ebf\u7a0b A \u5b8c\u6210\u6570\u636e\u5e93\u66f4\u65b0\r\n\u7ed3\u679c\u5c31\u662f\u6570\u636e\u5e93\u662f\u65b0\u7684\u503c\uff0c\u4f46\u7f13\u5b58\u4e2d\u8fd8\u662f\u65e7\u503c\u3002\r\n\u800c\u91c7\u7528\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u7f13\u5b58\u7684\u7b56\u7565\uff0c\u5373\u4f7f\u51fa\u73b0\u7c7b\u4f3c\u7684\u5e76\u53d1\u60c5\u51b5\uff0c\u6700\u574f\u7684\u60c5\u51b5\u4e5f\u53ea\u662f\u77ed\u6682\u5730\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u5230\u4e86\u65e7\u503c\uff0c\u4f46\u7f13\u5b58\u5220\u9664\u540e\u7684\u8bf7\u6c42\u4f1a\u76f4\u63a5\u4ece\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u6700\u65b0\u503c\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u53e6\u5916\uff0c\u5982\u679c\u5148\u5220\u7f13\u5b58\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u5f53\u6570\u636e\u5e93\u66f4\u65b0\u5931\u8d25\u65f6\uff0c\u7f13\u5b58\u5df2\u7ecf\u88ab\u5220\u9664\u4e86\u3002\u8fd9\u4f1a\u5bfc\u81f4\u77ed\u671f\u5185\u6240\u6709\u8bfb\u8bf7\u6c42\u90fd\u4f1a\u7a7f\u900f\u5230\u6570\u636e\u5e93\uff0c\u5bf9\u6570\u636e\u5e93\u9020\u6210\u989d\u5916\u7684\u538b\u529b\u3002"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"1756734135741",src:r(45637).A+"",width:"977",height:"417"}),"\r\n\u800c\u91c7\u7528\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u7f13\u5b58\u7684\u7b56\u7565\uff0c\u5373\u4f7f\u51fa\u73b0\u7c7b\u4f3c\u7684\u5e76\u53d1\u60c5\u51b5\uff0c\u6700\u574f\u7684\u60c5\u51b5\u4e5f\u53ea\u662f\u77ed\u6682\u5730\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u5230\u4e86\u65e7\u503c\uff0c\u4f46\u7f13\u5b58\u5220\u9664\u540e\u7684\u8bf7\u6c42\u4f1a\u76f4\u63a5\u4ece\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u6700\u65b0\u503c\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u53e6\u5916\uff0c\u5982\u679c\u5148\u5220\u7f13\u5b58\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u5f53\u6570\u636e\u5e93\u66f4\u65b0\u5931\u8d25\u65f6\uff0c\u7f13\u5b58\u5df2\u7ecf\u88ab\u5220\u9664\u4e86\u3002\u8fd9\u4f1a\u5bfc\u81f4\u77ed\u671f\u5185\u6240\u6709\u8bfb\u8bf7\u6c42\u90fd\u4f1a\u7a7f\u900f\u5230\u6570\u636e\u5e93\uff0c\u5bf9\u6570\u636e\u5e93\u9020\u6210\u989d\u5916\u7684\u538b\u529b\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756734179018",src:r(77588).A+"",width:"1087",height:"598"}),"\r\n\u800c\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u7f13\u5b58\uff0c\u5982\u679c\u6570\u636e\u5e93\u66f4\u65b0\u5931\u8d25\uff0c\u7f13\u5b58\u4fdd\u6301\u539f\u72b6\uff0c\u7cfb\u7edf\u4ecd\u7136\u80fd\u7ee7\u7eed\u6b63\u5e38\u63d0\u4f9b\u670d\u52a1\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public void updateUser(User user) {\r\n    try {\r\n        // \u5148\u66f4\u65b0\u6570\u636e\u5e93\r\n        database.updateUser(user);\r\n        \r\n        // \u518d\u5220\u9664\u7f13\u5b58\r\n        cache.delete("user:" + user.getId());\r\n    } catch (DatabaseException e) {\r\n        // \u6570\u636e\u5e93\u66f4\u65b0\u5931\u8d25\uff0c\u7f13\u5b58\u4fdd\u6301\u539f\u72b6\uff0c\u7cfb\u7edf\u4ecd\u53ef\u6b63\u5e38\u63d0\u4f9b\u670d\u52a1\r\n        log.error("Database update failed", e);\r\n        throw e;\r\n    } catch (CacheException e) {\r\n        // \u7f13\u5b58\u5220\u9664\u5931\u8d25\uff0c\u6570\u636e\u5e93\u5df2\u66f4\u65b0\uff0c\u6570\u636e\u4f1a\u5728TTL\u540e\u81ea\u52a8\u4e00\u81f4\r\n        log.warn("Cache deletion failed, will be eventually consistent", e);\r\n        // \u53ef\u4ee5\u9009\u62e9\u4e0d\u629b\u5f02\u5e38\uff0c\u56e0\u4e3a\u6709TTL\u515c\u5e95\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u90a3\u5047\u5982\u5bf9\u7f13\u5b58\u6570\u636e\u5e93\u4e00\u81f4\u6027\u8981\u6c42\u5f88\u9ad8\u8be5\u600e\u4e48\u529e\u5462",children:"\u90a3\u5047\u5982\u5bf9\u7f13\u5b58\u6570\u636e\u5e93\u4e00\u81f4\u6027\u8981\u6c42\u5f88\u9ad8\uff0c\u8be5\u600e\u4e48\u529e\u5462\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u5f53\u4e1a\u52a1\u5bf9\u7f13\u5b58\u4e0e\u6570\u636e\u5e93\u7684\u4e00\u81f4\u6027\u8981\u6c42\u5f88\u9ad8\u65f6\uff0c\u6bd4\u5982\u652f\u4ed8\u7cfb\u7edf\u3001\u5e93\u5b58\u7ba1\u7406\u7b49\u573a\u666f\uff0c\u6211\u4f1a\u91c7\u7528\u591a\u79cd\u7b56\u7565\u6765\u4fdd\u8bc1\u5f3a\u4e00\u81f4\u6027\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756734292238",src:r(21878).A+"",width:"1542",height:"738"}),"\r\n\u7b2c\u4e00\u79cd\uff0c\u5f15\u5165\u6d88\u606f\u961f\u5217\u6765\u4fdd\u8bc1\u7f13\u5b58\u6700\u7ec8\u88ab\u5220\u9664\uff0c\u6bd4\u5982\u8bf4\u5728\u6570\u636e\u5e93\u66f4\u65b0\u7684\u4e8b\u52a1\u4e2d\u63d2\u5165\u4e00\u6761\u672c\u5730\u6d88\u606f\u8bb0\u5f55\uff0c\u4e8b\u52a1\u63d0\u4ea4\u540e\u5f02\u6b65\u53d1\u9001\u7ed9 MQ \u8fdb\u884c\u7f13\u5b58\u5220\u9664\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756734304497",src:r(79157).A+"",width:"831",height:"401"}),"\r\n\u5373\u4f7f\u7f13\u5b58\u5220\u9664\u5931\u8d25\uff0c\u6d88\u606f\u961f\u5217\u7684\u91cd\u8bd5\u673a\u5236\u4e5f\u80fd\u4fdd\u8bc1\u6700\u7ec8\u4e00\u81f4\u6027\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Transactional\r\npublic void updateUser(UserInfo user) {\r\n    // \u5728\u4e8b\u52a1\u4e2d\u66f4\u65b0\u6570\u636e\u5e93\r\n    database.updateUser(user);\r\n    \r\n    // \u5728\u540c\u4e00\u4e8b\u52a1\u4e2d\u8bb0\u5f55\u9700\u8981\u5220\u9664\u7684\u7f13\u5b58\u4fe1\u606f\r\n    LocalMessage message = new LocalMessage("CACHE_DELETE", "user:" + user.getId());\r\n    database.insertLocalMessage(message);\r\n\r\n    // \u663e\u5f0f\u53d1\u5e03\u4e8b\u4ef6\uff0c\u4f9b\u76d1\u542c\u5668\u6355\u83b7\r\n    eventPublisher.publishEvent(new UserUpdateEvent(this, "user:" + user.getId()));\r\n}\r\n\r\n// \u4e8b\u52a1\u63d0\u4ea4\u540e\u53d1\u9001MQ\u6d88\u606f\r\n@TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)\r\npublic void sendCacheDeleteMessage(UserUpdateEvent event) {\r\n    messageQueue.send("cache-delete-topic", event.getCacheKey());\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c\u4e8c\u79cd\uff0c\u4f7f\u7528 Canal \u76d1\u542c MySQL \u7684 binlog\uff0c\u5728\u6570\u636e\u66f4\u65b0\u65f6\uff0c\u5c06\u6570\u636e\u53d8\u66f4\u8bb0\u5f55\u5230\u6d88\u606f\u961f\u5217\u4e2d\uff0c\u6d88\u8d39\u8005\u6d88\u606f\u76d1\u542c\u5230\u53d8\u66f4\u540e\u53bb\u5220\u9664\u7f13\u5b58\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756734327573",src:r(45977).A+"",width:"948",height:"576"}),"\r\n\u8fd9\u79cd\u65b9\u6848\u7684\u4f18\u52bf\u662f\u5b8c\u5168\u89e3\u8026\u4e86\u4e1a\u52a1\u4ee3\u7801\u548c\u7f13\u5b58\u7ef4\u62a4\u903b\u8f91\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@CanalListener\r\npublic class CacheUpdateListener {\r\n    \r\n    @EventHandler\r\n    public void handleUserUpdate(UserUpdateEvent event) {\r\n        // \u4ecebinlog\u4e8b\u4ef6\u4e2d\u63d0\u53d6\u53d8\u66f4\u4fe1\u606f\r\n        String userId = event.getUserId();\r\n        \r\n        // \u53d1\u9001\u7f13\u5b58\u5220\u9664\u6d88\u606f\r\n        CacheDeleteMessage message = new CacheDeleteMessage();\r\n        message.setCacheKey("user:" + userId);\r\n        messageQueue.send("cache-delete-topic", message);\r\n    }\r\n}\r\n// \u6d88\u8d39\u8005\u76d1\u542c\u6d88\u606f\u961f\u5217\r\n@KafkaListener(topics = "cache-delete-topic")\r\npublic void handleCacheDeleteMessage(CacheDeleteMessage message) {\r\n    // \u5220\u9664\u7f13\u5b58\r\n    cache.delete(message.getCacheKey());\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u5f53\u7136\u4e86\uff0c\u5982\u679c\u8bf4\u4e1a\u52a1\u6bd4\u8f83\u7b80\u5355\uff0c\u4e0d\u9700\u8981\u4e0a\u6d88\u606f\u961f\u5217\uff0c\u53ef\u4ee5\u901a\u8fc7\u5ef6\u8fdf\u53cc\u5220\u7b56\u7565\u964d\u4f4e\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e0d\u4e00\u81f4\u7684\u65f6\u95f4\u7a97\u53e3\uff0c\u5728\u7b2c\u4e00\u6b21\u5220\u9664\u7f13\u5b58\u4e4b\u540e\uff0c\u8fc7\u4e00\u6bb5\u65f6\u95f4\u4e4b\u540e\uff0c\u518d\u6b21\u5c1d\u8bd5\u5220\u9664\u7f13\u5b58\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756734360873",src:r(82581).A+"",width:"505",height:"678"}),"\r\n\u8fd9\u79cd\u65b9\u5f0f\u4e3b\u8981\u9488\u5bf9\u7f13\u5b58\u4e0d\u5b58\u5728\uff0c\u4f46\u5199\u5165\u4e86\u810f\u6570\u636e\u7684\u60c5\u51b5\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public void updateUser(UserInfo user) {\r\n    // \u7b2c\u4e00\u6b21\u5220\u9664\u7f13\u5b58\uff0c\u51cf\u5c11\u4e0d\u4e00\u81f4\u65f6\u95f4\u7a97\u53e3\r\n    cache.delete("user:" + user.getId());\r\n    \r\n    // \u66f4\u65b0\u6570\u636e\u5e93\r\n    database.updateUser(user);\r\n    \r\n    // \u7acb\u5373\u5220\u9664\u7f13\u5b58\r\n    cache.delete("user:" + user.getId());\r\n    \r\n    // \u5ef6\u65f6\u5220\u9664\uff0c\u5e94\u5bf9\u53ef\u80fd\u7684\u5e76\u53d1\u8bfb\u53d6\r\n    CompletableFuture.runAsync(() -> {\r\n        try {\r\n            Thread.sleep(1000); // \u5ef6\u65f6\u65f6\u95f4\u6839\u636e\u4e3b\u4ece\u540c\u6b65\u5ef6\u8fdf\u8c03\u6574\r\n            cache.delete("user:" + user.getId());\r\n        } catch (InterruptedException e) {\r\n            Thread.currentThread().interrupt();\r\n        }\r\n    });\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u6700\u540e\uff0c\u65e0\u8bba\u91c7\u7528\u54ea\u79cd\u7b56\u7565\uff0c\u6700\u597d\u4e3a\u7f13\u5b58\u8bbe\u7f6e\u4e00\u4e2a\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4\u4f5c\u4e3a\u6700\u540e\u7684\u4fdd\u969c\u3002\u5373\u4f7f\u6240\u6709\u7684\u4e3b\u52a8\u5220\u9664\u673a\u5236\u90fd\u5931\u8d25\u4e86\uff0cTTL \u4e5f\u80fd\u786e\u4fdd\u6570\u636e\u6700\u7ec8\u8fbe\u5230\u4e00\u81f4\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// \u6839\u636e\u6570\u636e\u7684\u91cd\u8981\u7a0b\u5ea6\u8bbe\u7f6e\u4e0d\u540c\u7684TTL\r\npublic void setCache(String key, Object value, DataImportance importance) {\r\n    int ttl;\r\n    switch (importance) {\r\n        case HIGH:      // \u5173\u952e\u6570\u636e\uff0c\u77edTTL\r\n            ttl = 300;  // 5\u5206\u949f\r\n            break;\r\n        case MEDIUM:    // \u4e00\u822c\u6570\u636e\r\n            ttl = 1800; // 30\u5206\u949f\r\n            break;\r\n        case LOW:       // \u4e0d\u592a\u91cd\u8981\u7684\u6570\u636e\r\n            ttl = 3600; // 1\u5c0f\u65f6\r\n            break;\r\n    }\r\n    \r\n    cache.setWithTTL(key, value, ttl);\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5982\u4f55\u4fdd\u8bc1\u672c\u5730\u7f13\u5b58\u548c\u5206\u5e03\u5f0f\u7f13\u5b58\u7684\u4e00\u81f4",children:"\u5982\u4f55\u4fdd\u8bc1\u672c\u5730\u7f13\u5b58\u548c\u5206\u5e03\u5f0f\u7f13\u5b58\u7684\u4e00\u81f4\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u6280\u672f\u6d3e\u5b9e\u6218\u9879\u76ee\u4e2d\uff0c\u4e3a\u4e86\u51cf\u8f7b Redis \u7684\u8d1f\u8f7d\u538b\u529b\uff0c\u6211\u53c8\u8ffd\u52a0\u4e86\u4e00\u5c42\u672c\u5730\u7f13\u5b58 Caffeine\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e3a\u4e86\u4fdd\u8bc1 Caffeine \u548c Redis \u7f13\u5b58\u7684\u4e00\u81f4\u6027\uff0c\u6211\u91c7\u7528\u7684\u7b56\u7565\u662f\u5f53\u6570\u636e\u66f4\u65b0\u65f6\uff0c\u901a\u8fc7 Redis \u7684 pub/sub \u673a\u5236\u5411\u6240\u6709\u5e94\u7528\u5b9e\u4f8b\u53d1\u9001\u7f13\u5b58\u66f4\u65b0\u901a\u77e5\uff0c\u6536\u5230\u901a\u77e5\u540e\u7684\u5b9e\u4f8b\u7acb\u5373\u66f4\u65b0\u6216\u8005\u5220\u9664\u672c\u5730\u7f13\u5b58\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756734441158",src:r(38001).A+"",width:"999",height:"788"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Service\r\npublic class CacheService {\r\n    \r\n    private final RedisTemplate redisTemplate;\r\n    private final CaffeineCache localCache;\r\n    \r\n    public void updateData(String key, Object value) {\r\n        // \u66f4\u65b0\u6570\u636e\u5e93\r\n        database.update(key, value);\r\n        \r\n        // \u66f4\u65b0\u5206\u5e03\u5f0f\u7f13\u5b58\r\n        redisTemplate.opsForValue().set(key, value, 30, TimeUnit.MINUTES);\r\n        \r\n        // \u53d1\u9001\u7f13\u5b58\u66f4\u65b0\u901a\u77e5\r\n        CacheUpdateMessage message = new CacheUpdateMessage(key, "UPDATE", value);\r\n        redisTemplate.convertAndSend("cache-update-channel", message);\r\n    }\r\n    \r\n    @EventListener\r\n    public void handleCacheUpdate(CacheUpdateMessage message) {\r\n        if ("UPDATE".equals(message.getAction())) {\r\n            localCache.put(message.getKey(), message.getValue());\r\n        } else if ("DELETE".equals(message.getAction())) {\r\n            localCache.invalidate(message.getKey());\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u8003\u8651\u5230\u6d88\u606f\u53ef\u80fd\u4e22\u5931\uff0c\u6211\u8fd8\u4f1a\u5f15\u5165\u7248\u672c\u53f7\u673a\u5236\u4f5c\u4e3a\u8865\u5145\u3002\u6bcf\u6b21\u4ece Redis \u83b7\u53d6\u6570\u636e\u65f6\u6dfb\u52a0\u4e00\u4e2a\u6700\u65b0\u7684\u7248\u672c\u53f7\u3002\u4ece\u672c\u5730\u7f13\u5b58\u83b7\u53d6\u6570\u636e\u524d\uff0c\u5148\u68c0\u67e5\u81ea\u5df1\u7684\u7248\u672c\u53f7\u662f\u5426\u662f\u6700\u65b0\u7684\uff0c\u5982\u679c\u53d1\u73b0\u7248\u672c\u843d\u540e\uff0c\u5c31\u4e3b\u52a8\u4ece Redis \u4e2d\u83b7\u53d6\u6700\u65b0\u6570\u636e\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Component\r\npublic class VersionBasedCacheManager {\r\n\r\n    @Autowired\r\n    private StringRedisTemplate redisTemplate;\r\n\r\n    // \u4f7f\u7528 Caffeine \u6784\u5efa\u672c\u5730\u7f13\u5b58\uff1a\u6700\u591a 1000 \u9879\uff0c\u5199\u5165\u540e 10 \u5206\u949f\u8fc7\u671f\r\n    private final Cache<String, VersionedData> localCache = Caffeine.newBuilder()\r\n        .maximumSize(1000)\r\n        .expireAfterWrite(10, TimeUnit.MINUTES)\r\n        .build();\r\n\r\n    /**\r\n     * \u83b7\u53d6\u7f13\u5b58\u6570\u636e\uff0c\u4f18\u5148\u4f7f\u7528\u672c\u5730\u7f13\u5b58\uff0c\u5fc5\u8981\u65f6\u4ece Redis \u52a0\u8f7d\r\n     */\r\n    public Object get(String key) {\r\n        VersionedData cached = localCache.getIfPresent(key); // \u4ece\u672c\u5730\u7f13\u5b58\u53d6\u51fa\r\n\r\n        // \u4ece Redis \u83b7\u53d6\u7248\u672c\u53f7\r\n        String versionStr = redisTemplate.opsForValue().get(key + ":version");\r\n\r\n        // \u5982\u679c Redis \u4e2d\u6ca1\u627e\u5230\u7248\u672c\u53f7\uff0c\u8bf4\u660e\u53ef\u80fd\u6570\u636e\u5df2\u5931\u6548\uff0c\u5f3a\u5236\u5237\u65b0\r\n        if (versionStr == null) {\r\n            return loadAndCache(key);\r\n        }\r\n\r\n        long remoteVersion = Long.parseLong(versionStr);\r\n\r\n        // \u5982\u679c\u672c\u5730\u6ca1\u6709\u7f13\u5b58\uff0c\u6216\u7248\u672c\u843d\u540e\u4e8e Redis\uff0c\u5f3a\u5236\u5237\u65b0\r\n        if (cached == null || cached.getVersion() < remoteVersion) {\r\n            return loadAndCache(key);\r\n        }\r\n\r\n        // \u547d\u4e2d\u672c\u5730\u7f13\u5b58\u4e14\u7248\u672c\u6700\u65b0\uff0c\u76f4\u63a5\u8fd4\u56de\r\n        return cached.getData();\r\n    }\r\n\r\n    /**\r\n     * \u4ece Redis \u52a0\u8f7d\u6570\u636e\u548c\u7248\u672c\uff0c\u5e76\u5199\u5165\u672c\u5730\u7f13\u5b58\r\n     */\r\n    private Object loadAndCache(String key) {\r\n        Object data = redisTemplate.opsForValue().get(key);\r\n        String versionStr = redisTemplate.opsForValue().get(key + ":version");\r\n\r\n        if (data != null && versionStr != null) {\r\n            long version = Long.parseLong(versionStr);\r\n            localCache.put(key, new VersionedData(data, version));\r\n        }\r\n\r\n        return data;\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u5982\u679c\u5728\u9879\u76ee\u4e2d\u591a\u4e2a\u5730\u65b9\u90fd\u8981\u4f7f\u7528\u5230\u4e8c\u7ea7\u7f13\u5b58\u7684\u903b\u8f91\u5982\u4f55\u8bbe\u8ba1\u8fd9\u4e00\u5757",children:"\u5982\u679c\u5728\u9879\u76ee\u4e2d\u591a\u4e2a\u5730\u65b9\u90fd\u8981\u4f7f\u7528\u5230\u4e8c\u7ea7\u7f13\u5b58\u7684\u903b\u8f91\uff0c\u5982\u4f55\u8bbe\u8ba1\u8fd9\u4e00\u5757\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u6211\u7684\u601d\u8def\u662f\u5c06\u4e8c\u7ea7\u7f13\u5b58\u62bd\u8c61\u6210\u4e00\u4e2a\u7edf\u4e00\u7684\u7ec4\u4ef6\u3002\u8bbe\u8ba1\u4e00\u4e2a CacheManager \u4f5c\u4e3a\u6838\u5fc3\u5165\u53e3\uff0c\u63d0\u4f9b get\u3001put\u3001evict \u7b49\u57fa\u672c\u64cd\u4f5c\uff0c\u6267\u884c\u5148\u67e5\u672c\u5730\u7f13\u5b58\uff0c\u518d\u67e5\u5206\u5e03\u5f0f\u7f13\u5b58\uff0c\u6700\u540e\u67e5\u6570\u636e\u5e93\u7684\u5b8c\u6574\u6d41\u7a0b\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public class CacheManager {\r\n\r\n    private final LocalCache localCache;\r\n    private final RedisCache redisCache;\r\n    private final Database database;\r\n\r\n    public CacheManager(LocalCache localCache, RedisCache redisCache, Database database) {\r\n        this.localCache = localCache;\r\n        this.redisCache = redisCache;\r\n        this.database = database;\r\n    }\r\n\r\n    public Object get(String key) {\r\n        // \u5148\u67e5\u672c\u5730\u7f13\u5b58\r\n        Object value = localCache.get(key);\r\n        if (value != null) {\r\n            return value;\r\n        }\r\n\r\n        // \u518d\u67e5\u5206\u5e03\u5f0f\u7f13\u5b58\r\n        value = redisCache.get(key);\r\n        if (value != null) {\r\n            // \u66f4\u65b0\u672c\u5730\u7f13\u5b58\r\n            localCache.put(key, value);\r\n            return value;\r\n        }\r\n\r\n        // \u6700\u540e\u67e5\u6570\u636e\u5e93\r\n        value = database.get(key);\r\n        if (value != null) {\r\n            // \u66f4\u65b0\u5206\u5e03\u5f0f\u7f13\u5b58\u548c\u672c\u5730\u7f13\u5b58\r\n            redisCache.put(key, value);\r\n            localCache.put(key, value);\r\n        }\r\n        \r\n        return value;\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u672c\u5730\u7f13\u5b58\u548c-redis-\u7684\u533a\u522b\u4e86\u89e3\u5417",children:"\u672c\u5730\u7f13\u5b58\u548c Redis \u7684\u533a\u522b\u4e86\u89e3\u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u53ef\u4ee5\u90e8\u7f72\u5728\u591a\u4e2a\u8282\u70b9\u4e0a\uff0c\u652f\u6301\u6570\u636e\u5206\u7247\u3001\u4e3b\u4ece\u590d\u5236\u548c\u96c6\u7fa4\u3002\u800c\u672c\u5730\u7f13\u5b58\u53ea\u80fd\u5728\u5355\u4e2a\u670d\u52a1\u5668\u4e0a\u4f7f\u7528\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u4e8e\u8bfb\u53d6\u9891\u7387\u6781\u9ad8\u3001\u6570\u636e\u76f8\u5bf9\u7a33\u5b9a\u3001\u5141\u8bb8\u77ed\u6682\u4e0d\u4e00\u81f4\u7684\u6570\u636e\uff0c\u6211\u4f18\u5148\u9009\u62e9\u672c\u5730\u7f13\u5b58\u3002\u6bd4\u5982\u7cfb\u7edf\u914d\u7f6e\u4fe1\u606f\u3001\u7528\u6237\u6743\u9650\u6570\u636e\u3001\u5546\u54c1\u5206\u7c7b\u4fe1\u606f\u7b49\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u800c\u5bf9\u4e8e\u9700\u8981\u5b9e\u65f6\u540c\u6b65\u3001\u6570\u636e\u53d8\u5316\u9891\u7e41\u3001\u591a\u4e2a\u670d\u52a1\u9700\u8981\u5171\u4eab\u7684\u6570\u636e\uff0c\u6211\u4f1a\u9009\u62e9 Redis\u3002\u6bd4\u5982\u7528\u6237\u4f1a\u8bdd\u4fe1\u606f\u3001\u8d2d\u7269\u8f66\u6570\u636e\u3001\u5b9e\u65f6\u7edf\u8ba1\u4fe1\u606f\u7b49\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u4ec0\u4e48\u662f\u70edkey",children:"\u4ec0\u4e48\u662f\u70edKey\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u6240\u8c13\u7684\u70ed Key\uff0c\u5c31\u662f\u6307\u5728\u5f88\u77ed\u65f6\u95f4\u5185\u88ab\u9891\u7e41\u8bbf\u95ee\u7684\u952e\u3002\u6bd4\u5982\u7535\u5546\u5927\u4fc3\u671f\u95f4\u7206\u6b3e\u5546\u54c1\u7684\u8be6\u60c5\u4fe1\u606f\uff0c\u6d41\u91cf\u660e\u661f\u7206\u74dc\u65f6\u7684\u4e2a\u4eba\u8d44\u6599\u3001\u70ed\u95e8\u8bdd\u9898\u7b49\uff0c\u90fd\u53ef\u80fd\u6210\u4e3a\u70edKey\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7531\u4e8e Redis \u662f\u5355\u7ebf\u7a0b\u6a21\u578b\uff0c\u5927\u91cf\u8bf7\u6c42\u96c6\u4e2d\u5230\u540c\u4e00\u4e2a\u952e\u4f1a\u5bfc\u81f4\u8be5 Redis \u8282\u70b9\u7684 CPU \u4f7f\u7528\u7387\u98d9\u5347\uff0c\u54cd\u5e94\u65f6\u95f4\u53d8\u957f\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728 Redis \u96c6\u7fa4\u73af\u5883\u4e0b\uff0c\u70edKey \u8fd8\u4f1a\u5bfc\u81f4\u6570\u636e\u5206\u5e03\u4e0d\u5747\u8861\uff0c\u67d0\u4e2a\u8282\u70b9\u627f\u53d7\u7684\u538b\u529b\u8fc7\u5927\u800c\u5176\u4ed6\u8282\u70b9\u76f8\u5bf9\u7a7a\u95f2\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756734563389",src:r(14086).A+"",width:"827",height:"500"}),"\r\n\u66f4\u4e25\u91cd\u7684\u60c5\u51b5\u662f\uff0c\u5f53\u70edKey \u8fc7\u671f\u6216\u88ab\u8bef\u5220\u65f6\uff0c\u4f1a\u5f15\u53d1\u7f13\u5b58\u51fb\u7a7f\u95ee\u9898\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u90a3\u600e\u4e48\u76d1\u63a7\u70edkey-\u5462",children:"\u90a3\u600e\u4e48\u76d1\u63a7\u70edKey \u5462\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u4e34\u65f6\u7684\u65b9\u6848\u53ef\u4ee5\u4f7f\u7528 redis-cli --hotkeys \u547d\u4ee4\u6765\u76d1\u63a7 Redis \u4e2d\u7684\u70ed Key\u3002\r\n\u6216\u8005\u5728\u8bbf\u95ee\u7f13\u5b58\u65f6\uff0c\u5728\u672c\u5730\u7ef4\u62a4\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u5f53\u67d0\u4e2a\u952e\u7684\u8bbf\u95ee\u6b21\u6570\u5728\u4e00\u5206\u949f\u5185\u8d85\u8fc7\u8bbe\u5b9a\u9608\u503c\uff0c\u5c31\u5c06\u5176\u6807\u8bb0\u4e3a\u70edKey\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Component\r\npublic class HotKeyDetector {\r\n    private final ConcurrentHashMap<String, AtomicLong> accessCounter = new ConcurrentHashMap<>();\r\n    private final int HOT_KEY_THRESHOLD = 1000;\r\n    \r\n    public boolean isHotKey(String key) {\r\n        long count = accessCounter.computeIfAbsent(key, k -> new AtomicLong(0))\r\n                                  .incrementAndGet();\r\n        return count > HOT_KEY_THRESHOLD;\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u90a3\u600e\u4e48\u5904\u7406\u70edkey-\u5462",children:"\u90a3\u600e\u4e48\u5904\u7406\u70edKey \u5462\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u6700\u6709\u6548\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u589e\u52a0\u672c\u5730\u7f13\u5b58\uff0c\u5c06\u70ed Key \u7f13\u5b58\u5230\u672c\u5730\u5185\u5b58\u4e2d\uff0c\u8fd9\u6837\u8bf7\u6c42\u5c31\u4e0d\u9700\u8981\u8bbf\u95ee Redis \u4e86\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756734670474",src:r(93304).A+"",width:"677",height:"401"}),"\r\n\u5bf9\u4e8e\u4e00\u4e9b\u7279\u522b\u70ed\u7684 Key\uff0c\u53ef\u4ee5\u5c06\u5176\u62c6\u5206\u6210\u591a\u4e2a\u5b50 Key\uff0c\u7136\u540e\u968f\u673a\u5206\u5e03\u5230\u4e0d\u540c\u7684 Redis \u8282\u70b9\u4e0a\u3002\u6bd4\u5982\u5c06 hot_product:12345 \u62c6\u5206\u6210 hot_product:12345:1\u3001hot_product:12345:2 \u7b49\u591a\u4e2a\u526f\u672c\uff0c\u8bfb\u53d6\u65f6\u968f\u673a\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756734685435",src:r(43545).A+"",width:"773",height:"352"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public String getHotData(String key) {\r\n    if (isHotKey(key)) {\r\n        // \u968f\u673a\u9009\u62e9\u4e00\u4e2a\u526f\u672c\r\n        int replica = ThreadLocalRandom.current().nextInt(HOT_KEY_REPLICAS);\r\n        return redis.get(key + ":" + replica);\r\n    }\r\n    return redis.get(key);\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u600e\u4e48\u5904\u7406\u5927-key-\u5462",children:"\u600e\u4e48\u5904\u7406\u5927 Key \u5462\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u5927Key \u662f\u6307\u5360\u7528\u5185\u5b58\u7a7a\u95f4\u8f83\u5927\u7684\u7f13\u5b58\u952e\uff0c\u6bd4\u5982\u8d85\u8fc7 10M \u7684\u952e\u503c\u5bf9\u3002\u5e38\u89c1\u7684\u5927Key \u7c7b\u578b\u5305\u62ec\uff1a\u5305\u542b\u5927\u91cf\u5143\u7d20\u7684 List\u3001Set\u3001Hash \u7ed3\u6784\uff0c\u5b58\u50a8\u5927\u6587\u4ef6\u7684 String \u7c7b\u578b\uff0c\u4ee5\u53ca\u5305\u542b\u590d\u6742\u5d4c\u5957\u5bf9\u8c61\u7684 JSON \u6570\u636e\u7b49\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u5185\u5b58\u6709\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u5bfc\u81f4 Redis \u5185\u5b58\u4e0d\u8db3\u3002\u53e6\u5916\uff0c\u5927Key \u8fd8\u4f1a\u5bfc\u81f4\u4e3b\u4ece\u590d\u5236\u540c\u6b65\u5ef6\u8fdf\uff0c\u751a\u81f3\u5f15\u53d1\u7f51\u7edc\u62e5\u585e\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u53ef\u4ee5\u901a\u8fc7 redis-cli --bigkeys \u547d\u4ee4\u6765\u76d1\u63a7 Redis \u4e2d\u7684\u5927 Key\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u6216\u8005\u7f16\u5199\u811a\u672c\u8fdb\u884c\u5168\u91cf\u626b\u63cf\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Component\r\npublic class BigKeyScanner {\r\n    \r\n    private final RedisTemplate redisTemplate;\r\n    private final int BIG_KEY_THRESHOLD = 1024 * 1024; // 1MB\r\n    \r\n    public List<BigKeyInfo> scanBigKeys() {\r\n        List<BigKeyInfo> bigKeys = new ArrayList<>();\r\n        \r\n        // \u4f7f\u7528SCAN\u547d\u4ee4\u904d\u5386\u6240\u6709\u952e\r\n        ScanOptions options = ScanOptions.scanOptions().count(1000).build();\r\n        Cursor<byte[]> cursor = redisTemplate.executeWithStickyConnection(\r\n            connection -> connection.scan(options)\r\n        );\r\n        \r\n        while (cursor.hasNext()) {\r\n            String key = new String(cursor.next());\r\n            long memory = getKeyMemoryUsage(key);\r\n            \r\n            if (memory > BIG_KEY_THRESHOLD) {\r\n                bigKeys.add(new BigKeyInfo(key, memory, getKeyType(key)));\r\n            }\r\n        }\r\n        \r\n        return bigKeys;\r\n    }\r\n    \r\n    private long getKeyMemoryUsage(String key) {\r\n        // \u4f7f\u7528MEMORY USAGE\u547d\u4ee4\u83b7\u53d6\u952e\u7684\u5185\u5b58\u5360\u7528\r\n        return redisTemplate.execute((RedisCallback<Long>) connection -> \r\n            connection.memoryUsage(key.getBytes())\r\n        );\r\n    }\r\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5bf9\u4e8e\u5927 Key \u95ee\u9898\uff0c\u6700\u6839\u672c\u7684\u89e3\u51b3\u65b9\u6848\u662f\u62c6\u5206\u5927 Key\uff0c\u5c06\u5176\u62c6\u5206\u6210\u591a\u4e2a\u5c0f Key \u5b58\u50a8\u3002\u6bd4\u5982\u5c06\u4e00\u4e2a\u5305\u542b\u5927\u91cf\u7528\u6237\u4fe1\u606f\u7684 Hash \u62c6\u5206\u6210\u591a\u4e2a\u5c0f Hash\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756734886639",src:r(93548).A+"",width:"738",height:"467"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public void splitBigKey(String bigKey) {\r\n    Map<String, String> bigData = redisTemplate.opsForHash().entries(bigKey);\r\n    \r\n    // \u5c06\u5927 Key \u62c6\u5206\u6210\u591a\u4e2a\u5c0f Key\r\n    for (Map.Entry<String, String> entry : bigData.entrySet()) {\r\n        String smallKey = bigKey + ":" + entry.getKey();\r\n        redisTemplate.opsForValue().set(smallKey, entry.getValue());\r\n    }\r\n    \r\n    // \u5220\u9664\u539f\u59cb\u5927 Key\r\n    redisTemplate.delete(bigKey);\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u53e6\u5916\uff0c\u5bf9\u4e8e JSON \u6570\u636e\uff0c\u53ef\u4ee5\u8fdb\u884c Gzip \u538b\u7f29\u540e\u518d\u5b58\u50a8\uff0c\u867d\u7136\u4f1a\u589e\u52a0\u4e00\u4e9b CPU \u5f00\u9500\uff0c\u4f46\u5728\u5185\u5b58\u654f\u611f\u7684\u573a\u666f\u5728\u662f\u503c\u5f97\u7684\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public void setCompressedData(String key, Object data) {\r\n    try {\r\n        String json = objectMapper.writeValueAsString(data);\r\n        byte[] compressed = compress(json.getBytes());\r\n        redisTemplate.opsForValue().set(key, compressed);\r\n    } catch (Exception e) {\r\n        log.error("Failed to compress data", e);\r\n    }\r\n}\r\n\r\nprivate byte[] compress(byte[] data) throws IOException {\r\n    ByteArrayOutputStream out = new ByteArrayOutputStream();\r\n    try (GZIPOutputStream gzip = new GZIPOutputStream(out)) {\r\n        gzip.write(data);\r\n    }\r\n    return out.toByteArray();\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u7f13\u5b58\u9884\u70ed\u600e\u4e48\u505a\u5462",children:"\u7f13\u5b58\u9884\u70ed\u600e\u4e48\u505a\u5462\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u7f13\u5b58\u9884\u70ed\u662f\u6307\u5728\u7cfb\u7edf\u542f\u52a8\u6216\u8005\u7279\u5b9a\u65f6\u95f4\u70b9\uff0c\u63d0\u524d\u5c06\u70ed\u70b9\u6570\u636e\u52a0\u8f7d\u5230\u7f13\u5b58\u4e2d\uff0c\u907f\u514d\u51b7\u542f\u52a8\u65f6\u5927\u91cf\u8bf7\u6c42\u76f4\u63a5\u6253\u5230\u6570\u636e\u5e93\u3002\r\n\u7f13\u5b58\u9884\u70ed\u7684\u65b9\u6cd5\u6709\u591a\u79cd\uff0c\u5728\u6280\u672f\u6d3e\u5b9e\u6218\u9879\u76ee\u4e2d\uff0c\u6211\u4f1a\u5728\u9879\u76ee\u542f\u52a8\u65f6\u5c06\u70ed\u95e8\u6587\u7ae0\u63d0\u524d\u52a0\u8f7d\u5230 Redis \u4e2d\uff0c\u5728\u6bcf\u5929\u51cc\u6668\u5b9a\u65f6\u5c06\u6700\u65b0\u7684\u7ad9\u70b9\u5730\u56fe\u66f4\u65b0\u5230 Redis\u4e2d\uff0c\u4ee5\u786e\u4fdd\u7528\u6237\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\u5c31\u80fd\u83b7\u53d6\u5230\u7f13\u5b58\u6570\u636e\uff0c\u4ece\u800c\u51cf\u8f7b\u6570\u636e\u5e93\u7684\u538b\u529b\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'/**\r\n * \u91c7\u7528\u5b9a\u65f6\u5668\u65b9\u6848\uff0c\u6bcf\u59295:15\u5206\u5237\u65b0\u7ad9\u70b9\u5730\u56fe\uff0c\u786e\u4fdd\u6570\u636e\u7684\u4e00\u81f4\u6027\r\n */\r\n@Scheduled(cron = "0 15 5 * * ?")\r\npublic void autoRefreshCache() {\r\n    log.info("\u5f00\u59cb\u5237\u65b0sitemap.xml\u7684url\u5730\u5740\uff0c\u907f\u514d\u51fa\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898!");\r\n    refreshSitemap();\r\n    log.info("\u5237\u65b0\u5b8c\u6210\uff01");\r\n}\r\n\r\n@Override\r\npublic void refreshSitemap() {\r\n    initSiteMap();\r\n}\r\n\r\nprivate synchronized void initSiteMap() {\r\n    long lastId = 0L;\r\n    RedisClient.del(SITE_MAP_CACHE_KEY);\r\n    while (true) {\r\n        List<SimpleArticleDTO> list = articleDao.getBaseMapper().listArticlesOrderById(lastId, SCAN_SIZE);\r\n\r\n        // \u5237\u65b0\u7ad9\u70b9\u5730\u56fe\u4fe1\u606f\uff0c\u653e\u5230 Redis \u5f53\u4e2d\r\n        Map<String, Long> map = list.stream().collect(Collectors.toMap(s -> String.valueOf(s.getId()), s -> s.getCreateTime().getTime(), (a, b) -> a));\r\n        RedisClient.hMSet(SITE_MAP_CACHE_KEY, map);\r\n        if (list.size() < SCAN_SIZE) {\r\n            break;\r\n        }\r\n        lastId = list.get(list.size() - 1).getId();\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u65e0\u5e95\u6d1e\u95ee\u9898\u542c\u8bf4\u8fc7\u5417\u5982\u4f55\u89e3\u51b3",children:"\u65e0\u5e95\u6d1e\u95ee\u9898\u542c\u8bf4\u8fc7\u5417\uff1f\u5982\u4f55\u89e3\u51b3\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u65e0\u5e95\u6d1e\u95ee\u9898\u7684\u6838\u5fc3\u5728\u4e8e\uff0c\u968f\u7740\u7f13\u5b58\u8282\u70b9\u6570\u91cf\u7684\u589e\u52a0\uff0c\u867d\u7136\u603b\u7684\u5b58\u50a8\u5bb9\u91cf\u548c\u7406\u8bba\u541e\u5410\u91cf\u90fd\u5728\u589e\u957f\uff0c\u4f46\u662f\u5355\u4e2a\u8bf7\u6c42\u7684\u54cd\u5e94\u65f6\u95f4\u53cd\u800c\u53d8\u957f\u4e86\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u4e2a\u95ee\u9898\u7684\u6839\u672c\u539f\u56e0\u662f\u7f51\u7edc\u901a\u4fe1\u5f00\u9500\u7684\u589e\u52a0\u3002\u5f53\u8282\u70b9\u6570\u91cf\u4ece\u51e0\u5341\u4e2a\u589e\u957f\u5230\u51e0\u5343\u4e2a\u65f6\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u4e0e\u66f4\u591a\u7684\u8282\u70b9\u8fdb\u884c\u901a\u4fe1\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5176\u6b21\u5c31\u662f\u6570\u636e\u5206\u5e03\u7684\u788e\u7247\u5316\u3002\u968f\u7740\u8282\u70b9\u589e\u591a\uff0c\u6570\u636e\u5206\u6563\u5f97\u66f4\u52a0\u7ec6\u788e\uff0c\u539f\u672c\u53ef\u4ee5\u5728\u4e00\u4e2a\u8282\u70b9\u83b7\u53d6\u7684\u76f8\u5173\u6570\u636e\uff0c\u73b0\u5728\u53ef\u80fd\u5206\u6563\u5728\u591a\u4e2a\u8282\u70b9\u4e0a\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u91c7\u53d6\u4ee5\u4e0b\u51e0\u79cd\u89e3\u51b3\u65b9\u6848\uff1a\r\n\u7b2c\u4e00\uff0c\u53ef\u4ee5\u5c06\u540c\u4e00\u8282\u70b9\u7684\u591a\u4e2a\u8bf7\u6c42\u5408\u5e76\u6210\u4e00\u4e2a\u6279\u91cf\u8bf7\u6c42\uff0c\u51cf\u5c11\u7f51\u7edc\u5f80\u8fd4\u6b21\u6570\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public Map<String, Object> batchGet(List<String> keys) {\r\n    // \u6309\u8282\u70b9\u5206\u7ec4keys\r\n    Map<String, List<String>> nodeKeysMap = groupKeysByNode(keys);\r\n    Map<String, Object> results = new ConcurrentHashMap<>();\r\n    \r\n    // \u5e76\u53d1\u8bbf\u95ee\u5404\u4e2a\u8282\u70b9\r\n    List<CompletableFuture<Void>> futures = nodeKeysMap.entrySet().stream()\r\n        .map(entry -> CompletableFuture.runAsync(() -> {\r\n            String node = entry.getKey();\r\n            List<String> nodeKeys = entry.getValue();\r\n            \r\n            // \u6279\u91cf\u83b7\u53d6\u8be5\u8282\u70b9\u7684\u6570\u636e\r\n            Map<String, Object> nodeResults = getFromNode(node, nodeKeys);\r\n            results.putAll(nodeResults);\r\n        }))\r\n        .collect(Collectors.toList());\r\n    \r\n    // \u7b49\u5f85\u6240\u6709\u8bf7\u6c42\u5b8c\u6210\r\n    CompletableFuture.allOf(futures.toArray(new CompletableFuture[0])).join();\r\n    \r\n    return results;\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e8c\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\u6765\u4f18\u5316\u6570\u636e\u5206\u5e03\uff0c\u51cf\u5c11\u6570\u636e\u8fc1\u79fb\u548c\u91cd\u5206\u5e03\u7684\u5f00\u9500\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public class LocalityAwareSharding {\r\n    \r\n    public String getNodeForKey(String key, String category) {\r\n        // \u76f8\u540c\u7c7b\u522b\u7684\u6570\u636e\u5c3d\u91cf\u5206\u914d\u5230\u76f8\u540c\u8282\u70b9\r\n        String shardKey = category + ":" + (key.hashCode() % SHARDS_PER_CATEGORY);\r\n        return consistentHash.getNode(shardKey);\r\n    }\r\n    \r\n    // \u7528\u6237\u76f8\u5173\u6570\u636e\u5c3d\u91cf\u5728\u540c\u4e00\u4e2a\u8282\u70b9\r\n    public String getUserDataNode(String userId) {\r\n        return "user_cluster_" + (userId.hashCode() % USER_CLUSTERS);\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"redis-\u8fd0\u7ef4",children:"Redis \u8fd0\u7ef4"}),"\n",(0,i.jsx)(n.h3,{id:"redis-\u62a5\u5185\u5b58\u4e0d\u8db3\u600e\u4e48\u5904\u7406",children:"Redis \u62a5\u5185\u5b58\u4e0d\u8db3\u600e\u4e48\u5904\u7406\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u62a5\u5185\u5b58\u4e0d\u8db3\u65f6\uff0c\u901a\u5e38\u662f\u56e0\u4e3a Redis \u5360\u7528\u7684\u7269\u7406\u5185\u5b58\u5df2\u7ecf\u63a5\u8fd1\u6216\u8005\u8d85\u8fc7\u4e86\u914d\u7f6e\u7684\u6700\u5927\u5185\u5b58\u9650\u5236\u3002\u8fd9\u65f6\u53ef\u4ee5\u91c7\u53d6\u4ee5\u4e0b\u51e0\u79cd\u6b65\u9aa4\u6765\u5904\u7406\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e00\uff0c\u4f7f\u7528 INFO memory \u547d\u4ee4\u67e5\u770b Redis \u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u770b\u770b\u662f\u5426\u771f\u7684\u8fbe\u5230\u4e86\u6700\u5927\u5185\u5b58\u9650\u5236\u3002\r\nredis-cli INFO memory\r\n\u7b2c\u4e8c\uff0c\u5982\u679c\u670d\u52a1\u5668\u8fd8\u6709\u53ef\u7528\u5185\u5b58\u7684\u8bdd\uff0c\u4fee\u6539 redis.conf \u4e2d\u7684 maxmemory \u53c2\u6570\uff0c\u589e\u52a0 Redis \u7684\u6700\u5927\u5185\u5b58\u9650\u5236\u3002\u6bd4\u5982\u5c06\u6700\u5927\u5185\u5b58\u8bbe\u7f6e\u4e3a 8GB\uff1a\r\nmaxmemory 8gb\r\n\u7b2c\u4e09\uff0c\u4fee\u6539 maxmemory-policy \u53c2\u6570\u6765\u8c03\u6574\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u3002\u6bd4\u5982\u53ef\u4ee5\u9009\u62e9 allkeys-lru \u7b56\u7565\uff0c\u8ba9 Redis \u81ea\u52a8\u5220\u9664\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u952e\r\nmaxmemory-policy allkeys-lru"}),"\n",(0,i.jsx)(n.h3,{id:"redis-key\u8fc7\u671f\u7b56\u7565\u6709\u54ea\u4e9b",children:"Redis key\u8fc7\u671f\u7b56\u7565\u6709\u54ea\u4e9b\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["Redis \u4e3b\u8981\u91c7\u7528\u4e86\u4e24\u79cd\u8fc7\u671f\u5220\u9664\u7b56\u7565\u6765\u4fdd\u8bc1\u8fc7\u671f\u7684 key \u80fd\u591f\u88ab\u53ca\u65f6\u5220\u9664\uff0c\u5305\u62ec\u60f0\u6027\u5220\u9664\u548c\u5b9a\u671f\u5220\u9664\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756735321906",src:r(13734).A+"",width:"1548",height:"570"}),"\r\n\u60f0\u6027\u5220\u9664\u662f\u6700\u57fa\u672c\u7684\u7b56\u7565\uff0c\u5f53\u5ba2\u6237\u7aef\u8bbf\u95ee\u4e00\u4e2a key \u65f6\uff0cRedis \u4f1a\u68c0\u67e5\u8be5 key \u662f\u5426\u5df2\u8fc7\u671f\uff0c\u5982\u679c\u8fc7\u671f\u5c31\u4f1a\u7acb\u5373\u5220\u9664\u5e76\u8fd4\u56de nil\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// \u6a21\u62df\u60f0\u6027\u5220\u9664\u7684\u903b\u8f91\r\npublic Object get(String key) {\r\n    RedisKey redisKey = getKeyFromMemory(key);\r\n    \r\n    if (redisKey != null && isExpired(redisKey)) {\r\n        // key\u5df2\u8fc7\u671f\uff0c\u5220\u9664\u5e76\u8fd4\u56denull\r\n        deleteKey(key);\r\n        return null;\r\n    }\r\n    \r\n    return redisKey != null ? redisKey.getValue() : null;\r\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd9\u79cd\u7b56\u7565\u7684\u4f18\u70b9\u662f\u4e0d\u4f1a\u6709\u989d\u5916\u7684 CPU \u5f00\u9500\uff0c\u53ea\u5728\u8bbf\u95ee key \u65f6\u624d\u68c0\u67e5\u3002\u4f46\u95ee\u9898\u662f\u5982\u679c\u4e00\u4e2a\u8fc7\u671f\u7684 key \u6c38\u8fdc\u4e0d\u88ab\u8bbf\u95ee\uff0c\u5b83\u5c31\u4f1a\u4e00\u76f4\u5360\u7528\u5185\u5b58\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756735356144",src:r(77354).A+"",width:"910",height:"483"}),"\r\n\u4e8e\u662f\u5c31\u6709\u4e86\u5b9a\u671f\u5220\u9664\u7b56\u7565\uff0cRedis \u4f1a\u5b9a\u671f\u968f\u673a\u9009\u62e9\u4e00\u4e9b\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684 key \u8fdb\u884c\u68c0\u67e5\uff0c\u5220\u9664\u5176\u4e2d\u5df2\u8fc7\u671f\u7684 key\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u9ed8\u8ba4\u6bcf\u79d2\u6267\u884c 10 \u6b21\uff0c\u6bcf\u6b21\u968f\u673a\u9009\u62e9 20 \u4e2a key \u8fdb\u884c\u68c0\u67e5\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"redis\u6709\u54ea\u4e9b\u5185\u5b58\u6dd8\u6c70\u7b56\u7565",children:"\ud83c\udf1fRedis\u6709\u54ea\u4e9b\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u5f53\u5185\u5b58\u4f7f\u7528\u63a5\u8fd1 maxmemory \u9650\u5236\u65f6\uff0cRedis \u4f1a\u4f9d\u636e\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u6765\u51b3\u5b9a\u5220\u9664\u54ea\u4e9b key \u4ee5\u7f13\u89e3\u5185\u5b58\u538b\u529b\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756735436275",src:r(15458).A+"",width:"3078",height:"1266"}),"\r\n\u5e38\u7528\u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u6709\u516b\u79cd\uff0c\u5206\u522b\u662f\u9ed8\u8ba4\u7684 noeviction\uff0c\u5185\u5b58\u4e0d\u8db3\u65f6\u4e0d\u4f1a\u5220\u9664\u4efb\u4f55 key\uff0c\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u4fe1\u606f\uff0c\u751f\u4ea7\u73af\u5883\u4e0b\u57fa\u672c\u4e0a\u4e0d\u4f1a\u4f7f\u7528\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u7136\u540e\u662f\u9488\u5bf9\u6240\u6709 key \u7684 allkeys-lru\u3001allkeys-lfu \u548c allkeys-random\u3002lru \u4f1a\u5220\u9664\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684 key\uff0c\u5728\u7eaf\u7f13\u5b58\u573a\u666f\u4e2d\u6700\u5e38\u7528\uff0c\u80fd\u81ea\u52a8\u4fdd\u7559\u70ed\u70b9\u6570\u636e\uff1blfu \u4f1a\u5220\u9664\u8bbf\u95ee\u9891\u7387\u6700\u4f4e\u7684 key\uff0c\u66f4\u9002\u5408\u957f\u671f\u8fd0\u884c\u7684\u7cfb\u7edf\uff1brandom \u4f1a\u968f\u673a\u5220\u9664\u4e00\u4e9b key\uff0c\u4e00\u822c\u4e0d\u63a8\u8350\u4f7f\u7528\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5176\u6b21\u662f\u9488\u5bf9\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684 key\uff0c\u6709 volatile-lru\u3001volatile-lfu\u3001volatile-ttl \u548c volatile-random\u3002"}),"\n",(0,i.jsx)(n.p,{children:"lru \u5728\u6df7\u5408\u5b58\u50a8\u573a\u666f\u4e2d\u7ecf\u5e38\u4f7f\u7528\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Service\r\npublic class HybridStorageService {\r\n    \r\n    // \u91cd\u8981\u6570\u636e\u4e0d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4e34\u65f6\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\r\n    public void storeData(String key, Object data, DataImportance importance) {\r\n        if (importance == DataImportance.HIGH) {\r\n            // \u91cd\u8981\u6570\u636e\u4e0d\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u5728volatile-*\u7b56\u7565\u4e0b\u4e0d\u4f1a\u88ab\u6dd8\u6c70\r\n            redisTemplate.opsForValue().set(key, data);\r\n        } else {\r\n            // \u4e34\u65f6\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u53ef\u4ee5\u88abvolatile-*\u7b56\u7565\u6dd8\u6c70\r\n            redisTemplate.opsForValue().set(key, data, Duration.ofHours(1));\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"lfu \u9002\u5408\u9700\u8981\u4fdd\u62a4\u67d0\u4e9b\u91cd\u8981\u6570\u636e\u4e0d\u88ab\u6dd8\u6c70\u7684\u573a\u666f\uff1bttl \u4f18\u5148\u5220\u9664\u5373\u5c06\u8fc7\u671f\u7684 key\uff0c\u5728\u7528\u6237\u4f1a\u8bdd\u7ba1\u7406\u7cfb\u7edf\u4e2d\u63a8\u8350\u4f7f\u7528\uff1brandom \u4ecd\u7136\u5f88\u5c11\u7528\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"lru-\u548c-lfu-\u7684\u533a\u522b\u662f\u4ec0\u4e48",children:"LRU \u548c LFU \u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"LRU \u662f Least Recently Used \u7684\u7f29\u5199\uff0c\u57fa\u4e8e\u65f6\u95f4\u7ef4\u5ea6\uff0c\u6dd8\u6c70\u6700\u8fd1\u6700\u5c11\u8bbf\u95ee\u7684\u952e\u3002"}),"\n",(0,i.jsx)(n.p,{children:"LFU \u662f Least Frequently Used \u7684\u7f29\u5199\uff0c\u57fa\u4e8e\u6b21\u6570\u7ef4\u5ea6\uff0c\u6dd8\u6c70\u8bbf\u95ee\u9891\u7387\u6700\u4f4e\u7684\u952e\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5047\u8bbe\u7f13\u5b58\u4e2d\u6709\u4e09\u4e2a\u6570\u636e A\u3001B\u3001C\uff0c\u5728 LRU \u573a\u666f\u4e0b\uff0c\u5982\u679c\u8bbf\u95ee\u987a\u5e8f\u662f A\u2192B\u2192C\u2192A\uff0c\u90a3\u4e48\u6b64\u65f6\u7684 LRU \u987a\u5e8f\u662fB\u2192C\u2192A\uff0c\u5982\u679c\u9700\u8981\u6dd8\u6c70\uff0c\u4f1a\u5148\u5220\u9664 B\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u4f46\u5728 LFU \u573a\u666f\u4e0b\uff0c\u5982\u679c A \u88ab\u8bbf\u95ee\u4e86 5 \u6b21\uff0cB \u88ab\u8bbf\u95ee\u4e86 2 \u6b21\uff0cC \u88ab\u8bbf\u95ee\u4e86 1 \u6b21\uff0c\u90a3\u4e48\u65e0\u8bba\u6700\u8fd1\u7684\u8bbf\u95ee\u987a\u5e8f\u5982\u4f55\uff0c\u90fd\u4f1a\u4f18\u5148\u6dd8\u6c70 C\uff0c\u56e0\u4e3a\u5b83\u7684\u8bbf\u95ee\u9891\u7387\u6700\u4f4e\u3002"}),"\n",(0,i.jsx)(n.p,{children:"LRU \u66f4\u9002\u5408\u6709\u660e\u663e\u65f6\u95f4\u5c40\u90e8\u6027\u7684\u573a\u666f\uff0c\u6bd4\u5982\u5728\u65b0\u95fb\u7f51\u7ad9\u4e2d\uff0c\u7528\u6237\u66f4\u5173\u5fc3\u6700\u65b0\u7684\u65b0\u95fb\uff0c\u800c\u6628\u5929\u7684\u65b0\u95fb\u8bbf\u95ee\u91cf\u4f1a\u6025\u5267\u4e0b\u964d\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cLRU \u80fd\u5f88\u597d\u5730\u4fdd\u7559\u7528\u6237\u5f53\u524d\u5173\u5fc3\u7684\u70ed\u70b9\u5185\u5bb9\u3002"}),"\n",(0,i.jsx)(n.p,{children:"LFU \u5219\u66f4\u9002\u5408\u6709\u957f\u671f\u8bbf\u95ee\u6a21\u5f0f\u7684\u573a\u666f\uff0c\u66f4\u5f3a\u8c03\u201c\u70ed\u5ea6\u201d\uff0c\u6bd4\u5982\u5728\u7535\u5546\u5e73\u53f0\u4e2d\uff0c\u67d0\u4e9b\u5546\u54c1\u53ef\u80fd\u957f\u671f\u4fdd\u6301\u70ed\u9500\u72b6\u6001\uff0c\u5373\u4f7f\u5b83\u4eec\u7684\u8bbf\u95ee\u65f6\u95f4\u95f4\u9694\u8f83\u957f\uff0c\u4f46\u7531\u4e8e\u8bbf\u95ee\u9891\u7387\u9ad8\uff0cLFU \u4f1a\u4f18\u5148\u4fdd\u7559\u8fd9\u4e9b\u5546\u54c1\u7684\u4fe1\u606f\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"redis\u53d1\u751f\u963b\u585e\u4e86\u600e\u4e48\u89e3\u51b3",children:"Redis\u53d1\u751f\u963b\u585e\u4e86\u600e\u4e48\u89e3\u51b3\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u53d1\u751f\u963b\u585e\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u662f\u6bd4\u8f83\u4e25\u91cd\u7684\u95ee\u9898\uff0c\u5f53\u53d1\u73b0 Redis \u53d8\u6162\u65f6\uff0c\u6211\u4f1a\u5148\u901a\u8fc7 monitor \u547d\u4ee4\u67e5\u770b\u5f53\u524d\u6b63\u5728\u6267\u884c\u7684\u547d\u4ee4\uff0c\u6216\u8005\u4f7f\u7528 slowlog \u547d\u4ee4\u67e5\u770b\u6162\u67e5\u8be2\u65e5\u5fd7\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u5f53\u524d\u6b63\u5728\u6267\u884c\u7684\u547d\u4ee4\r\nredis-cli MONITOR\r\n\r\n# \u67e5\u770b\u6162\u67e5\u8be2\u65e5\u5fd7\r\nredis-cli SLOWLOG GET 10\r\n\r\n# \u68c0\u67e5\u5ba2\u6237\u7aef\u8fde\u63a5\u72b6\u51b5\r\nredis-cli CLIENT LIST\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5927Key \u662f\u5bfc\u81f4 Redis \u963b\u585e\u7684\u4e3b\u8981\u539f\u56e0\u4e4b\u4e00\u3002\u6bd4\u5982\u8bf4\u76f4\u63a5 DEL \u4e00\u4e2a\u5305\u542b\u51e0\u767e\u4e07\u4e2a\u5143\u7d20\u7684 Set\uff0c\u5c31\u4f1a\u5bfc\u81f4 Redis \u963b\u585e\u51e0\u79d2\u949f\u751a\u81f3\u66f4\u4e45\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u65f6\u5019\u53ef\u4ee5\u7528 UNLINK \u547d\u4ee4\u66ff\u4ee3 DEL \u6765\u5f02\u6b65\u5220\u9664\uff0c\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# \u4f7f\u7528 UNLINK \u5f02\u6b65\u5220\u9664\u5927 Key\r\nredis-cli UNLINK big_key\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5bf9\u4e8e\u975e\u5e38\u5927\u7684\u96c6\u5408\uff0c\u53ef\u4ee5\u4f7f\u7528 SCAN \u547d\u4ee4\u5206\u6279\u5220\u9664\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public void safeBatchProcess(String key) {\r\n    ScanOptions options = ScanOptions.scanOptions().count(1000).build();\r\n    Cursor<String> cursor = redisTemplate.opsForSet().scan(key, options);\r\n    \r\n    while (cursor.hasNext()) {\r\n        String member = cursor.next();\r\n        // \u5206\u6279\u5904\u7406\uff0c\u907f\u514d\u963b\u585e\r\n        processElement(member);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u53e6\u5916\uff0c\u5f53 Redis \u4f7f\u7528\u7684\u5185\u5b58\u8d85\u8fc7\u7269\u7406\u5185\u5b58\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u5c06\u90e8\u5206\u5185\u5b58\u4ea4\u6362\u5230\u78c1\u76d8\uff0c\u8fd9\u65f6\u5019\u4f1a\u5bfc\u81f4 Redis \u54cd\u5e94\u53d8\u6162\u3002\u6211\u7684\u5904\u7406\u65b9\u5f0f\u662f\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"\u4f7f\u7528 free -h \u68c0\u67e5\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5 \uff1b\u786e\u8ba4 Redis \u7684 maxmemory \u8bbe\u7f6e\u662f\u5426\u5408\u7406\uff1b\u5982\u679c\u53d1\u751f\u4e86\u5185\u5b58\u4ea4\u6362\uff0c\u7acb\u5373\u8c03\u6574 maxmemory \u5e76\u6e05\u7406\u4e00\u4e9b\u4e0d\u91cd\u8981\u7684\u6570\u636e\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5927\u91cf\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u4e5f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u963b\u585e\uff0c\u8fd9\u65f6\u5019\u6700\u597d\u68c0\u67e5\u4e00\u4e0b\u8fde\u63a5\u6c60\u7684\u914d\u7f6e\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Configuration\r\npublic class RedisConnectionConfig {\r\n    \r\n    @Bean\r\n    public JedisConnectionFactory jedisConnectionFactory() {\r\n        JedisPoolConfig poolConfig = new JedisPoolConfig();\r\n        poolConfig.setMaxTotal(200);        // \u6700\u5927\u8fde\u63a5\u6570\r\n        poolConfig.setMaxIdle(50);          // \u6700\u5927\u7a7a\u95f2\u8fde\u63a5\r\n        poolConfig.setMinIdle(10);          // \u6700\u5c0f\u7a7a\u95f2\u8fde\u63a5\r\n        poolConfig.setMaxWaitMillis(3000);  // \u83b7\u53d6\u8fde\u63a5\u6700\u5927\u7b49\u5f85\u65f6\u95f4\r\n        poolConfig.setTestOnBorrow(true);   // \u83b7\u53d6\u8fde\u63a5\u65f6\u68c0\u6d4b\u6709\u6548\u6027\r\n        \r\n        return new JedisConnectionFactory(poolConfig);\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"redis-\u5e94\u7528",children:"Redis \u5e94\u7528"}),"\n",(0,i.jsx)(n.h3,{id:"redis\u5982\u4f55\u5b9e\u73b0\u5f02\u6b65\u6d88\u606f\u961f\u5217",children:"Redis\u5982\u4f55\u5b9e\u73b0\u5f02\u6b65\u6d88\u606f\u961f\u5217\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["Redis \u5b9e\u73b0\u5f02\u6b65\u6d88\u606f\u961f\u5217\u662f\u4e00\u4e2a\u5f88\u5b9e\u7528\u7684\u6280\u672f\u65b9\u6848\uff0c\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u662f\u4f7f\u7528 List \u914d\u5408 LPUSH \u548c RPOP \u547d\u4ee4\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756735748176",src:r(95898).A+"",width:"661",height:"206"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"@Service\r\npublic class SimpleRedisQueue {\r\n    \r\n    private final RedisTemplate<String, Object> redisTemplate;\r\n    \r\n    // \u751f\u4ea7\u8005\uff1a\u5411\u961f\u5217\u53d1\u9001\u6d88\u606f\r\n    public void sendMessage(String queueName, Object message) {\r\n        redisTemplate.opsForList().leftPush(queueName, message);\r\n    }\r\n    \r\n    // \u6d88\u8d39\u8005\uff1a\u4ece\u961f\u5217\u83b7\u53d6\u6d88\u606f\r\n    public Object receiveMessage(String queueName) {\r\n        return redisTemplate.opsForList().rightPop(queueName);\r\n    }\r\n    \r\n    // \u963b\u585e\u5f0f\u6d88\u8d39\uff0c\u907f\u514d\u8f6e\u8be2\r\n    public Object blockingReceive(String queueName, int timeoutSeconds) {\r\n        List<Object> result = redisTemplate.opsForList()\r\n            .rightPop(queueName, timeoutSeconds, TimeUnit.SECONDS);\r\n        return result != null && !result.isEmpty() ? result.get(0) : null;\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u53e6\u5916\u5c31\u662f\u7528 Redis \u7684 Pub/Sub \u6765\u5b9e\u73b0\u7b80\u5355\u7684\u6d88\u606f\u5e7f\u64ad\u548c\u8ba2\u9605\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Service\r\npublic class RedisPubSubService {\r\n    \r\n    private final RedisTemplate<String, Object> redisTemplate;\r\n    \r\n    // \u53d1\u5e03\u6d88\u606f\u5230\u6307\u5b9a\u9891\u9053\r\n    public void publish(String channel, Object message) {\r\n        redisTemplate.convertAndSend(channel, message);\r\n    }\r\n    \r\n    // \u8ba2\u9605\u9891\u9053\r\n    @PostConstruct\r\n    public void subscribe() {\r\n        redisTemplate.setMessageListener((message, pattern) -> {\r\n            System.out.println("Received message: " + message);\r\n        });\r\n        redisTemplate.getConnectionFactory().getConnection().subscribe(\r\n            new ChannelTopic("myChannel").getTopic().getBytes()\r\n        );\r\n    }\r\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u53d1\u5e03\u8005\u5c06\u6d88\u606f\u53d1\u5e03\u5230\u6307\u5b9a\u7684\u9891\u9053\uff0c\u8ba2\u9605\u8be5\u9891\u9053\u7684\u5ba2\u6237\u7aef\u5c31\u80fd\u6536\u5230\u6d88\u606f\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756735788471",src:r(44332).A+"",width:"609",height:"373"}),"\r\n\u4f46\u662f\u8fd9\u4e24\u79cd\u65b9\u5f0f\u90fd\u662f\u4e0d\u53ef\u9760\u7684\uff0c\u56e0\u4e3a\u6ca1\u6709 ACK \u673a\u5236\u6240\u4ee5\u4e0d\u80fd\u4fdd\u8bc1\u8ba2\u9605\u8005\u4e00\u5b9a\u80fd\u6536\u5230\u6d88\u606f\uff0c\u4e5f\u4e0d\u652f\u6301\u6d88\u606f\u6301\u4e45\u5316\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"redis\u5982\u4f55\u5b9e\u73b0\u5ef6\u65f6\u6d88\u606f\u961f\u5217",children:"Redis\u5982\u4f55\u5b9e\u73b0\u5ef6\u65f6\u6d88\u606f\u961f\u5217?"}),"\n",(0,i.jsx)(n.p,{children:"\u5ef6\u65f6\u6d88\u606f\u961f\u5217\u5728\u5b9e\u9645\u4e1a\u52a1\u4e2d\u5f88\u5e38\u89c1\uff0c\u6bd4\u5982\u8ba2\u5355\u8d85\u65f6\u53d6\u6d88\u3001\u5b9a\u65f6\u63d0\u9192\u7b49\u573a\u666f\u3002Redis \u867d\u7136\u4e0d\u662f\u4e13\u4e1a\u7684\u6d88\u606f\u961f\u5217\uff0c\u4f46\u53ef\u4ee5\u5f88\u597d\u5730\u5b9e\u73b0\u5ef6\u65f6\u961f\u5217\u529f\u80fd\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u6838\u5fc3\u601d\u8def\u662f\u5229\u7528 ZSet \u7684\u6709\u5e8f\u7279\u6027\uff0c\u5c06\u6d88\u606f\u4f5c\u4e3a member\uff0c\u628a\u6d88\u606f\u7684\u6267\u884c\u65f6\u95f4\u4f5c\u4e3a score\u3002\u8fd9\u6837\u6d88\u606f\u5c31\u4f1a\u6309\u7167\u6267\u884c\u65f6\u95f4\u81ea\u52a8\u6392\u5e8f\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5b9a\u671f\u626b\u63cf\u5f53\u524d\u65f6\u95f4\u4e4b\u524d\u7684\u6d88\u606f\u8fdb\u884c\u5904\u7406\u5c31\u53ef\u4ee5\u4e86\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756735821861",src:r(77639).A+"",width:"902",height:"171"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Service\r\npublic class DelayedMessageQueue {\r\n    \r\n    private final RedisTemplate<String, Object> redisTemplate;\r\n    \r\n    // \u53d1\u9001\u5ef6\u65f6\u6d88\u606f\r\n    public void sendDelayedMessage(String queueName, Object message, long delaySeconds) {\r\n        // \u8ba1\u7b97\u6d88\u606f\u7684\u6267\u884c\u65f6\u95f4\r\n        long executeTime = System.currentTimeMillis() + (delaySeconds * 1000);\r\n        \r\n        // \u5c06\u6d88\u606f\u52a0\u5165ZSet\uff0c\u4ee5\u6267\u884c\u65f6\u95f4\u4f5c\u4e3ascore\r\n        redisTemplate.opsForZSet().add(queueName, message, executeTime);\r\n        \r\n        log.info("\u53d1\u9001\u5ef6\u65f6\u6d88\u606f: {}, \u5ef6\u65f6: {}\u79d2", message, delaySeconds);\r\n    }\r\n    \r\n    // \u6d88\u8d39\u5ef6\u65f6\u6d88\u606f\r\n    @Scheduled(fixedDelay = 1000) // \u6bcf\u79d2\u626b\u63cf\u4e00\u6b21\r\n    public void consumeDelayedMessages() {\r\n        String queueName = "delayed:queue";\r\n        long currentTime = System.currentTimeMillis();\r\n        \r\n        // \u83b7\u53d6\u5df2\u5230\u671f\u7684\u6d88\u606f\uff08score <= \u5f53\u524d\u65f6\u95f4\uff09\r\n        Set<Object> messages = redisTemplate.opsForZSet()\r\n            .rangeByScore(queueName, 0, currentTime);\r\n        \r\n        for (Object message : messages) {\r\n            try {\r\n                // \u5904\u7406\u6d88\u606f\r\n                processMessage(message);\r\n                \r\n                // \u5904\u7406\u6210\u529f\u540e\u4ece\u961f\u5217\u4e2d\u79fb\u9664\r\n                redisTemplate.opsForZSet().remove(queueName, message);\r\n                \r\n                log.info("\u5904\u7406\u5ef6\u65f6\u6d88\u606f\u6210\u529f: {}", message);\r\n            } catch (Exception e) {\r\n                log.error("\u5904\u7406\u5ef6\u65f6\u6d88\u606f\u5931\u8d25: {}", message, e);\r\n                // \u53ef\u4ee5\u5b9e\u73b0\u91cd\u8bd5\u673a\u5236\r\n                handleFailedMessage(queueName, message);\r\n            }\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5177\u4f53\u5b9e\u73b0\u4e0a\uff0c\u6211\u4f1a\u5728\u751f\u4ea7\u8005\u53d1\u9001\u5ef6\u65f6\u6d88\u606f\u65f6\uff0c\u8ba1\u7b97\u6d88\u606f\u5e94\u8be5\u6267\u884c\u7684\u65f6\u95f4\u6233\uff0c\u7136\u540e\u7528 ZADD \u547d\u4ee4\u5c06\u6d88\u606f\u6dfb\u52a0\u5230 ZSet \u4e2d\u3002\r\nZADD delay_queue 1617024000 task1"}),"\n",(0,i.jsx)(n.p,{children:"\u6d88\u8d39\u8005\u901a\u8fc7\u5b9a\u65f6\u4efb\u52a1\uff0c\u4f7f\u7528 ZRANGEBYSCORE \u547d\u4ee4\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\u4e4b\u524d\u7684\u6240\u6709\u6d88\u606f\u3002\r\nZREMRANGEBYSCORE delay_queue -inf 1617024000"}),"\n",(0,i.jsx)(n.p,{children:"\u5904\u7406\u5b8c\u6210\u540e\u518d\u7528 ZREM \u5220\u9664\u6d88\u606f\u3002\r\nZREM delay_queue task1"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u6280\u672f\u6d3e\u5b9e\u6218\u9879\u76ee\u4e2d\uff0c\u6211\u5c31\u7528\u8fd9\u79cd\u65b9\u5f0f\u5b9e\u73b0\u4e86\u6587\u7ae0\u5b9a\u65f6\u53d1\u5e03\u7684\u529f\u80fd\u3002\u4f5c\u8005\u5728\u53d1\u5e03\u6587\u7ae0\u65f6\uff0c\u53ef\u4ee5\u9009\u62e9\u4e00\u4e2a\u672a\u6765\u7684\u65f6\u95f4\u8282\u70b9\uff0c\u6bd4\u5982\u8bf4 30 \u5206\u949f\u540e\uff0c\u7cfb\u7edf\u5c31\u4f1a\u5411\u5ef6\u65f6\u961f\u5217\u53d1\u9001\u4e00\u6761\u5ef6\u65f6\u6d88\u606f\uff0c\u7136\u540e\u5b9a\u65f6\u4efb\u52a1\u5c31\u4f1a\u5728 30 \u5206\u949f\u540e\u5c06\u8fd9\u6761\u6d88\u606f\u4ece\u5ef6\u65f6\u961f\u5217\u4e2d\u53d6\u51fa\u5e76\u53d1\u5e03\u6587\u7ae0\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"redis\u652f\u6301\u4e8b\u52a1\u5417",children:"\ud83c\udf1fRedis\u652f\u6301\u4e8b\u52a1\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u662f\u7684\uff0cRedis \u652f\u6301\u7b80\u5355\u7684\u4e8b\u52a1\uff0c\u53ef\u4ee5\u5c06 multi\u3001exec\u3001discard \u548c watch \u547d\u4ee4\u6253\u5305\uff0c\u7136\u540e\u4e00\u6b21\u6027\u7684\u6309\u987a\u5e8f\u6267\u884c\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756736081892",src:r(42664).A+"",width:"671",height:"587"}),"\r\n\u57fa\u672c\u6d41\u7a0b\u662f\u7528 multi \u5f00\u542f\u4e8b\u52a1\uff0c\u7136\u540e\u6267\u884c\u4e00\u7cfb\u5217\u547d\u4ee4\uff0c\u6700\u540e\u7528 exec \u63d0\u4ea4\u3002\u8fd9\u4e9b\u547d\u4ee4\u4f1a\u88ab\u653e\u5165\u961f\u5217\uff0c\u5728 exec \u65f6\u6279\u91cf\u6267\u884c\u3002\r\n\u5f53\u5ba2\u6237\u7aef\u5904\u4e8e\u975e\u4e8b\u52a1\u72b6\u6001\u65f6\uff0c\u6240\u6709\u53d1\u9001\u7ed9 Redis \u670d\u52a1\u7684\u547d\u4ee4\u90fd\u4f1a\u7acb\u5373\u6267\u884c\uff1b\u4f46\u5f53\u5ba2\u6237\u7aef\u8fdb\u5165\u4e8b\u52a1\u72b6\u6001\u4e4b\u540e\uff0c\u8fd9\u4e9b\u547d\u4ee4\u4f1a\u88ab\u653e\u5165\u4e00\u4e2a\u4e8b\u52a1\u961f\u5217\u4e2d\uff0c\u7136\u540e\u7acb\u5373\u8fd4\u56de QUEUED\uff0c\u8868\u793a\u547d\u4ee4\u5df2\u5165\u961f\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756736097859",src:r(37172).A+"",width:"591",height:"376"}),"\r\n\u5f53 exec \u547d\u4ee4\u6267\u884c\u65f6\uff0cRedis \u4f1a\u5c06\u4e8b\u52a1\u961f\u5217\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u6309\u5148\u8fdb\u5148\u51fa\u7684\u987a\u5e8f\u6267\u884c\u3002\u5f53\u4e8b\u52a1\u961f\u5217\u91cc\u7684\u547d\u4ee4\u5168\u90e8\u6267\u884c\u5b8c\u6bd5\u540e\uff0cRedis \u4f1a\u8fd4\u56de\u4e00\u4e2a\u6570\u7ec4\uff0c\u5305\u542b\u6bcf\u4e2a\u547d\u4ee4\u7684\u6267\u884c\u7ed3\u679c\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"discard \u547d\u4ee4\u7528\u4e8e\u53d6\u6d88\u4e00\u4e2a\u4e8b\u52a1\uff0c\u5b83\u4f1a\u6e05\u7a7a\u4e8b\u52a1\u961f\u5217\u5e76\u9000\u51fa\u4e8b\u52a1\u72b6\u6001\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["watch \u547d\u4ee4\u7528\u4e8e\u76d1\u89c6\u4e00\u4e2a\u6216\u8005\u591a\u4e2a key\uff0c\u5982\u679c\u8fd9\u4e2a key \u5728\u4e8b\u52a1\u6267\u884c\u4e4b\u524d \u88ab\u5176\u4ed6\u547d\u4ee4\u6539\u52a8\uff0c\u90a3\u4e48\u4e8b\u52a1\u5c06\u4f1a\u88ab\u6253\u65ad\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756736124117",src:r(34282).A+"",width:"596",height:"442"}),"\r\n\u4f46 Redis \u7684\u4e8b\u52a1\u4e0e MySQL \u7684\u6709\u5f88\u5927\u4e0d\u540c\uff0c\u5b83\u5e76\u4e0d\u652f\u6301\u56de\u6eda\uff0c\u4e5f\u4e0d\u652f\u6301\u9694\u79bb\u7ea7\u522b\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u8bf4\u4e00\u4e0b-redis-\u4e8b\u52a1\u7684\u539f\u7406",children:"\u8bf4\u4e00\u4e0b Redis \u4e8b\u52a1\u7684\u539f\u7406\uff1f"}),"\n",(0,i.jsx)(n.p,{children:'Redis \u4e8b\u52a1\u7684\u539f\u7406\u5e76\u4e0d\u590d\u6742\uff0c\u6838\u5fc3\u5c31\u662f\u4e00\u4e2a"\u5148\u6392\u961f\uff0c\u540e\u6267\u884c"\u7684\u673a\u5236\u3002'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"1756736185947",src:r(72140).A+"",width:"1080",height:"428"}),"\r\n\u5f53\u6267\u884c MULTI \u547d\u4ee4\u65f6\uff0cRedis \u4f1a\u7ed9\u8fd9\u4e2a\u5ba2\u6237\u7aef\u6253\u4e00\u4e2a\u4e8b\u52a1\u7684\u6807\u8bb0\uff0c\u8868\u793a\u8fd9\u4e2a\u5ba2\u6237\u7aef\u540e\u9762\u53d1\u9001\u7684\u547d\u4ee4\u4e0d\u4f1a\u88ab\u7acb\u5373\u6267\u884c\uff0c\u800c\u662f\u88ab\u653e\u5230\u4e00\u4e2a\u961f\u5217\u91cc\u6392\u961f\u7b49\u7740\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756736194629",src:r(52325).A+"",width:"1080",height:"626"}),"\r\n\u5f53 Redis \u6536\u5230 EXEC \u547d\u4ee4\u65f6\uff0c\u5b83\u4f1a\u628a\u961f\u5217\u91cc\u7684\u547d\u4ee4\u4e00\u4e2a\u4e2a\u62ff\u51fa\u6765\u6267\u884c\u3002\u56e0\u4e3a Redis \u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u6240\u4ee5\u8fd9\u4e2a\u8fc7\u7a0b\u4e0d\u4f1a\u88ab\u5176\u4ed6\u547d\u4ee4\u6253\u65ad\uff0c\u8fd9\u5c31\u4fdd\u8bc1\u4e86Redis \u4e8b\u52a1\u7684\u539f\u5b50\u6027\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756736205571",src:r(16574).A+"",width:"1080",height:"832"}),"\r\n\u5f53\u6267\u884c WATCH \u547d\u4ee4\u65f6\uff0cRedis \u4f1a\u5c06 key \u6dfb\u52a0\u5230\u5168\u5c40\u76d1\u89c6\u5b57\u5178\u4e2d\uff1b\u53ea\u8981\u8fd9\u4e9b key \u5728 EXEC \u524d\u88ab\u5176\u4ed6\u5ba2\u6237\u7aef\u4fee\u6539\uff0cRedis \u5c31\u4f1a\u7ed9\u76f8\u5173\u5ba2\u6237\u7aef\u6253\u4e0a\u810f\u6807\u8bb0\uff0cEXEC \u65f6\u53d1\u73b0\u4e8b\u52a1\u5df2\u88ab\u5e72\u6270\u5c31\u4f1a\u76f4\u63a5\u53d6\u6d88\u6574\u4e2a\u4e8b\u52a1\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// \u5168\u5c40\u76d1\u89c6\u5b57\u5178\r\ndict *watched_keys;\r\n\r\ntypedef struct watchedKey {\r\n    robj *key;\r\n    redisDb *db;\r\n} watchedKey;\n"})}),"\n",(0,i.jsx)(n.p,{children:"DISCARD \u505a\u7684\u4e8b\u60c5\u5f88\u7b80\u5355\u76f4\u63a5\uff0c\u9996\u5148\u68c0\u67e5\u5ba2\u6237\u7aef\u662f\u5426\u771f\u7684\u5728\u4e8b\u52a1\u72b6\u6001\uff0c\u5982\u679c\u4e0d\u5728\u5c31\u62a5\u9519\uff1b\u5982\u679c\u5728\u4e8b\u52a1\u72b6\u6001\uff0c\u5c31\u6e05\u7a7a\u4e8b\u52a1\u961f\u5217\u5e76\u9000\u51fa\u4e8b\u52a1\u72b6\u6001\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'void discardCommand(client *c) {\r\n    if (!(c->flags & CLIENT_MULTI)) {\r\n        addReplyError(c,"DISCARD without MULTI");\r\n        return;\r\n    }\r\n    discardTransaction(c);\r\n    addReply(c,shared.ok);\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"redis-\u4e8b\u52a1\u6709\u54ea\u4e9b\u6ce8\u610f\u70b9",children:"Redis \u4e8b\u52a1\u6709\u54ea\u4e9b\u6ce8\u610f\u70b9\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u6700\u91cd\u8981\u7684\u7684\u4e00\u70b9\u662f\uff0cRedis \u4e8b\u52a1\u4e0d\u652f\u6301\u56de\u6eda\uff0c\u4e00\u65e6 EXEC \u547d\u4ee4\u88ab\u8c03\u7528\uff0c\u6240\u6709\u547d\u4ee4\u90fd\u4f1a\u88ab\u6267\u884c\uff0c\u5373\u4f7f\u6709\u4e9b\u547d\u4ee4\u53ef\u80fd\u6267\u884c\u5931\u8d25\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"redis\u4e8b\u52a1\u4e3a\u4ec0\u4e48\u4e0d\u652f\u6301\u56de\u6eda",children:"Redis\u4e8b\u52a1\u4e3a\u4ec0\u4e48\u4e0d\u652f\u6301\u56de\u6eda\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u7684\u6838\u5fc3\u8bbe\u8ba1\u7406\u5ff5\u662f\u7b80\u5355\u3001\u9ad8\u6548\uff0c\u800c\u4e0d\u662f\u5b8c\u6574\u7684 ACID \u7279\u6027\u3002\u800c\u5b9e\u73b0\u56de\u6eda\u9700\u8981\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u4fdd\u5b58\u5927\u91cf\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u5e76\u5728\u53d1\u751f\u9519\u8bef\u65f6\u9006\u5411\u6267\u884c\u547d\u4ee4\u4ee5\u6062\u590d\u539f\u59cb\u72b6\u6001\u3002\u8fd9\u4f1a\u589e\u52a0 Redis \u7684\u590d\u6742\u6027\u548c\u6027\u80fd\u5f00\u9500\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"redis\u4e8b\u52a1\u6ee1\u8db3\u539f\u5b50\u6027\u5417\u8981\u600e\u4e48\u6539\u8fdb",children:"Redis\u4e8b\u52a1\u6ee1\u8db3\u539f\u5b50\u6027\u5417\uff1f\u8981\u600e\u4e48\u6539\u8fdb\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u7684\u4e8b\u52a1\u4e0d\u80fd\u6ee1\u8db3\u6807\u51c6\u7684\u539f\u5b50\u6027\uff0c\u56e0\u4e3a\u5b83\u4e0d\u652f\u6301\u4e8b\u52a1\u56de\u6eda\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5047\u5982\u67d0\u4e2a\u547d\u4ee4\u6267\u884c\u5931\u8d25\uff0c\u6574\u4e2a\u4e8b\u52a1\u5e76\u4e0d\u4f1a\u81ea\u52a8\u56de\u6eda\u5230\u521d\u59cb\u72b6\u6001\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u4e00\u4e2a\u8f6c\u8d26\u4e8b\u52a1\r\nredisTemplate.multi();\r\nredisTemplate.opsForValue().decrement("user:1:balance", 100); // \u6210\u529f\r\nredisTemplate.opsForList().leftPush("user:1:balance", "log");  // \u7c7b\u578b\u9519\u8bef\uff0c\u5931\u8d25\r\nredisTemplate.opsForValue().increment("user:2:balance", 100);  // \u8fd8\u662f\u4f1a\u6267\u884c\r\nList<Object> results = redisTemplate.exec();\r\n\r\n// \u7ed3\u679c\uff1a\u7528\u62371\u88ab\u6263\u4e86\u94b1\uff0c\u7528\u62372\u4e5f\u6536\u5230\u4e86\u94b1\uff0c\u4f46\u4e2d\u95f4\u7684\u65e5\u5fd7\u64cd\u4f5c\u5931\u8d25\u4e86\r\n// \u8fd9\u7b26\u5408Redis\u7684\u539f\u5b50\u6027\u5b9a\u4e49\uff0c\u4f46\u4e0d\u7b26\u5408\u4e1a\u52a1\u671f\u671b\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u53ef\u4ee5\u4f7f\u7528 Lua \u811a\u672c\u6765\u66ff\u4ee3\u4e8b\u52a1\uff0c\u811a\u672c\u8fd0\u884c\u671f\u95f4\uff0cRedis \u4e0d\u4f1a\u5904\u7406\u5176\u4ed6\u547d\u4ee4\uff0c\u5e76\u4e14\u6211\u4eec\u53ef\u4ee5\u5728\u811a\u672c\u4e2d\u5904\u7406\u6574\u4e2a\u4e1a\u52a1\u903b\u8f91\uff0c\u5305\u62ec\u6761\u4ef6\u68c0\u67e5\u548c\u9519\u8bef\u5904\u7406\uff0c\u4fdd\u8bc1\u8981\u4e48\u6267\u884c\u6210\u529f\uff0c\u8981\u4e48\u4fdd\u6301\u6700\u521d\u7684\u72b6\u6001\uff0c\u4e0d\u4f1a\u51fa\u73b0\u4e00\u4e2a\u547d\u4ee4\u6267\u884c\u5931\u8d25\u3001\u5176\u4ed6\u547d\u4ee4\u6267\u884c\u6210\u529f\u7684\u60c5\u51b5\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Service\r\npublic class ImprovedTransactionService {\r\n    \r\n    public boolean atomicTransfer(String fromUser, String toUser, int amount) {\r\n        String luaScript = \r\n            "local from_key = KEYS[1] " +\r\n            "local to_key = KEYS[2] " +\r\n            "local amount = tonumber(ARGV[1]) " +\r\n            \r\n            // \u68c0\u67e5\u8f6c\u51fa\u8d26\u6237\u4f59\u989d\r\n            "local from_balance = redis.call(\'GET\', from_key) " +\r\n            "if not from_balance then return -1 end " +\r\n            \r\n            "from_balance = tonumber(from_balance) " +\r\n            "if from_balance < amount then return -2 end " +\r\n            \r\n            // \u68c0\u67e5\u8f6c\u5165\u8d26\u6237\u662f\u5426\u5b58\u5728\r\n            "if redis.call(\'EXISTS\', to_key) == 0 then return -3 end " +\r\n            \r\n            // \u6240\u6709\u68c0\u67e5\u901a\u8fc7\uff0c\u6267\u884c\u8f6c\u8d26\r\n            "redis.call(\'DECRBY\', from_key, amount) " +\r\n            "redis.call(\'INCRBY\', to_key, amount) " +\r\n            \r\n            // \u8bb0\u5f55\u8f6c\u8d26\u65e5\u5fd7\r\n            "local log = from_key .. \':\' .. to_key .. \':\' .. amount " +\r\n            "redis.call(\'LPUSH\', \'transfer:log\', log) " +\r\n            \r\n            "return 1";\r\n        \r\n        DefaultRedisScript<Long> script = new DefaultRedisScript<>();\r\n        script.setScriptText(luaScript);\r\n        script.setResultType(Long.class);\r\n        \r\n        Long result = redisTemplate.execute(script, \r\n            Arrays.asList("user:" + fromUser + ":balance", "user:" + toUser + ":balance"),\r\n            amount);\r\n        \r\n        return result != null && result == 1;\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"redis-\u4e8b\u52a1\u7684-acid-\u7279\u6027\u5982\u4f55\u4f53\u73b0",children:"Redis \u4e8b\u52a1\u7684 ACID \u7279\u6027\u5982\u4f55\u4f53\u73b0\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u5355\u4e2a Redis \u547d\u4ee4\u7684\u6267\u884c\u662f\u539f\u5b50\u6027\u7684\uff0c\u4f46 Redis \u6ca1\u6709\u5728\u4e8b\u52a1\u4e0a\u589e\u52a0\u4efb\u4f55\u7ef4\u6301\u539f\u5b50\u6027\u7684\u673a\u5236\uff0c\u6240\u4ee5 Redis \u4e8b\u52a1\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u5982\u679c\u67d0\u4e2a\u547d\u4ee4\u5931\u8d25\u4e86\uff0c\u5176\u4ed6\u547d\u4ee4\u8fd8\u662f\u4f1a\u7ee7\u7eed\u6267\u884c\uff0c\u4e0d\u4f1a\u56de\u6eda\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756736388588",src:r(48750).A+"",width:"1080",height:"482"}),"\r\n\u4e00\u81f4\u6027\u6307\u7684\u662f\uff0c\u5982\u679c\u6570\u636e\u5728\u6267\u884c\u4e8b\u52a1\u4e4b\u524d\u662f\u4e00\u81f4\u7684\uff0c\u90a3\u4e48\u5728\u4e8b\u52a1\u6267\u884c\u4e4b\u540e\uff0c\u65e0\u8bba\u4e8b\u52a1\u662f\u5426\u6267\u884c\u6210\u529f\uff0c\u6570\u636e\u4e5f\u5e94\u8be5\u662f\u4e00\u81f4\u7684\u3002\u4f46 Redis \u4e8b\u52a1\u5e76\u4e0d\u4fdd\u8bc1\u4e00\u81f4\u6027\uff0c\u56e0\u4e3a\u5982\u679c\u4e8b\u52a1\u4e2d\u7684\u67d0\u4e2a\u547d\u4ee4\u5931\u8d25\u4e86\uff0c\u5176\u4ed6\u547d\u4ee4\u4ecd\u7136\u4f1a\u6267\u884c\uff0c\u5c31\u4f1a\u51fa\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"Redis \u662f\u5355\u7ebf\u7a0b\u6267\u884c\u4e8b\u52a1\u7684\uff0c\u5e76\u4e14\u4e0d\u4f1a\u4e2d\u65ad\uff0c\u76f4\u5230\u6267\u884c\u5b8c\u6240\u6709\u4e8b\u52a1\u961f\u5217\u4e2d\u7684\u547d\u4ee4\u4e3a\u6b62\u3002\u56e0\u6b64\uff0c\u6211\u8ba4\u4e3a Redis \u7684\u4e8b\u52a1\u5177\u6709\u9694\u79bb\u6027\u7684\u7279\u5f81\u3002"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"1756736455102",src:r(21559).A+"",width:"1080",height:"930"}),"\r\nRedis \u4e8b\u52a1\u7684\u6301\u4e45\u6027\u5b8c\u5168\u4f9d\u8d56\u4e8e Redis \u672c\u8eab\u7684\u6301\u4e45\u5316\u673a\u5236\uff0c\u5982\u679c\u5f00\u542f\u4e86 AOF\uff0c\u90a3\u4e48\u4e8b\u52a1\u4e2d\u7684\u547d\u4ee4\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u8bb0\u5f55\u5230 AOF \u6587\u4ef6\u4e2d\uff0c\u5f53\u7136\u4e5f\u8981\u770b AOF \u7684 fsync \u7b56\u7565\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u53ea\u5f00\u542f\u4e86 RDB\uff0c\u4e8b\u52a1\u4e2d\u7684\u547d\u4ee4\u53ef\u80fd\u4f1a\u5728\u4e0b\u6b21\u5feb\u7167\u524d\u4e22\u5931\u3002\u5982\u679c\u4e24\u4e2a\u90fd\u6ca1\u6709\u5f00\u542f\uff0c\u80af\u5b9a\u662f\u4e0d\u6ee1\u8db3\u6301\u4e45\u6027\u7684\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u6709lua\u811a\u672c\u64cd\u4f5credis\u7684\u7ecf\u9a8c\u5417",children:"\u6709Lua\u811a\u672c\u64cd\u4f5cRedis\u7684\u7ecf\u9a8c\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["Lua \u811a\u672c\u662f\u5904\u7406 Redis \u590d\u6742\u64cd\u4f5c\u7684\u9996\u9009\u65b9\u6848\uff0c\u6bd4\u5982\u8bf4\u539f\u5b50\u6263\u51cf\u5e93\u5b58\u3001\u5206\u5e03\u5f0f\u9501\u3001\u9650\u6d41\u7b49\u4e1a\u52a1\u573a\u666f\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7 Lua \u811a\u672c\u6765\u5b9e\u73b0\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756736515935",src:r(49506).A+"",width:"1400",height:"800"})]}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u79d2\u6740\u573a\u666f\u4e0b\uff0c\u53ef\u4ee5\u7528 Lua \u811a\u672c\u628a\u6240\u6709\u68c0\u67e5\u903b\u8f91\u90fd\u5199\u5728\u4e00\u8d77\uff1a\u5148\u770b\u5e93\u5b58\u591f\u4e0d\u591f\uff0c\u518d\u770b\u7528\u6237\u6709\u6ca1\u6709\u4e70\u8fc7\uff0c\u6240\u6709\u6761\u4ef6\u90fd\u6ee1\u8db3\u624d\u6263\u51cf\u5e93\u5b58\u3002\u56e0\u4e3a\u6574\u4e2a\u811a\u672c\u662f\u539f\u5b50\u6267\u884c\u7684\uff0cRedis \u5728\u6267\u884c\u671f\u95f4\u4e0d\u4f1a\u5904\u7406\u5176\u4ed6\u547d\u4ee4\uff0c\u6240\u4ee5\u53ef\u4ee5\u5f7b\u5e95\u89e3\u51b3\u8d85\u5356\u95ee\u9898\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u8fd9\u4e2a\u79d2\u6740\u811a\u672c\u6551\u4e86\u6211\u7684\u547d\r\nString luaScript = \r\n    "local stock = redis.call(\'GET\', KEYS[1]) " +\r\n    "if not stock or tonumber(stock) < tonumber(ARGV[2]) then " +\r\n    "    return -1 " +  // \u5e93\u5b58\u4e0d\u8db3\r\n    "end " +\r\n    "if redis.call(\'SISMEMBER\', KEYS[2], ARGV[1]) == 1 then " +\r\n    "    return -2 " +  // \u91cd\u590d\u8d2d\u4e70\r\n    "end " +\r\n    "redis.call(\'DECRBY\', KEYS[1], ARGV[2]) " +\r\n    "redis.call(\'SADD\', KEYS[2], ARGV[1]) " +\r\n    "return 1";\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u5206\u5e03\u5f0f\u9501\u573a\u666f\u4e0b\uff0c\u6211\u4e00\u5f00\u59cb\u7528\u7684 SETNX \u547d\u4ee4\u6765\u5b9e\u73b0\uff0c\u7ed3\u679c\u53d1\u73b0\u5982\u679c\u7a0b\u5e8f\u5f02\u5e38\u9000\u51fa\uff0c\u9501\u5c31\u6b7b\u6389\u4e86\u3002\u540e\u6765\u52a0\u4e86\u8fc7\u671f\u65f6\u95f4\uff0c\u4f46\u53c8\u53d1\u73b0\u53ef\u80fd\u8bef\u5220\u5176\u4ed6\u7ebf\u7a0b\u7684\u9501\u3002\u6700\u540e\u8fd8\u662f\u7528 Lua \u811a\u672c\u5f7b\u5e95\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\uff0c\u786e\u4fdd\u53ea\u6709\u9501\u7684\u6301\u6709\u8005\u624d\u80fd\u91ca\u653e\u9501\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u89e3\u9501\u811a\u672c\u7279\u522b\u91cd\u8981\uff0c\u5fc5\u987b\u9a8c\u8bc1\u662f\u81ea\u5df1\u7684\u9501\u624d\u80fd\u5220\r\nprivate final String UNLOCK_SCRIPT = \r\n    "if redis.call(\'GET\', KEYS[1]) == ARGV[1] then " +\r\n    "    return redis.call(\'DEL\', KEYS[1]) " +\r\n    "else " +\r\n    "    return 0 " +\r\n    "end";\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u751a\u81f3\u8fd8\u53ef\u4ee5\u7528 Lua\u811a\u672c\u5b9e\u73b0\u6ed1\u52a8\u7a97\u53e3\u9650\u6d41\u5668\uff0c\u4e00\u6b21\u6027\u5b8c\u6210\u8fc7\u671f\u6570\u636e\u6e05\u7406\u3001\u8ba1\u6570\u68c0\u67e5\u3001\u65b0\u8bb0\u5f55\u6dfb\u52a0\u4e09\u4e2a\u64cd\u4f5c\uff0c\u800c\u4e14\u5b8c\u5168\u539f\u5b50\u5316\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u6ed1\u52a8\u7a97\u53e3\u9650\u6d41\uff0c\u903b\u8f91\u6e05\u6670\uff0c\u6027\u80fd\u8fd8\u597d\r\nString luaScript = \r\n    "local key = KEYS[1] " +\r\n    "local now = tonumber(ARGV[1]) " +\r\n    "local window = tonumber(ARGV[2]) " +\r\n    "local limit = tonumber(ARGV[3]) " +\r\n    \r\n    // \u5148\u6e05\u7406\u8fc7\u671f\u8bb0\u5f55\r\n    "redis.call(\'ZREMRANGEBYSCORE\', key, 0, now - window) " +\r\n    \r\n    // \u68c0\u67e5\u5f53\u524d\u8bf7\u6c42\u6570\r\n    "local current = redis.call(\'ZCARD\', key) " +\r\n    "if current < limit then " +\r\n    "    redis.call(\'ZADD\', key, now, now) " +\r\n    "    return 1 " +\r\n    "else " +\r\n    "    return 0 " +\r\n    "end";\n'})}),"\n",(0,i.jsx)(n.h3,{id:"redis\u7684\u7ba1\u9053pipeline\u4e86\u89e3\u5417",children:"Redis\u7684\u7ba1\u9053Pipeline\u4e86\u89e3\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e86\u89e3\uff0cPipeline \u5141\u8bb8\u5ba2\u6237\u7aef\u4e00\u6b21\u6027\u5411 Redis \u670d\u52a1\u5668\u53d1\u9001\u591a\u4e2a\u547d\u4ee4\uff0c\u800c\u4e0d\u5fc5\u7b49\u5f85\u4e00\u4e2a\u547d\u4ee4\u54cd\u5e94\u540e\u624d\u80fd\u53d1\u9001\u4e0b\u4e00\u4e2a\u3002Redis \u670d\u52a1\u5668\u4f1a\u6309\u7167\u547d\u4ee4\u7684\u987a\u5e8f\u4f9d\u6b21\u6267\u884c\uff0c\u5e76\u5c06\u6240\u6709\u7ed3\u679c\u6253\u5305\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756736599196",src:r(67643).A+"",width:"776",height:"498"}),"\r\n\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u6bcf\u6267\u884c\u4e00\u4e2a Redis \u547d\u4ee4\u90fd\u9700\u8981\u4e00\u6b21\u7f51\u7edc\u5f80\u8fd4\uff1a\u53d1\u9001\u547d\u4ee4 -> \u7b49\u5f85\u54cd\u5e94 -> \u53d1\u9001\u4e0b\u4e00\u4e2a\u547d\u4ee4\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"\u5ba2\u6237\u7aef                    Redis\u670d\u52a1\u5668\r\n  |                           |\r\n  |------- SET key1 val1 ----\x3e|\r\n  |<------ OK ---------------|\r\n  |------- SET key2 val2 ----\x3e|\r\n  |<------ OK ---------------|\r\n  |------- GET key1 --------\x3e|\r\n  |<------ val1 -------------|\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u5927\u91cf\u8bf7\u6c42\u4f9d\u6b21\u53d1\u9001\uff0c\u7f51\u7edc\u5ef6\u8fdf\u4f1a\u663e\u8457\u589e\u52a0\u8bf7\u6c42\u7684\u603b\u6267\u884c\u65f6\u95f4\uff0c\u5047\u5982\u4e00\u6b21 RTT \u7684\u65f6\u95f4\u662f 1 \u6beb\u79d2\uff0c3 \u4e2a\u5c31\u662f 3 \u6beb\u79d2\u3002\u6709\u4e86 Pipeline \u540e\uff0c\u53ef\u4ee5\u4e00\u6b21\u6027\u53d1\u9001 3 \u4e2a\u547d\u4ee4\uff0c\u603b\u65f6\u95f4\u5c31\u53ea\u9700\u8981 1 \u6beb\u79d2\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Service\r\npublic class RedisBatchService {\r\n    \r\n    public void batchInsertUsers(List<User> users) {\r\n        // \u4e0d\u7528Pipeline\u7684\u9519\u8bef\u505a\u6cd5 - \u5f88\u6162\r\n        // for (User user : users) {\r\n        //     redisTemplate.opsForValue().set("user:" + user.getId(), user);\r\n        // }\r\n        \r\n        // \u4f7f\u7528Pipeline\u7684\u6b63\u786e\u505a\u6cd5\r\n        redisTemplate.executePipelined(new RedisCallback<Object>() {\r\n            @Override\r\n            public Object doInRedis(RedisConnection connection) throws DataAccessException {\r\n                for (User user : users) {\r\n                    String key = "user:" + user.getId();\r\n                    byte[] keyBytes = key.getBytes();\r\n                    byte[] valueBytes = serialize(user);\r\n                    \r\n                    connection.set(keyBytes, valueBytes);\r\n                }\r\n                return null; // Pipeline\u4e0d\u9700\u8981\u8fd4\u56de\u503c\r\n            }\r\n        });\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u7136\u4e86\uff0cPipeline \u4e0d\u662f\u8d8a\u5927\u8d8a\u597d\uff0c\u592a\u5927\u4f1a\u5360\u7528\u8fc7\u591a\u5185\u5b58\uff0c\u901a\u5e38\u5efa\u8bae\u6bcf\u4e2a Pipeline \u5305\u542b 1000 \u5230 5000 \u4e2a\u547d\u4ee4\u3002\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u8c03\u6574\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public void smartBatchInsert(List<String> data) {\r\n    int batchSize = 1000; // \u7ecf\u9a8c\u503c\uff0c\u6839\u636e\u6570\u636e\u5927\u5c0f\u8c03\u6574\r\n    \r\n    for (int i = 0; i < data.size(); i += batchSize) {\r\n        List<String> batch = data.subList(i, Math.min(i + batchSize, data.size()));\r\n        \r\n        redisTemplate.executePipelined(new RedisCallback<Object>() {\r\n            @Override\r\n            public Object doInRedis(RedisConnection connection) throws DataAccessException {\r\n                for (String item : batch) {\r\n                    connection.set(item.getBytes(), item.getBytes());\r\n                }\r\n                return null;\r\n            }\r\n        });\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u4ec0\u4e48\u573a\u666f\u4e0b\u9002\u5408\u4f7f\u7528-pipeline\u5462",children:"\u4ec0\u4e48\u573a\u666f\u4e0b\u9002\u5408\u4f7f\u7528 Pipeline\u5462\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u9700\u8981\u6279\u91cf\u63d2\u5165\u3001\u66f4\u65b0\u6216\u5220\u9664\u6570\u636e\uff0c\u6216\u8005\u9700\u8981\u6267\u884c\u5927\u91cf\u76f8\u4f3c\u7684\u547d\u4ee4\u65f6\u3002\u6bd4\u5982\uff1a\u7cfb\u7edf\u542f\u52a8\u65f6\u7684\u7f13\u5b58\u9884\u70ed -> \u6279\u91cf\u52a0\u8f7d\u70ed\u70b9\u6570\u636e\uff1b\u6bd4\u5982\u7edf\u8ba1\u6570\u636e\u7684\u6279\u91cf\u66f4\u65b0\uff1b\u6bd4\u5982\u5927\u6279\u91cf\u6570\u636e\u7684\u5bfc\u5165\u5bfc\u51fa\uff1b\u6bd4\u5982\u6279\u91cf\u5220\u9664\u8fc7\u671f\u6216\u65e0\u6548\u7684\u7f13\u5b58\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u6709\u4e86\u89e3\u8fc7-pipeline-\u7684\u5e95\u5c42\u539f\u7406\u5417",children:"\u6709\u4e86\u89e3\u8fc7 Pipeline \u7684\u5e95\u5c42\u539f\u7406\u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u6709\uff0c\u5176\u5b9e\u5c31\u662f\u7f13\u51b2\u7684\u601d\u60f3\u3002\u5728\u6280\u672f\u6d3e\u5b9e\u6218\u9879\u76ee\u4e2d\uff0c\u6211\u5c31\u5728 RedisClient \u7c7b\u4e2d\u5c01\u88c5\u4e86\u4e00\u4e2a PipelineAction \u5185\u90e8\u7c7b\uff0c\u7528\u6765\u7f13\u5b58\u547d\u4ee4\u3002"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"1756736707834",src:r(69807).A+"",width:"1482",height:"1400"}),"\r\nadd \u65b9\u6cd5\u5c06\u547d\u4ee4\u5305\u88c5\u6210 Runnable \u5bf9\u8c61\uff0c\u653e\u5165 List \u4e2d\u3002\u5f53\u6267\u884c execute \u65b9\u6cd5\u65f6\uff0c\u518d\u8c03\u7528 RedisTemplate \u7684 executePipelined \u65b9\u6cd5\u5f00\u542f\u7ba1\u9053\u6a21\u5f0f\u5c06\u591a\u4e2a\u547d\u4ee4\u53d1\u9001\u5230 Redis \u670d\u52a1\u7aef\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"1756736745896",src:r(37985).A+"",width:"1472",height:"1298"}),"\r\nRedis \u670d\u52a1\u7aef\u4ece\u8f93\u5165\u7f13\u51b2\u533a\u8bfb\u5230\u547d\u4ee4\u540e\uff0c\u4f1a\u6309\u7167 RESP \u534f\u8bae\u8fdb\u884c\u547d\u4ee4\u62c6\u89e3\uff0c\u518d\u4f9d\u6b21\u6267\u884c\u8fd9\u4e9b\u547d\u4ee4\u3002\u6267\u884c\u7ed3\u679c\u4f1a\u5199\u5165\u5230\u8f93\u51fa\u7f13\u51b2\u533a\uff0c\u6700\u540e\u518d\u5c06\u6240\u6709\u7ed3\u679c\u4e00\u6b21\u6027\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"typedef struct client {\r\n    sds querybuf;           // \u8f93\u5165\u7f13\u51b2\u533a\r\n    list *reply;            // \u8f93\u51fa\u7f13\u51b2\u533a\u94fe\u8868\r\n    unsigned long reply_bytes; // \u8f93\u51fa\u7f13\u51b2\u533a\u5927\u5c0f\r\n} client;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"redis\u80fd\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u5417",children:"\ud83c\udf1fRedis\u80fd\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u5206\u5e03\u5f0f\u9501\u662f\u4e00\u79cd\u7528\u4e8e\u63a7\u5236\u591a\u4e2a\u4e0d\u540c\u8fdb\u7a0b\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u7684\u9501\u673a\u5236\u3002\u5b83\u80fd\u786e\u4fdd\u5728\u540c\u4e00\u65f6\u523b\uff0c\u53ea\u6709\u4e00\u4e2a\u8282\u70b9\u53ef\u4ee5\u5bf9\u8d44\u6e90\u8fdb\u884c\u8bbf\u95ee\uff0c\u4ece\u800c\u907f\u514d\u5206\u5e03\u5f0f\u573a\u666f\u4e0b\u7684\u5e76\u53d1\u95ee\u9898\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u53ef\u4ee5\u4f7f\u7528 Redis \u7684 SETNX \u547d\u4ee4\u5b9e\u73b0\u7b80\u5355\u7684\u5206\u5e03\u5f0f\u9501\u3002\u6bd4\u5982 SET key value NX PX 3000 \u5c31\u521b\u5efa\u4e86\u4e00\u4e2a\u9501\u540d\u4e3a key \u7684\u5206\u5e03\u5f0f\u9501\uff0c\u9501\u7684\u6301\u6709\u8005\u4e3a value\u3002NX \u4fdd\u8bc1\u53ea\u6709\u5728 key \u4e0d\u5b58\u5728\u65f6\u624d\u80fd\u521b\u5efa\u6210\u529f\uff0cEX \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7528\u4ee5\u9632\u6b62\u6b7b\u9501\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756736787005",src:r(64999).A+"",width:"639",height:"431"})]}),"\n",(0,i.jsx)(n.h3,{id:"redis\u5982\u4f55\u4fdd\u8bc1-setnx-\u4e0d\u4f1a\u53d1\u751f\u51b2\u7a81",children:"Redis\u5982\u4f55\u4fdd\u8bc1 SETNX \u4e0d\u4f1a\u53d1\u751f\u51b2\u7a81\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u6211\u4eec\u4f7f\u7528 SET key value NX EX 30 \u8fd9\u4e2a\u547d\u4ee4\u8fdb\u884c\u52a0\u9501\u65f6\uff0cRedis \u4f1a\u628a\u6574\u4e2a\u64cd\u4f5c\u5f53\u4f5c\u4e00\u4e2a\u539f\u5b50\u6307\u4ee4\u6765\u6267\u884c\u3002\u56e0\u4e3a Redis \u7684\u547d\u4ee4\u5904\u7406\u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u6240\u4ee5\u5728\u540c\u4e00\u65f6\u523b\u53ea\u80fd\u6709\u4e00\u4e2a\u547d\u4ee4\u5728\u6267\u884c\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u6bd4\u5982\u8bf4\u4e24\u4e2a\u5ba2\u6237\u7aef A \u548c B \u540c\u65f6\u8bf7\u6c42\u540c\u4e00\u4e2a\u9501\uff1a"}),"\n",(0,i.jsx)(n.p,{children:"\u5ba2\u6237\u7aefA: SET lock_key uuid_a NX EX 30\r\n\u5ba2\u6237\u7aefB: SET lock_key uuid_b NX EX 30\r\n\u867d\u7136\u8fd9\u4e24\u4e2a\u8bf7\u6c42\u53ef\u80fd\u51e0\u4e4e\u540c\u65f6\u5230\u8fbe Redis \u670d\u52a1\u5668\uff0c\u4f46 Redis \u4f1a\u4e25\u683c\u6309\u7167\u5230\u8fbe\u7684\u5148\u540e\u987a\u5e8f\u6765\u5904\u7406\u3002\u5047\u8bbe A \u7684\u8bf7\u6c42\u5148\u5230\uff0cRedis \u4f1a\u5148\u6267\u884c A \u7684 SET \u547d\u4ee4\uff0c\u8fd9\u65f6 lock_key \u88ab\u8bbe\u7f6e\u4e3a uuid_a\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u5904\u7406 B \u7684\u8bf7\u6c42\u65f6\uff0c\u56e0\u4e3a lock_key \u5df2\u7ecf\u5b58\u5728\u4e86\uff0cNX \u6761\u4ef6\u4e0d\u6ee1\u8db3\uff0c\u6240\u4ee5 B \u7684 SET \u547d\u4ee4\u4f1a\u5931\u8d25\uff0c\u8fd4\u56de NULL\u3002\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u53ea\u6709 A \u80fd\u83b7\u53d6\u5230\u9501\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5173\u952e\u70b9\u5728\u4e8e NX \u7684\u8bed\u4e49\uff1aNOT EXISTS\uff0c\u53ea\u6709\u5728 key \u4e0d\u5b58\u5728\u7684\u65f6\u5019\u624d\u4f1a\u8bbe\u7f6e\u6210\u529f\u3002Redis \u5728\u6267\u884c\u8fd9\u4e2a\u547d\u4ee4\u65f6\uff0c\u4f1a\u5148\u68c0\u67e5 key \u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u624d\u4f1a\u8bbe\u7f6e\u503c\uff0c\u8fd9\u6574\u4e2a\u8fc7\u7a0b\u662f\u539f\u5b50\u7684\uff0c\u4e0d\u4f1a\u88ab\u5176\u4ed6\u547d\u4ee4\u6253\u65ad\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"setnx\u6709\u4ec0\u4e48\u95ee\u9898\u5982\u4f55\u89e3\u51b3",children:"SETNX\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u5982\u4f55\u89e3\u51b3\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u4f7f\u7528 SETNX \u521b\u5efa\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u867d\u7136\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u6765\u907f\u514d\u6b7b\u9501\uff0c\u4f46\u4f1a\u8bef\u5220\u9501\u3002\u6bd4\u5982\u7ebf\u7a0b A \u83b7\u53d6\u9501\u540e\uff0c\u4e1a\u52a1\u6267\u884c\u65f6\u95f4\u6bd4\u8f83\u957f\uff0c\u9501\u8fc7\u671f\u4e86\u3002\u8fd9\u65f6\u7ebf\u7a0b B \u83b7\u53d6\u5230\u9501\uff0c\u4f46\u7ebf\u7a0b A \u6267\u884c\u5b8c\u4e1a\u52a1\u903b\u8f91\u540e\uff0c\u4f1a\u5c1d\u8bd5\u5220\u9664\u9501\uff0c\u8fd9\u65f6\u5019\u5220\u6389\u7684\u5176\u5b9e\u662f\u7ebf\u7a0b B \u7684\u9501\u3002"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"1756736812545",src:r(25169).A+"",width:"1298",height:"1140"})}),"\n",(0,i.jsx)(n.p,{children:"\u53ef\u4ee5\u901a\u8fc7\u9501\u7684\u81ea\u52a8\u7eed\u671f\u673a\u5236\u6765\u89e3\u51b3\u9501\u8fc7\u671f\u7684\u95ee\u9898\uff0c\u6bd4\u5982 Redisson \u7684\u770b\u95e8\u72d7\u673a\u5236\uff0c\u5728\u540e\u53f0\u542f\u52a8\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\uff0c\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u5c31\u68c0\u67e5\u9501\u662f\u5426\u8fd8\u88ab\u5f53\u524d\u7ebf\u7a0b\u6301\u6709\uff0c\u5982\u679c\u662f\u5c31\u81ea\u52a8\u5ef6\u957f\u8fc7\u671f\u65f6\u95f4\u3002\u8fd9\u6837\u65e2\u907f\u514d\u4e86\u6b7b\u9501\uff0c\u53c8\u9632\u6b62\u4e86\u9501\u88ab\u63d0\u524d\u91ca\u653e\u3002"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"1756736824682",src:r(16624).A+"",width:"896",height:"812"})}),"\n",(0,i.jsx)(n.h3,{id:"redisson\u4e86\u89e3\u591a\u5c11",children:"Redisson\u4e86\u89e3\u591a\u5c11\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"Redisson \u662f\u4e00\u4e2a\u57fa\u4e8e Redis \u7684 Java \u5ba2\u6237\u7aef\uff0c\u5b83\u4e0d\u53ea\u662f\u5bf9 Redis \u7684\u64cd\u4f5c\u8fdb\u884c\u7b80\u5355\u5730\u5c01\u88c5\uff0c\u8fd8\u63d0\u4f9b\u4e86\u5f88\u591a\u5206\u5e03\u5f0f\u7684\u6570\u636e\u7ed3\u6784\u548c\u670d\u52a1\uff0c\u6bd4\u5982\u6700\u5e38\u7528\u7684\u5206\u5e03\u5f0f\u9501\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'RLock lock = redisson.getLock("lock");\r\nlock.lock();\r\ntry {\r\n    // do something\r\n} finally {\r\n    lock.unlock();\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Redisson \u7684\u5206\u5e03\u5f0f\u9501\u6bd4 SETNX \u5b8c\u5584\u7684\u5f97\u591a\uff0c\u5b83\u7684\u770b\u95e8\u72d7\u673a\u5236\u53ef\u4ee5\u8ba9\u6211\u4eec\u5728\u83b7\u53d6\u9501\u7684\u65f6\u5019\u7701\u53bb\u624b\u52a8\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u6b65\u9aa4\uff0c\u5b83\u5728\u5185\u90e8\u5c01\u88c5\u4e86\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\uff0c\u6bcf\u9694 10 \u79d2\u4f1a\u68c0\u67e5\u4e00\u6b21\uff0c\u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u8fd8\u6301\u6709\u9501\u5c31\u81ea\u52a8\u7eed\u671f 30 \u79d2\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"private Long tryAcquire(long waitTime, long leaseTime, TimeUnit unit, long threadId) {\r\n    return get(tryAcquireAsync(waitTime, leaseTime, unit, threadId));\r\n}\r\n\r\nprivate <T> RFuture<Long> tryAcquireAsync(long waitTime, long leaseTime, TimeUnit unit, long threadId) {\r\n    RFuture<Long> ttlRemainingFuture;\r\n    if (leaseTime != -1) {\r\n        // \u624b\u52a8\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\r\n        ttlRemainingFuture = tryLockInnerAsync(waitTime, leaseTime, unit, threadId, RedisCommands.EVAL_LONG);\r\n    } else {\r\n        // \u542f\u7528\u770b\u95e8\u72d7\u673a\u5236\uff0c\u4f7f\u7528\u9ed8\u8ba4\u768430\u79d2\u8fc7\u671f\u65f6\u95f4\r\n        ttlRemainingFuture = tryLockInnerAsync(waitTime, internalLockLeaseTime,\r\n                TimeUnit.MILLISECONDS, threadId, RedisCommands.EVAL_LONG);\r\n    }\r\n    \r\n    // \u5904\u7406\u83b7\u53d6\u9501\u6210\u529f\u7684\u60c5\u51b5\r\n    ttlRemainingFuture.onComplete((ttlRemaining, e) -> {\r\n        if (e != null) {\r\n            return;\r\n        }\r\n        // \u5982\u679c\u83b7\u53d6\u9501\u6210\u529f\u4e14\u542f\u7528\u770b\u95e8\u72d7\u673a\u5236\r\n        if (ttlRemaining == null) {\r\n            if (leaseTime != -1) {\r\n                internalLockLeaseTime = unit.toMillis(leaseTime);\r\n            } else {\r\n                scheduleExpirationRenewal(threadId); // \u542f\u52a8\u770b\u95e8\u72d7\r\n            }\r\n        }\r\n    });\r\n    return ttlRemainingFuture;\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u53e6\u5916\uff0cRedisson \u8fd8\u63d0\u4f9b\u4e86\u5206\u5e03\u5f0f\u9650\u6d41\u5668 RRateLimiter\uff0c\u57fa\u4e8e\u4ee4\u724c\u6876\u7b97\u6cd5\u5b9e\u73b0\uff0c\u7528\u4e8e\u63a7\u5236\u5206\u5e03\u5f0f\u73af\u5883\u4e0b\u7684\u8bbf\u95ee\u9891\u7387\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// API \u63a5\u53e3\u9650\u6d41\r\n@RestController\r\npublic class ApiController {\r\n    \r\n    @Autowired\r\n    private RedissonClient redissonClient;\r\n    \r\n    @GetMapping("/api/data")\r\n    public ResponseEntity<?> getData() {\r\n        RRateLimiter limiter = redissonClient.getRateLimiter("api.data");\r\n        limiter.trySetRate(RateType.OVERALL, 100, 1, RateIntervalUnit.MINUTES);\r\n        \r\n        if (limiter.tryAcquire()) {\r\n            // \u5904\u7406\u8bf7\u6c42\r\n            return ResponseEntity.ok(processData());\r\n        } else {\r\n            // \u9650\u6d41\u89e6\u53d1\r\n            return ResponseEntity.status(429).body("Rate limit exceeded");\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u8be6\u7ec6\u8bf4\u8bf4redisson\u7684\u770b\u95e8\u72d7\u673a\u5236",children:"\u8be6\u7ec6\u8bf4\u8bf4Redisson\u7684\u770b\u95e8\u72d7\u673a\u5236\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"Redisson \u7684\u770b\u95e8\u72d7\u673a\u5236\u662f\u4e00\u79cd\u81ea\u52a8\u7eed\u671f\u673a\u5236\uff0c\u7528\u4e8e\u89e3\u51b3\u5206\u5e03\u5f0f\u9501\u7684\u8fc7\u671f\u95ee\u9898\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u57fa\u672c\u539f\u7406\u662f\u8fd9\u6837\u7684\uff1a\u5f53\u8c03\u7528 lock() \u65b9\u6cd5\u52a0\u9501\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u663e\u5f0f\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0cRedisson \u4f1a\u9ed8\u8ba4\u7ed9\u9501\u52a0\u4e00\u4e2a 30 \u79d2\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u540c\u65f6\u542f\u7528\u4e00\u4e2a\u540d\u4e3a\u201c\u770b\u95e8\u72d7\u201d\u7684\u5b9a\u65f6\u4efb\u52a1\uff0c\u6bcf\u9694 10 \u79d2\uff08\u9ed8\u8ba4\u662f\u8fc7\u671f\u65f6\u95f4\u7684 1/3\uff09\uff0c\u53bb\u68c0\u67e5\u4e00\u6b21\u9501\u662f\u5426\u8fd8\u88ab\u5f53\u524d\u7ebf\u7a0b\u6301\u6709\uff0c\u5982\u679c\u662f\uff0c\u5c31\u81ea\u52a8\u7eed\u671f\uff0c\u5c06\u8fc7\u671f\u65f6\u95f4\u5ef6\u957f\u5230 30 \u79d2\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756736949971",src:r(34467).A+"",width:"1768",height:"768"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u4f2a\u4ee3\u7801\u5c55\u793a\u6838\u5fc3\u903b\u8f91\r\nprivate void renewExpiration() {\r\n    Timeout task = commandExecutor.getConnectionManager()\r\n        .newTimeout(new TimerTask() {\r\n            @Override\r\n            public void run(Timeout timeout) {\r\n                // \u7528 Lua \u811a\u672c\u68c0\u67e5\u5e76\u7eed\u671f\r\n                if (redis.call("get", lockKey) == currentThreadId) {\r\n                    redis.call("expire", lockKey, 30);\r\n                    // \u9012\u5f52\u8c03\u7528\uff0c\u7ee7\u7eed\u4e0b\u4e00\u6b21\u7eed\u671f\r\n                    renewExpiration();\r\n                }\r\n            }\r\n        }, 10, TimeUnit.SECONDS);\r\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u7eed\u671f\u7684 Lua \u811a\u672c\u4f1a\u68c0\u67e5\u9501\u7684 value \u662f\u5426\u5339\u914d\u5f53\u524d\u7ebf\u7a0b\uff0c\u5982\u679c\u5339\u914d\u5c31\u5ef6\u957f\u8fc7\u671f\u65f6\u95f4\u3002\u8fd9\u6837\u5c31\u80fd\u4fdd\u8bc1\u53ea\u6709\u9501\u7684\u771f\u6b63\u6301\u6709\u8005\u624d\u80fd\u7eed\u671f\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u8c03\u7528 unlock() \u65b9\u6cd5\u65f6\uff0c\u770b\u95e8\u72d7\u4efb\u52a1\u4f1a\u88ab\u53d6\u6d88\u3002\u6216\u8005\u5982\u679c\u4e1a\u52a1\u903b\u8f91\u6267\u884c\u5b8c\u4f46\u5fd8\u8bb0 unlock \u4e86\uff0c\u770b\u95e8\u72d7\u4e5f\u4f1a\u5e2e\u6211\u4eec\u81ea\u52a8\u68c0\u67e5\u9501\uff0c\u5982\u679c\u9501\u5df2\u7ecf\u4e0d\u5c5e\u4e8e\u5f53\u524d\u7ebf\u7a0b\u4e86\uff0c\u4e5f\u4f1a\u81ea\u52a8\u505c\u6b62\u7eed\u671f\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u6837\u6211\u4eec\u5c31\u4e0d\u7528\u62c5\u5fc3\u4e1a\u52a1\u6267\u884c\u65f6\u95f4\u8fc7\u957f\u5bfc\u81f4\u9501\u88ab\u63d0\u524d\u91ca\u653e\uff0c\u4e5f\u907f\u514d\u4e86\u624b\u52a8\u4f30\u7b97\u8fc7\u671f\u65f6\u95f4\u7684\u9ebb\u70e6\uff0c\u540c\u65f6\u4e5f\u89e3\u51b3\u4e86\u5206\u5e03\u5f0f\u73af\u5883\u4e0b\u7684\u6b7b\u9501\u95ee\u9898\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u770b\u95e8\u72d7\u673a\u5236\u4e2d\u7684\u68c0\u67e5\u9501\u8fc7\u7a0b\u662f\u539f\u5b50\u64cd\u4f5c\u5417",children:"\u770b\u95e8\u72d7\u673a\u5236\u4e2d\u7684\u68c0\u67e5\u9501\u8fc7\u7a0b\u662f\u539f\u5b50\u64cd\u4f5c\u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u662f\u7684\uff0cRedisson \u4f7f\u7528\u4e86 Lua \u811a\u672c\u6765\u4fdd\u8bc1\u9501\u68c0\u67e5\u7684\u539f\u5b50\u6027\u3002"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"1756736994405",src:r(13193).A+"",width:"1490",height:"1588"})}),"\n",(0,i.jsx)(n.p,{children:"Redis \u5728\u6267\u884c Lua \u811a\u672c\u65f6\uff0c\u4f1a\u628a\u6574\u4e2a\u811a\u672c\u5f53\u4f5c\u4e00\u4e2a\u547d\u4ee4\u6765\u5904\u7406\uff0c\u671f\u95f4\u4e0d\u4f1a\u6267\u884c\u5176\u4ed6\u547d\u4ee4\u3002\u6240\u4ee5 hexists \u68c0\u67e5\u548c expire \u7eed\u671f\u662f\u539f\u5b50\u6267\u884c\u7684\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"redlock\u4f60\u4e86\u89e3\u591a\u5c11",children:"Redlock\u4f60\u4e86\u89e3\u591a\u5c11\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"Redlock \u662f Redis \u4f5c\u8005 antirez \u63d0\u51fa\u7684\u4e00\u79cd\u5206\u5e03\u5f0f\u9501\u7b97\u6cd5\uff0c\u7528\u4e8e\u89e3\u51b3\u5355\u4e2a Redis \u5b9e\u4f8b\u4f5c\u4e3a\u5206\u5e03\u5f0f\u9501\u65f6\u5b58\u5728\u7684\u5355\u70b9\u6545\u969c\u95ee\u9898\u3002"}),"\n",(0,i.jsx)(n.p,{children:"Redlock \u7684\u6838\u5fc3\u601d\u60f3\u662f\u901a\u8fc7\u5728\u591a\u4e2a\u5b8c\u5168\u72ec\u7acb\u7684 Redis \u5b9e\u4f8b\u4e0a\u540c\u65f6\u83b7\u53d6\u9501\u6765\u5b9e\u73b0\u5bb9\u9519\u3002\r\nminLocksAmount \u65b9\u6cd5\u8fd4\u56de\u7684 locks.size()/2 + 1\uff0c\u6b63\u662f Redlock \u7b97\u6cd5\u8981\u6c42\u7684\u5c11\u6570\u670d\u4ece\u591a\u6570\u539f\u5219\u3002failedLocksLimit \u65b9\u6cd5\u4f1a\u8ba1\u7b97\u5141\u8bb8\u5931\u8d25\u7684\u9501\u6570\u91cf\uff0c\u786e\u4fdd\u5373\u4f7f\u90e8\u5206\u5b9e\u4f8b\u5931\u8d25\uff0c\u53ea\u8981\u6210\u529f\u7684\u5b9e\u4f8b\u6570\u91cf\u8d85\u8fc7\u4e00\u534a\u5c31\u8ba4\u4e3a\u83b7\u53d6\u9501\u6210\u529f\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7ea2\u9501\u4f1a\u5c1d\u8bd5\u4f9d\u6b21\u5411\u6240\u6709 Redis \u5b9e\u4f8b\u83b7\u53d6\u9501\uff0c\u5e76\u8bb0\u5f55\u6210\u529f\u83b7\u53d6\u7684\u9501\u6570\u91cf\uff0c\u5f53\u6570\u91cf\u8fbe\u5230 minLocksAmount \u65f6\u5c31\u8ba4\u4e3a\u83b7\u53d6\u6210\u529f\uff0c\u5426\u5219\u91ca\u653e\u5df2\u83b7\u53d6\u7684\u9501\u5e76\u8fd4\u56de\u5931\u8d25\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u867d\u7136 Redlock \u5b58\u5728\u4e00\u4e9b\u4e89\u8bae\uff0c\u6bd4\u5982\u8bf4\u65f6\u949f\u6f02\u79fb\u95ee\u9898\u3001\u7f51\u7edc\u5206\u533a\u5bfc\u81f4\u7684\u8111\u88c2\u95ee\u9898\uff0c\u4f46\u5b83\u4ecd\u7136\u662f\u4e00\u4e2a\u76f8\u5bf9\u6210\u719f\u7684\u5206\u5e03\u5f0f\u9501\u89e3\u51b3\u65b9\u6848\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u7ea2\u9501\u80fd\u4e0d\u80fd\u4fdd\u8bc1\u767e\u5206\u767e\u4e0a\u9501",children:"\u7ea2\u9501\u80fd\u4e0d\u80fd\u4fdd\u8bc1\u767e\u5206\u767e\u4e0a\u9501\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u4e0d\u80fd\uff0cRedlock \u65e0\u6cd5\u4fdd\u8bc1\u767e\u5206\u767e\u4e0a\u9501\u6210\u529f\uff0c\u8fd9\u662f\u7531\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u672c\u8d28\u7279\u6027\u51b3\u5b9a\u7684\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u6709\u7f51\u7edc\u5206\u533a\u65f6\uff0c\u5ba2\u6237\u7aef\u53ef\u80fd\u65e0\u6cd5\u4e0e\u8db3\u591f\u6570\u91cf\u7684 Redis \u5b9e\u4f8b\u901a\u4fe1\u3002\u6bd4\u5982\u5728 5 \u4e2a Redis \u5b9e\u4f8b\u7684\u90e8\u7f72\u4e2d\uff0c\u5982\u679c\u7f51\u7edc\u5206\u533a\u5bfc\u81f4\u5ba2\u6237\u7aef\u53ea\u80fd\u8bbf\u95ee\u5230 2 \u4e2a\u5b9e\u4f8b\uff0c\u90a3\u4e48\u65e0\u8bba\u5982\u4f55\u90fd\u65e0\u6cd5\u6ee1\u8db3\u7ea2\u9501\u8981\u6c42\u7684\u5c11\u6570\u670d\u4ece\u591a\u6570\u539f\u5219\uff0c\u83b7\u53d6\u9501\u7684\u65f6\u5019\u5fc5\u7136\u5931\u8d25\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public boolean tryLock(long waitTime, long leaseTime, TimeUnit unit) throws InterruptedException {\r\n    // ...\r\n    for (ListIterator<RLock> iterator = locks.listIterator(); iterator.hasNext();) {\r\n        RLock lock = iterator.next();\r\n        boolean lockAcquired;\r\n        try {\r\n            lockAcquired = lock.tryLock(awaitTime, newLeaseTime, TimeUnit.MILLISECONDS);\r\n        } catch (RedisResponseTimeoutException e) {\r\n            lockAcquired = false; // \u7f51\u7edc\u8d85\u65f6\u5bfc\u81f4\u5931\u8d25\r\n        } catch (Exception e) {\r\n            lockAcquired = false; // \u5176\u4ed6\u5f02\u5e38\u5bfc\u81f4\u5931\u8d25\r\n        }\r\n        \r\n        // \u5982\u679c\u5269\u4f59\u53ef\u5c1d\u8bd5\u7684\u5b9e\u4f8b\u6570\u91cf\u4e0d\u8db3\u4ee5\u8fbe\u5230\u591a\u6570\u6d3e\uff0c\u76f4\u63a5\u9000\u51fa\r\n        if (locks.size() - acquiredLocks.size() == failedLocksLimit()) {\r\n            break;\r\n        }\r\n    }\r\n    \r\n    // \u68c0\u67e5\u662f\u5426\u8fbe\u5230\u591a\u6570\u6d3e\u8981\u6c42\r\n    if (acquiredLocks.size() >= minLocksAmount(locks)) {\r\n        return true;\r\n    } else {\r\n        unlockInner(acquiredLocks);\r\n        return false; // \u672a\u8fbe\u5230\u591a\u6570\u6d3e\uff0c\u83b7\u53d6\u5931\u8d25\r\n    }\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u65f6\u949f\u6f02\u79fb\u4e5f\u4f1a\u5f71\u54cd\u6210\u529f\u7387\u3002\u5373\u4f7f\u6240\u6709\u5b9e\u4f8b\u90fd\u53ef\u8fbe\uff0c\u5982\u679c\u5404\u4e2a Redis \u5b9e\u4f8b\u4e4b\u95f4\u5b58\u5728\u660e\u663e\u7684\u65f6\u949f\u6f02\u79fb\uff0c\u6216\u8005\u5ba2\u6237\u7aef\u5728\u83b7\u53d6\u9501\u7684\u8fc7\u7a0b\u4e2d\u8017\u65f6\u8fc7\u957f\uff0c\u6bd4\u5982\u7f51\u7edc\u5ef6\u8fdf\u3001GC \u505c\u987f\u7b49\uff0c\u90fd\u53ef\u80fd\u4f1a\u5bfc\u81f4\u9501\u5728\u83b7\u53d6\u5b8c\u6210\u524d\u5c31\u8fc7\u671f\uff0c\u4ece\u800c\u83b7\u53d6\u5931\u8d25\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u91cd\u8bd5\u673a\u5236\u6765\u63d0\u9ad8\u9501\u7684\u6210\u529f\u7387\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"for (int i = 0; i < maxRetries; i++) {\r\n    if (redLock.tryLock(waitTime, leaseTime, TimeUnit.MILLISECONDS)) {\r\n        return true;\r\n    }\r\n    Thread.sleep(retryDelay);\r\n}\r\nreturn false;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u9879\u76ee\u4e2d\u6709\u7528\u5230\u5206\u5e03\u5f0f\u9501\u5417",children:"\u9879\u76ee\u4e2d\u6709\u7528\u5230\u5206\u5e03\u5f0f\u9501\u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u5728PmHub\u9879\u76ee\u4e2d\uff0c\u6211\u6709\u4f7f\u7528 Redission \u7684\u5206\u5e03\u5f0f\u9501\u6765\u786e\u4fdd\u6d41\u7a0b\u72b6\u6001\u7684\u66f4\u65b0\u6309\u987a\u5e8f\u6267\u884c\uff0c\u4e14\u4e0d\u88ab\u5176\u4ed6\u6d41\u7a0b\u670d\u52a1\u5e72\u6270\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u5e95\u5c42\u7ed3\u6784",children:"\u5e95\u5c42\u7ed3\u6784"}),"\n",(0,i.jsx)(n.h3,{id:"redis\u90fd\u6709\u54ea\u4e9b\u5e95\u5c42\u6570\u636e\u7ed3\u6784",children:"\ud83c\udf1fRedis\u90fd\u6709\u54ea\u4e9b\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["Redis \u4e4b\u6240\u4ee5\u5feb\uff0c\u9664\u4e86\u57fa\u4e8e\u5185\u5b58\u8bfb\u5199\u4e4b\u5916\uff0c\u8fd8\u6709\u5f88\u91cd\u8981\u7684\u4e00\u70b9\u5c31\u662f\u5b83\u7cbe\u5fc3\u8bbe\u8ba1\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u3002Redis \u603b\u5171\u6709 8 \u79cd\u6838\u5fc3\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u6211\u6309\u7167\u91cd\u8981\u7a0b\u5ea6\u6765\u8bf4\u4e00\u4e0b\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737123972",src:r(67037).A+"",width:"1151",height:"563"})]}),"\n",(0,i.jsxs)(n.p,{children:["\u9996\u5148\u662f SDS\uff0c\u8fd9\u662f Redis \u81ea\u5df1\u5b9e\u73b0\u7684\u52a8\u6001\u5b57\u7b26\u4e32\uff0c\u5b83\u4fdd\u7559\u4e86 C \u8bed\u8a00\u539f\u751f\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\uff0c\u6240\u4ee5\u83b7\u53d6\u957f\u5ea6\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(1)\uff0c\u5728\u6b64\u57fa\u7840\u4e0a\u8fd8\u652f\u6301\u52a8\u6001\u6269\u5bb9\uff0c\u4ee5\u53ca\u5b58\u50a8\u4e8c\u8fdb\u5236\u6570\u636e\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737140624",src:r(65324).A+"",width:"655",height:"438"}),"\r\n\u7136\u540e\u662f\u5b57\u5178\uff0c\u66f4\u5e95\u5c42\u662f\u7528\u6570\u7ec4+\u94fe\u8868\u5b9e\u73b0\u7684\u54c8\u5e0c\u8868\u3002\u5b83\u7684\u8bbe\u8ba1\u5f88\u5de7\u5999\uff0c\u7528\u4e86\u4e24\u4e2a\u54c8\u5e0c\u8868\uff0c\u5e73\u65f6\u7528\u7b2c\u4e00\u4e2a\uff0crehash \u7684\u65f6\u5019\u7528\u7b2c\u4e8c\u4e2a\uff0c\u8fd9\u6837\u53ef\u4ee5\u6e10\u8fdb\u5f0f\u5730\u8fdb\u884c\u6269\u5bb9\uff0c\u4e0d\u4f1a\u963b\u585e\u592a\u4e45\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737153378",src:r(72806).A+"",width:"1027",height:"796"}),(0,i.jsx)(n.br,{}),"\n",'\u63a5\u4e0b\u6765\u538b\u7f29\u5217\u8868 ziplist\uff0c\u8fd9\u4e2a\u8bbe\u8ba1\u5f88\u6709\u610f\u601d\u3002Redis \u4e3a\u4e86\u8282\u7701\u5185\u5b58\uff0c\u8bbe\u8ba1\u4e86\u8fd9\u79cd\u7d27\u51d1\u578b\u7684\u6570\u636e\u7ed3\u6784\uff0c\u628a\u6240\u6709\u5143\u7d20\u8fde\u7eed\u5b58\u50a8\u5728\u4e00\u5757\u5185\u5b58\u91cc\u3002\u4f46\u662f\u5b83\u6709\u4e2a\u81f4\u547d\u95ee\u9898\u53eb"\u8fde\u9501\u66f4\u65b0"\uff0c\u5c31\u662f\u5f53\u6211\u4eec\u4fee\u6539\u4e00\u4e2a\u5143\u7d20\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u540e\u9762\u6240\u6709\u7684\u5143\u7d20\u90fd\u8981\u91cd\u65b0\u7f16\u7801\uff0c\u6027\u80fd\u4f1a\u6025\u5267\u4e0b\u964d\u3002\r\n',(0,i.jsx)(n.img,{alt:"1756737167133",src:r(91352).A+"",width:"1021",height:"600"}),"\r\n\u4e3a\u4e86\u89e3\u51b3\u538b\u7f29\u5217\u8868\u7684\u95ee\u9898\uff0cRedis \u540e\u6765\u8bbe\u8ba1\u4e86 quicklist\u3002\u8fd9\u4e2a\u8bbe\u8ba1\u601d\u8def\u5f88\u806a\u660e\uff0c\u5b83\u628a ziplist \u62c6\u5206\u6210\u5c0f\u5757\uff0c\u7136\u540e\u7528\u53cc\u5411\u94fe\u8868\u628a\u8fd9\u4e9b\u5c0f\u5757\u4e32\u8d77\u6765\u3002\u8fd9\u6837\u65e2\u4fdd\u6301\u4e86 ziplist \u8282\u7701\u5185\u5b58\u7684\u4f18\u52bf\uff0c\u53c8\u907f\u514d\u4e86\u8fde\u9501\u66f4\u65b0\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u5c0f\u5757\u7684 ziplist \u90fd\u4e0d\u4f1a\u592a\u5927\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737184298",src:r(35377).A+"",width:"884",height:"593"}),"\r\n\u518d\u540e\u6765\uff0cRedis \u53c8\u8bbe\u8ba1\u4e86 listpack\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u8bf4\u662f ziplist \u7684\u5b8c\u7f8e\u66ff\u4ee3\u54c1\u3002\u5b83\u6700\u5927\u7684\u7279\u70b9\u662f\u6bcf\u4e2a\u5143\u7d20\u53ea\u8bb0\u5f55\u81ea\u5df1\u7684\u957f\u5ea6\uff0c\u4e0d\u8bb0\u5f55\u524d\u4e00\u4e2a\u5143\u7d20\u7684\u957f\u5ea6\uff0c\u8fd9\u6837\u5c31\u5f7b\u5e95\u89e3\u51b3\u4e86\u8fde\u9501\u66f4\u65b0\u7684\u95ee\u9898\u3002Redis 5.0 \u5df2\u7ecf\u7528 listpack \u66ff\u6362\u4e86 ziplist\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737205785",src:r(52012).A+"",width:"1960",height:"826"}),"\r\n\u8df3\u8868skiplist \u4e3b\u8981\u7528\u5728 ZSet \u4e2d\u3002\u5b83\u7684\u8bbe\u8ba1\u5f88\u5de7\u5999\uff0c\u901a\u8fc7\u591a\u5c42\u6307\u9488\u6765\u5b9e\u73b0\u5feb\u901f\u67e5\u627e\uff0c\u5e73\u5747\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(log N)\u3002\u76f8\u6bd4\u7ea2\u9ed1\u6811\uff0c\u8df3\u8868\u7684\u5b9e\u73b0\u66f4\u7b80\u5355\uff0c\u800c\u4e14\u652f\u6301\u8303\u56f4\u67e5\u8be2\uff0c\u8fd9\u5bf9 Redis \u7684\u6709\u5e8f\u96c6\u5408\u6765\u8bf4\u5f88\u91cd\u8981\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd8\u6709\u6574\u6570\u96c6\u5408intset\uff0c\u5f53 Set \u4e2d\u90fd\u662f\u6574\u6570\u4e14\u5143\u7d20\u6570\u91cf\u8f83\u5c11\u65f6\u4f7f\u7528\uff0c\u5185\u90e8\u662f\u4e00\u4e2a\u6709\u5e8f\u6570\u7ec4\uff0c\u67e5\u627e\u7528\u7684\u4e8c\u5206\u6cd5\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737243177",src:r(30419).A+"",width:"1889",height:"1039"}),"\r\n\u6700\u540e\u662f\u53cc\u5411\u94fe\u8868LinkedList\uff0c\u65e9\u671f\u7248\u672c\u7684 Redis \u4f1a\u5728 List \u4e2d\u7528\u5230\uff0c\u4f46 Redis 3.2 \u540e\u5c31\u88ab quicklist \u66ff\u4ee3\u4e86\uff0c\u56e0\u4e3a\u7eaf\u94fe\u8868\u7684\u95ee\u9898\u662f\u5185\u5b58\u4e0d\u8fde\u7eed\uff0c\u5f71\u54cd CPU \u7f13\u5b58\u6027\u80fd\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737267626",src:r(31708).A+"",width:"1938",height:"1128"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u7b80\u5355\u4ecb\u7ecd\u4e0b\u94fe\u8868",children:"\u7b80\u5355\u4ecb\u7ecd\u4e0b\u94fe\u8868\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u7684 linkedlist \u662f\u2f00\u4e2a\u53cc\u5411\u2f46\u73af\u94fe\u8868\u7ed3\u6784\uff0c\u548c Java \u4e2d\u7684 LinkedList \u7c7b\u4f3c\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u8282\u70b9\u7531 listNode \u8868\u793a\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u6709\u6307\u5411\u5176\u524d\u7f6e\u8282\u70b9\u548c\u540e\u7f6e\u8282\u70b9\u7684\u6307\u9488\uff0c\u5934\u8282\u70b9\u7684\u524d\u7f6e\u548c\u5c3e\u8282\u70b9\u7684\u540e\u7f6e\u5747\u6307\u5411 null\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737308299",src:r(90994).A+"",width:"964",height:"708"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u5173\u4e8e\u6574\u6570\u96c6\u5408\u80fd\u518d\u8be6\u7ec6\u8bf4\u8bf4\u5417",children:"\u5173\u4e8e\u6574\u6570\u96c6\u5408\uff0c\u80fd\u518d\u8be6\u7ec6\u8bf4\u8bf4\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u6574\u6570\u96c6\u5408\u662f Redis \u4e2d\u4e00\u4e2a\u975e\u5e38\u7cbe\u5de7\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5f53\u4e00\u4e2a Set \u53ea\u5305\u542b\u6574\u6570\u5143\u7d20\uff0c\u5e76\u4e14\u6570\u91cf\u4e0d\u591a\u65f6\uff0c\u9ed8\u8ba4\u4e0d\u8d85\u8fc7 512 \u4e2a\uff0cRedis \u5c31\u4f1a\u7528 intset \u6765\u5b58\u50a8\u8fd9\u4e9b\u6570\u636e\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737319518",src:r(66330).A+"",width:"1013",height:"342"}),"\r\nintset \u6700\u6709\u610f\u601d\u7684\u5730\u65b9\u662f\u7c7b\u578b\u5347\u7ea7\u673a\u5236\u3002\u5b83\u6709\u4e09\u79cd\u7f16\u7801\u65b9\u5f0f\uff1a16\u4f4d\u300132\u4f4d\u548c 64\u4f4d\uff0c\u4f1a\u6839\u636e\u5b58\u50a8\u7684\u6574\u6570\u5927\u5c0f\u52a8\u6001\u8c03\u6574\u3002\u6bd4\u5982\u539f\u6765\u5b58\u7684\u90fd\u662f\u5c0f\u6574\u6570\uff0c\u7528 16 \u4f4d\u7f16\u7801\u5c31\u591f\u4e86\uff0c\u4f46\u7a81\u7136\u63d2\u5165\u4e86\u4e00\u4e2a\u5f88\u5927\u7684\u6570\uff0c\u8d85\u51fa\u4e86 16 \u4f4d\u7684\u8303\u56f4\uff0c\u8fd9\u65f6\u6574\u4e2a\u6570\u7ec4\u4f1a\u5347\u7ea7\u5230 32 \u4f4d\u7f16\u7801\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"typedef struct intset {\r\n    uint32_t encoding;   // \u7f16\u7801\u65b9\u5f0f\uff1a16\u4f4d\u300132\u4f4d\u621664\u4f4d\r\n    uint32_t length;     // \u5143\u7d20\u6570\u91cf\r\n    int8_t contents[];   // \u4fdd\u5b58\u5143\u7d20\u7684\u6570\u7ec4\r\n} intset;\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u7136\u4e86\uff0c\u8fd9\u79cd\u5347\u7ea7\u662f\u6709\u4ee3\u4ef7\u7684\uff0c\u56e0\u4e3a\u9700\u8981\u91cd\u65b0\u5206\u914d\u5185\u5b58\u5e76\u590d\u5236\u6570\u636e\uff0c\u5e76\u4e14\u662f\u4e0d\u53ef\u9006\u7684\uff0c\u4f46\u5b83\u7684\u597d\u5904\u662f\u53ef\u4ee5\u8282\u7701\u5185\u5b58\u7a7a\u95f4\uff0c\u7279\u522b\u662f\u5728\u5b58\u50a8\u5927\u91cf\u5c0f\u6574\u6570\u65f6\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u53e6\u5916\uff0c\u6240\u6709\u5143\u7d20\u5728\u6570\u7ec4\u4e2d\u6309\u7167\u4ece\u5c0f\u5230\u5927\u7684\u987a\u5e8f\u6392\u5217\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e8c\u5206\u67e5\u627e\u6765\u5b9a\u4f4d\u5143\u7d20\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(log N)"}),"\n",(0,i.jsx)(n.h3,{id:"\u8bf4\u4e00\u4e0bzset-\u7684\u5e95\u5c42\u539f\u7406",children:"\u8bf4\u4e00\u4e0bzset \u7684\u5e95\u5c42\u539f\u7406\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["ZSet \u662f Redis \u6700\u590d\u6742\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5b83\u6709\u4e24\u79cd\u5e95\u5c42\u5b9e\u73b0\u65b9\u5f0f\uff1a\u538b\u7f29\u5217\u8868\u548c\u8df3\u8868\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737371705",src:r(79112).A+"",width:"616",height:"352"}),"\r\n\u5f53\u4fdd\u5b58\u7684\u5143\u7d20\u6570\u91cf\u5c11\u4e8e 128 \u4e2a\uff0c\u4e14\u4fdd\u5b58\u7684\u6240\u6709\u5143\u7d20\u5927\u5c0f\u90fd\u5c0f\u4e8e 64 \u5b57\u8282\u65f6\uff0cRedis \u4f1a\u91c7\u7528\u538b\u7f29\u5217\u8868\u7684\u7f16\u7801\u65b9\u5f0f\uff1b\u5426\u5219\u5c31\u7528\u8df3\u8868\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u7136\uff0c\u8fd9\u4e24\u4e2a\u6761\u4ef6\u90fd\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u8fdb\u884c\u8c03\u6574\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u9009\u62e9\u538b\u7f29\u5217\u8868\u4f5c\u4e3a\u5e95\u5c42\u5b9e\u73b0\u65f6\uff0c\u6bcf\u4e2a\u5143\u7d20\u4f1a\u4f7f\u7528\u4e24\u4e2a\u7d27\u6328\u5728\u4e00\u8d77\u7684\u8282\u70b9\u6765\u4fdd\u5b58\uff1a\u7b2c\u4e00\u4e2a\u8282\u70b9\u4fdd\u5b58\u5143\u7d20\u7684\u6210\u5458\uff0c\u7b2c\u4e8c\u4e2a\u8282\u70b9\u4fdd\u5b58\u5143\u7d20\u7684\u5206\u503c\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737423334",src:r(22814).A+"",width:"669",height:"240"}),"\r\n\u6240\u6709\u5143\u7d20\u6309\u5206\u503c\u4ece\u5c0f\u5230\u5927\u6709\u5e8f\u6392\u5217\uff0c\u5c0f\u7684\u653e\u5728\u9760\u8fd1\u8868\u5934\u7684\u4f4d\u7f6e\uff0c\u5927\u7684\u653e\u5728\u9760\u8fd1\u8868\u5c3e\u7684\u4f4d\u7f6e\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u4f46\u8df3\u8868\u7684\u7f3a\u70b9\u662f\u67e5\u627e\u53ea\u80fd\u6309\u987a\u5e8f\u8fdb\u884c\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(N)\uff0c\u800c\u4e14\u5728\u6700\u574f\u7684\u60c5\u51b5\u4e0b\uff0c\u63d2\u5165\u548c\u5220\u9664\u64cd\u4f5c\u8fd8\u53ef\u80fd\u4f1a\u5f15\u8d77\u8fde\u9501\u66f4\u65b0\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u5143\u7d20\u6570\u91cf\u8f83\u591a\u6216\u5143\u7d20\u8f83\u5927\u65f6\uff0cRedis \u4f1a\u4f7f\u7528 skiplist \u7684\u7f16\u7801\u65b9\u5f0f\uff1b\u8fd9\u4e2a\u8bbe\u8ba1\u975e\u5e38\u7684\u5de7\u5999\uff0c\u540c\u65f6\u4f7f\u7528\u4e86\u4e24\u79cd\u6570\u636e\u7ed3\u6784\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"typedef struct zset {\r\n    zskiplist *zsl;  // \u8df3\u8dc3\u8868\r\n    dict *dict;      // \u5b57\u5178\r\n} zset;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u8df3\u8868\u6309\u5206\u6570\u6709\u5e8f\u4fdd\u5b58\u6240\u6709\u5143\u7d20\uff0c\u4e14\u652f\u6301\u8303\u56f4\u67e5\u8be2\uff08\u5982 ZRANGE\u3001ZRANGEBYSCORE\uff09\uff0c\u5e73\u5747\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(log N)\u3002\u800c\u54c8\u5e0c\u8868\u5219\u7528\u6765\u5b58\u50a8\u6210\u5458\u548c\u5206\u503c\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u67e5\u627e\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737460637",src:r(68297).A+"",width:"1031",height:"741"}),"\r\n\u867d\u7136\u540c\u65f6\u4f7f\u7528\u4e24\u79cd\u7ed3\u6784\uff0c\u4f46\u5b83\u4eec\u4f1a\u901a\u8fc7\u6307\u9488\u6765\u5171\u4eab\u76f8\u540c\u5143\u7d20\u7684\u6210\u5458\u548c\u5206\u503c\uff0c\u56e0\u6b64\u4e0d\u4f1a\u6d6a\u8d39\u989d\u5916\u7684\u5185\u5b58"]}),"\n",(0,i.jsx)(n.h3,{id:"\u4f60\u77e5\u9053\u4e3a\u4ec0\u4e48redis-70\u8981\u7528listpack\u6765\u66ff\u4ee3ziplist\u5417",children:"\u4f60\u77e5\u9053\u4e3a\u4ec0\u4e48Redis 7.0\u8981\u7528listpack\u6765\u66ff\u4ee3ziplist\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u7b54\uff1a\u4e3b\u8981\u662f\u4e3a\u4e86\u89e3\u51b3\u538b\u7f29\u5217\u8868\u7684\u4e00\u4e2a\u6838\u5fc3\u95ee\u9898\u2014\u2014\u8fde\u9501\u66f4\u65b0\u3002\u5728\u538b\u7f29\u5217\u8868\u4e2d\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u9700\u8981\u8bb0\u5f55\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u4fe1\u606f\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737494710",src:r(61042).A+"",width:"1200",height:"581"}),'\r\n\u5f53\u63d2\u5165\u6216\u5220\u9664\u4e00\u4e2a\u8282\u70b9\u65f6\uff0c\u5982\u679c\u8fd9\u4e2a\u64cd\u4f5c\u5bfc\u81f4\u67d0\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u90a3\u4e48\u540e\u7eed\u7684\u8282\u70b9\u53ef\u80fd\u90fd\u9700\u8981\u66f4\u65b0\u5b83\u4eec\u5b58\u50a8\u7684"\u524d\u4e00\u4e2a\u8282\u70b9\u957f\u5ea6"\u5b57\u6bb5\u3002\u6700\u574f\u7684\u60c5\u51b5\u4e0b\uff0c\u4e00\u6b21\u64cd\u4f5c\u53ef\u80fd\u89e6\u53d1\u6574\u4e2a\u94fe\u8868\u7684\u66f4\u65b0\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4f1a\u4ece O(1)\u9000\u5316\u5230 O(n\xb2)\u3002']}),"\n",(0,i.jsxs)(n.p,{children:["\u800c listpack \u7684\u8bbe\u8ba1\u7406\u5ff5\u5b8c\u5168\u4e0d\u540c\u3002\u5b83\u8ba9\u6bcf\u4e2a\u8282\u70b9\u53ea\u8bb0\u5f55\u81ea\u5df1\u7684\u957f\u5ea6\u4fe1\u606f\uff0c\u4e0d\u518d\u4f9d\u8d56\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u3002\u8fd9\u6837\u5c31\u4ece\u6839\u672c\u4e0a\u907f\u514d\u4e86\u8fde\u9501\u66f4\u65b0\u7684\u95ee\u9898\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737539886",src:r(16234).A+"",width:"2000",height:"562"}),"\r\nlistpack \u4e2d\u7684\u8282\u70b9\u4e0d\u518d\u4fdd\u5b58\u5176\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\uff0c\u800c\u662f\u4fdd\u5b58\u5f53\u524d\u8282\u70b9\u7684\u7f16\u7801\u7c7b\u578b\u3001\u6570\u636e\u548c\u957f\u5ea6\u3002"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"1756737550793",src:r(76034).A+"",width:"2000",height:"786"})}),"\n",(0,i.jsx)(n.h3,{id:"\u8fde\u9501\u66f4\u65b0\u662f\u600e\u4e48\u53d1\u751f\u7684",children:"\u8fde\u9501\u66f4\u65b0\u662f\u600e\u4e48\u53d1\u751f\u7684\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u6bd4\u5982\u8bf4\u6211\u4eec\u6709\u4e00\u4e2a\u538b\u7f29\u5217\u8868\uff0c\u5176\u4e2d\u6709\u51e0\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u90fd\u662f 253 \u4e2a\u5b57\u8282\u3002\u5728 ziplist \u7684\u7f16\u7801\u4e2d\uff0c\u5982\u679c\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u5c0f\u4e8e 254 \u5b57\u8282\uff0c\u6211\u4eec\u53ea\u9700\u8981 1 \u4e2a\u5b57\u8282\u6765\u5b58\u50a8\u8fd9\u4e2a\u957f\u5ea6\u4fe1\u606f\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756737573634",src:r(23317).A+"",width:"1280",height:"797"}),"\r\n\u4f46\u5982\u679c\u5728\u8fd9\u4e9b\u8282\u70b9\u524d\u9762\u63d2\u5165\u4e00\u4e2a\u957f\u5ea6\u4e3a 254 \u5b57\u8282\u7684\u8282\u70b9\uff0c\u90a3\u4e48\u539f\u6765\u53ea\u9700\u8981 1 \u4e2a\u5b57\u8282\u5b58\u50a8\u957f\u5ea6\u7684\u8282\u70b9\u73b0\u5728\u9700\u8981 5 \u4e2a\u5b57\u8282\u6765\u5b58\u50a8\u957f\u5ea6\u4fe1\u606f\u3002\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u540e\u7eed\u6240\u6709\u8282\u70b9\u7684\u957f\u5ea6\u4fe1\u606f\u90fd\u9700\u8981\u66f4\u65b0\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"redis-\u4e3a\u4ec0\u4e48\u4e0d\u7528-c-\u8bed\u8a00\u7684\u539f\u751f\u5b57\u7b26\u4e32",children:"Redis \u4e3a\u4ec0\u4e48\u4e0d\u7528 C \u8bed\u8a00\u7684\u539f\u751f\u5b57\u7b26\u4e32\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c\u4e00\uff0cC \u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u5176\u5b9e\u5c31\u662f\u5b57\u7b26\u6570\u7ec4\uff0c\u4ee5 \\0 \u7ed3\u5c3e\uff0c\u8fd9\u610f\u5473\u7740\u5982\u679c\u6570\u636e\u672c\u8eab\u5305\u542b \\0 \u5b57\u8282\uff0c\u5c31\u4f1a\u88ab\u8bef\u8ba4\u4e3a\u5b57\u7b26\u4e32\u7ed3\u675f\u3002\u4f46 Redis \u9700\u8981\u5b58\u50a8\u5404\u79cd\u7c7b\u578b\u7684\u6570\u636e\uff0c\u5305\u62ec\u56fe\u7247\u3001\u5e8f\u5217\u5316\u5bf9\u8c61\u7b49\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u4e2d\u5f88\u53ef\u80fd\u5305\u542b \\0\u3002",(0,i.jsx)(n.br,{}),"\n","\u7b2c\u4e8c\uff0c\u5982\u679c\u9700\u8981\u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\uff0cC \u8bed\u8a00\u53ea\u80fd\u8c03\u7528 strlen() \u51fd\u6570\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(N)\uff0c\u56e0\u4e3a\u8981\u904d\u5386\u6574\u4e2a\u5b57\u7b26\u4e32\u76f4\u5230\u9047\u5230 \\0\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e09\uff0cC \u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u4e0d\u4f1a\u81ea\u52a8\u68c0\u67e5\u8fb9\u754c\uff0c\u5982\u679c\u5f80\u4e00\u4e2a\u5b57\u7b26\u6570\u7ec4\u91cc\u5199\u5165\u8d85\u8fc7\u5176\u5bb9\u91cf\u7684\u6570\u636e\uff0c\u5c31\u4f1a\u51fa\u73b0\u7f13\u51b2\u533a\u6ea2\u51fa\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u56db\uff0cC \u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u4e0d\u652f\u6301\u52a8\u6001\u6269\u5bb9\uff0c\u5982\u679c\u9700\u8981\u4fee\u6539\u5185\u5bb9\uff0c\u5c31\u5fc5\u987b\u91cd\u65b0\u5206\u914d\u5185\u5b58\u5e76\u590d\u5236\u6570\u636e\uff0c\u5f00\u9500\u5f88\u5927\u3002"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u8bbe\u8ba1\u7684 SDS \u5b8c\u7f8e\u89e3\u51b3\u4e86\u8fd9\u4e9b\u95ee\u9898\uff0c\u83b7\u53d6\u957f\u5ea6\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 len \u5b57\u6bb5\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\uff1bfree \u5b57\u6bb5\u4f1a\u8bb0\u5f55\u5269\u4f59\u7a7a\u95f4\uff0c\u56e0\u6b64 Redis \u53ef\u4ee5\u6839\u636e\u9884\u5206\u914d\u7b56\u7565\u52a8\u6001\u6269\u5bb9\uff0c\u4e0d\u7528\u5728\u8ffd\u52a0\u6570\u636e\u65f6\u91cd\u65b0\u5206\u914d\u5185\u5b58\uff1b\u5e76\u4e14\u4e0d\u4f9d\u8d56\u4e8e \\0 \u7ed3\u5c3e\uff0c\u53ef\u4ee5\u5b58\u50a8\u4efb\u610f\u4e8c\u8fdb\u5236\u6570\u636e\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u4f60\u7814\u7a76\u8fc7-redis-\u7684\u5b57\u5178\u6e90\u7801\u5417",children:"\u4f60\u7814\u7a76\u8fc7 Redis \u7684\u5b57\u5178\u6e90\u7801\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u662f\u7684\uff0c\u6709\u7814\u7a76\u8fc7\u3002Redis \u7684\u5b57\u5178\u5206\u4e3a\u4e09\u5c42\uff0c\u6700\u5916\u5c42\u662f\u4e00\u4e2a dict \u7ed3\u6784\uff0c\u5305\u542b\u4e24\u4e2a\u54c8\u5e0c\u8868 ht[0] \u548c ht[1]\uff0c\u7528\u4e8e\u5b58\u50a8\u952e\u503c\u5bf9\u3002\u6bcf\u4e2a\u54c8\u5e0c\u8868\u7531\u4e00\u4e2a\u6570\u7ec4\u548c\u94fe\u8868\u7ec4\u6210\uff0c\u6570\u7ec4\u7528\u4e8e\u5feb\u901f\u5b9a\u4f4d\uff0c\u94fe\u8868\u7528\u4e8e\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756741114121",src:r(68772).A+"",width:"1179",height:"581"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"// \u6700\u5916\u5c42\u7684\u5b57\u5178\u7ed3\u6784\r\ntypedef struct dict {\r\n    dictht ht[2];       // \u4e24\u4e2a\u54c8\u5e0c\u8868\uff01\u8fd9\u662f\u5173\u952e\r\n    long rehashidx;     // rehash\u7d22\u5f15\uff0c-1\u8868\u793a\u6ca1\u6709\u8fdb\u884crehash\r\n    // ...\r\n} dict;\r\n\r\n// \u54c8\u5e0c\u8868\u7ed3\u6784\r\ntypedef struct dictht {\r\n    dictEntry **table;  // \u54c8\u5e0c\u8868\u6570\u7ec4\r\n    unsigned long size; // \u54c8\u5e0c\u8868\u5927\u5c0f\r\n    unsigned long sizemask; // \u54c8\u5e0c\u8868\u5927\u5c0f\u63a9\u7801\uff0c\u7528\u4e8e\u8ba1\u7b97\u7d22\u5f15\u503c\r\n    unsigned long used; // \u8be5\u54c8\u5e0c\u8868\u5df2\u6709\u8282\u70b9\u7684\u6570\u91cf\r\n} dictht;\r\n\r\n// \u54c8\u5e0c\u8868\u8282\u70b9\r\ntypedef struct dictEntry {\r\n    void *key;              // \u952e\r\n    v;                 // \u503c\r\n    struct dictEntry *next; // \u6307\u5411\u4e0b\u4e2a\u54c8\u5e0c\u8868\u8282\u70b9\uff0c\u5f62\u6210\u94fe\u8868\r\n} dictEntry;\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5b57\u5178\u6700\u6838\u5fc3\u7684\u7279\u70b9\u662f\u6e10\u8fdb\u5f0f rehash\uff0c\u8fd9\u662f\u6211\u89c9\u5f97\u6700\u7cbe\u5f69\u7684\u90e8\u5206\u3002\u4f20\u7edf\u7684\u54c8\u5e0c\u8868\u6269\u5bb9\u90fd\u662f\u4e00\u6b21\u6027\u5b8c\u6210\u7684\uff0c\u4f46 Redis \u4e0d\u662f\u8fd9\u6837\u7684\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u8d1f\u8f7d\u56e0\u5b50\u89e6\u53d1 rehash \u6761\u4ef6\u65f6\uff0cRedis \u4f1a\u4e3a\u54c8\u5e0c\u88681 \u5206\u914d\u65b0\u7684\u7a7a\u95f4\uff0c\u901a\u5e38\u662f\u54c8\u5e0c\u8868 0 \u7684\u4e24\u500d\u5927\u5c0f\uff0c\u7136\u540e\u5c06 rehashidx \u8bbe\u7f6e\u4e3a 0\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u63a5\u4e0b\u6765\u7684\u5173\u952e\u662f\uff0cRedis \u4e0d\u4f1a\u4e00\u6b21\u6027\u628a\u6240\u6709\u6570\u636e\u4ece\u54c8\u5e0c\u88680 \u8fc1\u79fb\u5230\u54c8\u5e0c\u88681\uff0c\u800c\u662f\u6bcf\u6b21\u64cd\u4f5c\u5b57\u5178\u65f6\uff0c\u987a\u4fbf\u8fc1\u79fb\u54c8\u5e0c\u88680 \u4e2d rehashidx \u4f4d\u7f6e\u4e0a\u7684\u6240\u6709\u952e\u503c\u5bf9\u3002\u8fc1\u79fb\u5b8c\u4e00\u4e2a\u69fd\u4f4d\u540e\uff0crehashidx \u9012\u589e\uff0c\u76f4\u5230\u6574\u4e2a\u54c8\u5e0c\u88680 \u8fc1\u79fb\u5b8c\u6bd5\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756741159057",src:r(88441).A+"",width:"3378",height:"2989"}),"\r\n\u8fd9\u79cd\u8bbe\u8ba1\u7684\u5de7\u5999\u4e4b\u5904\u5728\u4e8e\u628a rehash \u7684\u5f00\u9500\u5206\u644a\u5230\u4e86\u6bcf\u6b21\u64cd\u4f5c\u4e2d\u3002\u5047\u8bbe\u6709\u4e00\u4e2a\u51e0\u767e\u4e07\u952e\u7684\u54c8\u5e0c\u8868\uff0c\u5982\u679c\u4e00\u6b21\u6027 rehash \u53ef\u80fd\u9700\u8981\u51e0\u767e\u6beb\u79d2\uff0c\u8fd9\u5bf9\u5355\u7ebf\u7a0b\u7684 Redis \u6765\u8bf4\u662f\u707e\u96be\u6027\u7684\u3002\u4f46\u901a\u8fc7\u6e10\u8fdb\u5f0f rehash\uff0c\u6bcf\u6b21\u64cd\u4f5c\u53ea\u589e\u52a0\u5f88\u5c11\u7684\u989d\u5916\u5f00\u9500\uff0c\u7528\u6237\u57fa\u672c\u611f\u89c9\u4e0d\u5230\u5ef6\u8fdf\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u5728 rehash \u671f\u95f4\uff0c\u67e5\u627e\u64cd\u4f5c\u4f1a\u5148\u67e5 \u54c8\u5e0c\u8868 0\uff0c\u6ca1\u627e\u5230\u518d\u67e5\u54c8\u5e0c\u8868 1\uff1b\u4f46\u662f\u65b0\u63d2\u5165\u7684\u6570\u636e\u53ea\u4f1a\u653e\u5230\u54c8\u5e0c\u8868 1 \u4e2d\u3002\u8fd9\u6837\u65e2\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u7684\u5b8c\u6574\u6027\uff0c\u53c8\u80fd\u907f\u514d\u6570\u636e\u7684\u91cd\u590d\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u9047\u5230\u54c8\u5e0c\u51b2\u7a81\u600e\u4e48\u529e",children:"\u9047\u5230\u54c8\u5e0c\u51b2\u7a81\u600e\u4e48\u529e\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["Redis \u662f\u901a\u8fc7\u94fe\u5730\u5740\u6cd5\u6765\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u7684\uff0c\u6bcf\u4e2a\u54c8\u5e0c\u8868\u7684\u69fd\u4f4d\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u94fe\u8868\u7684\u5934\u6307\u9488\uff0c\u5f53\u591a\u4e2a\u952e\u7684\u54c8\u5e0c\u503c\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u69fd\u4f4d\u65f6\uff0c\u8fd9\u4e9b\u952e\u4f1a\u4ee5\u94fe\u8868\u7684\u5f62\u5f0f\u4e32\u8054\u8d77\u6765\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756741208371",src:r(3581).A+"",width:"789",height:"329"}),"\r\n\u5177\u4f53\u5b9e\u73b0\u4e0a\uff0cRedis \u4f1a\u901a\u8fc7\u54c8\u5e0c\u8868\u8282\u70b9\u7684 next \u6307\u9488\uff0c\u6307\u5411\u4e0b\u4e00\u4e2a\u5177\u6709\u76f8\u540c\u54c8\u5e0c\u503c\u7684\u8282\u70b9\u3002\u5f53\u53d1\u751f\u51b2\u7a81\u65f6\uff0c\u65b0\u7684\u952e\u503c\u5bf9\u4f1a\u63d2\u5165\u5230\u94fe\u8868\u7684\u5934\u90e8\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(1)\u3002\u67e5\u627e\u65f6\u9700\u8981\u904d\u5386\u6574\u4e2a\u94fe\u8868\uff0c\u6700\u574f\u7684\u60c5\u51b5\u4e0b\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(n)\uff0c\u4f46\u901a\u5e38\u94fe\u8868\u90fd\u6bd4\u8f83\u77ed\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u53e6\u5916\uff0cRedis \u8bbe\u8ba1\u7684\u54c8\u5e0c\u51fd\u6570\u5728\u5206\u5e03\u4e0a\u4e5f\u6bd4\u8f83\u5747\u5300\uff0c\u80fd\u591f\u6709\u6548\u51cf\u5c11\u54c8\u5e0c\u51b2\u7a81\u7684\u53d1\u751f\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"/* MurmurHash2, by Austin Appleby\r\n * Note - This code makes a few assumptions about how your machine behaves -\r\n * 1. We can read a 4-byte value from any address without crashing\r\n * 2. sizeof(int) == 4\r\n *\r\n * And it has a few limitations -\r\n *\r\n * 1. It will not work incrementally.\r\n * 2. It will not produce the same results on little-endian and big-endian\r\n *    machines.\r\n */\r\nunsigned int dictGenHashFunction(const void *key, int len) {\r\n    /* 'm' and 'r' are mixing constants generated offline.\r\n       They're not really 'magic', they just happen to work well.  */\r\n    uint32_t seed = dict_hash_function_seed;\r\n    const uint32_t m = 0x5bd1e995;\r\n    const int r = 24;\r\n\r\n    /* Initialize the hash to a 'random' value */\r\n    uint32_t h = seed ^ len;\r\n\r\n    /* Mix 4 bytes at a time into the hash */\r\n    const unsigned char *data = (const unsigned char *)key;\r\n\r\n    while(len >= 4) {\r\n        uint32_t k = *(uint32_t*)data;\r\n\r\n        k *= m;\r\n        k ^= k >> r;\r\n        k *= m;\r\n\r\n        h *= m;\r\n        h ^= k;\r\n\r\n        data += 4;\r\n        len -= 4;\r\n    }\r\n\r\n    /* Handle the last few bytes of the input array  */\r\n    switch(len) {\r\n    case 3: h ^= data[2] << 16;\r\n    case 2: h ^= data[1] << 8;\r\n    case 1: h ^= data[0]; h *= m;\r\n    };\r\n\r\n    /* Do a few final mixes of the hash to ensure the last few\r\n       * bytes are well-incorporated. */\r\n    h ^= h >> 13;\r\n    h *= m;\r\n    h ^= h >> 15;\r\n\r\n    return (unsigned int)h;\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u4f60\u4e86\u89e3\u8df3\u8868\u5417",children:"\ud83c\udf1f\u4f60\u4e86\u89e3\u8df3\u8868\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u8df3\u8868\u662f\u4e00\u79cd\u975e\u5e38\u5de7\u5999\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u5728\u6709\u5e8f\u94fe\u8868\u7684\u57fa\u7840\u4e0a\u5efa\u7acb\u4e86\u591a\u5c42\u7d22\u5f15\uff0c\u6700\u5e95\u5c42\u5305\u542b\u6240\u6709\u6570\u636e\uff0c\u6bcf\u5f80\u4e0a\u4e00\u5c42\uff0c\u8282\u70b9\u6570\u91cf\u5c31\u51cf\u5c11\u4e00\u534a\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756741244328",src:r(8635).A+"",width:"927",height:"148"}),'\r\n\u5b83\u7684\u6838\u5fc3\u601d\u60f3\u662f"\u7528\u7a7a\u95f4\u6362\u65f6\u95f4"\uff0c\u901a\u8fc7\u591a\u5c42\u7d22\u5f15\u6765\u8df3\u8fc7\u5927\u91cf\u8282\u70b9\uff0c\u4ece\u800c\u63d0\u9ad8\u67e5\u627e\u6548\u7387\u3002']}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"1756741261042",src:r(79757).A+"",width:"1122",height:"457"}),"\r\n\u6bcf\u4e2a\u8282\u70b9\u6709 50% \u7684\u6982\u7387\u53ea\u5728\u7b2c 1 \u5c42\u51fa\u73b0\uff0c25% \u7684\u6982\u7387\u5728\u7b2c 2 \u5c42\u51fa\u73b0\uff0c\u4f9d\u6b64\u7c7b\u63a8\u3002\u67e5\u627e\u7684\u65f6\u5019\u4ece\u6700\u9ad8\u5c42\u5f00\u59cb\u6c34\u5e73\u79fb\u52a8\uff0c\u5f53\u4e0b\u4e00\u4e2a\u8282\u70b9\u503c\u5927\u4e8e\u76ee\u6807\u65f6\uff0c\u5c31\u5411\u4e0b\u8df3\u4e00\u5c42\uff0c\u76f4\u5230\u627e\u5230\u76ee\u6807\u8282\u70b9\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756741300958",src:r(65527).A+"",width:"1432",height:"754"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u600e\u4e48\u5f80\u8df3\u8868\u63d2\u5165\u8282\u70b9\u5462",children:"\u600e\u4e48\u5f80\u8df3\u8868\u63d2\u5165\u8282\u70b9\u5462\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u9996\u5148\u662f\u627e\u5230\u63d2\u5165\u4f4d\u7f6e\uff0c\u4ece\u6700\u9ad8\u5c42\u7684\u5934\u8282\u70b9\u5f00\u59cb\uff0c\u5728\u6bcf\u4e00\u5c42\u90fd\u627e\u5230\u5e94\u8be5\u63d2\u5165\u4f4d\u7f6e\u7684\u524d\u9a71\u8282\u70b9\uff0c\u7528\u4e00\u4e2a update \u6570\u7ec4\u628a\u8fd9\u4e9b\u524d\u9a71\u8282\u70b9\u8bb0\u5f55\u4e0b\u6765\u3002\u8fd9\u4e2a\u67e5\u627e\u8fc7\u7a0b\u548c\u666e\u901a\u67e5\u627e\u4e00\u6837\uff0c\u5728\u6bcf\u5c42\u5411\u53f3\u79fb\u52a8\u76f4\u5230\u4e0b\u4e2a\u8282\u70b9\u7684\u503c\u5927\u4e8e\u8981\u63d2\u5165\u7684\u503c\uff0c\u7136\u540e\u4e0b\u964d\u5230\u4e0b\u4e00\u5c42\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"// \u8bb0\u5f55\u6bcf\u5c42\u7684\u63d2\u5165\u4f4d\u7f6e\r\nzskiplistNode *update[ZSKIPLIST_MAXLEVEL];\r\nzskiplistNode *x;\r\nint i, level;\r\n\r\n// \u4ece\u6700\u9ad8\u5c42\u5f00\u59cb\u67e5\u627e\r\nx = zsl->header;\r\nfor (i = zsl->level-1; i >= 0; i--) {\r\n    // \u5728\u5f53\u524d\u5c42\u6c34\u5e73\u79fb\u52a8\uff0c\u627e\u5230\u63d2\u5165\u4f4d\u7f6e\r\n    while (x->level[i].forward &&\r\n           (x->level[i].forward->score < score ||\r\n            (x->level[i].forward->score == score &&\r\n             sdscmp(x->level[i].forward->ele, ele) < 0)))\r\n    {\r\n        x = x->level[i].forward;\r\n    }\r\n    update[i] = x;  // \u8bb0\u5f55\u6bcf\u5c42\u7684\u524d\u9a71\u8282\u70b9\r\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\u968f\u673a\u751f\u6210\u65b0\u8282\u70b9\u7684\u5c42\u6570\u3002\u901a\u5e38\u7528\u4e00\u4e2a\u5faa\u73af\uff0c\u6bcf\u6b21\u6709 50% \u7684\u6982\u7387\u7ee7\u7eed\u5f80\u4e0a\uff0c\u76f4\u5230\u968f\u673a\u5931\u8d25\u6216\u8fbe\u5230\u6700\u5927\u5c42\u6570\u9650\u5236\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"// Redis \u4e2d\u7684\u968f\u673a\u5c42\u6570\u751f\u6210\r\nint zslRandomLevel(void) {\r\n    int level = 1;\r\n    while ((random()&0xFFFF) < (ZSKIPLIST_P * 0xFFFF))\r\n        level += 1;\r\n    return (level < ZSKIPLIST_MAXLEVEL) ? level : ZSKIPLIST_MAXLEVEL;\r\n}\r\n\r\n// \u751f\u6210\u65b0\u8282\u70b9\u7684\u5c42\u6570\r\nlevel = zslRandomLevel();\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u521b\u5efa\u65b0\u8282\u70b9\u540e\uff0c\u4ece\u5e95\u5c42\u5f00\u59cb\u5230\u65b0\u8282\u70b9\u7684\u6700\u9ad8\u5c42\uff0c\u5728\u6bcf\u4e00\u5c42\u90fd\u8fdb\u884c\u6807\u51c6\u7684\u94fe\u8868\u63d2\u5165\u64cd\u4f5c\u3002\u8fd9\u4e00\u6b65\u8981\u5229\u7528\u4e4b\u524d\u8bb0\u5f55\u7684 update \u6570\u7ec4\uff0c\u5c06\u65b0\u8282\u70b9\u63d2\u5165\u5230\u6b63\u786e\u4f4d\u7f6e\uff0c\u7136\u540e\u66f4\u65b0\u524d\u540e\u6307\u9488\u7684\u8fde\u63a5\u5173\u7cfb\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"// \u66f4\u65b0\u524d\u8fdb\u6307\u9488\r\nfor (i = 0; i < level; i++) {\r\n    x->level[i].forward = update[i]->level[i].forward;\r\n    update[i]->level[i].forward = x;\r\n    \r\n    // \u66f4\u65b0\u8de8\u5ea6\u4fe1\u606f\r\n    x->level[i].span = update[i]->level[i].span - (rank[0] - rank[i]);\r\n    update[i]->level[i].span = (rank[0] - rank[i]) + 1;\r\n}\r\n\r\n// \u66f4\u65b0\u672a\u6d89\u53ca\u5c42\u7684\u8de8\u5ea6\r\nfor (i = level; i < zsl->level; i++) {\r\n    update[i]->level[i].span++;\r\n}\r\n\r\n// \u66f4\u65b0\u540e\u9000\u6307\u9488\r\nx->backward = (update[0] == zsl->header) ? NULL : update[0];\r\nif (x->level[0].forward)\r\n    x->level[0].forward->backward = x;\r\nelse\r\n    zsl->tail = x;\r\n\r\n// \u66f4\u65b0\u8df3\u8868\u957f\u5ea6\r\nzsl->length++;\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6211\u4eec\u6765\u6a21\u62df\u4e00\u4e2a\u8df3\u8868\u7684\u63d2\u5165\u8fc7\u7a0b\uff0c\u5047\u8bbe\u63d2\u5165\u7684\u6570\u636e\u4f9d\u6b21\u662f 22\u300119\u30017\u30013\u300137\u300111\u300126\u3002"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"1756741370982",src:r(16749).A+"",width:"1141",height:"1338"}),"\r\n\u90a3\u5047\u5982\u6211\u4eec\u5728\u4e00\u4e2a\u5df2\u7ecf\u5206\u5e03\u4e86 1\u300114\u300127\u300131\u300144\u300156\u300163\u300170\u300180\u300191 \u7684\u8df3\u8868\u4e2d\u63d2\u5165\u4e00\u4e2a 67 \u7684\u8282\u70b9\uff0c\u63d2\u5165\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff1a"]}),"\n",(0,i.jsx)(n.h3,{id:"zset\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u8df3\u8868\u5462",children:"zset\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u8df3\u8868\u5462\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e00\uff0c\u8df3\u8868\u5929\u7136\u5c31\u662f\u6709\u5e8f\u7684\u6570\u636e\u7ed3\u6784\uff0c\u67e5\u627e\u3001\u63d2\u5165\u548c\u5220\u9664\u90fd\u80fd\u4fdd\u6301 O(log n) \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e8c\uff0c\u8df3\u8868\u652f\u6301\u8303\u56f4\u67e5\u8be2\uff0c\u627e\u5230\u8d77\u59cb\u4f4d\u7f6e\u540e\u53ef\u4ee5\u76f4\u63a5\u6cbf\u7740\u5e95\u5c42\u94fe\u8868\u987a\u5e8f\u904d\u5386\uff0c\u6ee1\u8db3 ZRANGE \u6309\u6392\u540d\u83b7\u53d6\u5143\u7d20\uff0c\u6216\u8005 ZRANGEBYSCORE \u6309\u5206\u503c\u8303\u56f4\u83b7\u53d6\u5143\u7d20\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"\u8df3\u8868\u662f\u5982\u4f55\u5b9a\u4e49\u7684\u5462",children:"\u8df3\u8868\u662f\u5982\u4f55\u5b9a\u4e49\u7684\u5462\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u8df3\u8868\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u591a\u5c42\u94fe\u8868\uff0c\u5e95\u5c42\u662f\u4e00\u4e2a\u5305\u542b\u6240\u6709\u5143\u7d20\u7684\u6709\u5e8f\u94fe\u8868\uff0c\u4e0a\u4e00\u5c42\u4f5c\u4e3a\u7d22\u5f15\u5c42\uff0c\u5305\u542b\u4e86\u4e0b\u4e00\u5c42\u7684\u90e8\u5206\u8282\u70b9\uff1b\u5c42\u6570\u901a\u8fc7\u968f\u673a\u7b97\u6cd5\u786e\u5b9a\uff0c\u7406\u8bba\u4e0a\u53ef\u4ee5\u65e0\u9650\u9ad8\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756741424469",src:r(29565).A+"",width:"1502",height:"643"}),"\r\n\u8df3\u8868\u8282\u70b9\u5305\u542b\u5206\u503c score\u3001\u6210\u5458\u5bf9\u8c61 obj\u3001\u4e00\u4e2a\u540e\u9000\u6307\u9488 backward\uff0c\u4ee5\u53ca\u4e00\u4e2a\u5c42\u7ea7\u6570\u7ec4 level\u3002\u6bcf\u4e2a\u5c42\u7ea7\u5305\u542b forward \u524d\u8fdb\u6307\u9488\u548c span \u8de8\u5ea6\u4fe1\u606f\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"typedef struct skiplistNode {\r\n    double score;                    // \u5206\u503c\uff08\u7528\u4e8e\u6392\u5e8f\uff09\r\n    robj *obj;                      // \u6570\u636e\u5bf9\u8c61\r\n    struct skiplistNode *backward;   // \u540e\u9000\u6307\u9488\r\n    struct skiplistLevel {\r\n        struct skiplistNode *forward; // \u524d\u8fdb\u6307\u9488\r\n        unsigned int span;           // \u8de8\u5ea6\uff08\u5230\u4e0b\u4e2a\u8282\u70b9\u7684\u8ddd\u79bb\uff09\r\n    } level[];                      // \u5c42\u7ea7\u6570\u7ec4\r\n} skiplistNode;\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8df3\u8868\u672c\u8eab\u5305\u542b\u5934\u5c3e\u8282\u70b9\u6307\u9488\u3001\u8282\u70b9\u603b\u6570 length \u548c\u5f53\u524d\u6700\u5927\u5c42\u6570 level\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"typedef struct skiplist {\r\n    struct skiplistNode *header, *tail; // \u5934\u5c3e\u8282\u70b9\r\n    unsigned long length;               // \u8282\u70b9\u6570\u91cf\r\n    int level;                         // \u6700\u5927\u5c42\u6570\r\n} skiplist;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"span-\u8de8\u5ea6\u6709\u4ec0\u4e48\u7528",children:"span \u8de8\u5ea6\u6709\u4ec0\u4e48\u7528\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["span \u8bb0\u5f55\u4e86\u5f53\u524d\u8282\u70b9\u5230\u4e0b\u4e00\u8282\u70b9\u4e4b\u95f4\uff0c\u5e95\u5c42\u5230\u5e95\u8de8\u8d8a\u4e86\u51e0\u4e2a\u8282\u70b9\uff0c\u5b83\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u5feb\u901f\u627e\u5230 ZSet \u4e2d\u67d0\u4e2a\u5206\u503c\u7684\u6392\u540d\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756741736509",src:r(73916).A+"",width:"1430",height:"440"}),"\r\n\u6bd4\u5982\u8bf4\u6211\u4eec\u6267\u884c ZRANK \u547d\u4ee4\u65f6\uff0c\u5982\u679c\u6ca1\u6709 span\uff0c\u5c31\u9700\u8981\u4ece\u5934\u8282\u70b9\u5f00\u59cb\u904d\u5386\u6bcf\u4e2a\u8282\u70b9\uff0c\u76f4\u5230\u627e\u5230\u76ee\u6807\u5206\u503c\uff0c\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n)\u3002\r\n\u4f46\u6709\u4e86 span\uff0c\u6211\u4eec\u5728\u4ece\u9ad8\u5c42\u5f80\u4f4e\u5c42\u641c\u7d22\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u76f4\u63a5\u8df3\u8fc7\u4e00\u4e9b\u8282\u70b9\uff0c\u5feb\u901f\u5b9a\u4f4d\u5230\u76ee\u6807\u5206\u503c\u6240\u5728\u7684\u8303\u56f4\u3002\u8fd9\u6837\u5c31\u80fd\u628a\u65f6\u95f4\u590d\u6742\u5ea6\u964d\u5230 O(log n)\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:"long skiplistGetRank(skiplist *zsl, double score, robj *obj) {\r\n    skiplistNode *x = zsl->header;\r\n    unsigned long rank = 0;\r\n    \r\n    // \u4ece\u6700\u9ad8\u5c42\u5f00\u59cb\u67e5\u627e\r\n    for (int i = zsl->level - 1; i >= 0; i--) {\r\n        while (x->level[i].forward &&\r\n               (x->level[i].forward->score < score ||\r\n                (x->level[i].forward->score == score &&\r\n                 compareStringObjects(x->level[i].forward->obj, obj) < 0))) {\r\n            \r\n            rank += x->level[i].span;  // \u7d2f\u52a0\u8de8\u5ea6\r\n            x = x->level[i].forward;\r\n        }\r\n        \r\n        // \u627e\u5230\u76ee\u6807\u8282\u70b9\r\n        if (x->level[i].forward &&\r\n            x->level[i].forward->score == score &&\r\n            equalStringObjects(x->level[i].forward->obj, obj)) {\r\n            rank += x->level[i].span;\r\n            return rank;\r\n        }\r\n    }\r\n    \r\n    return 0;\r\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u4e3a\u4ec0\u4e48\u8df3\u8868\u7684\u8303\u56f4\u67e5\u8be2\u6548\u7387\u6bd4\u5b57\u5178\u9ad8",children:"\u4e3a\u4ec0\u4e48\u8df3\u8868\u7684\u8303\u56f4\u67e5\u8be2\u6548\u7387\u6bd4\u5b57\u5178\u9ad8\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["\u5b57\u5178\u662f\u901a\u8fc7\u54c8\u5e0c\u51fd\u6570\u5c06\u952e\u503c\u5bf9\u5206\u6563\u5b58\u50a8\u7684\uff0c\u5143\u7d20\u5728\u5185\u5b58\u4e2d\u662f\u65e0\u5e8f\u5206\u5e03\u7684\uff0c\u6ca1\u6709\u4efb\u4f55\u987a\u5e8f\u5173\u7cfb\u3002\u800c\u8df3\u8868\u672c\u8eab\u5c31\u662f\u6709\u5e8f\u7684\u6570\u636e\u7ed3\u6784\uff0c\u6240\u6709\u5143\u7d20\u6309\u7167\u5206\u503c\u4ece\u5c0f\u5230\u5927\u6392\u5217\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756741793308",src:r(45818).A+"",width:"1512",height:"468"}),"\r\n\u5f53\u9700\u8981\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u5b57\u5178\u5fc5\u987b\u904d\u5386\u6240\u6709\u5143\u7d20\uff0c\u9010\u4e2a\u68c0\u67e5\u6bcf\u4e2a\u5143\u7d20\u662f\u5426\u5728\u6307\u5b9a\u8303\u56f4\u5185\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n)\u3002\u6bd4\u5982\u8981\u627e\u5206\u503c\u5728 60 \u5230 80 \u4e4b\u95f4\u7684\u6240\u6709\u5143\u7d20\uff0c\u5b57\u5178\u53ea\u80fd\u628a\u6574\u4e2a\u54c8\u5e0c\u8868\u626b\u63cf\u4e00\u904d\uff0c\u56e0\u4e3a\u5b83\u65e0\u6cd5\u77e5\u9053\u7b26\u5408\u6761\u4ef6\u7684\u5143\u7d20\u5728\u54ea\u91cc\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u800c\u8df3\u8868\u7684\u8303\u56f4\u67e5\u8be2\u5c31\u9ad8\u6548\u591a\u4e86\u3002\u9996\u5148\u7528 O(log n) \u65f6\u95f4\u627e\u5230\u8303\u56f4\u7684\u8d77\u59cb\u4f4d\u7f6e\uff0c\u7136\u540e\u6cbf\u7740\u5e95\u5c42\u7684\u6709\u5e8f\u94fe\u8868\u987a\u5e8f\u904d\u5386\uff0c\u76f4\u5230\u8d85\u51fa\u8303\u56f4\u4e3a\u6b62\u3002\u603b\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(log n + k)\uff0c\u5176\u4e2d k \u662f\u7ed3\u679c\u96c6\u7684\u5927\u5c0f\u3002\u8fd9\u79cd\u6548\u7387\u5dee\u5f02\u5728\u6570\u636e\u91cf\u5927\u7684\u65f6\u5019\u975e\u5e38\u660e\u663e\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756741810158",src:r(9571).A+"",width:"1185",height:"723"}),"\r\n\u8fd9\u4e5f\u662f\u4e3a\u4ec0\u4e48 Redis \u7684 zset \u8981\u7528\u8df3\u8868\u800c\u4e0d\u662f\u7eaf\u54c8\u5e0c\u8868\u7684\u91cd\u8981\u539f\u56e0\uff0c\u56e0\u4e3a zset \u7ecf\u5e38\u9700\u8981 ZRANGE\u3001ZRANGEBYSCORE \u8fd9\u7c7b\u8303\u56f4\u64cd\u4f5c\u3002\u5b9e\u9645\u4e0a Redis \u7684 zset \u662f\u8df3\u8868\u548c\u54c8\u5e0c\u8868\u7684\u7ec4\u5408\uff1a\u8df3\u8868\u4fdd\u8bc1\u6709\u5e8f\u6027\u652f\u6301\u8303\u56f4\u67e5\u8be2\uff0c\u54c8\u5e0c\u8868\u4fdd\u8bc1 O(1) \u7684\u5355\u70b9\u67e5\u627e\u6548\u7387\uff0c\u4e24\u8005\u4e92\u8865\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u538b\u7f29\u5217\u8868\u4e86\u89e3\u5417",children:"\u538b\u7f29\u5217\u8868\u4e86\u89e3\u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u7b54\uff1a\u538b\u7f29\u5217\u8868\u662f Redis \u4e3a\u4e86\u8282\u7701\u5185\u5b58\u800c\u8bbe\u8ba1\u7684\u4e00\u79cd\u7d27\u51d1\u578b\u6570\u636e\u7ed3\u6784\uff0c\u5b83\u4f1a\u628a\u6240\u6709\u6570\u636e\u8fde\u7eed\u5b58\u50a8\u5728\u4e00\u5757\u5185\u5b58\u5f53\u4e2d\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u6574\u4e2a\u7ed3\u6784\u5305\u542b\u5934\u90e8\u4fe1\u606f\uff0c\u5982\u603b\u7684\u5b57\u8282\u6570\u3001\u5c3e\u90e8\u504f\u79fb\u91cf\u3001\u8282\u70b9\u6570\u91cf\uff0c\u4ee5\u53ca\u8fde\u7eed\u7684\u8282\u70b9\u6570\u636e\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756741838018",src:r(10084).A+"",width:"1097",height:"98"}),"\r\n\u5f53 list\u3001hash \u548c set \u7684\u6570\u636e\u91cf\u8f83\u5c0f\u4e14\u503c\u90fd\u4e0d\u5927\u65f6\uff0c\u5e95\u5c42\u4f1a\u4f7f\u7528\u538b\u7f29\u5217\u8868\u6765\u5b9e\u73b0\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u901a\u5e38\u60c5\u51b5\u5728\uff0c\u6bcf\u4e2a\u8282\u70b9\u5305\u542b\u4e09\u4e2a\u90e8\u5206\uff1a\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u3001\u7f16\u7801\u7c7b\u578b\u548c\u5b9e\u9645\u7684\u6570\u636e\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756741863693",src:r(24977).A+"",width:"1526",height:"482"}),"\r\n\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u662f\u4e3a\u4e86\u652f\u6301\u4ece\u540e\u5f80\u524d\u904d\u5386\uff1b\u5f53\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u5c0f\u4e8e 254 \u5b57\u8282\u65f6\uff0c\u4f7f\u7528 1 \u5b57\u8282\u5b58\u50a8\uff1b\u5426\u5219\u7528 5 \u5b57\u8282\u5b58\u50a8\uff0c\u7b2c\u4e00\u4e2a\u5b57\u8282\u8bbe\u7f6e\u4e3a 254\uff0c\u540e\u56db\u4e2a\u5b57\u8282\u5b58\u50a8\u5b9e\u9645\u957f\u5ea6\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"1756741886579",src:r(64147).A+"",width:"1706",height:"1330"}),"\r\n\u7f16\u7801\u7c7b\u578b\u4f1a\u6839\u636e\u6570\u636e\u7684\u5b9e\u9645\u60c5\u51b5\u9009\u62e9\u6700\u7d27\u51d1\u7684\u5b58\u50a8\u65b9\u5f0f\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"1756741899345",src:r(6576).A+"",width:"972",height:"177"}),"\r\n\u4f46\u538b\u7f29\u5217\u8868\u6709\u4e2a\u81f4\u547d\u95ee\u9898\uff0c\u5c31\u662f\u8fde\u9501\u66f4\u65b0\u3002\u5f53\u63d2\u5165\u6216\u5220\u9664\u8282\u70b9\u5bfc\u81f4\u67d0\u4e2a\u8282\u70b9\u957f\u5ea6\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u53ef\u80fd\u4f1a\u5f71\u54cd\u540e\u7eed\u6240\u6709\u8282\u70b9\u5b58\u50a8\u7684\u201c\u524d\u4e00\u4e2a\u8282\u70b9\u957f\u5ea6\u201d\u5b57\u6bb5\uff0c\u6700\u574f\u60c5\u51b5\u4e0b\u65f6\u95f4\u590d\u6742\u5ea6\u4f1a\u9000\u5316\u5230 O(n\xb2)\u3002"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"1756741915311",src:r(60416).A+"",width:"815",height:"1075"})}),"\n",(0,i.jsx)(n.h3,{id:"ziplist-\u7684\u8282\u70b9\u6570\u91cf\u4f1a\u8d85\u8fc7-65535-\u5417",children:"ziplist \u7684\u8282\u70b9\u6570\u91cf\u4f1a\u8d85\u8fc7 65535 \u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u4e0d\u4f1a\u3002"}),"\n",(0,i.jsx)(n.p,{children:"Zllen \u5b57\u6bb5\u7684\u7c7b\u578b\u662f uint16_t\uff0c\u6700\u5927\u503c\u4e3a 65535\uff0c\u4e5f\u5c31\u662f 2 \u7684 16\u6b21\u65b9\uff0c\u6240\u4ee5\u538b\u7f29\u5217\u8868\u7684\u8282\u70b9\u6570\u91cf\u4e0d\u4f1a\u8d85\u8fc7 65535\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u5f53\u8282\u70b9\u6570\u91cf\u5c0f\u4e8e 65535 \u65f6\uff0c\u8be5\u5b57\u6bb5\u4f1a\u5b58\u50a8\u5b9e\u9645\u7684\u6570\u91cf\uff1b\u5426\u5219\u8be5\u5b57\u6bb5\u5c31\u56fa\u5b9a\u4e3a 65535\uff0c\u5b9e\u9645\u5b58\u50a8\u7684\u6570\u91cf\u9700\u8981\u9010\u4e2a\u904d\u5386\u8282\u70b9\u6765\u8ba1\u7b97\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"ziplist-\u7684\u7f16\u7801\u7c7b\u578b\u4e86\u89e3\u591a\u5c11",children:"ziplist \u7684\u7f16\u7801\u7c7b\u578b\u4e86\u89e3\u591a\u5c11\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"ziplist \u7684\u7f16\u7801\u7c7b\u578b\u8bbe\u8ba1\u5f97\u5f88\u7cbe\u5de7\uff0c\u4e3b\u8981\u5206\u4e3a\u5b57\u7b26\u4e32\u7f16\u7801\u548c\u6574\u6570\u7f16\u7801\u4e24\u5927\u7c7b\uff0c\u76ee\u7684\u662f\u7528\u6700\u5c11\u7684\u5b57\u8282\u5b58\u50a8\u6570\u636e\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u6bd4\u5982 0 \u5230 12 \u8fd9\u4e9b\u5c0f\u6574\u6570\u76f4\u63a5\u7f16\u7801\u5728 type \u5b57\u6bb5\u4e2d\uff0c\u53ea\u9700\u8981 1 \u4e2a\u5b57\u8282\u3002\r\n\u7f16\u7801\t\u957f\u5ea6\t\u63cf\u8ff0\r\n11000000\t1\u5b57\u8282\tint16_t\u7c7b\u578b\u6574\u6570\uff0c2 \u5b57\u8282\r\n11010000\t1\u5b57\u8282\tint32_t\u7c7b\u578b\u6574\u6570\uff0c4 \u5b57\u8282\r\n11100000\t1\u5b57\u8282\tint64_t\u7c7b\u578b\u6574\u6570\uff0c8 \u5b57\u8282\r\n11110000\t1\u5b57\u8282\t24\u4f4d\u6709\u7b26\u53f7\u6574\u6570 \uff0c3 \u5b57\u8282\r\n1111xxxx\t1\u5b57\u8282\t\u6570\u636e\u8303\u56f4\u5728[0-12]\uff0c\u6570\u636e\u5305\u542b\u5728\u7f16\u7801\u4e2d\r\n",(0,i.jsx)(n.img,{alt:"1756742267322",src:r(26845).A+"",width:"4558",height:"3310"}),"\r\n\u5bf9\u4e8e\u5b57\u7b26\u4e32\u7f16\u7801\uff0c\u6839\u636e\u5b57\u7b26\u4e32\u957f\u5ea6\u6709\u4e09\u79cd\u683c\u5f0f\u3002\u957f\u5ea6\u5c0f\u4e8e 63 \u5b57\u8282\u7684\u7528 00 \u5f00\u5934\u7684\u5355\u5b57\u8282\u7f16\u7801\uff0c\u5269\u4f59 6 \u4f4d\u5b58\u50a8\u957f\u5ea6\u3002\u957f\u5ea6\u5728 63 \u5230 16383 \u4e4b\u95f4\u7684\u7528 01 \u5f00\u5934\u7684\u53cc\u5b57\u8282\u7f16\u7801\uff0c\u5269\u4f59 14 \u4f4d\u5b58\u50a8\u957f\u5ea6\u3002\u8d85\u8fc7 16383 \u5b57\u8282\u7684\u7528 10 \u5f00\u5934\uff0c\u540e\u9762\u8ddf 4 \u5b57\u8282\u5b58\u50a8\u957f\u5ea6\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u7f16\u7801\t\u957f\u5ea6\t\u63cf\u8ff0\r\n00pppppp\t1\u5b57\u8282\t0-63 \u5b57\u8282\u7684\u5b57\u7b26\u4e32\r\n01pppppp qqqqqqqq\t2\u5b57\u8282\t64-16383\u5b57\u8282\u7684\u5b57\u7b26\u4e32\r\n10______ qqqqqqqq rrrrrrrr ssssssss tttttttt\t5\u5b57\u8282\t16384-4294967295\u5b57\u8282\u7684\u5b57\u7b26\u4e32"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"1756742290634",src:r(44971).A+"",width:"2628",height:"1760"})}),"\n",(0,i.jsx)(n.h3,{id:"quicklist-\u4e86\u89e3\u5417",children:"quicklist \u4e86\u89e3\u5417\uff1f"}),"\n",(0,i.jsxs)(n.p,{children:["quicklist \u662f Redis \u5728 3.2 \u7248\u672c\u65f6\u5f15\u5165\u7684\uff0c\u4e13\u95e8\u7528\u4e8e List \u7684\u5e95\u5c42\u5b9e\u73b0\uff0c\u5b83\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u6df7\u5408\u578b\u6570\u636e\u7ed3\u6784\uff0c\u7ed3\u5408\u4e86\u538b\u7f29\u5217\u8868\u548c\u53cc\u5411\u94fe\u8868\u7684\u4f18\u70b9\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756742307399",src:r(97610).A+"",width:"1340",height:"786"})]}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u65e9\u671f\u7684\u7248\u672c\u4e2d\uff0cList \u4f1a\u6839\u636e\u5143\u7d20\u7684\u6570\u91cf\u548c\u5927\u5c0f\u91c7\u7528\u4e24\u79cd\u4e0d\u540c\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u5f53\u5143\u7d20\u8f83\u5c11\u6216\u8005\u8f83\u5c0f\u65f6\uff0c\u4f1a\u4f7f\u7528\u538b\u7f29\u5217\u8868\uff1b\u5426\u5219\u7528\u53cc\u5411\u94fe\u8868\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u4f46\u8fd9\u79cd\u8bbe\u8ba1\u6709\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u5f53 List \u4e2d\u7684\u5143\u7d20\u6570\u91cf\u8f83\u591a\u65f6\uff0c\u538b\u7f29\u5217\u8868\u4f1a\u56e0\u4e3a\u8fde\u9501\u66f4\u65b0\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\uff0c\u800c\u53cc\u5411\u94fe\u8868\u53c8\u4f1a\u5360\u7528\u66f4\u591a\u5185\u5b58\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["quicklist \u901a\u8fc7\u5c06 List \u62c6\u5206\u4e3a\u591a\u4e2a\u5c0f\u7684 ziplist\uff0c\u518d\u901a\u8fc7\u6307\u9488\u94fe\u63a5\u6210\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u5de7\u5999\u7684\u89e3\u51b3\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756742317904",src:r(44623).A+"",width:"1131",height:"389"}),"\r\n\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bcf\u4e2a ziplist \u53ef\u4ee5\u5b58\u50a8 8KB \u7684\u6570\u636e\uff0c\u5047\u5982\u6bcf\u4e2a\u5143\u7d20\u7684\u5927\u5c0f\u6070\u597d\u662f 1KB\uff0c\u90a3\u4e48\u4e00\u4e2a quicklist \u5c31\u53ef\u4ee5\u5b58\u50a8 8 \u4e2a\u5143\u7d20\u300280 \u4e2a\u8fd9\u6837\u7684\u5143\u7d20\u5c31\u4f1a\u88ab\u5206\u6210 10 \u4e2a ziplist\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u6837\u65e2\u4fdd\u7559\u4e86\u538b\u7f29\u5217\u8868\u7684\u5185\u5b58\u7d27\u51d1\u6027\uff0c\u53c8\u51cf\u5c11\u4e86\u53cc\u5411\u94fe\u8868\u6307\u9488\u7684\u6570\u91cf\uff0c\u8fdb\u4e00\u6b65\u964d\u4f4e\u4e86\u5185\u5b58\u5f00\u9500\u3002"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{alt:"1756742328433",src:r(13678).A+"",width:"1199",height:"610"}),"\r\n\u9664\u6b64\u4e4b\u5916\uff0cquicklist \u8fd8\u6709\u4e00\u4e2a\u91cd\u8981\u7684\u7279\u6027\uff0c\u5c31\u662f\u5b83\u7684\u53ef\u914d\u7f6e\u6027\uff0c\u53ef\u4ee5\u901a\u8fc7\u586b\u5145\u56e0\u5b50\u63a7\u5236\u6bcf\u4e2a ziplist \u8282\u70b9\u7684\u5927\u5c0f\u3002\u5f53\u586b\u5145\u56e0\u5b50\u4e3a\u6b63\u6570\u65f6\uff0c\u5b83\u8fd8\u53ef\u4ee5\u9650\u5236\u6bcf\u4e2a ziplist \u6700\u591a\u5305\u542b\u7684\u5143\u7d20\u6570\u91cf\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# \u586b\u5145\u56e0\u5b50\uff0c\u9ed8\u8ba4 -2\uff088KB\uff09\r\nlist-max-ziplist-size 10\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u60f3\u8fdb\u4e00\u6b65\u8282\u7701\u5185\u5b58\uff0cquicklist \u8fd8\u652f\u6301\u5bf9\u4e2d\u95f4\u8282\u70b9\u8fdb\u884c LZF \u538b\u7f29\uff0c\u538b\u7f29\u6df1\u5ea6\u4e3a 1 \u65f6\uff0c\u8868\u793a\u9664\u4e86\u9996\u5c3e\u5404 1 \u4e2a\u8282\u70b9\u4e0d\u538b\u7f29\u5916\uff0c\u5176\u4ed6\u8282\u70b9\u90fd\u538b\u7f29\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# \u538b\u7f29\u6df1\u5ea6\uff0c\u9ed8\u8ba4 0\uff08\u4e0d\u538b\u7f29\uff09\r\nlist-compress-depth 1\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"1756742378091",src:r(77167).A+"",width:"1280",height:"1032"})}),"\n",(0,i.jsx)(n.h3,{id:"lzf-\u538b\u7f29\u7b97\u6cd5\u4e86\u89e3\u5417",children:"LZF \u538b\u7f29\u7b97\u6cd5\u4e86\u89e3\u5417\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"LZF \u662f\u4e00\u79cd\u5feb\u901f\u7684\u65e0\u635f\u538b\u7f29\u7b97\u6cd5\uff0c\u4e3b\u8981\u7528\u4e8e\u51cf\u5c11\u6570\u636e\u5b58\u50a8\u7a7a\u95f4\u3002\u5b83\u7684\u6838\u5fc3\u601d\u60f3\u662f\u901a\u8fc7\u67e5\u627e\u91cd\u590d\u6570\u636e\u6765\u5b9e\u73b0\u538b\u7f29\uff0c\u901a\u8fc7\u4e00\u4e2a\u6ed1\u52a8\u7a97\u53e3\u6765\u67e5\u627e\u91cd\u590d\u7684\u5b57\u8282\u5e8f\u5217\uff0c\u5e76\u5c06\u8fd9\u4e9b\u5e8f\u5217\u66ff\u6362\u4e3a\u66f4\u77ed\u7684\u5f15\u7528\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u8865\u5145",children:"\u8865\u5145"}),"\n",(0,i.jsx)(n.h3,{id:"\u5047\u5982-redis-\u91cc\u9762\u6709-1-\u4ebf\u4e2a-key\u5176\u4e2d\u6709-10w-\u4e2a-key-\u662f\u4ee5\u67d0\u4e2a\u56fa\u5b9a\u7684\u5df2\u77e5\u7684\u524d\u7f00\u5f00\u5934\u7684\u5982\u4f55\u5c06\u5b83\u4eec\u5168\u90e8\u627e\u51fa\u6765",children:"\u5047\u5982 Redis \u91cc\u9762\u6709 1 \u4ebf\u4e2a key\uff0c\u5176\u4e2d\u6709 10w \u4e2a key \u662f\u4ee5\u67d0\u4e2a\u56fa\u5b9a\u7684\u5df2\u77e5\u7684\u524d\u7f00\u5f00\u5934\u7684\uff0c\u5982\u4f55\u5c06\u5b83\u4eec\u5168\u90e8\u627e\u51fa\u6765\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u6211\u4f1a\u4f7f\u7528 SCAN \u547d\u4ee4\u914d\u5408 MATCH \u53c2\u6570\u6765\u89e3\u51b3\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u6bd4\u5982\u8981\u627e\u4ee5 user: \u5f00\u5934\u7684 key\uff0c\u53ef\u4ee5\u6267\u884c SCAN 0 MATCH user:* COUNT 1000\u3002"}),"\n",(0,i.jsx)(n.p,{children:"SCAN \u7684\u4f18\u52bf\u5728\u4e8e\u5b83\u662f\u57fa\u4e8e\u6e38\u6807\u7684\u589e\u91cf\u8fed\u4ee3\uff0c\u6bcf\u6b21\u53ea\u8fd4\u56de\u4e00\u5c0f\u6279\u7ed3\u679c\uff0c\u4e0d\u4f1a\u963b\u585e\u670d\u52a1\u5668\u3002\u53ef\u4ee5\u4ece\u6e38\u6807 0 \u5f00\u59cb\uff0c\u6bcf\u6b21\u5904\u7406\u8fd4\u56de\u7684 key \u5217\u8868\uff0c\u7136\u540e\u7528\u8fd4\u56de\u7684\u4e0b\u4e00\u4e2a\u6e38\u6807\u7ee7\u7eed\u626b\u63cf\uff0c\u76f4\u5230\u6e38\u6807\u56de\u5230 0 \u8868\u793a\u626b\u63cf\u5b8c\u6210\u3002\r\n\u5343\u4e07\u4e0d\u8981\u7528 KEYS \u547d\u4ee4\uff0c\u56e0\u4e3a KEYS \u4f1a\u963b\u585e Redis \u670d\u52a1\u5668\u76f4\u5230\u904d\u5386\u5b8c\u6240\u6709 key\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5bf9 1 \u4ebf\u4e2a key \u6267\u884c KEYS \u662f\u975e\u5e38\u5371\u9669\u7684\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"redis\u5728\u79d2\u6740\u573a\u666f\u4e0b\u53ef\u4ee5\u626e\u6f14\u4ec0\u4e48\u89d2\u8272",children:"Redis\u5728\u79d2\u6740\u573a\u666f\u4e0b\u53ef\u4ee5\u626e\u6f14\u4ec0\u4e48\u89d2\u8272\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u79d2\u6740\u662f\u4e00\u79cd\u975e\u5e38\u7279\u6b8a\u7684\u4e1a\u52a1\u573a\u666f\uff0c\u5b83\u7684\u7279\u70b9\u662f\u5728\u6781\u77ed\u65f6\u95f4\u5185\u4f1a\u6709\u5927\u91cf\u7528\u6237\u6d8c\u5165\u7cfb\u7edf\uff0c\u5bf9\u7cfb\u7edf\u7684\u5e76\u53d1\u5904\u7406\u80fd\u529b\u3001\u54cd\u5e94\u901f\u5ea6\u548c\u6570\u636e\u4e00\u81f4\u6027\u90fd\u63d0\u51fa\u4e86\u6781\u9ad8\u7684\u8981\u6c42\u3002\u5728\u8fd9\u79cd\u573a\u666f\u4e0b\uff0cRedis \u4f5c\u4e3a\u4e00\u79cd\u9ad8\u6027\u80fd\u7684\u5185\u5b58\u6570\u636e\u5e93\uff0c\u80fd\u591f\u53d1\u6325\u591a\u65b9\u9762\u7684\u5173\u952e\u4f5c\u7528\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u6bd4\u5982\u8bf4\u5728\u79d2\u6740\u5f00\u59cb\u524d\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5546\u54c1\u4fe1\u606f\u3001\u5e93\u5b58\u6570\u636e\u7b49\u9884\u5148\u52a0\u8f7d\u5230 Redis \u4e2d\uff0c\u8fd9\u6837\u5927\u91cf\u7684\u7528\u6237\u8bfb\u8bf7\u6c42\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece Redis \u4e2d\u83b7\u53d6\u54cd\u5e94\uff0c\u800c\u4e0d\u5fc5\u6bcf\u6b21\u90fd\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u8fd9\u6837\u5c31\u80fd\u5927\u5927\u51cf\u8f7b\u6570\u636e\u5e93\u7684\u8bbf\u95ee\u538b\u529b\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756742466906",src:r(32104).A+"",width:"1346",height:"853"}),"\r\n\u5176\u6b21\uff0cRedis \u5728\u5e93\u5b58\u63a7\u5236\u65b9\u9762\u5177\u6709\u5f97\u5929\u72ec\u539a\u7684\u4f18\u52bf\u3002\u79d2\u6740\u6700\u6838\u5fc3\u7684\u95ee\u9898\u4e4b\u4e00\u5c31\u662f\u5bb9\u6613\u53d1\u751f\u8d85\u5356\u3002Redis \u63d0\u4f9b\u7684\u539f\u5b50\u64cd\u4f5c\u5982 DECR\u3001DECRBY \u7b49\u547d\u4ee4\uff0c\u53ef\u4ee5\u786e\u4fdd\u5728\u9ad8\u5e76\u53d1\u73af\u5883\u4e0b\u5e93\u5b58\u8ba1\u6570\u7684\u51c6\u786e\u6027\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756742482775",src:r(88450).A+"",width:"640",height:"377"}),"\r\n\u66f4\u590d\u6742\u7684\u903b\u8f91\uff0c\u53ef\u4ee5\u901a\u8fc7 Lua \u811a\u672c\u6765\u5b9e\u73b0\uff0c\u56e0\u4e3a Lua \u811a\u672c\u5728 Redis \u4e2d\u662f\u539f\u5b50\u6267\u884c\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u5305\u542b\u590d\u6742\u7684\u5224\u65ad\u548c\u64cd\u4f5c\u903b\u8f91\uff0c\u6bd4\u5982\u5148\u68c0\u67e5\u5e93\u5b58\u662f\u5426\u5145\u8db3\uff0c\u518d\u8fdb\u884c\u6263\u51cf\uff0c\u8fd9\u6574\u4e2a\u8fc7\u7a0b\u662f\u4e0d\u4f1a\u88ab\u5176\u4ed6\u64cd\u4f5c\u6253\u65ad\u7684\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c\u4e09\u70b9\uff0cRedis \u7684\u5206\u5e03\u5f0f\u9501\u53ef\u4ee5\u786e\u4fdd\u591a\u4e2a\u7528\u6237\u540c\u65f6\u62a2\u8d2d\u540c\u4e00\u4ef6\u5546\u54c1\u65f6\u7684\u64cd\u4f5c\u662f\u4e92\u65a5\u7684\uff0c\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\u7684\u540c\u65f6\uff0c\u8fd8\u53ef\u4ee5\u7528\u6765\u9632\u6b62\u7528\u6237\u91cd\u590d\u4e0b\u5355\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756742496498",src:r(42555).A+"",width:"1217",height:"1036"}),"\r\n\u7b2c\u56db\u70b9\uff0c\u9650\u6d41\u524a\u5cf0\u3002\u79d2\u6740\u5f00\u59cb\u7684\u77ac\u95f4\uff0c\u53ef\u80fd\u4f1a\u6709\u6210\u5343\u4e0a\u4e07\u7684\u8bf7\u6c42\u540c\u65f6\u5230\u8fbe\uff0c\u5982\u679c\u4e0d\u52a0\u63a7\u5236\uff0c\u5f88\u5bb9\u6613\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\u3002Redis \u53ef\u4ee5\u5b9e\u73b0\u591a\u79cd\u9650\u6d41\u7b97\u6cd5\uff0c\u6bd4\u5982\u7b80\u5355\u7684\u8ba1\u6570\u5668\u9650\u6d41\u3001\u4ee4\u724c\u6876\u6216\u6f0f\u6876\u7b97\u6cd5\u7b49\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756742511336",src:r(90766).A+"",width:"659",height:"502"}),"\r\n\u901a\u8fc7\u9650\u6d41\u7b97\u6cd5\u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u5355\u4f4d\u65f6\u95f4\u5185\u7cfb\u7edf\u80fd\u591f\u5904\u7406\u7684\u8bf7\u6c42\u6570\u91cf\uff0c\u8d85\u51fa\u90e8\u5206\u53ef\u4ee5\u6392\u961f\u6216\u8005\u76f4\u63a5\u62d2\u7edd\uff0c\u4ece\u800c\u4fdd\u62a4\u7cfb\u7edf\u7684\u7a33\u5b9a\u8fd0\u884c\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"redis\u5177\u4f53\u5982\u4f55\u5b9e\u73b0\u524a\u5cf0\u5462",children:"Redis\u5177\u4f53\u5982\u4f55\u5b9e\u73b0\u524a\u5cf0\u5462\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u524a\u5cf0\u7684\u672c\u8d28\u662f\u5c06\u77ac\u65f6\u7684\u9ad8\u6d41\u91cf\u8bf7\u6c42\u7f13\u51b2\u8d77\u6765\uff0c\u901a\u8fc7\u6392\u961f\u3001\u9650\u6d41\u7b49\u673a\u5236\uff0c\u4f7f\u7cfb\u7edf\u4ee5\u4e00\u4e2a\u53ef\u627f\u53d7\u7684\u901f\u5ea6\u6765\u5904\u7406\u8bf7\u6c42\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u90a3\u7b2c\u4e00\u6b65\u5c31\u662f\u7f13\u5b58\u9884\u70ed\u3002\u5728\u79d2\u6740\u6d3b\u52a8\u5f00\u59cb\u524d\uff0c\u5148\u628a\u5546\u54c1\u4fe1\u606f\u8fd9\u4e9b\u70ed\u70b9\u6570\u636e\u63d0\u524d\u52a0\u8f7d\u5230 Redis \u4e2d\u3002\u8fd9\u6837\u7528\u6237\u8bbf\u95ee\u5546\u54c1\u9875\u9762\u65f6\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece Redis \u8bfb\u53d6\uff0c\u6570\u636e\u5e93\u57fa\u672c\u4e0a\u4e0d\u4f1a\u6709\u538b\u529b\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756742532824",src:r(26767).A+"",width:"1126",height:"484"}),'\r\n\u7b2c\u4e8c\u6b65\u662f\u5f15\u5165\u6d88\u606f\u961f\u5217\uff0c\u7279\u522b\u662f\u4e0b\u5355\u8fd9\u79cd\u5199\u64cd\u4f5c\uff0c\u4e0d\u80fd\u8ba9\u7528\u6237\u7b49\u592a\u4e45\uff0c\u4f46\u540e\u7aef\u5904\u7406\u8ba2\u5355\u3001\u6263\u5e93\u5b58\u8fd9\u4e9b\u64cd\u4f5c\u53c8\u6bd4\u8f83\u91cd\u3002\u6240\u4ee5\u53ef\u4ee5\u7528 Redis \u7684 List \u505a\u4e86\u4e2a\u961f\u5217\uff0c\u6216\u8005\u76f4\u63a5\u7528 RocketMQ \u8fd9\u79cd\u6807\u51c6\u7684\u6d88\u606f\u4e2d\u95f4\u4ef6\uff0c\u7528\u6237\u4e0b\u5355\u540e\u7acb\u5373\u8fd4\u56de"\u8ba2\u5355\u63d0\u4ea4\u6210\u529f"\uff0c\u7136\u540e\u628a\u8ba2\u5355\u6570\u636e\u4e22\u5230\u961f\u5217\u91cc\uff0c\u540e\u53f0\u670d\u52a1\u6162\u6162\u6d88\u8d39\u3002\u8fd9\u6837\u65e2\u4fdd\u8bc1\u4e86\u7528\u6237\u4f53\u9a8c\uff0c\u53c8\u907f\u514d\u4e86\u7cfb\u7edf\u88ab\u77ac\u65f6\u5199\u8bf7\u6c42\u538b\u57ae\u3002\r\n',(0,i.jsx)(n.img,{alt:"1756742547294",src:r(51736).A+"",width:"1134",height:"682"}),"\r\n\u7b2c\u4e09\u6b65\uff0c\u53ef\u4ee5\u5728\u79d2\u6740\u6d3b\u52a8\u4e2d\u52a0\u5165\u7b54\u9898\u73af\u8282\uff0c\u53ea\u6709\u7b54\u5bf9\u9898\u76ee\u7684\u7528\u6237\u624d\u80fd\u53c2\u4e0e\u79d2\u6740\u6d3b\u52a8\uff0c\u8fd9\u6837\u53ef\u4ee5\u6700\u5927\u7a0b\u5ea6\u51cf\u5c11\u65e0\u6548\u8bf7\u6c42\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756742563119",src:r(47088).A+"",width:"1208",height:"299"})]}),"\n",(0,i.jsx)(n.p,{children:"\u4e00\u4e2a\u6bd4\u8f83\u5b8c\u6574\u7684\u79d2\u6740\u524a\u5cf0\u5904\u7406\u65b9\u6848\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'@Service\r\npublic class SeckillServiceImpl implements SeckillService {\r\n    \r\n    @Autowired\r\n    private RedisTemplate<String, String> redisTemplate;\r\n    \r\n    @Autowired\r\n    private OrderService orderService;\r\n    \r\n    @Autowired\r\n    private CommodityService commodityService;\r\n    \r\n    /**\r\n     * \u79d2\u6740\u8bf7\u6c42\u5165\u53e3\r\n     */\r\n    public Result seckill(Long userId, Long commodityId) {\r\n        // 1. \u7528\u6237\u8bf7\u6c42\u9891\u7387\u9650\u5236\r\n        if (!countRateLimit("user:" + userId, 5, 60)) {\r\n            return Result.error("\u8bf7\u6c42\u8fc7\u4e8e\u9891\u7e41");\r\n        }\r\n        \r\n        // 2. \u5546\u54c1\u662f\u5426\u5728\u79d2\u6740\u65f6\u95f4\u5185\r\n        if (!isInSeckillTime(commodityId)) {\r\n            return Result.error("\u79d2\u6740\u672a\u5f00\u59cb\u6216\u5df2\u7ed3\u675f");\r\n        }\r\n        \r\n        // 3. \u662f\u5426\u8fd8\u6709\u5e93\u5b58(\u5feb\u901f\u5931\u8d25)\r\n        String stockKey = "seckill:stock:" + commodityId;\r\n        Integer stock = Integer.valueOf(redisTemplate.opsForValue().get(stockKey));\r\n        if (stock != null && stock <= 0) {\r\n            return Result.error("\u5546\u54c1\u5df2\u552e\u7f44");\r\n        }\r\n        \r\n        // 4. \u5168\u5c40\u9650\u6d41\r\n        if (!acquireToken("global", 1000, 100)) {\r\n            // \u7cfb\u7edf\u8d1f\u8f7d\u8fc7\u9ad8\uff0c\u5c06\u8bf7\u6c42\u653e\u5165\u961f\u5217\u5ef6\u8fdf\u5904\u7406\r\n            enqueueDelayedRequest(userId, commodityId);\r\n            return Result.success("\u79d2\u6740\u8bf7\u6c42\u5df2\u53d7\u7406\uff0c\u6392\u961f\u5904\u7406\u4e2d");\r\n        }\r\n        \r\n        // 5. \u68c0\u67e5\u7528\u6237\u662f\u5426\u5df2\u8d2d\u4e70\r\n        if (hasUserBought(userId, commodityId)) {\r\n            return Result.error("\u60a8\u5df2\u7ecf\u8d2d\u4e70\u8fc7\u8be5\u5546\u54c1");\r\n        }\r\n        \r\n        // 6. \u5c06\u8bf7\u6c42\u653e\u5165\u961f\u5217\uff0c\u8fd4\u56de\u6392\u961f\u72b6\u6001\r\n        String requestId = generateRequestId(userId, commodityId);\r\n        enqueueRequest(userId, commodityId, requestId);\r\n        \r\n        return Result.success("\u79d2\u6740\u8bf7\u6c42\u5df2\u63d0\u4ea4\uff0c\u8bf7\u7b49\u5f85\u7ed3\u679c", requestId);\r\n    }\r\n    \r\n    /**\r\n     * \u5f02\u6b65\u5904\u7406\u79d2\u6740\u8bf7\u6c42\r\n     */\r\n    @Scheduled(fixedRate = 50) // \u6bcf50ms\u5904\u7406\u4e00\u6279\r\n    public void processSeckillQueue() {\r\n        String queueKey = "seckill:queue";\r\n        \r\n        // \u6279\u91cf\u5904\u7406\uff0c\u63a7\u5236\u5904\u7406\u901f\u5ea6\r\n        for (int i = 0; i < 10; i++) {\r\n            String requestJson = redisTemplate.opsForList().leftPop(queueKey);\r\n            if (requestJson == null) {\r\n                break;\r\n            }\r\n            \r\n            SeckillRequest request = JSON.parseObject(requestJson, SeckillRequest.class);\r\n            try {\r\n                // \u6267\u884c\u79d2\u6740\u6838\u5fc3\u903b\u8f91\r\n                boolean success = doSeckill(request.getUserId(), request.getCommodityId());\r\n                \r\n                // \u66f4\u65b0\u8bf7\u6c42\u72b6\u6001\uff0c\u4fbf\u4e8e\u7528\u6237\u67e5\u8be2\r\n                String statusKey = "seckill:status:" + request.getRequestId();\r\n                redisTemplate.opsForValue().set(statusKey, success ? "SUCCESS" : "FAILED", 1, TimeUnit.HOURS);\r\n                \r\n            } catch (Exception e) {\r\n                log.error("\u5904\u7406\u79d2\u6740\u8bf7\u6c42\u5931\u8d25", e);\r\n                // \u8bb0\u5f55\u5931\u8d25\u72b6\u6001\r\n                String statusKey = "seckill:status:" + request.getRequestId();\r\n                redisTemplate.opsForValue().set(statusKey, "ERROR", 1, TimeUnit.HOURS);\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * \u79d2\u6740\u6838\u5fc3\u903b\u8f91\r\n     */\r\n    private boolean doSeckill(Long userId, Long commodityId) {\r\n        // \u4f7f\u7528Lua\u811a\u672c\u4fdd\u8bc1\u539f\u5b50\u6027\u64cd\u4f5c\r\n        String script = \r\n            "-- \u68c0\u67e5\u5e93\u5b58\\n" +\r\n            "local stockKey = KEYS[1]\\n" +\r\n            "local stock = tonumber(redis.call(\'get\', stockKey))\\n" +\r\n            "if stock == nil or stock <= 0 then\\n" +\r\n            "    return 0\\n" +\r\n            "end\\n" +\r\n            "\\n" +\r\n            "-- \u68c0\u67e5\u662f\u5426\u91cd\u590d\u8d2d\u4e70\\n" +\r\n            "local boughtKey = KEYS[2]\\n" +\r\n            "local hasBought = redis.call(\'sismember\', boughtKey, ARGV[1])\\n" +\r\n            "if hasBought == 1 then\\n" +\r\n            "    return -1\\n" +\r\n            "end\\n" +\r\n            "\\n" +\r\n            "-- \u6263\u51cf\u5e93\u5b58\u5e76\u8bb0\u5f55\u8d2d\u4e70\\n" +\r\n            "redis.call(\'decr\', stockKey)\\n" +\r\n            "redis.call(\'sadd\', boughtKey, ARGV[1])\\n" +\r\n            "\\n" +\r\n            "-- \u8fd4\u56de\u6210\u529f\\n" +\r\n            "return 1";\r\n        \r\n        String stockKey = "seckill:stock:" + commodityId;\r\n        String boughtKey = "seckill:bought:" + commodityId;\r\n        \r\n        Long result = (Long) redisTemplate.execute(\r\n            new DefaultRedisScript<>(script, Long.class),\r\n            Arrays.asList(stockKey, boughtKey),\r\n            userId.toString()\r\n        );\r\n        \r\n        if (result == 1) {\r\n            // \u521b\u5efa\u8ba2\u5355(\u53ef\u4ee5\u8fdb\u4e00\u6b65\u5f02\u6b65\u5316)\r\n            createOrder(userId, commodityId);\r\n            return true;\r\n        }\r\n        \r\n        return false;\r\n    }\r\n    \r\n    // \u5176\u4ed6\u8f85\u52a9\u65b9\u6cd5...\r\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"redis\u5982\u4f55\u505a\u9650\u6d41\u5462",children:"Redis\u5982\u4f55\u505a\u9650\u6d41\u5462\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"\u9650\u6d41\u662f\u4e3a\u4e86\u63a7\u5236\u7cfb\u7edf\u7684\u8bf7\u6c42\u901f\u7387\uff0c\u9632\u6b62\u7cfb\u7edf\u88ab\u8fc7\u591a\u7684\u8bf7\u6c42\u538b\u57ae\u3002"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u5b9e\u73b0\u9650\u6d41\u6700\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u57fa\u4e8e\u8ba1\u6570\u5668\u7684\u56fa\u5b9a\u7a97\u53e3\u9650\u6d41\u3002\u6bd4\u5982\u9650\u5236\u7528\u6237\u6bcf\u5206\u949f\u6700\u591a\u8bbf\u95ee 100 \u6b21\uff0c\u6211\u4eec\u5c31\u7528 INCR \u547d\u4ee4\u7ed9\u6bcf\u4e2a\u7528\u6237\u8bbe\u4e2a\u8ba1\u6570\u5668\uff0ckey \u662f rate_limit:\u7528\u6237ID:\u5206\u949f\u65f6\u95f4\u6233\uff0c\u6bcf\u6b21\u8bf7\u6c42\u5c31\u52a0 1\uff0c\u540c\u65f6\u8bbe\u7f6e 60 \u79d2\u8fc7\u671f\u3002\u5982\u679c\u8ba1\u6570\u8d85\u8fc7 100 \u5c31\u62d2\u7edd\u8bf7\u6c42\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u4f2a\u4ee3\u7801\r\nString key = "rate_limit:" + userId;\r\n// \u5c1d\u8bd5\u83b7\u53d6\u5f53\u524d\u8ba1\u6570\r\nLong count = redis.get(key);\r\n// \u5982\u679ckey\u4e0d\u5b58\u5728\uff0c\u8bbe\u7f6e\u4e3a1\u5e76\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\r\nif (count == null) {\r\n    redis.setex(key, 60, "1"); // 60\u79d2\u7a97\u53e3\u671f\r\n    return true; // \u5141\u8bb8\u8bbf\u95ee\r\n}\r\n// \u5982\u679c\u8ba1\u6570\u672a\u8d85\u8fc7\u9650\u5236\r\nif (count < maxRequests) {\r\n    redis.incr(key);\r\n    return true; // \u5141\u8bb8\u8bbf\u95ee\r\n}\r\nreturn false; // \u62d2\u7edd\u8bbf\u95ee\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u79cd\u65b9\u6cd5\u7b80\u5355\u7c97\u66b4\uff0c\u4f46\u6709\u4e2a\u95ee\u9898\u5c31\u662f\u4e34\u754c\u65f6\u95f4\u4f1a\u6709\u7a81\u523a\uff0c\u6bd4\u5982\u7528\u6237\u5728\u7b2c 59 \u79d2\u8bbf\u95ee\u4e86 100 \u6b21\uff0c\u7b2c 61 \u79d2\u53c8\u8bbf\u95ee 100 \u6b21\uff0c\u76f8\u5f53\u4e8e 2 \u79d2\u5185\u8bbf\u95ee\u4e86 200 \u6b21\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e8c\u79cd\u5c31\u662f\u6ed1\u52a8\u7a97\u53e3\u9650\u6d41\uff0c\u901a\u8fc7 Redis \u7684 ZSET \u6765\u5b9e\u73b0\uff0c\u628a\u6bcf\u6b21\u8bf7\u6c42\u7684\u65f6\u95f4\u6233\u4f5c\u4e3a score \u5b58\u8fdb\u53bb\uff0c\u7136\u540e\u7528 ZREMRANGEBYSCORE \u5220\u9664\u7a97\u53e3\u5916\u7684\u65e7\u6570\u636e\uff0c\u518d\u7528 ZCARD \u7edf\u8ba1\u5f53\u524d\u7a97\u53e3\u5185\u7684\u8bf7\u6c42\u6570\u3002\u8fd9\u6837\u9650\u6d41\u5c31\u6bd4\u8f83\u5747\u5300\u4e86\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// \u4f2a\u4ee3\u7801\r\nString key = "sliding_window:" + userId;\r\nlong now = System.currentTimeMillis();\r\n// \u6dfb\u52a0\u5f53\u524d\u8bf7\u6c42\u5230\u6709\u5e8f\u96c6\u5408\uff0cscore\u4e3a\u5f53\u524d\u65f6\u95f4\u6233\r\nredis.zadd(key, now, String.valueOf(now));\r\n// \u79fb\u9664\u65f6\u95f4\u7a97\u53e3\u4e4b\u524d\u7684\u8bf7\u6c42\u6570\u636e\r\nredis.zremrangeByScore(key, 0, now - windowSize);\r\n// \u8bbe\u7f6ekey\u8fc7\u671f\u65f6\u95f4\uff0c\u907f\u514d\u51b7\u7528\u6237\u6301\u7eed\u5360\u7528\u5185\u5b58\r\nredis.expire(key, windowSize / 1000 + 1);\r\n// \u83b7\u53d6\u5f53\u524d\u7a97\u53e3\u7684\u8bf7\u6c42\u6570\r\nLong count = redis.zcard(key);\r\nreturn count <= maxRequests;\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u901a\u5e38\u4f1a\u91c7\u7528\u4ee4\u724c\u6876\u7b97\u6cd5\uff0c\u5b83\u5c31\u50cf\u5728\u5e1d\u90fd/\u9b54\u90fd\u4e70\u8f66\uff0c\u6447\u5230\u53f7\u624d\u6709\u8d44\u683c\uff0c\u6ca1\u6447\u5230\u5c31\u53ea\u80fd\u7b49\u4e0b\u4e00\u6b21\uff08\ud83d\ude01\uff09\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u53ef\u4ee5\u5728 Redis \u91cc\u5b58\u4e24\u4e2a\u503c\uff0c\u4e00\u4e2a\u662f\u4ee4\u724c\u6570\u91cf\uff0c\u4e00\u4e2a\u662f\u4e0a\u6b21\u66f4\u65b0\u65f6\u95f4\u3002\u6bcf\u6b21\u8bf7\u6c42\u65f6\u7528 Lua \u811a\u672c\u8ba1\u7b97\u5e94\u8be5\u8865\u5145\u591a\u5c11\u4ee4\u724c\uff0c\u7136\u540e\u5224\u65ad\u662f\u5426\u6709\u8db3\u591f\u7684\u4ee4\u724c\u3002\r\n",(0,i.jsx)(n.img,{alt:"1756742625281",src:r(33475).A+"",width:"1990",height:"1074"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"-- Redis Lua\u811a\u672c\u5b9e\u73b0\u4ee4\u724c\u6876\u7b97\u6cd5\r\nlocal key = KEYS[1]  -- \u9650\u6d41\u7684key\r\nlocal max_permits = tonumber(ARGV[1])  -- \u6700\u5927\u4ee4\u724c\u6570\r\nlocal permits_per_second = tonumber(ARGV[2])  -- \u6bcf\u79d2\u4ea7\u751f\u7684\u4ee4\u724c\u6570\r\nlocal required_permits = tonumber(ARGV[3])  -- \u8bf7\u6c42\u7684\u4ee4\u724c\u6570\r\n\r\n-- \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\r\nlocal time = redis.call('time')\r\nlocal now_micros = tonumber(time[1]) * 1000000 + tonumber(time[2])\r\n\r\n-- \u83b7\u53d6\u4e0a\u6b21\u66f4\u65b0\u7684\u65f6\u95f4\u548c\u5f53\u524d\u5b58\u50a8\u7684\u4ee4\u724c\u6570\r\nlocal last_micros = tonumber(redis.call('hget', key, 'last_micros') or 0)\r\nlocal stored_permits = tonumber(redis.call('hget', key, 'stored_permits') or 0)\r\n\r\n-- \u8ba1\u7b97\u65f6\u95f4\u95f4\u9694\u5185\u65b0\u4ea7\u751f\u7684\u4ee4\u724c\u6570\r\nlocal interval_micros = now_micros - last_micros\r\nlocal new_permits = interval_micros * permits_per_second / 1000000\r\nstored_permits = math.min(max_permits, stored_permits + new_permits)\r\n\r\n-- \u5224\u65ad\u4ee4\u724c\u662f\u5426\u8db3\u591f\r\nlocal result = 0\r\nif stored_permits >= required_permits then\r\n    -- \u4ee4\u724c\u8db3\u591f\uff0c\u66f4\u65b0\u4ee4\u724c\u6570\u548c\u65f6\u95f4\r\n    stored_permits = stored_permits - required_permits\r\n    result = 1\r\nend\r\n\r\n-- \u66f4\u65b0Redis\u4e2d\u7684\u6570\u636e\r\nredis.call('hset', key, 'last_micros', now_micros)\r\nredis.call('hset', key, 'stored_permits', stored_permits)\r\nredis.call('expire', key, 10)  -- \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u907f\u514d\u957f\u671f\u5360\u7528\u5185\u5b58\r\n\r\nreturn result\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5ba2\u6237\u7aef\u5b95\u673a\u540e-redis-\u670d\u52a1\u7aef\u5982\u4f55\u611f\u77e5\u5230",children:"\u5ba2\u6237\u7aef\u5b95\u673a\u540e Redis \u670d\u52a1\u7aef\u5982\u4f55\u611f\u77e5\u5230\uff1f"}),"\n",(0,i.jsx)(n.p,{children:"TCP \u7684 keepalive \u662f Redis \u7528\u6765\u68c0\u6d4b\u5ba2\u6237\u7aef\u8fde\u63a5\u72b6\u6001\u7684\u4e3b\u8981\u673a\u5236\uff0c\u9ed8\u8ba4\u503c\u4e3a 300 \u79d2\u3002\r\n\u5f53\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u5728\u6307\u5b9a\u65f6\u95f4\u5185\u6ca1\u6709\u4efb\u4f55\u6570\u636e\u4ea4\u4e92\u65f6\uff0cRedis \u670d\u52a1\u5668\u4f1a\u53d1\u9001 TCP ACK \u63a2\u6d4b\u5305\uff0c\u5982\u679c\u8fde\u7eed\u591a\u6b21\u6ca1\u6709\u6536\u5230\u54cd\u5e94\uff0cTCP \u534f\u8bae\u6808\u4f1a\u901a\u77e5 Redis \u670d\u52a1\u7aef\u8fde\u63a5\u5df2\u65ad\u5f00\uff0c\u4e4b\u540e\uff0cRedis \u670d\u52a1\u7aef\u4f1a\u6e05\u7406\u76f8\u5173\u7684\u8fde\u63a5\u8d44\u6e90\uff0c\u91ca\u653e\u8fde\u63a5\u3002\r\n\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a timeout \u53c2\u6570\uff0c\u7528\u6765\u63a7\u5236\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u7a7a\u95f2\u8d85\u65f6\u65f6\u95f4\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# \u8868\u793a600\u79d2\u5185\u6ca1\u6709\u4efb\u4f55\u547d\u4ee4\u5219\u65ad\u5f00\u8fde\u63a5\r\nconfig set timeout 600\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u9ed8\u8ba4\u503c\u4e3a 0\uff0c\u8868\u793a\u6c38\u4e0d\u65ad\u5f00\u8fde\u63a5\uff1b\u5f53\u8bbe\u7f6e\u4e3a\u975e\u96f6\u503c\u65f6\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u5728\u6307\u5b9a\u65f6\u95f4\u5185\u6ca1\u6709\u53d1\u9001\u4efb\u4f55\u547d\u4ee4\uff0c\u670d\u52a1\u7aef\u4f1a\u4e3b\u52a8\u65ad\u5f00\u8fde\u63a5\u3002"}),"\n",(0,i.jsx)(n.p,{children:"Redis \u670d\u52a1\u5668\u4f1a\u5b9a\u671f\u68c0\u67e5\u7a7a\u95f2\u8fde\u63a5\u662f\u5426\u8d85\u65f6\uff0c\u68c0\u67e5\u9891\u7387\u7531 hz \u53c2\u6570\u63a7\u5236\uff1b\u8fd9\u5c06\u6709\u52a9\u4e8e\u91ca\u653e\u90a3\u4e9b\u5ba2\u6237\u7aef\u5f02\u5e38\u9000\u51fa\u4f46 TCP \u8fde\u63a5\u672a\u6b63\u5e38\u5173\u95ed\u7684\u8d44\u6e90\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u4e0d\u540c\u7684\u8fde\u63a5\u6c60\u4e5f\u4f1a\u6709\u81ea\u5df1\u7684\u8fde\u63a5\u68c0\u6d4b\u673a\u5236\uff0c\u6bd4\u5982 Jedis \u8fde\u63a5\u6c60\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e testOnBorrow \u548c testWhileIdle \u6765\u542f\u7528\u8fde\u63a5\u68c0\u6d4b\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# \u662f\u5426\u542f\u7528\u8fde\u63a5\u6c60\r\nspring.redis.jedis.pool.enabled=true\r\n# \u8fde\u63a5\u6c60\u6700\u5927\u8fde\u63a5\u6570\uff08\u4f7f\u7528\u8d1f\u503c\u8868\u793a\u6ca1\u6709\u9650\u5236\uff09\r\nspring.redis.jedis.pool.max-active=200\r\n# \u8fde\u63a5\u6c60\u6700\u5927\u7a7a\u95f2\u8fde\u63a5\u6570\r\nspring.redis.jedis.pool.max-idle=200\r\n# \u8fde\u63a5\u6c60\u6700\u5c0f\u7a7a\u95f2\u8fde\u63a5\u6570\r\nspring.redis.jedis.pool.min-idle=50\r\n# \u8fde\u63a5\u6c60\u6700\u5927\u963b\u585e\u7b49\u5f85\u65f6\u95f4\uff08\u4f7f\u7528\u8d1f\u503c\u8868\u793a\u6ca1\u6709\u9650\u5236\uff09\r\nspring.redis.jedis.pool.max-wait=3000\r\n# \u7a7a\u95f2\u8fde\u63a5\u68c0\u67e5\u95f4\u9694\uff08\u6beb\u79d2\uff09\r\nspring.redis.jedis.pool.time-between-eviction-runs=60000\n"})})]})}function o(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},72806:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737153378-a92187a22de53e47f4bfa7e28adcc9fe.png"},72994:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733078424-ea9e14532da2167e63644b1734e89618.png"},73757:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732184761-3b448516a610ffaa8336bc2f45299807.png"},73916:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741736509-7e01d05805fa0cc8a73790d9d11beb63.png"},74723:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732994762-ce6457f71825925ad0245f111ad7936a.png"},76034:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737550793-1dadbac60115c8e7b531fa0686a5f101.png"},77167:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756742378091-b1dfeb6bbdb3c30aacd2481eb6d581f2.png"},77354:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756735356144-60abaa4311051f986b0bbd15342b589d.png"},77588:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756734179018-21cdbc523fee63f8d95608cff18e6add.png"},77639:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756735821861-cc6cccc610427cbc57f3c64c1437dcc1.png"},79112:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737371705-d9238a202b3393ad03f61e2d35abf235.png"},79157:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756734304497-554ed957f6d5d08a991f77e831c4672c.png"},79393:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733314451-501bf7ef9044857955fdba365c539062.png"},79460:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_23-466d4a231812eafad5de0afd3bd59639.png"},79752:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732303608-a8973a33047ebcd629ba7724249fff82.png"},79757:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741261042-0b3ef3f0cd19f799fc82b7f40a7e7d61.png"},81450:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_14-58414f2a38e55c75b5c21e94c00a5f28.png"},81628:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_9-b3d6326f02948a30cca92e0434c6f6c5.png"},82581:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756734360873-9e1bd34f4e1da1f7eb0db6254700f552.png"},83929:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732873364-4f66ec10006803ebea30a9b64affabc5.png"},86083:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733241315-6cd6680bb45b94d5d7e19c7fe26da01e.png"},86292:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_1-3a5076a8234ff4ead75fb49ec95f3dc5.png"},86578:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733698709-95c1226fc85f6eb3b5ccce334aca9bb3.png"},87156:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img-408828fc0e9b1287483cf759bc585612.png"},88230:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732229854-9b4a9bc5ec5c77f37637249a4c50d733.png"},88441:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756741159057-c230636ae9eaf3b69589ee730c01a7df.png"},88450:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756742482775-c6a33c4272cb9ef84de99916d2656d45.png"},88948:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756682635040-4b3d676fdd4a947700b2f3323a1fd194.png"},89085:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756683200167-849eeaff9b449ea43fd03d9da6550f9c.png"},89193:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_26-bc2885aa2f56cf204c16f760c7edc16c.png"},89381:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_39-9d1d3c11b246a681228fedd2904b5a0f.png"},89403:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_24-8968e9dde731f72d1b46e0dbfda5de1d.png"},90302:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_29-d8d0807cff188f2cfd7c36585b2942d2.png"},90470:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756684639798-978dc76e388670e164c74e574f08ec6c.png"},90630:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_18-d1311cafd7c9abaed8e73c437fa7bf31.png"},90766:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756742511336-6bcd548ea46c40719f4cb56c296d2604.png"},90994:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737308299-6c7b2dc89cf110132df9734fbe2d319d.png"},91153:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756684860111-394f63484c27d13e89ee49a27bbcd117.png"},91352:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756737167133-a0e6d532870a9d1d71c55fd53cc0fab1.png"},92233:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756683178222-d8ff7e244f1ac0caee8bce470feb3a7e.png"},92864:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732778273-288ffe432104ad0b0ac8f9876a5544a8.png"},93023:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_20-304a9d3c51c04026fb2596d6cfb4d8eb.png"},93304:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756734670474-f11e33c27433f21e1d4872f633f7d918.png"},93548:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756734886639-40dfabdb2a403e98c121614d348df432.png"},94414:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733231061-583f2cc5e180701679ac42dae2f4a7b7.png"},94850:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_36-a4a193c66fe871632ccdbf32ab8cfbfa.png"},95898:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756735748176-20a5f6c9d31019b2c72cc01681916f05.png"},96528:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_5-8de7cd0e198698f9c3fc2860d8ff943d.png"},96802:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756733661312-38833e1adfbe6d6893ea1ba701aea9c4.png"},97610:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756742307399-1257b26ce3e40a38828389064cff7d62.png"},99101:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_31-6510473b71566cc5f6f49cc68d10a616.png"},99141:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/img_8-06f81c9049f7b8db0504de90a3a4f90b.png"},99262:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756682551610-1c3d220519afcc1db10d17bb710104e7.png"},99913:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/1756732898204-d901c3ba8455305b626347cd3739d7aa.png"}}]);