<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-MYSQL/mysql-tmp" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">mysql-tmp | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/doc/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/doc/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/doc/docs/MYSQL/mysql-tmp"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="mysql-tmp | My Site"><meta data-rh="true" name="description" content="title: &quot;MYSQL&quot;"><meta data-rh="true" property="og:description" content="title: &quot;MYSQL&quot;"><link data-rh="true" rel="icon" href="/doc/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/doc/docs/MYSQL/mysql-tmp"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/doc/docs/MYSQL/mysql-tmp" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/doc/docs/MYSQL/mysql-tmp" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"mysql-tmp","item":"https://your-docusaurus-site.example.com/doc/docs/MYSQL/mysql-tmp"}]}</script><link rel="alternate" type="application/rss+xml" href="/doc/blog/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/doc/blog/atom.xml" title="My Site Atom Feed"><link rel="stylesheet" href="/doc/assets/css/styles.8d5b4fe0.css">
<script src="/doc/assets/js/runtime~main.76c25152.js" defer="defer"></script>
<script src="/doc/assets/js/main.2ba6fd96.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/doc/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/doc/"><div class="navbar__logo"><img src="/doc/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/doc/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/doc/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/doc/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/docs/intro">Tutorial Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc/docs/category/tutorial---basics">Tutorial - Basics</a><button aria-label="Expand sidebar category &#x27;Tutorial - Basics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc/docs/category/tutorial---extras">Tutorial - Extras</a><button aria-label="Expand sidebar category &#x27;Tutorial - Extras&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/doc/docs/JAVA/">java</a><button aria-label="Expand sidebar category &#x27;java&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/INTERVIEW/MQ">MQ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/doc/docs/INTERVIEW/MYSQL/MYSQL-REVIEW">MYSQL</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/docs/INTERVIEW/MYSQL/MYSQL-REVIEW">MYSQL-REVIEW</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/doc/docs/MYSQL/mysql-tmp">mysql-tmp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/doc/docs/MYSQL/mysql常见命令查询">mysql常见命令查询</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/INTERVIEW/NGINX/NGINX-REVIEW">NGINX</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/intereview/redis">REDIS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/INTERVIEW/SPRING/SPRING-REVIEW">SPRING</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/doc/docs/tmp">tmp</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/INTERVIEW/分布式/分布式-REVIEW">分布式</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/doc/docs/INTERVIEW/微服务/微服务-REVIEW">微服务</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">MYSQL</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">mysql-tmp</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>mysql-tmp</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="title-mysqlid-mysqldescription-mysqlslug-docsinstallationsidebar_label-mysqlsidebar_position-1tags-mysql">title: &quot;MYSQL&quot;
id: MYSQL
description: &quot;MYSQL&quot;
slug: /docs/installation
sidebar_label: &quot;MYSQL&quot;
sidebar_position: 1
tags: [MYSQL]<a href="#title-mysqlid-mysqldescription-mysqlslug-docsinstallationsidebar_label-mysqlsidebar_position-1tags-mysql" class="hash-link" aria-label="Direct link to title: &quot;MYSQL&quot;
id: MYSQL
description: &quot;MYSQL&quot;
slug: /docs/installation
sidebar_label: &quot;MYSQL&quot;
sidebar_position: 1
tags: [MYSQL]" title="Direct link to title: &quot;MYSQL&quot;
id: MYSQL
description: &quot;MYSQL&quot;
slug: /docs/installation
sidebar_label: &quot;MYSQL&quot;
sidebar_position: 1
tags: [MYSQL]">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mysql结构">mysql结构<a href="#mysql结构" class="hash-link" aria-label="Direct link to mysql结构" title="Direct link to mysql结构">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="架构">架构<a href="#架构" class="hash-link" aria-label="Direct link to 架构" title="Direct link to 架构">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="连接层">连接层<a href="#连接层" class="hash-link" aria-label="Direct link to 连接层" title="Direct link to 连接层">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="服务层">服务层<a href="#服务层" class="hash-link" aria-label="Direct link to 服务层" title="Direct link to 服务层">​</a></h3>
<ol>
<li>SQL接口：接收SQL语句（如SELECT * FROM users）</li>
<li>查询解析器：生成解析树（如语法树AST）</li>
<li>查询优化器：基于代价模型生成执行计划（EXPLAIN可查看）</li>
<li>执行器：调用存储引擎API执行操作 :调用存储引擎接口执行操作（如读写数据），并处理事务提交/回滚</li>
<li>事务管理器:仅支持事务的引擎如 InnoDB）： 通过 undo log 实现原子性（回滚），锁机制与 MVCC 实现隔离性，redo log 实现持久性</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="存储层">存储层<a href="#存储层" class="hash-link" aria-label="Direct link to 存储层" title="Direct link to 存储层">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="锁">锁<a href="#锁" class="hash-link" aria-label="Direct link to 锁" title="Direct link to 锁">​</a></h3>
<p>全局锁
表级锁
表共享锁（S锁）：允许多事务同时读，禁止写。
表排他锁（X锁）：禁止其他事务读写
元数据锁（MDL）：自动加锁，保护表结构（如 ALTER TABLE）
行级锁
记录锁（Record Lock）：锁定索引记录。
间隙锁（Gap Lock）：锁定<strong>索引间隙</strong>（如 1 和 3 之间的间隙），防止插入幻读。
临键锁（Next-Key Lock）：记录锁 + 间隙锁（默认行锁算法）
高并发写操作：如电商库存扣减（FOR UPDATE 确保原子更新）
防止幻读：范围查询时用临键锁（RR 隔离级别下）</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="innodb的行锁在哪些场景下会退化为表锁如何避免这种情况">InnoDB的行锁在哪些场景下会退化为表锁？如何避免这种情况？<a href="#innodb的行锁在哪些场景下会退化为表锁如何避免这种情况" class="hash-link" aria-label="Direct link to InnoDB的行锁在哪些场景下会退化为表锁？如何避免这种情况？" title="Direct link to InnoDB的行锁在哪些场景下会退化为表锁？如何避免这种情况？">​</a></h4>
<ol>
<li>无索引/索引失效	全表扫描	强制建索引，避免索引失效</li>
<li>低区分度索引	优化器弃用索引	改用组合索引或高基数字段</li>
<li>大范围查询	间隙锁+行锁覆盖过多数据	分批操作，缩小查询范围</li>
<li>高并发锁冲突	InnoDB主动升级锁	缩短事务，降低隔离级别（这个为什么可以）</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="为什么分布式下的mysql都是使用读已提交的">为什么分布式下的mysql都是使用读已提交的？<a href="#为什么分布式下的mysql都是使用读已提交的" class="hash-link" aria-label="Direct link to 为什么分布式下的mysql都是使用读已提交的？" title="Direct link to 为什么分布式下的mysql都是使用读已提交的？">​</a></h4>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="分布式下的mysql应该如何设置需要解决什么问题">分布式下的mysql应该如何设置，需要解决什么问题<a href="#分布式下的mysql应该如何设置需要解决什么问题" class="hash-link" aria-label="Direct link to 分布式下的mysql应该如何设置，需要解决什么问题" title="Direct link to 分布式下的mysql应该如何设置，需要解决什么问题">​</a></h4>
<ol>
<li>
<p>数据分片：
范围分片：按时间或ID范围划分（如订单表按月分区） ：时序数据（日志、订单） 易出现数据倾斜
哈希分片：通过user_id % N分散数据（N为分片数），避免热点 ： 均匀分布需求（用户表） 扩容需数据迁移
基因分片：结合业务属性（如地域）分片，减少跨片查询。 关联查询多的业务（电商） 路由逻辑复杂
（比如用订单和用户， 将用户id的后n位强制写到订单生成规则中，这样 根据hash n位的数据得到的就是同一个分片
分片工具：
客户端
服务端</p>
</li>
<li>
<p>读写分离和主从复制：
主库启用binlog，从库设置relay-log和read-only=1  这里是为什么
使用GTID保障复制一致性，避免位点同步问题 GTID  是啥？
读写分离：
客户端代理， select 和其他语句分离
服务端代理：配置规则</p>
</li>
<li>
<p>主从延迟应对：
减小事务
并行事务 slave_parallel_workers？</p>
</li>
<li>
<p>一致性方案：
最终一致性：
异步复制场景下，通过重试机制或消息队列补偿（如订单状态同步）
。
强一致性方案：？
分布式事务：XA协议（性能低）、Seata的AT模式
。
同步复制：半同步复制（rpl_semi_sync_master_wait_point=AFTER_SYNC），但牺牲吞吐量</p>
</li>
<li>
<p>性能与扩展性优化
问题：跨分片查询效率低、连接池瓶颈。
解决方案：</p>
</li>
</ol>
<p>查询优化：
分片键设计：确保高频查询命中单一分片（如按user_id查订单）
。
全局索引表：对非分片键查询（如商品名称），建立独立索引表
。
连接池配置：
使用HikariCP/Druid，设置max_pool_size=CPU核数*2 + 1
。
缓存层设计：
旁路缓存（Cache Aside）：先读缓存，未命中则读库并回写，更新时先写库再删缓存
。
5. 高可用与故障恢复
问题：节点故障导致服务中断、数据丢失风险。
解决方案：</p>
<p>高可用架构：
MHA（Master High Availability）：主库故障时自动切换从库
。
Orchestrator/Consul：自动化故障检测与切换
。
数据备份：
物理备份：Percona XtraBackup热备份，支持增量
。
逻辑备份：mysqldump导出关键表，结合Binlog恢复
。
6. 监控与运维
问题：分布式系统复杂度高，难以及时发现异常。
解决方案：</p>
<p>监控工具：
PMM：监控慢查询、锁等待、复制延迟
。
Prometheus+Grafana：自定义指标可视化（如分片负载均衡状态）
。
日志分析：
开启慢查询日志（slow_query_log=1），定期分析pt-query-digest</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql执行流程">sql执行流程<a href="#sql执行流程" class="hash-link" aria-label="Direct link to sql执行流程" title="Direct link to sql执行流程">​</a></h3>
<p>连接和解析
比如 UPDATE user SET money=100 WHERE id=1;
1.连接器： 身份验证
2.分析器：检查sql语法
3.优化器：根据执行成本进行sql优化
锁定行目标行，防止别人修改
锁超时时多久？
4， 写日志 留后路
Undo Log（回滚日志 : 先把旧值（如 money=50）存到 Undo Log。万一要回滚（比如事务取消），就用它恢复原状
打算改什么（物理日志）
Redo Log
① 先写内存的 Log Buffer →
② 事务提交时刷盘（默认策略 innodb_flush_log_at_trx_commit=1 保证崩溃不丢）
。
设计巧思：直接写磁盘慢，先写 Redo Log（顺序写）再异步刷数据（随机写），性能提升 10 倍以上
Binlog（归档日志）：
作用：记录“改了啥”（逻辑日志，如 SQL 语句），用于主从复制或数据恢复
提交顺序：在 Redo Log 写完后写入（下一步细说）。</p>
<p>S1[Redo Log Prepare] --&gt; S2[写Binlog] --&gt; S3[Redo Log Commit]
两阶段提交（保证日志一致）
死在 S1 前：日志不全，事务作废。
死在 S2 前：Redo Log 有 Prepare 但无 Binlog，回滚。
死在 S3 前：Binlog 已写，重启后自动 Commit 完成事务</p>
<p>💾 改内存与刷盘（延迟写磁盘）
Buffer Pool（内存工作区）：
数据从磁盘加载到 Buffer Pool（类似草稿纸），在内存中直接改（如 money=50 → 100），改完叫“脏页”
性能关键：改内存比写磁盘快得多（纳秒 vs 毫秒）
刷脏页：
后台线程在系统空闲时，把脏页写回磁盘（类似定期整理笔记到档案）
触发条件：
Buffer Pool 满了（淘汰旧页）
Redo Log 写满了（循环复用前必须刷）
提交事务与释放锁</p>
<p>锁行 → 留旧档（Undo）→ 改内存 → 记操作（Redo+Binlog）→ 对账提交 → 后台刷盘。
设计精髓：日志先行，内存优先，锁保安全。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mysql的读锁和写锁在什么时候加mvvc时候使用的锁是什么锁">mysql的读锁和写锁在什么时候加，mvvc时候使用的锁是什么锁<a href="#mysql的读锁和写锁在什么时候加mvvc时候使用的锁是什么锁" class="hash-link" aria-label="Direct link to mysql的读锁和写锁在什么时候加，mvvc时候使用的锁是什么锁" title="Direct link to mysql的读锁和写锁在什么时候加，mvvc时候使用的锁是什么锁">​</a></h4>
<p>显示加锁:
读锁（S锁  SELECT ... LOCK IN SHARE MODE， 需要确保读取的数据不会给我其他事务修改（如报表生成时）
写锁： SELECT ... FOR UPDATE
隐式加锁场景
写操作自动枷锁， 而读操作不会</p>
<p>MVCC 实现无锁读提升并发，X锁保证写操作原子性，两者共同保障高并发下的数据一致性</p>
<p>mysql在修改数据时，有索引和没索引分别是怎么加锁的，索引不同类型枷锁逻辑一样吗</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mvcc--解决读写冲突">MVCC : 解决读写冲突<a href="#mvcc--解决读写冲突" class="hash-link" aria-label="Direct link to MVCC : 解决读写冲突" title="Direct link to MVCC : 解决读写冲突">​</a></h3>
<p>实现原理：
数据存在多个版本（事务id， 回滚指针）
Read View ：MVCC = 给数据拍快照 + 读旧不改新 + 按规则挑版本
最小事务id（当前系统中活跃事务的最小ID值） + 活跃事务id列表 + 下一个待分配的事务id</p>
<p>只读事务ID ≤ 自己事务ID 的数据（确保是自己或前人改的）
排除未提交事务改的数据（避免脏读）
读已提交（RC）：每次读都新生成一个Read View → 能读到别人刚提交的数据
可重复读（RR）：事务内只用第一个Read View → 全程读同一份快照（别人提交了也看不见）</p>
<p>ReadView  = 最小活跃事务id + 活跃事务列表 + 下一个待分配事务id + 当前事务id</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="主从复制的格式">主从复制的格式<a href="#主从复制的格式" class="hash-link" aria-label="Direct link to 主从复制的格式" title="Direct link to 主从复制的格式">​</a></h3>
<p>分布式的binlog为什么设置成Row格式 ：Binlog 的 ROW 格式记录行数据的变更值
Bin log类型：
STATEMENT  记录sql语句， 在分布式中有一致性风险： 如now()
ROW: 录行数据的变更值
MIXED: 动态选择格式 + 逻辑复杂，仍可能不一致 :行为不可预测：复杂语句可能意外切换格式，增加调试难度</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="主从复制流程">主从复制流程<a href="#主从复制流程" class="hash-link" aria-label="Direct link to 主从复制流程" title="Direct link to 主从复制流程">​</a></h3>
<p>MySQL主从复制的同步流程，用大白话解释就是：
主库把数据变更像“写日记”一样记下来，从库派人去“抄作业”，再自己动手把作业做完。整个过程分三步走，结合生活场景更好理解</p>
<p>主库写日记（记录变更）
主库收到写操作（比如新增订单、修改库存），会把操作细节写到自己的“流水账本”里（binlog日志）
这个账本记录的是操作内容（例如：“商品A库存减1”），而不是直接存数据文件
比喻：就像餐厅老板用笔记本记下每一笔订单（“3号桌点鱼香肉丝”）</p>
<p>第二步：从库抄作业（复制日志）
从库派个“学徒”（I/O线程）去主库那儿，把最新的账本内容抄回来
抄回来的内容存到从库的“临时笔记”里（relay log中继日志）
关键点：抄作业是异步的——主库不用等从库抄完，直接忙自己的事</p>
<p>第三步：从库自己做作业（执行变更）
从库再派个“厨师”（SQL线程），读取临时笔记（relay log）里的内容，照着操作一遍
比如看到“商品A库存减1”，就从自己数据库里减掉对应的库存
延迟问题：如果厨师手慢（从库性能差），或者订单太多（主库写入频繁），分店数据可能比总店“晚几步”
比喻：分店厨师根据抄回来的订单，一份一份做菜。</p>
<p>三种同步方式：
异步复制（默认）：主库不管从库抄没抄完，直接干别的（速度快，可能丢数据）
半同步复制：主库等至少一个从库说“抄完了！”才继续（平衡速度和安全性）
全同步复制：主库等所有从库都做完才响应（太慢，极少用）</p>
<p>在从库跑命令 SHOW SLAVE STATUS\G，看两个关键指标：
Slave_IO_Running：学徒（I/O线程）在干活吗？
Slave_SQL_Running：厨师（SQL线程）在干活吗？
两者都是 Yes 才算正常</p>
<p>主从延迟的核心原因</p>
<ol>
<li>硬件与资源瓶颈： 网络和IO</li>
<li>事务与SQL问题 ： 大事务， 慢sql， 锁等待（select update)
主库订单爆单（大事务），分店厨师忙不过来；
分店配置差（CPU/磁盘慢）；
网络卡顿（学徒路上堵车）</li>
</ol>
<p>mysql5.7支持并行复制
DATABASE模式 ：按数据库名分发事务，不同库的事务可并行执行，同一库内事务串行处理
MySQL 5.7：首选LOGICAL_CLOCK，配置slave_parallel_workers≥8 推荐 ???
基于主库的组提交（Group Commit）机制，同一组提交的事务在从库并行回放。通过last_committed和sequence_number标记事务组依赖关系
MySQL 8.0：启用WRITESET+有序主键，并行度提升3~5倍：
计算事务修改行的哈希值（Writeset），无行冲突的事务即可并行
依赖条件：表必须有主键或唯一索引（否则退化为LOGICAL_CLOCK）
通过哈希历史表（Writeset History）快速判断行冲突 ???</p>
<p>库并行 → 事务组并行 → 行级并行，粒度不断细化
生产建议：
MySQL 5.7：首选LOGICAL_CLOCK，配置slave_parallel_workers≥8
。
MySQL 8.0：启用WRITESET+有序主键，并行度提升3~5倍</p>
<h1>MySQL 专家级面试问题清单</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-基础与架构">1. 基础与架构<a href="#1-基础与架构" class="hash-link" aria-label="Direct link to 1. 基础与架构" title="Direct link to 1. 基础与架构">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="索引-indexing">索引 (Indexing)<a href="#索引-indexing" class="hash-link" aria-label="Direct link to 索引 (Indexing)" title="Direct link to 索引 (Indexing)">​</a></h3>
<ul>
<li>解释 <code>B-Tree</code> 索引（特别是 InnoDB 中使用的 <code>B+Tree</code>）的工作原理。为什么它是最常用的索引类型？它有哪些优势，又有哪些局限性（在哪些场景下可能不是最佳选择）？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="存储引擎-storage-engines">存储引擎 (Storage Engines)<a href="#存储引擎-storage-engines" class="hash-link" aria-label="Direct link to 存储引擎 (Storage Engines)" title="Direct link to 存储引擎 (Storage Engines)">​</a></h3>
<ul>
<li>详细比较 <code>InnoDB</code> 和 <code>MyISAM</code> 的主要区别（事务支持、锁级别、崩溃恢复、外键、索引结构、表空间管理等）。在什么场景下可能会考虑使用 <code>MyISAM</code>（尽管现在很少了）？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="事务-transactions">事务 (Transactions)<a href="#事务-transactions" class="hash-link" aria-label="Direct link to 事务 (Transactions)" title="Direct link to 事务 (Transactions)">​</a></h3>
<ul>
<li>解释数据库事务的 <code>ACID</code> 属性。<code>InnoDB</code> 是如何通过各种机制（如 <code>undo log</code>、<code>redo log</code>、锁）来实现 <code>ACID</code> 特性的？</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-查询性能与优化">2. 查询性能与优化<a href="#2-查询性能与优化" class="hash-link" aria-label="Direct link to 2. 查询性能与优化" title="Direct link to 2. 查询性能与优化">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="执行计划-execution-plans">执行计划 (Execution Plans)<a href="#执行计划-execution-plans" class="hash-link" aria-label="Direct link to 执行计划 (Execution Plans)" title="Direct link to 执行计划 (Execution Plans)">​</a></h3>
<ul>
<li>如何解读 <code>EXPLAIN</code> 的输出（重点关注 <code>type</code>、<code>key</code>、<code>key_len</code>、<code>rows</code>、<code>Extra</code> 等字段）？看到 <code>ALL</code>、<code>index</code>、<code>range</code> 等 <code>type</code> 分别意味着什么？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="慢查询-slow-queries">慢查询 (Slow Queries)<a href="#慢查询-slow-queries" class="hash-link" aria-label="Direct link to 慢查询 (Slow Queries)" title="Direct link to 慢查询 (Slow Queries)">​</a></h3>
<ul>
<li>描述诊断和优化慢查询的步骤（从定位慢查询、分析执行计划到具体的优化手段）。如何启用和有效利用 MySQL 的慢查询日志？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="索引优化">索引优化<a href="#索引优化" class="hash-link" aria-label="Direct link to 索引优化" title="Direct link to 索引优化">​</a></h3>
<ul>
<li>什么是 <code>覆盖索引</code>？为什么它通常能显著提升查询性能？</li>
<li>什么是 <code>索引下推</code>？它解决了什么问题？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="join-优化">JOIN 优化<a href="#join-优化" class="hash-link" aria-label="Direct link to JOIN 优化" title="Direct link to JOIN 优化">​</a></h3>
<ul>
<li>MySQL 优化器是如何决定 <code>JOIN</code> 顺序的（基于什么信息）？有哪些策略可以优化多表 <code>JOIN</code> 的性能？</li>
<li>什么是 <code>Block Nested-Loop Join (BNL)</code> 和 <code>Hash Join</code>（如果 MySQL 版本支持）？各自的适用场景？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="常见陷阱">常见陷阱<a href="#常见陷阱" class="hash-link" aria-label="Direct link to 常见陷阱" title="Direct link to 常见陷阱">​</a></h3>
<ul>
<li>为什么使用 <code>SELECT *</code> 通常是低效的？</li>
<li><code>LIKE &#x27;%value%&#x27;</code> 查询有什么性能问题？有什么替代方案吗？</li>
<li>函数操作列（如 <code>WHERE YEAR(date_column) = 2023</code>）会对索引使用产生什么影响？如何规避？</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-锁与并发控制">3. 锁与并发控制<a href="#3-锁与并发控制" class="hash-link" aria-label="Direct link to 3. 锁与并发控制" title="Direct link to 3. 锁与并发控制">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="锁机制-locking">锁机制 (Locking)<a href="#锁机制-locking" class="hash-link" aria-label="Direct link to 锁机制 (Locking)" title="Direct link to 锁机制 (Locking)">​</a></h3>
<ul>
<li><code>InnoDB</code> 的行级锁是如何实现的（记录锁、间隙锁、Next-Key 锁）？请描述这些锁的机制以及它们在不同事务隔离级别下的表现。</li>
<li><code>共享锁(S锁)</code> 和 <code>排他锁(X锁)</code> 有何区别？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="死锁-deadlocks">死锁 (Deadlocks)<a href="#死锁-deadlocks" class="hash-link" aria-label="Direct link to 死锁 (Deadlocks)" title="Direct link to 死锁 (Deadlocks)">​</a></h3>
<ul>
<li>什么是死锁？<code>InnoDB</code> 如何检测和解决死锁？</li>
<li>在应用程序层面，有哪些策略可以尽量减少或避免死锁的发生？如何查看和分析 MySQL 中的死锁信息？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="隔离级别-isolation-levels">隔离级别 (Isolation Levels)<a href="#隔离级别-isolation-levels" class="hash-link" aria-label="Direct link to 隔离级别 (Isolation Levels)" title="Direct link to 隔离级别 (Isolation Levels)">​</a></h3>
<ul>
<li>MySQL 支持哪些事务隔离级别（Read Uncommitted, Read Committed, Repeatable Read, Serializable）？</li>
<li>详细解释 <code>READ COMMITTED</code> 和 <code>REPEATABLE READ</code>（InnoDB 的默认级别）在解决 <strong>脏读</strong>、<strong>不可重复读</strong> 和 <strong>幻读</strong> 问题上的区别。</li>
<li><code>REPEATABLE READ</code> 真的完全杜绝幻读了吗？</li>
<li><code>Serializable</code> 级别的代价是什么？</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-复制与高可用性-replication--high-availability">4. 复制与高可用性 (Replication &amp; High Availability)<a href="#4-复制与高可用性-replication--high-availability" class="hash-link" aria-label="Direct link to 4. 复制与高可用性 (Replication &amp; High Availability)" title="Direct link to 4. 复制与高可用性 (Replication &amp; High Availability)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="主从复制-master-slave-replication">主从复制 (Master-Slave Replication)<a href="#主从复制-master-slave-replication" class="hash-link" aria-label="Direct link to 主从复制 (Master-Slave Replication)" title="Direct link to 主从复制 (Master-Slave Replication)">​</a></h3>
<ul>
<li>描述基于 Binlog 的主从复制的基本原理（包含 Binlog 格式：<code>Statement</code>、<code>Row</code>、<code>Mixed</code>）。每种 Binlog 格式有什么优缺点？</li>
<li>什么是 <code>半同步复制</code>（Semisynchronous Replication）？它与异步复制相比优势在哪？</li>
<li>如何监控复制延迟？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="故障切换-failover">故障切换 (Failover)<a href="#故障切换-failover" class="hash-link" aria-label="Direct link to 故障切换 (Failover)" title="Direct link to 故障切换 (Failover)">​</a></h3>
<ul>
<li>当主库宕机时，如何进行主从切换？这通常涉及哪些步骤和潜在风险？</li>
<li>了解哪些自动故障切换方案？<code>GTID</code>（Global Transaction Identifier）在主从复制和故障切换中有什么重要作用？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="读写分离">读写分离<a href="#读写分离" class="hash-link" aria-label="Direct link to 读写分离" title="Direct link to 读写分离">​</a></h3>
<ul>
<li>如何利用主从复制实现读写分离？</li>
<li>在读写分离架构中，会遇到什么问题（比如主从延迟导致的数据不一致）？如何应对这些问题？</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-模式设计与数据类型">5. 模式设计与数据类型<a href="#5-模式设计与数据类型" class="hash-link" aria-label="Direct link to 5. 模式设计与数据类型" title="Direct link to 5. 模式设计与数据类型">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="范式-vs-反范式">范式 vs 反范式<a href="#范式-vs-反范式" class="hash-link" aria-label="Direct link to 范式 vs 反范式" title="Direct link to 范式 vs 反范式">​</a></h3>
<ul>
<li>在数据库模式设计时，如何权衡 <code>规范化</code>（范式）和 <code>反范式化</code>？分别会带来什么好处和代价？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="数据类型选择">数据类型选择<a href="#数据类型选择" class="hash-link" aria-label="Direct link to 数据类型选择" title="Direct link to 数据类型选择">​</a></h3>
<ul>
<li>为不同的数据选择合适的 <code>数据类型</code>（如 <code>INT</code> vs <code>BIGINT</code>、<code>CHAR</code> vs <code>VARCHAR</code>、<code>TEXT/BLOB</code> vs <code>VARCHAR</code>、<code>DATETIME</code> vs <code>TIMESTAMP</code>）有多重要？</li>
<li>为什么使用 <code>ENUM</code> 或 <code>SET</code> 有时是危险的？</li>
<li><code>VARCHAR(255)</code> 有什么特殊含义吗？为什么很多人倾向于使用它？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="auto-increment-pk-vs-uuid">Auto Increment PK vs UUID<a href="#auto-increment-pk-vs-uuid" class="hash-link" aria-label="Direct link to Auto Increment PK vs UUID" title="Direct link to Auto Increment PK vs UUID">​</a></h3>
<ul>
<li>将 <code>AUTO_INCREMENT</code> 整数作为主键和 <code>UUID</code> 作为主键有何优缺点？什么情况下更倾向于使用 <code>UUID</code>？</li>
<li>使用 <code>UUID</code> 作为主键对 InnoDB 有什么性能影响？</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-日志备份与恢复">6. 日志、备份与恢复<a href="#6-日志备份与恢复" class="hash-link" aria-label="Direct link to 6. 日志、备份与恢复" title="Direct link to 6. 日志、备份与恢复">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="日志文件">日志文件<a href="#日志文件" class="hash-link" aria-label="Direct link to 日志文件" title="Direct link to 日志文件">​</a></h3>
<ul>
<li>解释 <code>Binlog</code>、<code>Redo Log</code> 和 <code>Undo Log</code> 各自的作用。它们在数据恢复、复制、事务实现中扮演什么角色？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="备份策略">备份策略<a href="#备份策略" class="hash-link" aria-label="Direct link to 备份策略" title="Direct link to 备份策略">​</a></h3>
<ul>
<li>描述常用的 MySQL 备份方法（如 <code>mysqldump</code>、<code>mysqlpump</code>、<code>mydumper</code>、Percona XtraBackup 等）。它们的优缺点是什么（如逻辑备份 vs 物理备份、备份时间、恢复时间、对线上性能影响）？</li>
<li>什么是 <code>Point-in-Time Recovery (PITR)</code>？如何实现？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="恢复演练">恢复演练<a href="#恢复演练" class="hash-link" aria-label="Direct link to 恢复演练" title="Direct link to 恢复演练">​</a></h3>
<ul>
<li>为什么仅仅有备份是不够的？为什么 <code>定期进行恢复演练</code> 至关重要？</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-管理与监控">7. 管理与监控<a href="#7-管理与监控" class="hash-link" aria-label="Direct link to 7. 管理与监控" title="Direct link to 7. 管理与监控">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="监控指标">监控指标<a href="#监控指标" class="hash-link" aria-label="Direct link to 监控指标" title="Direct link to 监控指标">​</a></h3>
<ul>
<li>你会监控哪些关键的 MySQL 性能指标（如 <code>QPS/TPS</code>、连接数、慢查询、锁等待、Buffer Pool 命中率、复制延迟、InnoDB 状态变量等）？</li>
<li>使用什么工具（<code>SHOW STATUS</code>、<code>SHOW ENGINE INNODB STATUS</code>、<code>Performance Schema</code>、<code>Sys Schema</code>、Prometheus + Grafana 等）？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="连接管理">连接管理<a href="#连接管理" class="hash-link" aria-label="Direct link to 连接管理" title="Direct link to 连接管理">​</a></h3>
<ul>
<li>应用程序连接池设置不当可能导致什么问题（比如耗尽连接数）？如何配置合理的 <code>max_connections</code> 和相关参数？</li>
<li>如何处理过多的 <code>Sleep</code> 连接？</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-安全-security">8. 安全 (Security)<a href="#8-安全-security" class="hash-link" aria-label="Direct link to 8. 安全 (Security)" title="Direct link to 8. 安全 (Security)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="常见威胁">常见威胁<a href="#常见威胁" class="hash-link" aria-label="Direct link to 常见威胁" title="Direct link to 常见威胁">​</a></h3>
<ul>
<li>如何防止 <code>SQL 注入攻击</code>？</li>
<li>MySQL 数据库有哪些常见的配置层面的安全加固措施（比如禁用 <code>LOCAL INFILE</code>、限制远程访问、最小权限原则）？密码策略怎么设置？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="加密">加密<a href="#加密" class="hash-link" aria-label="Direct link to 加密" title="Direct link to 加密">​</a></h3>
<ul>
<li>了解 <code>Transparent Data Encryption (TDE)</code> 吗？</li>
<li>在 MySQL 中如何保护敏感数据（列加密 vs 应用层加密）？</li>
<li>使用 <code>SSL/TLS</code> 加密客户端连接需要做哪些配置？</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="9-版本特性与演进">9. 版本特性与演进<a href="#9-版本特性与演进" class="hash-link" aria-label="Direct link to 9. 版本特性与演进" title="Direct link to 9. 版本特性与演进">​</a></h2>
<ul>
<li>你了解 MySQL 5.7 和 8.0 引入的一些主要特性吗（比如 MySQL 8.0 的 <code>窗口函数</code>、<code>原子 DDL</code>、<code>角色</code>、<code>JSON 增强</code>、<code>Data Dictionary 使用 InnoDB</code>、默认字符集变为 <code>utf8mb4</code>）？这些特性解决了什么问题？</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="10-场景题-开放性问题">10. 场景题 (开放性问题)<a href="#10-场景题-开放性问题" class="hash-link" aria-label="Direct link to 10. 场景题 (开放性问题)" title="Direct link to 10. 场景题 (开放性问题)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="场景一">场景一<a href="#场景一" class="hash-link" aria-label="Direct link to 场景一" title="Direct link to 场景一">​</a></h3>
<ul>
<li>你在一个大型电商系统中负责数据库。在高峰期，一个核心商品的详情页查询突然变得非常慢。简述你的排查思路。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="场景二">场景二<a href="#场景二" class="hash-link" aria-label="Direct link to 场景二" title="Direct link to 场景二">​</a></h3>
<ul>
<li>你们团队计划将数据库从 MySQL 5.6 迁移到 MySQL 8.0。你会进行哪些评估和准备工作？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="经验分享">经验分享<a href="#经验分享" class="hash-link" aria-label="Direct link to 经验分享" title="Direct link to 经验分享">​</a></h3>
<ul>
<li>分享一个你处理过的最具挑战性的 MySQL 性能问题或故障。你是如何分析、定位和解决的？学到了什么？</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="架构考量">架构考量<a href="#架构考量" class="hash-link" aria-label="Direct link to 架构考量" title="Direct link to 架构考量">​</a></h3>
<ul>
<li>设计一个需要极高读写吞吐量（如每秒上万 TPS）和低延迟的系统时，你会如何在数据库层面进行架构设计？（考虑分库分表、缓存、读写分离、使用 NewSQL 等方向）</li>
</ul>
<p>在分布式系统中如何保证事务的ACID特性？有哪些常见的分布式事务解决方案？</p>
<p>事务支持
原子性 (Atomicity)：这个最好理解，就是‘要么全干完，要么全不干’。
比如转账：我转给你100块，这个操作包含‘我账户减100’和‘你账户加100’两步。原子性保证这两步必须一起成功或一起失败。不可能出现我钱扣了，你钱没加上这种‘中间状态’。要是第二步出错了，整个操作会回滚，我扣掉的钱也会加回来，就像什么都没发生过一样。怎么做到的呢？ 主要靠 Undo Log（回滚日志）。数据库在改数据之前，会先把改动前的样子记在这个日志里。万一要回滚（比如出错或者主动ROLLBACK），就按照这个日志把数据‘倒带’回去
。
一致性 (Consistency)：
这个是说，事务不管成功还是失败，都不能把数据库搞‘乱套’，得从一个‘合理’状态变到另一个‘合理’状态。
还是转账例子：转账前我俩总共有3000块，转账后，无论成功失败，我俩总和还得是3000块（成功：我2900你1100；失败：还是我3000你0）。数据库自己也会帮忙守规矩，比如设了‘余额不能为负’的检查，如果我转完钱变负数了，事务就会失败回滚，保证数据始终‘合理’。怎么做到的呢？
它其实是靠原子性、隔离性和持久性这三个兄弟一起努力实现的最终结果。数据库本身的约束（主键、外键、Check约束）和业务逻辑也在帮忙</p>
<p>隔离性 (Isolation)：
这个是说，好多事儿（事务）同时办的时候，别互相‘串台’了。
想象一下，你正在看我账户余额准备给我发工资，我同时在转账。隔离性保证你看到我的余额时，要么是我转账前的钱，要么是我转账后的钱，绝对不会看到我转账‘减了100块但还没加给对方’这种中间混乱状态（这叫‘脏读’）。
MySQL提供了几个‘隔离级别’（比如读已提交、可重复读）让我们选，平衡‘不串台’的程度和性能。级别越高越不‘串台’，但可能越慢。怎么做到的呢？ 主要靠两招：锁（Locking）和 MVCC（多版本并发控制）。锁就是‘我先用，你等着’；MVCC更巧妙，它让每个事务看到的是数据在某个时间点的‘快照’，大家看各自的‘快照’，互不干扰。默认的可重复读（RR）级别下，InnoDB引擎还通过‘临键锁’(Next-Key Locks) 基本解决了幻读问题
。
持久性 (Durability)：
这个最简单粗暴，就是说‘这事儿办成了，就板上钉钉了！’
一旦我点了‘确认转账’，系统告诉我‘转账成功’，那么即使这时电脑突然断电、数据库崩溃了，等重启之后，我的钱肯定是扣掉的，你的钱肯定是加上的。成功提交的结果绝对不会丢。怎么做到的呢？
核心是靠 Redo Log（重做日志）。事务提交的时候，并不是立刻把修改写到真正的数据文件里（因为直接写磁盘慢），而是先把‘我干了啥’（修改记录）快速写到这个Redo Log文件里（顺序写，很快），并且确保这个日志刷到磁盘上才算完事。之后数据库再找机会慢慢把数据从内存刷到磁盘。万一崩溃了，重启时数据库就用Redo Log这个‘操作记录’来重做一遍，把丢失的修改恢复回来</p>
<p>在高并发场景中，如何根据业务需求选择合适的隔离级别？</p>
<p>锁：
全局锁
表共享锁（S锁）：允许多事务同时读，禁止写。
表排他锁（X锁）：禁止其他事务读写
元数据锁（MDL）：自动加锁，保护表结构（如 ALTER TABLE）</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sql优化逻辑">sql优化逻辑<a href="#sql优化逻辑" class="hash-link" aria-label="Direct link to sql优化逻辑" title="Direct link to sql优化逻辑">​</a></h2>
<p>终极口诀#
发现慢SQL → EXPLAIN分析 → 缺索引就加 → 避免索引失效 → 优化SQL写法 → 拆表改配置 → 还不快？上缓存/读写分离！</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="查询语句优化">查询语句优化<a href="#查询语句优化" class="hash-link" aria-label="Direct link to 查询语句优化" title="Direct link to 查询语句优化">​</a></h3>
<ul>
<li>避免全表扫描
禁止 SELECT *，明确指定所需列（如 SELECT id, name）</li>
</ul>
<ol start="2">
<li>避免 LIKE &#x27;%value%&#x27;，改用 LIKE &#x27;value%&#x27; 或全文索引</li>
<li>减少函数操作（如 WHERE YEAR(date) = 2025 → WHERE date BETWEEN &#x27;2025-01-01&#x27; AND &#x27;2025-12-31&#x27;）</li>
</ol>
<ul>
<li>简化复杂操作</li>
</ul>
<ol>
<li>用 JOIN 替代子查询，减少嵌套层级</li>
<li>拆分大查询（如分页用 LIMIT，避免单次返回过多数据）</li>
<li>用 BETWEEN 替代 IN 处理连续值（如 num BETWEEN 1 AND 5）</li>
</ol>
<ul>
<li>利用缓存与批处理</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-二索引优化">📌 二、索引优化<a href="#-二索引优化" class="hash-link" aria-label="Direct link to 📌 二、索引优化" title="Direct link to 📌 二、索引优化">​</a></h3>
<ul>
<li>设计高效索引</li>
</ul>
<ol>
<li>组合索引：按查询频率和选择性排序</li>
<li>覆盖索引：包含查询所有字段（这样就不需要回表）</li>
<li>前缀索引#：对长字符串列（mysql索引有长度限制的）</li>
</ol>
<ul>
<li>避免索引失效</li>
</ul>
<ol>
<li>禁止对索引列运算</li>
<li>复合索引需满足最左前缀原则</li>
</ol>
<ul>
<li>维护索引</li>
</ul>
<ol>
<li>删除冗余索引（如已有 (a,b) 则无需单独 (a)</li>
<li>定期重建碎片索引：OPTIMIZE TABLE table_name？</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-三表结构与数据类型优化">🧱 三、表结构与数据类型优化<a href="#-三表结构与数据类型优化" class="hash-link" aria-label="Direct link to 🧱 三、表结构与数据类型优化" title="Direct link to 🧱 三、表结构与数据类型优化">​</a></h3>
<ul>
<li>合理设计表</li>
</ul>
<ol>
<li>字段类型最小化（如用 TINYINT 代替 INT，DATE 代替字符串存日期）</li>
<li>避免 NULL 字段，默认值替代？</li>
<li>控制单表字段数（建议 ≤20） ？</li>
<li>大字段（如文本）拆出去#：单独放一张表，主表只留ID关联</li>
</ol>
<ul>
<li>分区与分表</li>
</ul>
<ol>
<li>垂直分表：拆分大字段（如 TEXT）到独立表</li>
<li>水平分表：按时间分区（如 PARTITION BY RANGE (YEAR(date))）</li>
<li>归档历史数据（如 INSERT INTO archive_table SELECT * WHERE date &lt; &#x27;2020-01-01&#x27;）[冷热数据分离]</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="️-四配置参数与存储引擎">⚙️ 四、配置参数与存储引擎<a href="#️-四配置参数与存储引擎" class="hash-link" aria-label="Direct link to ⚙️ 四、配置参数与存储引擎" title="Direct link to ⚙️ 四、配置参数与存储引擎">​</a></h3>
<ul>
<li>关键参数调整</li>
</ul>
<ol>
<li>InnoDB缓冲池#：innodb_buffer_pool_size 设为物理内存的70%~80%</li>
<li>日志与事务：innodb_log_file_size=256M、innodb_flush_log_at_trx_commit=2（平衡安全与性能）</li>
<li>连接管理：max_connections=500、wait_timeout=1800（防连接泄漏）</li>
</ol>
<ul>
<li>存储引擎选择</li>
</ul>
<ol>
<li>InnoDB：支持事务、行级锁，适合高并发读写</li>
<li>MyISAM：仅读密集型场景（注意不支持事务）</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="上缓存读写分离">上缓存/读写分离<a href="#上缓存读写分离" class="hash-link" aria-label="Direct link to 上缓存/读写分离" title="Direct link to 上缓存/读写分离">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="读写分离高并发时写操作走主库读操作甩给从库1主多从">读写分离#：高并发时，写操作走主库，读操作甩给从库（1主多从）。<a href="#读写分离高并发时写操作走主库读操作甩给从库1主多从" class="hash-link" aria-label="Direct link to 读写分离#：高并发时，写操作走主库，读操作甩给从库（1主多从）。" title="Direct link to 读写分离#：高并发时，写操作走主库，读操作甩给从库（1主多从）。">​</a></h4>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="加缓存频繁读的结果比如商品详情丢redis别反复查数据库">加缓存：频繁读的结果（比如商品详情）丢Redis，别反复查数据库。<a href="#加缓存频繁读的结果比如商品详情丢redis别反复查数据库" class="hash-link" aria-label="Direct link to 加缓存：频繁读的结果（比如商品详情）丢Redis，别反复查数据库。" title="Direct link to 加缓存：频繁读的结果（比如商品详情）丢Redis，别反复查数据库。">​</a></h4>
<p>当数据量达到500GB时性能会显著下降
。而TiDB支持无感水平扩展，通过增加节点即可实现PB级数据处理</p>
<p>TiDB通过Raft协议实现多副本冗余，自动故障转移，恢复时间小于30秒
，真正实现数据零丢失</p>
<p>#MySQL 集群：
#主从架构#：依赖主节点处理写操作，从节点异步复制数据（Binlog 日志），存在数据延迟风险
。
#单机存储#：数据与计算耦合，扩展需依赖分库分表中间件（如 ShardingSphere），业务侵入性强</p>
<p>存储引擎瓶颈：B+树维护成本剧增
InnoDB 使用 B+ 树索引，当数据量达到 500GB 时，索引层级可能从 2-3 层增至 4-5 层，查询需更多磁盘 I/O（从 1-3 次增至 4-5 次）
。
#关键瓶颈：SMO（结构修改操作）的并发限制#
数据增删改触发 B+ 树分裂/合并时，InnoDB 需对根节点加 #SX 锁（意向排他锁）#，导致所有 SMO 操作串行执行。高并发写入场景下，锁竞争激烈，吞吐量骤降</p>
<p>I/O 瓶颈：磁盘读写效率暴跌#
#内存与数据量比例失衡#
InnoDB 依赖缓冲池（innodb_buffer_pool_size）缓存热点数据。假设服务器内存 64GB，缓冲池设为 48GB，500GB 数据仅 #9.6% 可缓存，剩余 90% 需频繁读写磁盘
。
随机读写场景下，机械硬盘 IOPS 约 100-200，SSD 约 1 万-10 万。500GB 数据导致大量随机 I/O，机械硬盘延迟显著（如 10ms/次），SSD 寿命与性能亦受影响
。
#日志写入压力#
事务提交需写 Redo Log（重做日志），500GB 数据伴随高频写入时，日志文件刷新（innodb_flush_log_at_trx_commit=1）成为 I/O 瓶颈
。</p>
<p>索引效率下降：查询成本指数级增长#
#索引深度增加与碎片化#
大表索引层级加深，范围查询（如 WHERE date BETWEEN ...）需遍历更多节点，耗时增加
。
频繁增删导致索引碎片化，物理存储不连续，进一步增加随机 I/O。即使有索引，查询效率仍可能下降 30% 以上
。
#统计信息不准确#
InnoDB 采样统计索引分布（如 innodb_stats_sample_pages），500GB 数据下采样率不足，导致优化器选择低效执行计划（如全表扫描代替索引扫描）
。</p>
<p>#总结：500GB 为何成为性能拐点？##
#硬件天花板#：内存远小于数据量，I/O 成绝对瓶颈。
#架构限制#：B+ 树维护的串行化、索引深度、统计信息精度等问题被放大
。
#运维成本#：备份、索引维护、扩容等操作复杂度陡增。</p>
<p>#分库分表#：按业务拆分数据至多个物理节点
。
#冷热分离#：将历史数据归档至独立存储（如 TokuDB 高压缩引擎）
。
#读写分离 + 缓存#：用 Redis 缓存热点数据，查询分流至从库
。
#SSD 与内存升级#：NVMe SSD 提升 I/O，内存扩容至数据量的 20% 以上
。
#索引优化#：定期重建碎片索引，使用覆盖索引减少回表
。</p>
<p>某电商订单表达 400GB 后查询延迟超 10 秒，通过分表（按月拆分）+ 缓冲池扩容至 128GB + 归档 2 年前数据，性能恢复至毫秒级响应</p>
<p>优化策略包括基于成本的优化（CBO）和谓词下推（Predicate Pushdown）
CBO(cost-base-optimization) <!-- -->:io<!-- -->（磁盘和内存）和cpu（包括条件过滤（row_evaluate_cost）、排序、聚合等操作，默认每行处理成本为 0.1 ）
谓词下推（Predicate Pushdown）:提前过滤数据、减少I/O</p>
<ol>
<li>将WHERE条件尽可能提前到数据源（如存储引擎层）执行，减少后续处理的数据量</li>
</ol>
<div class="language-mysql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-mysql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- 未优化：先JOIN后过滤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SELECT * FROM orders JOIN items ON orders.item_id = items.id </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    WHERE items.category = &#x27;Electronics&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -- 优化后：先过滤items表再JOIN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SELECT * FROM orders </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    JOIN (SELECT * FROM items WHERE category = &#x27;Electronics&#x27;) AS filtered_items </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ON orders.item_id = filtered_items.id;</span><br></span></code></pre></div></div>
<ol start="2">
<li>ICP（Index Condition Pushdown）:将WHERE条件下推至存储引擎层，在扫描<strong>二级索引</strong>时过滤数据，减少回表次数</li>
<li>分布式数据库中的扩展</li>
</ol>
<ul>
<li>Bloom Filter下推:在Hash Join前，用小表构建Bloom Filter广播到大表节点，提前过滤无效数据?</li>
<li>列式存储优化:利用列统计信息（如Min/Max）跳过无关数据块（如Parquet格式）</li>
</ul>
<ol start="4">
<li>使用限制<!-- -->:Left<!-- --> Join中右表条件可下推，但左表条件不可下推（需保留所有左表行),若条件包含 RAND()、UNIX_TIMESTAMP() 等函数，整个谓词无法下推</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="缓冲区">缓冲区<a href="#缓冲区" class="hash-link" aria-label="Direct link to 缓冲区" title="Direct link to 缓冲区">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="buffer-pool缓存数据页和索引页-采用lru算法">Buffer Pool：缓存数据页和索引页, 采用lru算法<a href="#buffer-pool缓存数据页和索引页-采用lru算法" class="hash-link" aria-label="Direct link to Buffer Pool：缓存数据页和索引页, 采用lru算法" title="Direct link to Buffer Pool：缓存数据页和索引页, 采用lru算法">​</a></h3>
<h3></h3>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="显式加读锁--可用户生成一致性报表和写锁是冲突的">显式加读锁 ： 可用户生成一致性报表，和写锁是冲突的<a href="#显式加读锁--可用户生成一致性报表和写锁是冲突的" class="hash-link" aria-label="Direct link to 显式加读锁 ： 可用户生成一致性报表，和写锁是冲突的" title="Direct link to 显式加读锁 ： 可用户生成一致性报表，和写锁是冲突的">​</a></h2>
<p>select * from orders  limit 100 lock in share mode;</p>
<h1>MyISAM  select的时候自动加入读锁</h1>
<h1>InnoDB 当插入或更新触发唯一键冲突（如 Duplicate key）时，事务会对冲突的唯一索引加 S 锁，直到事务回滚释放</h1>
<h1>特殊备份操作：使用 CREATE TABLE ... SELECT 语句复制表时，会对原表加 S 锁</h1>
<h1>MDL读锁</h1>
<p>显式读锁（S 锁）与排他锁（X 锁）互斥，若事务 A 持 S 锁，事务 B 尝试加 X 锁会阻塞，可能形成死锁链</p>
<p>不同隔离级别下的读锁行为
READ COMMITTED	普通 SELECT 使用快照读（MVCC），不加锁
REPEATABLE READ	普通 SELECT 同样使用快照读，不加锁
SERIALIZABLE	所有 SELECT 自动转为 SELECT ... LOCK IN SHARE MODE，强制加 S 锁</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="缓冲区innodb">缓冲区(Innodb）<a href="#缓冲区innodb" class="hash-link" aria-label="Direct link to 缓冲区(Innodb）" title="Direct link to 缓冲区(Innodb）">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="buffer-pool缓存数据页和索引页-采用lru算法-1">Buffer Pool：缓存数据页和索引页, 采用lru算法<a href="#buffer-pool缓存数据页和索引页-采用lru算法-1" class="hash-link" aria-label="Direct link to Buffer Pool：缓存数据页和索引页, 采用lru算法" title="Direct link to Buffer Pool：缓存数据页和索引页, 采用lru算法">​</a></h3>
<p>SHOW VARIABLES LIKE &#x27;%innodb_old_blocks_time%&#x27;  冷热数据分离</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="change-pool-缓存非唯一二级索引的变更操作">Change Pool: 缓存非唯一二级索引的变更操作<a href="#change-pool-缓存非唯一二级索引的变更操作" class="hash-link" aria-label="Direct link to Change Pool: 缓存非唯一二级索引的变更操作" title="Direct link to Change Pool: 缓存非唯一二级索引的变更操作">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="log-pool暂存重做日志redo-log和回滚日志undo-log定期批量刷盘默认16mb">Log Pool:暂存重做日志（redo log）和回滚日志（undo log），定期批量刷盘（默认16MB）<a href="#log-pool暂存重做日志redo-log和回滚日志undo-log定期批量刷盘默认16mb" class="hash-link" aria-label="Direct link to Log Pool:暂存重做日志（redo log）和回滚日志（undo log），定期批量刷盘（默认16MB）" title="Direct link to Log Pool:暂存重做日志（redo log）和回滚日志（undo log），定期批量刷盘（默认16MB）">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="自适应哈希索引adaptive-hash-index">自适应哈希索引（Adaptive Hash Index)<a href="#自适应哈希索引adaptive-hash-index" class="hash-link" aria-label="Direct link to 自适应哈希索引（Adaptive Hash Index)" title="Direct link to 自适应哈希索引（Adaptive Hash Index)">​</a></h3>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="服务层buffer均线程私有">服务层buffer，均线程私有<a href="#服务层buffer均线程私有" class="hash-link" aria-label="Direct link to 服务层buffer，均线程私有" title="Direct link to 服务层buffer，均线程私有">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="排序缓冲区sort-buffer用于处理-order-bygroup-bydistinct-等排序操作避免磁盘临时文件sort_buffer_size">排序缓冲区（Sort Buffer）：用于处理 ORDER BY、GROUP BY、DISTINCT 等排序操作，避免磁盘临时文件	sort_buffer_size<a href="#排序缓冲区sort-buffer用于处理-order-bygroup-bydistinct-等排序操作避免磁盘临时文件sort_buffer_size" class="hash-link" aria-label="Direct link to 排序缓冲区（Sort Buffer）：用于处理 ORDER BY、GROUP BY、DISTINCT 等排序操作，避免磁盘临时文件	sort_buffer_size" title="Direct link to 排序缓冲区（Sort Buffer）：用于处理 ORDER BY、GROUP BY、DISTINCT 等排序操作，避免磁盘临时文件	sort_buffer_size">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="连接缓冲区join-buffer优化多表连接如嵌套循环连接缓存关联表的中间结果join_buffer_size">连接缓冲区（Join Buffer）：优化多表连接（如嵌套循环连接），缓存关联表的中间结果	join_buffer_size<a href="#连接缓冲区join-buffer优化多表连接如嵌套循环连接缓存关联表的中间结果join_buffer_size" class="hash-link" aria-label="Direct link to 连接缓冲区（Join Buffer）：优化多表连接（如嵌套循环连接），缓存关联表的中间结果	join_buffer_size" title="Direct link to 连接缓冲区（Join Buffer）：优化多表连接（如嵌套循环连接），缓存关联表的中间结果	join_buffer_size">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="读缓冲区read-buffer提升全表扫描效率预读磁盘数据到内存顺序读场景read_buffer_size">读缓冲区（Read Buffer）：提升全表扫描效率，预读磁盘数据到内存（顺序读场景）	read_buffer_size<a href="#读缓冲区read-buffer提升全表扫描效率预读磁盘数据到内存顺序读场景read_buffer_size" class="hash-link" aria-label="Direct link to 读缓冲区（Read Buffer）：提升全表扫描效率，预读磁盘数据到内存（顺序读场景）	read_buffer_size" title="Direct link to 读缓冲区（Read Buffer）：提升全表扫描效率，预读磁盘数据到内存（顺序读场景）	read_buffer_size">​</a></h3>
<p>INSERT INTO promo_product_platform
(platform_id, <code>name</code>, product_industry)
VALUES</p>
<p>(3878738232100649,&#x27;坦途风云&#x27;,&#x27;NOVEL&#x27;)
,
(962955424384795,&#x27;小说&#x27;,&#x27;NOVEL&#x27;)
,
(6167043057485595,&#x27;女总裁谈情，我被动入坑&#x27;,&#x27;NOVEL&#x27;)</p>
<p>ON DUPLICATE KEY UPDATE
update_time = NOW()</p>
<p>INSERT INTO promo_product_platform
(platform_id, <code>name</code>, product_industry)
VALUES</p>
<p>(962955424384795,&#x27;小说&#x27;,&#x27;NOVEL&#x27;)
,
(3878738232100649,&#x27;坦途风云&#x27;,&#x27;NOVEL&#x27;)
,
(6167043057485595,&#x27;女总裁谈情，我被动入坑&#x27;,&#x27;NOVEL&#x27;)</p>
<p>ON DUPLICATE KEY UPDATE
update_time = NOW()</p>
<p>以上两个sql开启不同的事务，为什么会出现死锁
在于 加锁的顺序 和 INSERT ... ON DUPLICATE KEY UPDATE的特殊加锁机制。
当执行 INSERT ... ON DUPLICATE KEY UPDATE时，InnoDB 需要先检查唯一键约束以判断是插入还是更新。这个过程涉及到锁的获取：</p>
<ol>
<li></li>
</ol>
<p>初步的锁：为了检查重复键，InnoDB 会先尝试以 S Lock（共享锁） 锁定相关的索引记录。共享锁之间不互斥，多个事务可以同时持有 S Lock 读取同一行。</p>
<ol start="2">
<li></li>
</ol>
<p>升级为排他锁：</p>
<p>•
如果记录不存在，S Lock 随后会升级为 X Lock（排他锁） 以执行插入操作。</p>
<p>•
如果记录已存在，并且是 ON DUPLICATE KEY UPDATE，那么 S Lock 也会升级为 X Lock 以执行更新操作。</p>
<ol start="3">
<li></li>
</ol>
<p>关键点：这个加锁过程是逐行进行的，而不是一次性原子地锁定所有行。事务在锁定第一行后，会再去锁定第二行，依此类推。</p>
<p>时间点</p>
<p>事务 T1 (SQL1)</p>
<p>事务 T2 (SQL2)</p>
<p>说明</p>
<p>t1</p>
<p>锁定 行 A (3878738232100649)
(先获得 S Lock，然后升级为 X Lock)</p>
<p>锁定 行 A&#x27; (962955424384795)
(先获得 S Lock，然后升级为 X Lock)</p>
<p>两个事务都成功获得了各自第一条记录的排他锁。</p>
<p>t2</p>
<p>尝试锁定行 B (962955424384795)
(发现该行已被 T2 锁定，进入等待队列)</p>
<p>尝试锁定行 B&#x27; (3878738232100649)
(发现该行已被 T1 锁定，进入等待队列)</p>
<p>死锁发生！
T1 需要 T2 持有的锁（行 B）才能继续；
T2 需要 T1 持有的锁（行 B&#x27;，即行 A）才能继续。</p>
<p>t3</p>
<p>InnoDB 的死锁检测机制被触发，选择其中一个事务（本例中是 T2）进行回滚，以解除死锁。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/MYSQL/mysql-tmp.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/doc/docs/INTERVIEW/MYSQL/MYSQL-REVIEW"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">MYSQL-REVIEW</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/doc/docs/MYSQL/mysql常见命令查询"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">mysql常见命令查询</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#title-mysqlid-mysqldescription-mysqlslug-docsinstallationsidebar_label-mysqlsidebar_position-1tags-mysql" class="table-of-contents__link toc-highlight">title: &quot;MYSQL&quot;
id: MYSQL
description: &quot;MYSQL&quot;
slug: /docs/installation
sidebar_label: &quot;MYSQL&quot;
sidebar_position: 1
tags: [MYSQL]</a></li><li><a href="#mysql结构" class="table-of-contents__link toc-highlight">mysql结构</a></li><li><a href="#架构" class="table-of-contents__link toc-highlight">架构</a><ul><li><a href="#连接层" class="table-of-contents__link toc-highlight">连接层</a></li><li><a href="#服务层" class="table-of-contents__link toc-highlight">服务层</a></li><li><a href="#存储层" class="table-of-contents__link toc-highlight">存储层</a></li><li><a href="#锁" class="table-of-contents__link toc-highlight">锁</a></li><li><a href="#sql执行流程" class="table-of-contents__link toc-highlight">sql执行流程</a></li><li><a href="#mvcc--解决读写冲突" class="table-of-contents__link toc-highlight">MVCC : 解决读写冲突</a></li><li><a href="#主从复制的格式" class="table-of-contents__link toc-highlight">主从复制的格式</a></li><li><a href="#主从复制流程" class="table-of-contents__link toc-highlight">主从复制流程</a></li></ul></li><li><a href="#1-基础与架构" class="table-of-contents__link toc-highlight">1. 基础与架构</a><ul><li><a href="#索引-indexing" class="table-of-contents__link toc-highlight">索引 (Indexing)</a></li><li><a href="#存储引擎-storage-engines" class="table-of-contents__link toc-highlight">存储引擎 (Storage Engines)</a></li><li><a href="#事务-transactions" class="table-of-contents__link toc-highlight">事务 (Transactions)</a></li></ul></li><li><a href="#2-查询性能与优化" class="table-of-contents__link toc-highlight">2. 查询性能与优化</a><ul><li><a href="#执行计划-execution-plans" class="table-of-contents__link toc-highlight">执行计划 (Execution Plans)</a></li><li><a href="#慢查询-slow-queries" class="table-of-contents__link toc-highlight">慢查询 (Slow Queries)</a></li><li><a href="#索引优化" class="table-of-contents__link toc-highlight">索引优化</a></li><li><a href="#join-优化" class="table-of-contents__link toc-highlight">JOIN 优化</a></li><li><a href="#常见陷阱" class="table-of-contents__link toc-highlight">常见陷阱</a></li></ul></li><li><a href="#3-锁与并发控制" class="table-of-contents__link toc-highlight">3. 锁与并发控制</a><ul><li><a href="#锁机制-locking" class="table-of-contents__link toc-highlight">锁机制 (Locking)</a></li><li><a href="#死锁-deadlocks" class="table-of-contents__link toc-highlight">死锁 (Deadlocks)</a></li><li><a href="#隔离级别-isolation-levels" class="table-of-contents__link toc-highlight">隔离级别 (Isolation Levels)</a></li></ul></li><li><a href="#4-复制与高可用性-replication--high-availability" class="table-of-contents__link toc-highlight">4. 复制与高可用性 (Replication &amp; High Availability)</a><ul><li><a href="#主从复制-master-slave-replication" class="table-of-contents__link toc-highlight">主从复制 (Master-Slave Replication)</a></li><li><a href="#故障切换-failover" class="table-of-contents__link toc-highlight">故障切换 (Failover)</a></li><li><a href="#读写分离" class="table-of-contents__link toc-highlight">读写分离</a></li></ul></li><li><a href="#5-模式设计与数据类型" class="table-of-contents__link toc-highlight">5. 模式设计与数据类型</a><ul><li><a href="#范式-vs-反范式" class="table-of-contents__link toc-highlight">范式 vs 反范式</a></li><li><a href="#数据类型选择" class="table-of-contents__link toc-highlight">数据类型选择</a></li><li><a href="#auto-increment-pk-vs-uuid" class="table-of-contents__link toc-highlight">Auto Increment PK vs UUID</a></li></ul></li><li><a href="#6-日志备份与恢复" class="table-of-contents__link toc-highlight">6. 日志、备份与恢复</a><ul><li><a href="#日志文件" class="table-of-contents__link toc-highlight">日志文件</a></li><li><a href="#备份策略" class="table-of-contents__link toc-highlight">备份策略</a></li><li><a href="#恢复演练" class="table-of-contents__link toc-highlight">恢复演练</a></li></ul></li><li><a href="#7-管理与监控" class="table-of-contents__link toc-highlight">7. 管理与监控</a><ul><li><a href="#监控指标" class="table-of-contents__link toc-highlight">监控指标</a></li><li><a href="#连接管理" class="table-of-contents__link toc-highlight">连接管理</a></li></ul></li><li><a href="#8-安全-security" class="table-of-contents__link toc-highlight">8. 安全 (Security)</a><ul><li><a href="#常见威胁" class="table-of-contents__link toc-highlight">常见威胁</a></li><li><a href="#加密" class="table-of-contents__link toc-highlight">加密</a></li></ul></li><li><a href="#9-版本特性与演进" class="table-of-contents__link toc-highlight">9. 版本特性与演进</a></li><li><a href="#10-场景题-开放性问题" class="table-of-contents__link toc-highlight">10. 场景题 (开放性问题)</a><ul><li><a href="#场景一" class="table-of-contents__link toc-highlight">场景一</a></li><li><a href="#场景二" class="table-of-contents__link toc-highlight">场景二</a></li><li><a href="#经验分享" class="table-of-contents__link toc-highlight">经验分享</a></li><li><a href="#架构考量" class="table-of-contents__link toc-highlight">架构考量</a></li></ul></li><li><a href="#sql优化逻辑" class="table-of-contents__link toc-highlight">sql优化逻辑</a><ul><li><a href="#查询语句优化" class="table-of-contents__link toc-highlight">查询语句优化</a></li><li><a href="#-二索引优化" class="table-of-contents__link toc-highlight">📌 二、索引优化</a></li><li><a href="#-三表结构与数据类型优化" class="table-of-contents__link toc-highlight">🧱 三、表结构与数据类型优化</a></li><li><a href="#️-四配置参数与存储引擎" class="table-of-contents__link toc-highlight">⚙️ 四、配置参数与存储引擎</a></li><li><a href="#上缓存读写分离" class="table-of-contents__link toc-highlight">上缓存/读写分离</a></li></ul></li><li><a href="#缓冲区" class="table-of-contents__link toc-highlight">缓冲区</a><ul><li><a href="#buffer-pool缓存数据页和索引页-采用lru算法" class="table-of-contents__link toc-highlight">Buffer Pool：缓存数据页和索引页, 采用lru算法</a></li></ul></li><li><a href="#显式加读锁--可用户生成一致性报表和写锁是冲突的" class="table-of-contents__link toc-highlight">显式加读锁 ： 可用户生成一致性报表，和写锁是冲突的</a></li><li><a href="#缓冲区innodb" class="table-of-contents__link toc-highlight">缓冲区(Innodb）</a><ul><li><a href="#buffer-pool缓存数据页和索引页-采用lru算法-1" class="table-of-contents__link toc-highlight">Buffer Pool：缓存数据页和索引页, 采用lru算法</a></li><li><a href="#change-pool-缓存非唯一二级索引的变更操作" class="table-of-contents__link toc-highlight">Change Pool: 缓存非唯一二级索引的变更操作</a></li><li><a href="#log-pool暂存重做日志redo-log和回滚日志undo-log定期批量刷盘默认16mb" class="table-of-contents__link toc-highlight">Log Pool:暂存重做日志（redo log）和回滚日志（undo log），定期批量刷盘（默认16MB）</a></li><li><a href="#自适应哈希索引adaptive-hash-index" class="table-of-contents__link toc-highlight">自适应哈希索引（Adaptive Hash Index)</a></li></ul></li><li><a href="#服务层buffer均线程私有" class="table-of-contents__link toc-highlight">服务层buffer，均线程私有</a><ul><li><a href="#排序缓冲区sort-buffer用于处理-order-bygroup-bydistinct-等排序操作避免磁盘临时文件sort_buffer_size" class="table-of-contents__link toc-highlight">排序缓冲区（Sort Buffer）：用于处理 ORDER BY、GROUP BY、DISTINCT 等排序操作，避免磁盘临时文件	sort_buffer_size</a></li><li><a href="#连接缓冲区join-buffer优化多表连接如嵌套循环连接缓存关联表的中间结果join_buffer_size" class="table-of-contents__link toc-highlight">连接缓冲区（Join Buffer）：优化多表连接（如嵌套循环连接），缓存关联表的中间结果	join_buffer_size</a></li><li><a href="#读缓冲区read-buffer提升全表扫描效率预读磁盘数据到内存顺序读场景read_buffer_size" class="table-of-contents__link toc-highlight">读缓冲区（Read Buffer）：提升全表扫描效率，预读磁盘数据到内存（顺序读场景）	read_buffer_size</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/doc/docs/intro">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/doc/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>